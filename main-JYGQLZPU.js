var hI=Object.defineProperty,pI=Object.defineProperties;var mI=Object.getOwnPropertyDescriptors;var q0=Object.getOwnPropertySymbols;var gI=Object.prototype.hasOwnProperty,yI=Object.prototype.propertyIsEnumerable;var $0=(n,e,t)=>e in n?hI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ue=(n,e)=>{for(var t in e||={})gI.call(e,t)&&$0(n,t,e[t]);if(q0)for(var t of q0(e))yI.call(e,t)&&$0(n,t,e[t]);return n},it=(n,e)=>pI(n,mI(e));var Fp;function Mu(){return Fp}function qi(n){let e=Fp;return Fp=n,e}var Y0=Symbol("NotFound");function Rs(n){return n===Y0||n?.name==="\u0275NotFound"}var Mn=null,Cu=!1,Op=1,vI=null,gn=Symbol("SIGNAL");function Pe(n){let e=Mn;return Mn=n,e}function Au(){return Mn}var Ro={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Ns(n){if(Cu)throw new Error("");if(Mn===null)return;Mn.consumerOnSignalRead(n);let e=Mn.producersTail;if(e!==void 0&&e.producer===n)return;let t,i=Mn.recomputing;if(i&&(t=e!==void 0?e.nextProducer:Mn.producers,t!==void 0&&t.producer===n)){Mn.producersTail=t,t.lastReadVersion=n.version;return}let r=n.consumersTail;if(r!==void 0&&r.consumer===Mn&&(!i||EI(r,Mn)))return;let o=Fs(Mn),s={producer:n,consumer:Mn,nextProducer:t,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};Mn.producersTail=s,e!==void 0?e.nextProducer=s:Mn.producers=s,o&&Z0(n,s)}function X0(){Op++}function Du(n){if(!(Fs(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===Op)){if(!n.producerMustRecompute(n)&&!Ls(n)){Iu(n);return}n.producerRecomputeValue(n),Iu(n)}}function kp(n){if(n.consumers===void 0)return;let e=Cu;Cu=!0;try{for(let t=n.consumers;t!==void 0;t=t.nextConsumer){let i=t.consumer;i.dirty||_I(i)}}finally{Cu=e}}function Up(){return Mn?.consumerAllowSignalWrites!==!1}function _I(n){n.dirty=!0,kp(n),n.consumerMarkedDirty?.(n)}function Iu(n){n.dirty=!1,n.lastCleanEpoch=Op}function No(n){return n&&J0(n),Pe(n)}function J0(n){n.producersTail=void 0,n.recomputing=!0}function Ps(n,e){Pe(e),n&&j0(n)}function j0(n){n.recomputing=!1;let e=n.producersTail,t=e!==void 0?e.nextProducer:n.producers;if(t!==void 0){if(Fs(n))do t=Bp(t);while(t!==void 0);e!==void 0?e.nextProducer=void 0:n.producers=void 0}}function Ls(n){for(let e=n.producers;e!==void 0;e=e.nextProducer){let t=e.producer,i=e.lastReadVersion;if(i!==t.version||(Du(t),i!==t.version))return!0}return!1}function Po(n){if(Fs(n)){let e=n.producers;for(;e!==void 0;)e=Bp(e)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function Z0(n,e){let t=n.consumersTail,i=Fs(n);if(t!==void 0?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,n.consumers=e),e.prevConsumer=t,n.consumersTail=e,!i)for(let r=n.producers;r!==void 0;r=r.nextProducer)Z0(r.producer,r)}function Bp(n){let e=n.producer,t=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,i!==void 0?i.prevConsumer=r:e.consumersTail=r,r!==void 0)r.nextConsumer=i;else if(e.consumers=i,!Fs(e)){let o=e.producers;for(;o!==void 0;)o=Bp(o)}return t}function Fs(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function Ru(n){vI?.(n)}function EI(n,e){let t=e.producersTail;if(t!==void 0){let i=e.producers;do{if(i===n)return!0;if(i===t)break;i=i.nextProducer}while(i!==void 0)}return!1}function Nu(n,e){return Object.is(n,e)}function Pu(n,e){let t=Object.create(xI);t.computation=n,e!==void 0&&(t.equal=e);let i=()=>{if(Du(t),Ns(t),t.value===Pl)throw t.error;return t.value};return i[gn]=t,Ru(t),i}var wu=Symbol("UNSET"),bu=Symbol("COMPUTING"),Pl=Symbol("ERRORED"),xI=it(ue({},Ro),{value:wu,dirty:!0,error:null,equal:Nu,kind:"computed",producerMustRecompute(n){return n.value===wu||n.value===bu},producerRecomputeValue(n){if(n.value===bu)throw new Error("");let e=n.value;n.value=bu;let t=No(n),i,r=!1;try{i=n.computation(),Pe(null),r=e!==wu&&e!==Pl&&i!==Pl&&n.equal(e,i)}catch(o){i=Pl,n.error=o}finally{Ps(n,t)}if(r){n.value=e;return}n.value=i,n.version++}});function SI(){throw new Error}var K0=SI;function Q0(n){K0(n)}function Vp(n){K0=n}var TI=null;function Hp(n,e){let t=Object.create(Lu);t.value=n,e!==void 0&&(t.equal=e);let i=()=>eE(t);return i[gn]=t,Ru(t),[i,s=>Os(t,s),s=>zp(t,s)]}function eE(n){return Ns(n),n.value}function Os(n,e){Up()||Q0(n),n.equal(n.value,e)||(n.value=e,MI(n))}function zp(n,e){Up()||Q0(n),Os(n,e(n.value))}var Lu=it(ue({},Ro),{equal:Nu,value:void 0,kind:"signal"});function MI(n){n.version++,X0(),kp(n),TI?.(n)}function Ve(n){return typeof n=="function"}function ks(n){let t=n(i=>{Error.call(i),i.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Fu=ks(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Ll(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Yt=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let o of t)o.remove(this);else t.remove(this);let{initialTeardown:i}=this;if(Ve(i))try{i()}catch(o){e=o instanceof Fu?o.errors:[o]}let{_finalizers:r}=this;if(r){this._finalizers=null;for(let o of r)try{tE(o)}catch(s){e=e??[],s instanceof Fu?e=[...e,...s.errors]:e.push(s)}}if(e)throw new Fu(e)}}add(e){var t;if(e&&e!==this)if(this.closed)tE(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Ll(t,e)}remove(e){let{_finalizers:t}=this;t&&Ll(t,e),e instanceof n&&e._removeParent(this)}};Yt.EMPTY=(()=>{let n=new Yt;return n.closed=!0,n})();var Gp=Yt.EMPTY;function Ou(n){return n instanceof Yt||n&&"closed"in n&&Ve(n.remove)&&Ve(n.add)&&Ve(n.unsubscribe)}function tE(n){Ve(n)?n():n.unsubscribe()}var Ci={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Us={setTimeout(n,e,...t){let{delegate:i}=Us;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=Us;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function ku(n){Us.setTimeout(()=>{let{onUnhandledError:e}=Ci;if(e)e(n);else throw n})}function Fl(){}var nE=Wp("C",void 0,void 0);function iE(n){return Wp("E",void 0,n)}function rE(n){return Wp("N",n,void 0)}function Wp(n,e,t){return{kind:n,value:e,error:t}}var Lo=null;function Bs(n){if(Ci.useDeprecatedSynchronousErrorHandling){let e=!Lo;if(e&&(Lo={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:i}=Lo;if(Lo=null,t)throw i}}else n()}function oE(n){Ci.useDeprecatedSynchronousErrorHandling&&Lo&&(Lo.errorThrown=!0,Lo.error=n)}var Fo=class extends Yt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Ou(e)&&e.add(this)):this.destination=bI}static create(e,t,i){return new Vs(e,t,i)}next(e){this.isStopped?$p(rE(e),this):this._next(e)}error(e){this.isStopped?$p(iE(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?$p(nE,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},CI=Function.prototype.bind;function qp(n,e){return CI.call(n,e)}var Yp=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Uu(i)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Uu(i)}else Uu(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Uu(t)}}},Vs=class extends Fo{constructor(e,t,i){super();let r;if(Ve(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let o;this&&Ci.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&qp(e.next,o),error:e.error&&qp(e.error,o),complete:e.complete&&qp(e.complete,o)}):r=e}this.destination=new Yp(r)}};function Uu(n){Ci.useDeprecatedSynchronousErrorHandling?oE(n):ku(n)}function wI(n){throw n}function $p(n,e){let{onStoppedNotification:t}=Ci;t&&Us.setTimeout(()=>t(n,e))}var bI={closed:!0,next:Fl,error:wI,complete:Fl};var Hs=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Xn(n){return n}function Xp(...n){return Jp(n)}function Jp(n){return n.length===0?Xn:n.length===1?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}var yt=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){let o=AI(t)?t:new Vs(t,i,r);return Bs(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return i=sE(i),new i((r,o)=>{let s=new Vs({next:a=>{try{t(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(t){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(t)}[Hs](){return this}pipe(...t){return Jp(t)(this)}toPromise(t){return t=sE(t),new t((i,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>i(o))})}}return n.create=e=>new n(e),n})();function sE(n){var e;return(e=n??Ci.Promise)!==null&&e!==void 0?e:Promise}function II(n){return n&&Ve(n.next)&&Ve(n.error)&&Ve(n.complete)}function AI(n){return n&&n instanceof Fo||II(n)&&Ou(n)}function jp(n){return Ve(n?.lift)}function pt(n){return e=>{if(jp(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function mt(n,e,t,i,r){return new Zp(n,e,t,i,r)}var Zp=class extends Fo{constructor(e,t,i,r,o,s){super(e),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function zs(){return pt((n,e)=>{let t=null;n._refCount++;let i=mt(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var Gs=class extends yt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,jp(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Yt;let t=this.getSubject();e.add(this.source.subscribe(mt(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Yt.EMPTY)}return e}refCount(){return zs()(this)}};var aE=ks(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var tn=(()=>{class n extends yt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let i=new Bu(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new aE}next(t){Bs(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(t)}})}error(t){Bs(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Bs(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:i,isStopped:r,observers:o}=this;return i||r?Gp:(this.currentObservers=null,o.push(t),new Yt(()=>{this.currentObservers=null,Ll(o,t)}))}_checkFinalizedStatuses(t){let{hasError:i,thrownError:r,isStopped:o}=this;i?t.error(r):o&&t.complete()}asObservable(){let t=new yt;return t.source=this,t}}return n.create=(e,t)=>new Bu(e,t),n})(),Bu=class extends tn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.next)===null||i===void 0||i.call(t,e)}error(e){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.error)===null||i===void 0||i.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,i;return(i=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&i!==void 0?i:Gp}};var yn=class extends tn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};var Bn=new yt(n=>n.complete());function lE(n){return n&&Ve(n.schedule)}function cE(n){return n[n.length-1]}function uE(n){return Ve(cE(n))?n.pop():void 0}function Xr(n){return lE(cE(n))?n.pop():void 0}function fE(n,e,t,i){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(i.next(u))}catch(f){s(f)}}function l(u){try{c(i.throw(u))}catch(f){s(f)}}function c(u){u.done?o(u.value):r(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}function dE(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Oo(n){return this instanceof Oo?(this.v=n,this):new Oo(n)}function hE(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(m){return function(v){return Promise.resolve(v).then(m,f)}}function a(m,v){i[m]&&(r[m]=function(_){return new Promise(function(y,g){o.push([m,_,y,g])>1||l(m,_)})},v&&(r[m]=v(r[m])))}function l(m,v){try{c(i[m](v))}catch(_){p(o[0][3],_)}}function c(m){m.value instanceof Oo?Promise.resolve(m.value.v).then(u,f):p(o[0][2],m)}function u(m){l("next",m)}function f(m){l("throw",m)}function p(m,v){m(v),o.shift(),o.length&&l(o[0][0],o[0][1])}}function pE(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof dE=="function"?dE(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(s){return new Promise(function(a,l){s=n[o](s),r(a,l,s.done,s.value)})}}function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}var Vu=n=>n&&typeof n.length=="number"&&typeof n!="function";function Hu(n){return Ve(n?.then)}function zu(n){return Ve(n[Hs])}function Gu(n){return Symbol.asyncIterator&&Ve(n?.[Symbol.asyncIterator])}function Wu(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function DI(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var qu=DI();function $u(n){return Ve(n?.[qu])}function Yu(n){return hE(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:i,done:r}=yield Oo(t.read());if(r)return yield Oo(void 0);yield yield Oo(i)}}finally{t.releaseLock()}})}function Xu(n){return Ve(n?.getReader)}function ln(n){if(n instanceof yt)return n;if(n!=null){if(zu(n))return RI(n);if(Vu(n))return NI(n);if(Hu(n))return PI(n);if(Gu(n))return mE(n);if($u(n))return LI(n);if(Xu(n))return FI(n)}throw Wu(n)}function RI(n){return new yt(e=>{let t=n[Hs]();if(Ve(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function NI(n){return new yt(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function PI(n){return new yt(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ku)})}function LI(n){return new yt(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function mE(n){return new yt(e=>{OI(n,e).catch(t=>e.error(t))})}function FI(n){return mE(Yu(n))}function OI(n,e){var t,i,r,o;return fE(this,void 0,void 0,function*(){try{for(t=pE(n);i=yield t.next(),!i.done;){let s=i.value;if(e.next(s),e.closed)return}}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=t.return)&&(yield o.call(t))}finally{if(r)throw r.error}}e.complete()})}function Vn(n,e,t,i=0,r=!1){let o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function Ju(n,e=0){return pt((t,i)=>{t.subscribe(mt(i,r=>Vn(i,n,()=>i.next(r),e),()=>Vn(i,n,()=>i.complete(),e),r=>Vn(i,n,()=>i.error(r),e)))})}function ju(n,e=0){return pt((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function gE(n,e){return ln(n).pipe(ju(e),Ju(e))}function yE(n,e){return ln(n).pipe(ju(e),Ju(e))}function vE(n,e){return new yt(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}function _E(n,e){return new yt(t=>{let i;return Vn(t,e,()=>{i=n[qu](),Vn(t,e,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(s){t.error(s);return}o?t.complete():t.next(r)},0,!0)}),()=>Ve(i?.return)&&i.return()})}function Zu(n,e){if(!n)throw new Error("Iterable cannot be null");return new yt(t=>{Vn(t,e,()=>{let i=n[Symbol.asyncIterator]();Vn(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function EE(n,e){return Zu(Yu(n),e)}function xE(n,e){if(n!=null){if(zu(n))return gE(n,e);if(Vu(n))return vE(n,e);if(Hu(n))return yE(n,e);if(Gu(n))return Zu(n,e);if($u(n))return _E(n,e);if(Xu(n))return EE(n,e)}throw Wu(n)}function Gt(n,e){return e?xE(n,e):ln(n)}function Le(...n){let e=Xr(n);return Gt(n,e)}function Ws(n,e){let t=Ve(n)?n:()=>n,i=r=>r.error(t());return new yt(e?r=>e.schedule(i,0,r):i)}function Kp(n){return!!n&&(n instanceof yt||Ve(n.lift)&&Ve(n.subscribe))}var fr=ks(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function gt(n,e){return pt((t,i)=>{let r=0;t.subscribe(mt(i,o=>{i.next(n.call(e,o,r++))}))})}var{isArray:kI}=Array;function UI(n,e){return kI(e)?n(...e):n(e)}function SE(n){return gt(e=>UI(n,e))}var{isArray:BI}=Array,{getPrototypeOf:VI,prototype:HI,keys:zI}=Object;function TE(n){if(n.length===1){let e=n[0];if(BI(e))return{args:e,keys:null};if(GI(e)){let t=zI(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}function GI(n){return n&&typeof n=="object"&&VI(n)===HI}function ME(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function Ku(...n){let e=Xr(n),t=uE(n),{args:i,keys:r}=TE(n);if(i.length===0)return Gt([],e);let o=new yt(WI(i,e,r?s=>ME(r,s):Xn));return t?o.pipe(SE(t)):o}function WI(n,e,t=Xn){return i=>{CE(e,()=>{let{length:r}=n,o=new Array(r),s=r,a=r;for(let l=0;l<r;l++)CE(e,()=>{let c=Gt(n[l],e),u=!1;c.subscribe(mt(i,f=>{o[l]=f,u||(u=!0,a--),a||i.next(t(o.slice()))},()=>{--s||i.complete()}))},i)},i)}}function CE(n,e,t){n?Vn(t,n,e):e()}function wE(n,e,t,i,r,o,s,a){let l=[],c=0,u=0,f=!1,p=()=>{f&&!l.length&&!c&&e.complete()},m=_=>c<i?v(_):l.push(_),v=_=>{o&&e.next(_),c++;let y=!1;ln(t(_,u++)).subscribe(mt(e,g=>{r?.(g),o?m(g):e.next(g)},()=>{y=!0},void 0,()=>{if(y)try{for(c--;l.length&&c<i;){let g=l.shift();s?Vn(e,s,()=>v(g)):v(g)}p()}catch(g){e.error(g)}}))};return n.subscribe(mt(e,m,()=>{f=!0,p()})),()=>{a?.()}}function Xt(n,e,t=1/0){return Ve(e)?Xt((i,r)=>gt((o,s)=>e(i,o,r,s))(ln(n(i,r))),t):(typeof e=="number"&&(t=e),pt((i,r)=>wE(i,r,n,t)))}function qs(n=1/0){return Xt(Xn,n)}function bE(){return qs(1)}function $s(...n){return bE()(Gt(n,Xr(n)))}function Ol(n){return new yt(e=>{ln(n()).subscribe(e)})}function Jn(n,e){return pt((t,i)=>{let r=0;t.subscribe(mt(i,o=>n.call(e,o,r++)&&i.next(o)))})}function hr(n){return pt((e,t)=>{let i=null,r=!1,o;i=e.subscribe(mt(t,void 0,void 0,s=>{o=ln(n(s,hr(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function IE(n,e,t,i,r){return(o,s)=>{let a=t,l=e,c=0;o.subscribe(mt(s,u=>{let f=c++;l=a?n(l,u,f):(a=!0,u),i&&s.next(l)},r&&(()=>{a&&s.next(l),s.complete()})))}}function ko(n,e){return Ve(e)?Xt(n,e,1):Xt(n,1)}function Jr(n){return pt((e,t)=>{let i=!1;e.subscribe(mt(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function pr(n){return n<=0?()=>Bn:pt((e,t)=>{let i=0;e.subscribe(mt(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function Qu(n=qI){return pt((e,t)=>{let i=!1;e.subscribe(mt(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function qI(){return new fr}function kl(n){return pt((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function mr(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Jn((r,o)=>n(r,o,i)):Xn,pr(1),t?Jr(e):Qu(()=>new fr))}function Ys(n){return n<=0?()=>Bn:pt((e,t)=>{let i=[];e.subscribe(mt(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function Qp(n,e){let t=arguments.length>=2;return i=>i.pipe(n?Jn((r,o)=>n(r,o,i)):Xn,Ys(1),t?Jr(e):Qu(()=>new fr))}function em(n,e){return pt(IE(n,e,arguments.length>=2,!0))}function tm(...n){let e=Xr(n);return pt((t,i)=>{(e?$s(n,t,e):$s(n,t)).subscribe(i)})}function Hn(n,e){return pt((t,i)=>{let r=null,o=0,s=!1,a=()=>s&&!r&&i.complete();t.subscribe(mt(i,l=>{r?.unsubscribe();let c=0,u=o++;ln(n(l,u)).subscribe(r=mt(i,f=>i.next(e?e(l,f,u,c++):f),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function ed(n){return pt((e,t)=>{ln(n).subscribe(mt(t,()=>t.complete(),Fl)),!t.closed&&e.subscribe(t)})}function cn(n,e,t){let i=Ve(n)||e||t?{next:n,error:e,complete:t}:n;return i?pt((r,o)=>{var s;(s=i.subscribe)===null||s===void 0||s.call(i);let a=!0;r.subscribe(mt(o,l=>{var c;(c=i.next)===null||c===void 0||c.call(i,l),o.next(l)},()=>{var l;a=!1,(l=i.complete)===null||l===void 0||l.call(i),o.complete()},l=>{var c;a=!1,(c=i.error)===null||c===void 0||c.call(i,l),o.error(l)},()=>{var l,c;a&&((l=i.unsubscribe)===null||l===void 0||l.call(i)),(c=i.finalize)===null||c===void 0||c.call(i)}))}):Xn}function AE(n){let e=Pe(null);try{return n()}finally{Pe(e)}}var DE=it(ue({},Ro),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,kind:"effect"});function RE(n){if(n.dirty=!1,n.version>0&&!Ls(n))return;n.version++;let e=No(n);try{n.cleanup(),n.fn()}finally{Ps(n,e)}}var od="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",Te=class extends Error{code;constructor(e,t){super(Js(e,t)),this.code=e}};function $I(n){return`NG0${Math.abs(n)}`}function Js(n,e){return`${$I(n)}${e?": "+e:""}`}var zl=globalThis;function Tt(n){for(let e in n)if(n[e]===Tt)return e;throw Error("")}function yr(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(yr).join(", ")}]`;if(n==null)return""+n;let e=n.overriddenName||n.name;if(e)return`${e}`;let t=n.toString();if(t==null)return""+t;let i=t.indexOf(`
`);return i>=0?t.slice(0,i):t}function fm(n,e){return n?e?`${n} ${e}`:n:e||""}var YI=Tt({__forward_ref__:Tt});function sd(n){return n.__forward_ref__=sd,n.toString=function(){return yr(this())},n}function zn(n){return hm(n)?n():n}function hm(n){return typeof n=="function"&&n.hasOwnProperty(YI)&&n.__forward_ref__===sd}function Ae(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Gl(n){return XI(n,ad)}function pm(n){return Gl(n)!==null}function XI(n,e){return n.hasOwnProperty(e)&&n[e]||null}function JI(n){let e=n?.[ad]??null;return e||null}function im(n){return n&&n.hasOwnProperty(nd)?n[nd]:null}var ad=Tt({\u0275prov:Tt}),nd=Tt({\u0275inj:Tt}),Oe=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=Ae({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function mm(n){return n&&!!n.\u0275providers}var gm=Tt({\u0275cmp:Tt}),ym=Tt({\u0275dir:Tt}),vm=Tt({\u0275pipe:Tt}),_m=Tt({\u0275mod:Tt}),Bl=Tt({\u0275fac:Tt}),zo=Tt({__NG_ELEMENT_ID__:Tt}),NE=Tt({__NG_ENV_ID__:Tt});function Go(n){return typeof n=="string"?n:n==null?"":String(n)}function LE(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():Go(n)}var FE=Tt({ngErrorCode:Tt}),jI=Tt({ngErrorMessage:Tt}),ZI=Tt({ngTokenPath:Tt});function Em(n,e){return OE("",-200,e)}function ld(n,e){throw new Te(-201,!1)}function OE(n,e,t){let i=new Te(e,n);return i[FE]=e,i[jI]=n,t&&(i[ZI]=t),i}function KI(n){return n[FE]}var rm;function kE(){return rm}function jn(n){let e=rm;return rm=n,e}function xm(n,e,t){let i=Gl(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(t&8)return null;if(e!==void 0)return e;ld(n,"Injector")}var QI={},Uo=QI,eA="__NG_DI_FLAG__",om=class{injector;constructor(e){this.injector=e}retrieve(e,t){let i=Bo(t)||0;try{return this.injector.get(e,i&8?null:Uo,i)}catch(r){if(Rs(r))return r;throw r}}};function tA(n,e=0){let t=Mu();if(t===void 0)throw new Te(-203,!1);if(t===null)return xm(n,void 0,e);{let i=nA(e),r=t.retrieve(n,i);if(Rs(r)){if(i.optional)return null;throw r}return r}}function Ue(n,e=0){return(kE()||tA)(zn(n),e)}function se(n,e){return Ue(n,Bo(e))}function Bo(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function nA(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function sm(n){let e=[];for(let t=0;t<n.length;t++){let i=zn(n[t]);if(Array.isArray(i)){if(i.length===0)throw new Te(900,!1);let r,o=0;for(let s=0;s<i.length;s++){let a=i[s],l=iA(a);typeof l=="number"?l===-1?r=a.token:o|=l:r=a}e.push(Ue(r,o))}else e.push(Ue(i))}return e}function iA(n){return n[eA]}function Vo(n,e){let t=n.hasOwnProperty(Bl);return t?n[Bl]:null}function UE(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=e[i];if(t&&(r=t(r),o=t(o)),o!==r)return!1}return!0}function BE(n){return n.flat(Number.POSITIVE_INFINITY)}function cd(n,e){n.forEach(t=>Array.isArray(t)?cd(t,e):e(t))}function Sm(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Wl(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function VE(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(r===1)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;){let o=r-2;n[r]=n[o],r--}n[e]=t,n[e+1]=i}}function HE(n,e,t){let i=js(n,e);return i>=0?n[i|1]=t:(i=~i,VE(n,i,e,t)),i}function ud(n,e){let t=js(n,e);if(t>=0)return n[t|1]}function js(n,e){return rA(n,e,1)}function rA(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){let o=i+(r-i>>1),s=n[o<<t];if(e===s)return o<<t;s>e?r=o:i=o+1}return~(r<<t)}var Wo={},vr=[],Zr=new Oe(""),Tm=new Oe("",-1),Mm=new Oe(""),Vl=class{get(e,t=Uo){if(t===Uo){let r=OE("",-201);throw r.name="\u0275NotFound",r}return t}};function Cm(n){return n[_m]||null}function Kr(n){return n[gm]||null}function wm(n){return n[ym]||null}function zE(n){return n[vm]||null}function ql(n){return{\u0275providers:n}}function GE(...n){return{\u0275providers:bm(!0,n),\u0275fromNgModule:!0}}function bm(n,...e){let t=[],i=new Set,r,o=s=>{t.push(s)};return cd(e,s=>{let a=s;id(a,o,[],i)&&(r||=[],r.push(a))}),r!==void 0&&WE(r,o),t}function WE(n,e){for(let t=0;t<n.length;t++){let{ngModule:i,providers:r}=n[t];Im(r,o=>{e(o,i)})}}function id(n,e,t,i){if(n=zn(n),!n)return!1;let r=null,o=im(n),s=!o&&Kr(n);if(!o&&!s){let l=n.ngModule;if(o=im(l),o)r=l;else return!1}else{if(s&&!s.standalone)return!1;r=n}let a=i.has(r);if(s){if(a)return!1;if(i.add(r),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)id(c,e,t,i)}}else if(o){if(o.imports!=null&&!a){i.add(r);let c;try{cd(o.imports,u=>{id(u,e,t,i)&&(c||=[],c.push(u))})}finally{}c!==void 0&&WE(c,e)}if(!a){let c=Vo(r)||(()=>new r);e({provide:r,useFactory:c,deps:vr},r),e({provide:Mm,useValue:r,multi:!0},r),e({provide:Zr,useValue:()=>Ue(r),multi:!0},r)}let l=o.providers;if(l!=null&&!a){let c=n;Im(l,u=>{e(u,c)})}}else return!1;return r!==n&&n.providers!==void 0}function Im(n,e){for(let t of n)mm(t)&&(t=t.\u0275providers),Array.isArray(t)?Im(t,e):e(t)}var oA=Tt({provide:String,useValue:Tt});function qE(n){return n!==null&&typeof n=="object"&&oA in n}function sA(n){return!!(n&&n.useExisting)}function aA(n){return!!(n&&n.useFactory)}function rd(n){return typeof n=="function"}var $l=new Oe(""),td={},PE={},nm;function Yl(){return nm===void 0&&(nm=new Vl),nm}var un=class{},Ho=class extends un{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,lm(e,s=>this.processProvider(s)),this.records.set(Tm,Xs(void 0,this)),r.has("environment")&&this.records.set(un,Xs(void 0,this));let o=this.records.get($l);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(Mm,vr,{self:!0}))}retrieve(e,t){let i=Bo(t)||0;try{return this.get(e,Uo,i)}catch(r){if(Rs(r))return r;throw r}}destroy(){Ul(this),this._destroyed=!0;let e=Pe(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Pe(e)}}onDestroy(e){return Ul(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){Ul(this);let t=qi(this),i=jn(void 0),r;try{return e()}finally{qi(t),jn(i)}}get(e,t=Uo,i){if(Ul(this),e.hasOwnProperty(NE))return e[NE](this);let r=Bo(i),o,s=qi(this),a=jn(void 0);try{if(!(r&4)){let c=this.records.get(e);if(c===void 0){let u=fA(e)&&Gl(e);u&&this.injectableDefInScope(u)?c=Xs(am(e),td):c=null,this.records.set(e,c)}if(c!=null)return this.hydrate(e,c,r)}let l=r&2?Yl():this.parent;return t=r&8&&t===Uo?null:t,l.get(e,t)}catch(l){let c=KI(l);throw c===-200||c===-201?new Te(c,null):l}finally{jn(a),qi(s)}}resolveInjectorInitializers(){let e=Pe(null),t=qi(this),i=jn(void 0),r;try{let o=this.get(Zr,vr,{self:!0});for(let s of o)s()}finally{qi(t),jn(i),Pe(e)}}toString(){let e=[],t=this.records;for(let i of t.keys())e.push(yr(i));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=zn(e);let t=rd(e)?e:zn(e&&e.provide),i=cA(e);if(!rd(e)&&e.multi===!0){let r=this.records.get(t);r||(r=Xs(void 0,td,!0),r.factory=()=>sm(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t,i){let r=Pe(null);try{if(t.value===PE)throw Em(yr(e));return t.value===td&&(t.value=PE,t.value=t.factory(void 0,i)),typeof t.value=="object"&&t.value&&dA(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{Pe(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=zn(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function am(n){let e=Gl(n),t=e!==null?e.factory:Vo(n);if(t!==null)return t;if(n instanceof Oe)throw new Te(204,!1);if(n instanceof Function)return lA(n);throw new Te(204,!1)}function lA(n){if(n.length>0)throw new Te(204,!1);let t=JI(n);return t!==null?()=>t.factory(n):()=>new n}function cA(n){if(qE(n))return Xs(void 0,n.useValue);{let e=$E(n);return Xs(e,td)}}function $E(n,e,t){let i;if(rd(n)){let r=zn(n);return Vo(r)||am(r)}else if(qE(n))i=()=>zn(n.useValue);else if(aA(n))i=()=>n.useFactory(...sm(n.deps||[]));else if(sA(n))i=(r,o)=>Ue(zn(n.useExisting),o!==void 0&&o&8?8:void 0);else{let r=zn(n&&(n.useClass||n.provide));if(uA(n))i=()=>new r(...sm(n.deps));else return Vo(r)||am(r)}return i}function Ul(n){if(n.destroyed)throw new Te(205,!1)}function Xs(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function uA(n){return!!n.deps}function dA(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function fA(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function lm(n,e){for(let t of n)Array.isArray(t)?lm(t,e):t&&mm(t)?lm(t.\u0275providers,e):e(t)}function Pn(n,e){let t;n instanceof Ho?(Ul(n),t=n):t=new om(n);let i,r=qi(t),o=jn(void 0);try{return e()}finally{qi(r),jn(o)}}function YE(){return kE()!==void 0||Mu()!=null}var bi=0,De=1,Fe=2,nn=3,di=4,fi=5,Zs=6,Ks=7,Wt=8,Qr=9,Yi=10,Ht=11,Qs=12,Am=13,qo=14,Zn=15,eo=16,$o=17,Xi=18,Xl=19,Dm=20,gr=21,dd=22,_r=23,Kn=24,fd=25,Yo=26,dn=27,XE=1,Rm=6,to=7,Jl=8,Xo=9,Jt=10;function Ji(n){return Array.isArray(n)&&typeof n[XE]=="object"}function Ii(n){return Array.isArray(n)&&n[XE]===!0}function Nm(n){return(n.flags&4)!==0}function no(n){return n.componentOffset>-1}function hd(n){return(n.flags&1)===1}function Jo(n){return!!n.template}function ea(n){return(n[Fe]&512)!==0}function jo(n){return(n[Fe]&256)===256}var Pm="svg",JE="math";function hi(n){for(;Array.isArray(n);)n=n[bi];return n}function Lm(n,e){return hi(e[n])}function Ai(n,e){return hi(e[n.index])}function jl(n,e){return n.data[e]}function jE(n,e){return n[e]}function pi(n,e){let t=e[n];return Ji(t)?t:t[bi]}function ZE(n){return(n[Fe]&4)===4}function pd(n){return(n[Fe]&128)===128}function KE(n){return Ii(n[nn])}function ji(n,e){return e==null?null:n[e]}function Fm(n){n[$o]=0}function Om(n){n[Fe]&1024||(n[Fe]|=1024,pd(n)&&Zo(n))}function QE(n,e){for(;n>0;)e=e[qo],n--;return e}function Zl(n){return!!(n[Fe]&9216||n[Kn]?.dirty)}function md(n){n[Yi].changeDetectionScheduler?.notify(8),n[Fe]&64&&(n[Fe]|=1024),Zl(n)&&Zo(n)}function Zo(n){n[Yi].changeDetectionScheduler?.notify(0);let e=jr(n);for(;e!==null&&!(e[Fe]&8192||(e[Fe]|=8192,!pd(e)));)e=jr(e)}function km(n,e){if(jo(n))throw new Te(911,!1);n[gr]===null&&(n[gr]=[]),n[gr].push(e)}function ex(n,e){if(n[gr]===null)return;let t=n[gr].indexOf(e);t!==-1&&n[gr].splice(t,1)}function jr(n){let e=n[nn];return Ii(e)?e[nn]:e}function Um(n){return n[Ks]??=[]}function Bm(n){return n.cleanup??=[]}function tx(n,e,t,i){let r=Um(e);r.push(t),n.firstCreatePass&&Bm(n).push(i,r.length-1)}var We={lFrame:yx(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var cm=!1;function nx(){return We.lFrame.elementDepthCount}function ix(){We.lFrame.elementDepthCount++}function Vm(){We.lFrame.elementDepthCount--}function rx(){return We.bindingsEnabled}function ox(){return We.skipHydrationRootTNode!==null}function Hm(n){return We.skipHydrationRootTNode===n}function zm(){We.skipHydrationRootTNode=null}function Xe(){return We.lFrame.lView}function Cn(){return We.lFrame.tView}function at(n){return We.lFrame.contextLView=n,n[Wt]}function lt(n){return We.lFrame.contextLView=null,n}function vn(){let n=Gm();for(;n!==null&&n.type===64;)n=n.parent;return n}function Gm(){return We.lFrame.currentTNode}function sx(){let n=We.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function ta(n,e){let t=We.lFrame;t.currentTNode=n,t.isParent=e}function Wm(){return We.lFrame.isParent}function ax(){We.lFrame.isParent=!1}function lx(){return We.lFrame.contextLView}function qm(){return cm}function na(n){let e=cm;return cm=n,e}function cx(){let n=We.lFrame,e=n.bindingRootIndex;return e===-1&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function ux(){return We.lFrame.bindingIndex}function dx(n){return We.lFrame.bindingIndex=n}function Ko(){return We.lFrame.bindingIndex++}function $m(n){let e=We.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function fx(){return We.lFrame.inI18n}function hx(n,e){let t=We.lFrame;t.bindingIndex=t.bindingRootIndex=n,gd(e)}function px(){return We.lFrame.currentDirectiveIndex}function gd(n){We.lFrame.currentDirectiveIndex=n}function mx(n){let e=We.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function yd(){return We.lFrame.currentQueryIndex}function Kl(n){We.lFrame.currentQueryIndex=n}function hA(n){let e=n[De];return e.type===2?e.declTNode:e.type===1?n[fi]:null}function Ym(n,e,t){if(t&4){let r=e,o=n;for(;r=r.parent,r===null&&!(t&1);)if(r=hA(o),r===null||(o=o[qo],r.type&10))break;if(r===null)return!1;e=r,n=o}let i=We.lFrame=gx();return i.currentTNode=e,i.lView=n,!0}function vd(n){let e=gx(),t=n[De];We.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function gx(){let n=We.lFrame,e=n===null?null:n.child;return e===null?yx(n):e}function yx(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function vx(){let n=We.lFrame;return We.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var Xm=vx;function _d(){let n=vx();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function _x(n){return(We.lFrame.contextLView=QE(n,We.lFrame.contextLView))[Wt]}function Er(){return We.lFrame.selectedIndex}function io(n){We.lFrame.selectedIndex=n}function Ed(){let n=We.lFrame;return jl(n.tView,n.selectedIndex)}function Zi(){We.lFrame.currentNamespace=Pm}function ro(){pA()}function pA(){We.lFrame.currentNamespace=null}function Ex(){return We.lFrame.currentNamespace}var xx=!0;function xd(){return xx}function Sd(n){xx=n}function um(n,e=null,t=null,i){let r=Jm(n,e,t,i);return r.resolveInjectorInitializers(),r}function Jm(n,e=null,t=null,i,r=new Set){let o=[t||vr,GE(n)];return i=i||(typeof n=="object"?void 0:yr(n)),new Ho(o,e||Yl(),i||null,r)}var ui=class n{static THROW_IF_NOT_FOUND=Uo;static NULL=new Vl;static create(e,t){if(Array.isArray(e))return um({name:""},t,e,"");{let i=e.name??"";return um({name:i},e.parent,e.providers,i)}}static \u0275prov=Ae({token:n,providedIn:"any",factory:()=>Ue(Tm)});static __NG_ELEMENT_ID__=-1},_n=new Oe(""),oo=(()=>{class n{static __NG_ELEMENT_ID__=mA;static __NG_ENV_ID__=t=>t}return n})(),Hl=class extends oo{_lView;constructor(e){super(),this._lView=e}get destroyed(){return jo(this._lView)}onDestroy(e){let t=this._lView;return km(t,e),()=>ex(t,e)}};function mA(){return new Hl(Xe())}var wi=class{_console=console;handleError(e){this._console.error("ERROR",e)}},mi=new Oe("",{providedIn:"root",factory:()=>{let n=se(un),e;return t=>{n.destroyed&&!e?setTimeout(()=>{throw t}):(e??=n.get(wi),e.handleError(t))}}}),Sx={provide:Zr,useValue:()=>void se(wi),multi:!0};function Dt(n,e){let[t,i,r]=Hp(n,e?.equal),o=t,s=o[gn];return o.set=i,o.update=r,o.asReadonly=jm.bind(o),o}function jm(){let n=this[gn];if(n.readonlyFn===void 0){let e=()=>this();e[gn]=n,n.readonlyFn=e}return n.readonlyFn}var Ql=(()=>{class n{view;node;constructor(t,i){this.view=t,this.node=i}static __NG_ELEMENT_ID__=gA}return n})();function gA(){return new Ql(Xe(),vn())}var $i=class{},ec=new Oe("",{providedIn:"root",factory:()=>!1});var Zm=new Oe(""),Td=new Oe(""),xr=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new yn(!1);get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new yt(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=Ae({token:n,providedIn:"root",factory:()=>new n})}return n})();function Qo(...n){}var tc=(()=>{class n{static \u0275prov=Ae({token:n,providedIn:"root",factory:()=>new dm})}return n})(),dm=class{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){let t=e.zone,i=this.queues.get(t);i.has(e)&&(i.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let i=this.queues.get(t);i.has(e)||i.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(let[t,i]of this.queues)t===null?e||=this.flushQueue(i):e||=t.run(()=>this.flushQueue(i));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(let i of e)i.dirty&&(this.dirtyEffectCount--,t=!0,i.run());return t}};function jd(n){return{toString:n}.toString()}function MA(n){return typeof n=="function"}var Rd=class{previousValue;currentValue;firstChange;constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}};function tS(n,e,t,i){e!==null?e.applyValueToInputSignal(e,i):n[t]=i}var is=(()=>{let n=()=>nS;return n.ngInherit=!0,n})();function nS(n){return n.type.prototype.ngOnChanges&&(n.setInput=wA),CA}function CA(){let n=rS(this),e=n?.current;if(e){let t=n.previous;if(t===Wo)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function wA(n,e,t,i,r){let o=this.declaredInputs[i],s=rS(n)||bA(n,{previous:Wo,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[o];a[o]=new Rd(c&&c.currentValue,t,l===Wo),tS(n,e,r,t)}var iS="__ngSimpleChanges__";function rS(n){return n[iS]||null}function bA(n,e){return n[iS]=e}var Tx=[];var Rt=function(n,e=null,t){for(let i=0;i<Tx.length;i++){let r=Tx[i];r(n,e,t)}};function IA(n,e,t){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){let s=nS(e);(t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s)}r&&(t.preOrderHooks??=[]).push(0-n,r),o&&((t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o))}function AA(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){let o=n.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=o;s&&(n.contentHooks??=[]).push(-t,s),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),c&&((n.viewHooks??=[]).push(t,c),(n.viewCheckHooks??=[]).push(t,c)),u!=null&&(n.destroyHooks??=[]).push(t,u)}}function wd(n,e,t){oS(n,e,3,t)}function bd(n,e,t,i){(n[Fe]&3)===t&&oS(n,e,t,i)}function Km(n,e){let t=n[Fe];(t&3)===e&&(t&=16383,t+=1,n[Fe]=t)}function oS(n,e,t,i){let r=i!==void 0?n[$o]&65535:0,o=i??-1,s=e.length-1,a=0;for(let l=r;l<s;l++)if(typeof e[l+1]=="number"){if(a=e[l],i!=null&&a>=i)break}else e[l]<0&&(n[$o]+=65536),(a<o||o==-1)&&(DA(n,t,e,l),n[$o]=(n[$o]&4294901760)+l+2),l++}function Mx(n,e){Rt(4,n,e);let t=Pe(null);try{e.call(n)}finally{Pe(t),Rt(5,n,e)}}function DA(n,e,t,i){let r=t[i]<0,o=t[i+1],s=r?-t[i]:t[i],a=n[s];r?n[Fe]>>14<n[$o]>>16&&(n[Fe]&3)===e&&(n[Fe]+=16384,Mx(a,o)):Mx(a,o)}var ra=-1,rc=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,i,r){this.factory=e,this.name=r,this.canSeeViewProviders=t,this.injectImpl=i}};function RA(n){return(n.flags&8)!==0}function NA(n){return(n.flags&16)!==0}function PA(n,e,t){let i=0;for(;i<t.length;){let r=t[i];if(typeof r=="number"){if(r!==0)break;i++;let o=t[i++],s=t[i++],a=t[i++];n.setAttribute(e,s,a,o)}else{let o=r,s=t[++i];LA(o)?n.setProperty(e,o,s):n.setAttribute(e,o,s),i++}}return i}function sS(n){return n===3||n===4||n===6}function LA(n){return n.charCodeAt(0)===64}function Zd(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){let r=e[i];typeof r=="number"?t=r:t===0||(t===-1||t===2?Cx(n,t,r,null,e[++i]):Cx(n,t,r,null,null))}}return n}function Cx(n,e,t,i,r){let o=0,s=n.length;if(e===-1)s=-1;else for(;o<n.length;){let a=n[o++];if(typeof a=="number"){if(a===e){s=-1;break}else if(a>e){s=o-1;break}}}for(;o<n.length;){let a=n[o];if(typeof a=="number")break;if(a===t){r!==null&&(n[o+1]=r);return}o++,r!==null&&o++}s!==-1&&(n.splice(s,0,e),o=s+1),n.splice(o++,0,t),r!==null&&n.splice(o++,0,r)}function aS(n){return n!==ra}function Nd(n){return n&32767}function FA(n){return n>>16}function Pd(n,e){let t=FA(n),i=e;for(;t>0;)i=i[qo],t--;return i}var og=!0;function wx(n){let e=og;return og=n,e}var OA=256,lS=OA-1,cS=5,kA=0,Ki={};function UA(n,e,t){let i;typeof t=="string"?i=t.charCodeAt(0)||0:t.hasOwnProperty(zo)&&(i=t[zo]),i==null&&(i=t[zo]=kA++);let r=i&lS,o=1<<r;e.data[n+(r>>cS)]|=o}function uS(n,e){let t=dS(n,e);if(t!==-1)return t;let i=e[De];i.firstCreatePass&&(n.injectorIndex=e.length,Qm(i.data,n),Qm(e,null),Qm(i.blueprint,null));let r=Ng(n,e),o=n.injectorIndex;if(aS(r)){let s=Nd(r),a=Pd(r,e),l=a[De].data;for(let c=0;c<8;c++)e[o+c]=a[s+c]|l[s+c]}return e[o+8]=r,o}function Qm(n,e){n.push(0,0,0,0,0,0,0,0,e)}function dS(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function Ng(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;r!==null;){if(i=gS(r),i===null)return ra;if(t++,r=r[qo],i.injectorIndex!==-1)return i.injectorIndex|t<<16}return ra}function BA(n,e,t){UA(n,e,t)}function VA(n,e){if(e==="class")return n.classes;if(e==="style")return n.styles;let t=n.attrs;if(t){let i=t.length,r=0;for(;r<i;){let o=t[r];if(sS(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<i&&typeof t[r]=="string";)r++;else{if(o===e)return t[r+1];r=r+2}}}return null}function fS(n,e,t){if(t&8||n!==void 0)return n;ld(e,"NodeInjector")}function hS(n,e,t,i){if(t&8&&i===void 0&&(i=null),(t&3)===0){let r=n[Qr],o=jn(void 0);try{return r?r.get(e,i,t&8):xm(e,i,t&8)}finally{jn(o)}}return fS(i,e,t)}function pS(n,e,t,i=0,r){if(n!==null){if(e[Fe]&2048&&!(i&2)){let s=WA(n,e,t,i,Ki);if(s!==Ki)return s}let o=mS(n,e,t,i,Ki);if(o!==Ki)return o}return hS(e,t,i,r)}function mS(n,e,t,i,r){let o=zA(t);if(typeof o=="function"){if(!Ym(e,n,i))return i&1?fS(r,t,i):hS(e,t,i,r);try{let s;if(s=o(i),s==null&&!(i&8))ld(t);else return s}finally{Xm()}}else if(typeof o=="number"){let s=null,a=dS(n,e),l=ra,c=i&1?e[Zn][fi]:null;for((a===-1||i&4)&&(l=a===-1?Ng(n,e):e[a+8],l===ra||!Ix(i,!1)?a=-1:(s=e[De],a=Nd(l),e=Pd(l,e)));a!==-1;){let u=e[De];if(bx(o,a,u.data)){let f=HA(a,e,t,s,i,c);if(f!==Ki)return f}l=e[a+8],l!==ra&&Ix(i,e[De].data[a+8]===c)&&bx(o,a,e)?(s=u,a=Nd(l),e=Pd(l,e)):a=-1}}return r}function HA(n,e,t,i,r,o){let s=e[De],a=s.data[n+8],l=i==null?no(a)&&og:i!=s&&(a.type&3)!==0,c=r&1&&o===a,u=Id(a,s,t,l,c);return u!==null?Ld(e,s,u,a,r):Ki}function Id(n,e,t,i,r){let o=n.providerIndexes,s=e.data,a=o&1048575,l=n.directiveStart,c=n.directiveEnd,u=o>>20,f=i?a:a+u,p=r?a+u:c;for(let m=f;m<p;m++){let v=s[m];if(m<l&&t===v||m>=l&&v.type===t)return m}if(r){let m=s[l];if(m&&Jo(m)&&m.type===t)return l}return null}function Ld(n,e,t,i,r){let o=n[t],s=e.data;if(o instanceof rc){let a=o;if(a.resolving){let m=LE(s[t]);throw Em(m)}let l=wx(a.canSeeViewProviders);a.resolving=!0;let c=s[t].type||s[t],u,f=a.injectImpl?jn(a.injectImpl):null,p=Ym(n,i,0);try{o=n[t]=a.factory(void 0,r,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&IA(t,s[t],e)}finally{f!==null&&jn(f),wx(l),a.resolving=!1,Xm()}}return o}function zA(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(zo)?n[zo]:void 0;return typeof e=="number"?e>=0?e&lS:GA:e}function bx(n,e,t){let i=1<<n;return!!(t[e+(n>>cS)]&i)}function Ix(n,e){return!(n&2)&&!(n&1&&e)}var es=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return pS(this._tNode,this._lView,e,Bo(i),t)}};function GA(){return new es(vn(),Xe())}function Kd(n){return jd(()=>{let e=n.prototype.constructor,t=e[Bl]||sg(e),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let o=r[Bl]||sg(r);if(o&&o!==t)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function sg(n){return hm(n)?()=>{let e=sg(zn(n));return e&&e()}:Vo(n)}function WA(n,e,t,i,r){let o=n,s=e;for(;o!==null&&s!==null&&s[Fe]&2048&&!ea(s);){let a=mS(o,s,t,i|2,Ki);if(a!==Ki)return a;let l=o.parent;if(!l){let c=s[Dm];if(c){let u=c.get(t,Ki,i);if(u!==Ki)return u}l=gS(s),s=s[qo]}o=l}return r}function gS(n){let e=n[De],t=e.type;return t===2?e.declTNode:t===1?n[fi]:null}function fc(n){return VA(vn(),n)}function qA(){return da(vn(),Xe())}function da(n,e){return new Cr(Ai(n,e))}var Cr=(()=>{class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=qA}return n})();function yS(n){return n instanceof Cr?n.nativeElement:n}function $A(){return this._results[Symbol.iterator]()}var Fd=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new tn}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let i=BE(e);(this._changesDetected=!UE(this._results,i,t))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=$A};function vS(n){return(n.flags&128)===128}var Pg=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(Pg||{}),_S=new Map,YA=0;function XA(){return YA++}function JA(n){_S.set(n[Xl],n)}function ag(n){_S.delete(n[Xl])}var Ax="__ngContext__";function oa(n,e){Ji(e)?(n[Ax]=e[Xl],JA(e)):n[Ax]=e}function ES(n){return SS(n[Qs])}function xS(n){return SS(n[di])}function SS(n){for(;n!==null&&!Ii(n);)n=n[di];return n}var lg;function Lg(n){lg=n}function TS(){if(lg!==void 0)return lg;if(typeof document<"u")return document;throw new Te(210,!1)}var Qd=new Oe("",{providedIn:"root",factory:()=>jA}),jA="ng",ef=new Oe(""),fa=new Oe("",{providedIn:"platform",factory:()=>"unknown"});var tf=new Oe("",{providedIn:"root",factory:()=>TS().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var ZA="h",KA="b";var MS="r";var CS="di";var wS=!1,bS=new Oe("",{providedIn:"root",factory:()=>wS});var QA=(n,e,t,i)=>{};function eD(n,e,t,i){QA(n,e,t,i)}function Fg(n){return(n.flags&32)===32}var tD=()=>null;function IS(n,e,t=!1){return tD(n,e,t)}function AS(n,e){let t=n.contentQueries;if(t!==null){let i=Pe(null);try{for(let r=0;r<t.length;r+=2){let o=t[r],s=t[r+1];if(s!==-1){let a=n.data[s];Kl(o),a.contentQueries(2,e[s],s)}}}finally{Pe(i)}}}function cg(n,e,t){Kl(0);let i=Pe(null);try{e(n,t)}finally{Pe(i)}}function DS(n,e,t){if(Nm(e)){let i=Pe(null);try{let r=e.directiveStart,o=e.directiveEnd;for(let s=r;s<o;s++){let a=n.data[s];if(a.contentQueries){let l=t[s];a.contentQueries(1,l,s)}}}finally{Pe(i)}}}var Sr=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n})(Sr||{});var Md;function nD(){if(Md===void 0&&(Md=null,zl.trustedTypes))try{Md=zl.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Md}function Dx(n){return nD()?.createScriptURL(n)||n}var Od=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${od})`}};function nf(n){return n instanceof Od?n.changingThisBreaksApplicationSecurity:n}function Og(n,e){let t=RS(n);if(t!=null&&t!==e){if(t==="ResourceURL"&&e==="URL")return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${od})`)}return t===e}function RS(n){return n instanceof Od&&n.getTypeName()||null}var iD=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function NS(n){return n=String(n),n.match(iD)?n:"unsafe:"+n}var rf=(function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n})(rf||{});function hc(n){let e=LS();return e?e.sanitize(rf.URL,n)||"":Og(n,"URL")?nf(n):NS(Go(n))}function PS(n){let e=LS();if(e)return Dx(e.sanitize(rf.RESOURCE_URL,n)||"");if(Og(n,"ResourceURL"))return Dx(nf(n));throw new Te(904,!1)}function rD(n,e){return e==="src"&&(n==="embed"||n==="frame"||n==="iframe"||n==="media"||n==="script")||e==="href"&&(n==="base"||n==="link")?PS:hc}function kg(n,e,t){return rD(e,t)(n)}function LS(){let n=Xe();return n&&n[Yi].sanitizer}function FS(n){return n instanceof Function?n():n}function oD(n,e,t){let i=n.length;for(;;){let r=n.indexOf(e,t);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let o=e.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}t=r+1}}var OS="ng-template";function sD(n,e,t,i){let r=0;if(i){for(;r<e.length&&typeof e[r]=="string";r+=2)if(e[r]==="class"&&oD(e[r+1].toLowerCase(),t,0)!==-1)return!0}else if(Ug(n))return!1;if(r=e.indexOf(1,r),r>-1){let o;for(;++r<e.length&&typeof(o=e[r])=="string";)if(o.toLowerCase()===t)return!0}return!1}function Ug(n){return n.type===4&&n.value!==OS}function aD(n,e,t){let i=n.type===4&&!t?OS:n.value;return e===i}function lD(n,e,t){let i=4,r=n.attrs,o=r!==null?dD(r):0,s=!1;for(let a=0;a<e.length;a++){let l=e[a];if(typeof l=="number"){if(!s&&!Di(i)&&!Di(l))return!1;if(s&&Di(l))continue;s=!1,i=l|i&1;continue}if(!s)if(i&4){if(i=2|i&1,l!==""&&!aD(n,l,t)||l===""&&e.length===1){if(Di(i))return!1;s=!0}}else if(i&8){if(r===null||!sD(n,r,l,t)){if(Di(i))return!1;s=!0}}else{let c=e[++a],u=cD(l,r,Ug(n),t);if(u===-1){if(Di(i))return!1;s=!0;continue}if(c!==""){let f;if(u>o?f="":f=r[u+1].toLowerCase(),i&2&&c!==f){if(Di(i))return!1;s=!0}}}}return Di(i)||s}function Di(n){return(n&1)===0}function cD(n,e,t,i){if(e===null)return-1;let r=0;if(i||!t){let o=!1;for(;r<e.length;){let s=e[r];if(s===n)return r;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=e[++r];for(;typeof a=="string";)a=e[++r];continue}else{if(s===4)break;if(s===0){r+=4;continue}}r+=o?1:2}return-1}else return fD(e,n)}function uD(n,e,t=!1){for(let i=0;i<e.length;i++)if(lD(n,e[i],t))return!0;return!1}function dD(n){for(let e=0;e<n.length;e++){let t=n[e];if(sS(t))return e}return n.length}function fD(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let i=n[t];if(typeof i=="number")return-1;if(i===e)return t;t++}return-1}function Rx(n,e){return n?":not("+e.trim()+")":e}function hD(n){let e=n[0],t=1,i=2,r="",o=!1;for(;t<n.length;){let s=n[t];if(typeof s=="string")if(i&2){let a=n[++t];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else i&8?r+="."+s:i&4&&(r+=" "+s);else r!==""&&!Di(s)&&(e+=Rx(o,r),r=""),i=s,o=o||!Di(i);t++}return r!==""&&(e+=Rx(o,r)),e}function pD(n){return n.map(hD).join(",")}function mD(n){let e=[],t=[],i=1,r=2;for(;i<n.length;){let o=n[i];if(typeof o=="string")r===2?o!==""&&e.push(o,n[++i]):r===8&&t.push(o);else{if(!Di(r))break;r=o}i++}return t.length&&e.push(1,...t),e}var gi={};function gD(n,e){return n.createText(e)}function yD(n,e,t){n.setValue(e,t)}function kS(n,e,t){return n.createElement(e,t)}function kd(n,e,t,i,r){n.insertBefore(e,t,i,r)}function US(n,e,t){n.appendChild(e,t)}function Nx(n,e,t,i,r){i!==null?kd(n,e,t,i,r):US(n,e,t)}function BS(n,e,t,i){n.removeChild(null,e,t,i)}function vD(n,e,t){n.setAttribute(e,"style",t)}function _D(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function VS(n,e,t){let{mergedAttrs:i,classes:r,styles:o}=t;i!==null&&PA(n,e,i),r!==null&&_D(n,e,r),o!==null&&vD(n,e,o)}function Bg(n,e,t,i,r,o,s,a,l,c,u){let f=dn+i,p=f+r,m=ED(f,p),v=typeof c=="function"?c():c;return m[De]={type:n,blueprint:m,template:t,queries:null,viewQuery:a,declTNode:e,data:m.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:v,incompleteFirstPass:!1,ssrId:u}}function ED(n,e){let t=[];for(let i=0;i<e;i++)t.push(i<n?null:gi);return t}function xD(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=Bg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function Vg(n,e,t,i,r,o,s,a,l,c,u){let f=e.blueprint.slice();return f[bi]=r,f[Fe]=i|4|128|8|64|1024,(c!==null||n&&n[Fe]&2048)&&(f[Fe]|=2048),Fm(f),f[nn]=f[qo]=n,f[Wt]=t,f[Yi]=s||n&&n[Yi],f[Ht]=a||n&&n[Ht],f[Qr]=l||n&&n[Qr]||null,f[fi]=o,f[Xl]=XA(),f[Zs]=u,f[Dm]=c,f[Zn]=e.type==2?n[Zn]:f,f}function SD(n,e,t){let i=Ai(e,n),r=xD(t),o=n[Yi].rendererFactory,s=Hg(n,Vg(n,r,null,HS(t),i,e,null,o.createRenderer(i,t),null,null,null));return n[e.index]=s}function HS(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function zS(n,e,t,i){if(t===0)return-1;let r=e.length;for(let o=0;o<t;o++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function Hg(n,e){return n[Qs]?n[Am][di]=e:n[Qs]=e,n[Am]=e,e}function de(n=1){GS(Cn(),Xe(),Er()+n,!1)}function GS(n,e,t,i){if(!i)if((e[Fe]&3)===3){let o=n.preOrderCheckHooks;o!==null&&wd(e,o,t)}else{let o=n.preOrderHooks;o!==null&&bd(e,o,0,t)}io(t)}var of=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(of||{});function ug(n,e,t,i){let r=Pe(null);try{let[o,s,a]=n.inputs[t],l=null;(s&of.SignalBased)!==0&&(l=e[o][gn]),l!==null&&l.transformFn!==void 0?i=l.transformFn(i):a!==null&&(i=a.call(e,i)),n.setInput!==null?n.setInput(e,l,i,t,o):tS(e,l,o,i)}finally{Pe(r)}}var Tr=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(Tr||{}),TD;function zg(n,e){return TD(n,e)}var sa=new Set,Gg=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(Gg||{}),pc=new Oe(""),Px=new Set;function ao(n){Px.has(n)||(Px.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var WS=!1,dg=class extends tn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,YE()&&(this.destroyRef=se(oo,{optional:!0})??void 0,this.pendingTasks=se(xr,{optional:!0})??void 0)}emit(e){let t=Pe(null);try{super.next(e)}finally{Pe(t)}}subscribe(e,t,i){let r=e,o=t||(()=>null),s=i;if(e&&typeof e=="object"){let l=e;r=l.next?.bind(l),o=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:r,error:o,complete:s});return e instanceof Yt&&e.add(a),a}wrapInTimeout(e){return t=>{let i=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{i!==void 0&&this.pendingTasks?.remove(i)}})}}},wn=dg;function qS(n){let e,t;function i(){n=Qo;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),i()})),()=>i()}function Lx(n){return queueMicrotask(()=>n()),()=>{n=Qo}}var Wg="isAngularZone",Ud=Wg+"_ID",MD=0,rn=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new wn(!1);onMicrotaskEmpty=new wn(!1);onStable=new wn(!1);onError=new wn(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=WS}=e;if(typeof Zone>"u")throw new Te(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&i,s.shouldCoalesceRunChangeDetection=r,s.callbackScheduled=!1,s.scheduleInRootZone=o,bD(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(Wg)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new Te(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new Te(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,e,CD,Qo,Qo);try{return o.runTask(s,t,i)}finally{o.cancelTask(s)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}},CD={};function qg(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function wD(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){qS(()=>{n.callbackScheduled=!1,fg(n),n.isCheckStableRunning=!0,qg(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),fg(n)}function bD(n){let e=()=>{wD(n)},t=MD++;n._inner=n._inner.fork({name:"angular",properties:{[Wg]:!0,[Ud]:t,[Ud+t]:!0},onInvokeTask:(i,r,o,s,a,l)=>{if(ID(l))return i.invokeTask(o,s,a,l);try{return Fx(n),i.invokeTask(o,s,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),Ox(n)}},onInvoke:(i,r,o,s,a,l,c)=>{try{return Fx(n),i.invoke(o,s,a,l,c)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!AD(l)&&e(),Ox(n)}},onHasTask:(i,r,o,s)=>{i.hasTask(o,s),r===o&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,fg(n),qg(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(i,r,o,s)=>(i.handleError(o,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function fg(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function Fx(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function Ox(n){n._nesting--,qg(n)}var oc=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new wn;onMicrotaskEmpty=new wn;onStable=new wn;onError=new wn;run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}};function ID(n){return $S(n,"__ignore_ng_zone__")}function AD(n){return $S(n,"__scheduler_tick__")}function $S(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var YS=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ae({token:n,providedIn:"root",factory:()=>new n})}return n})();var DD=new Oe("",{providedIn:"root",factory:()=>({queue:new Set,isScheduled:!1,scheduler:null})});function XS(n,e){let t=n.get(DD);if(Array.isArray(e))for(let i of e)t.queue.add(i);else t.queue.add(e);t.scheduler&&t.scheduler(n)}function RD(n,e){for(let[t,i]of e)XS(n,i.animateFns)}function kx(n,e,t,i){let r=n?.[Yo]?.enter;e!==null&&r&&r.has(t.index)&&RD(i,r)}function ia(n,e,t,i,r,o,s,a){if(r!=null){let l,c=!1;Ii(r)?l=r:Ji(r)&&(c=!0,r=r[bi]);let u=hi(r);n===0&&i!==null?(kx(a,i,o,t),s==null?US(e,i,u):kd(e,i,u,s||null,!0)):n===1&&i!==null?(kx(a,i,o,t),kd(e,i,u,s||null,!0)):n===2?Ux(a,o,t,f=>{BS(e,u,c,f)}):n===3&&Ux(a,o,t,()=>{e.destroyNode(u)}),l!=null&&WD(e,n,t,l,o,i,s)}}function ND(n,e){JS(n,e),e[bi]=null,e[fi]=null}function PD(n,e,t,i,r,o){i[bi]=r,i[fi]=e,af(n,i,t,1,r,o)}function JS(n,e){e[Yi].changeDetectionScheduler?.notify(9),af(n,e,e[Ht],2,null,null)}function LD(n){let e=n[Qs];if(!e)return eg(n[De],n);for(;e;){let t=null;if(Ji(e))t=e[Qs];else{let i=e[Jt];i&&(t=i)}if(!t){for(;e&&!e[di]&&e!==n;)Ji(e)&&eg(e[De],e),e=e[nn];e===null&&(e=n),Ji(e)&&eg(e[De],e),t=e&&e[di]}e=t}}function $g(n,e){let t=n[Xo],i=t.indexOf(e);t.splice(i,1)}function sf(n,e){if(jo(e))return;let t=e[Ht];t.destroyNode&&af(n,e,t,3,null,null),LD(e)}function eg(n,e){if(jo(e))return;let t=Pe(null);try{e[Fe]&=-129,e[Fe]|=256,e[Kn]&&Po(e[Kn]),kD(n,e),OD(n,e),e[De].type===1&&e[Ht].destroy();let i=e[eo];if(i!==null&&Ii(e[nn])){i!==e[nn]&&$g(i,e);let r=e[Xi];r!==null&&r.detachView(n)}ag(e)}finally{Pe(t)}}function Ux(n,e,t,i){let r=n?.[Yo];if(r==null||r.leave==null||!r.leave.has(e.index))return i(!1);if(r.skipLeaveAnimations)return r.skipLeaveAnimations=!1,i(!1);n&&sa.add(n),XS(t,()=>{if(r.leave&&r.leave.has(e.index)){let s=r.leave.get(e.index),a=[];if(s)for(let l=0;l<s.animateFns.length;l++){let c=s.animateFns[l],{promise:u}=c();a.push(u)}r.running=Promise.allSettled(a),FD(n,i)}else n&&sa.delete(n),i(!1)})}function FD(n,e){let t=n[Yo]?.running;if(t){t.then(()=>{n[Yo].running=void 0,sa.delete(n),e(!0)});return}e(!1)}function OD(n,e){let t=n.cleanup,i=e[Ks];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let a=t[s+3];a>=0?i[a]():i[-a].unsubscribe(),s+=2}else{let a=i[t[s+1]];t[s].call(a)}i!==null&&(e[Ks]=null);let r=e[gr];if(r!==null){e[gr]=null;for(let s=0;s<r.length;s++){let a=r[s];a()}}let o=e[_r];if(o!==null){e[_r]=null;for(let s of o)s.destroy()}}function kD(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let i=0;i<t.length;i+=2){let r=e[t[i]];if(!(r instanceof rc)){let o=t[i+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=r[o[s]],l=o[s+1];Rt(4,a,l);try{l.call(a)}finally{Rt(5,a,l)}}else{Rt(4,r,o);try{o.call(r)}finally{Rt(5,r,o)}}}}}function UD(n,e,t){return BD(n,e.parent,t)}function BD(n,e,t){let i=e;for(;i!==null&&i.type&168;)e=i,i=e.parent;if(i===null)return t[bi];if(no(i)){let{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===Sr.None||r===Sr.Emulated)return null}return Ai(i,t)}function VD(n,e,t){return zD(n,e,t)}function HD(n,e,t){return n.type&40?Ai(n,t):null}var zD=HD,Bx;function Yg(n,e,t,i){let r=UD(n,i,e),o=e[Ht],s=i.parent||e[fi],a=VD(s,i,e);if(r!=null)if(Array.isArray(t))for(let l=0;l<t.length;l++)Nx(o,r,t[l],a,!1);else Nx(o,r,t,a,!1);Bx!==void 0&&Bx(o,i,e,t,r)}function nc(n,e){if(e!==null){let t=e.type;if(t&3)return Ai(e,n);if(t&4)return hg(-1,n[e.index]);if(t&8){let i=e.child;if(i!==null)return nc(n,i);{let r=n[e.index];return Ii(r)?hg(-1,r):hi(r)}}else{if(t&128)return nc(n,e.next);if(t&32)return zg(e,n)()||hi(n[e.index]);{let i=jS(n,e);if(i!==null){if(Array.isArray(i))return i[0];let r=jr(n[Zn]);return nc(r,i)}else return nc(n,e.next)}}}return null}function jS(n,e){if(e!==null){let i=n[Zn][fi],r=e.projection;return i.projection[r]}return null}function hg(n,e){let t=Jt+n+1;if(t<e.length){let i=e[t],r=i[De].firstChild;if(r!==null)return nc(i,r)}return e[to]}function Xg(n,e,t,i,r,o,s){for(;t!=null;){let a=i[Qr];if(t.type===128){t=t.next;continue}let l=i[t.index],c=t.type;if(s&&e===0&&(l&&oa(hi(l),i),t.flags|=2),!Fg(t))if(c&8)Xg(n,e,t.child,i,r,o,!1),ia(e,n,a,r,l,t,o,i);else if(c&32){let u=zg(t,i),f;for(;f=u();)ia(e,n,a,r,f,t,o,i);ia(e,n,a,r,l,t,o,i)}else c&16?GD(n,e,i,t,r,o):ia(e,n,a,r,l,t,o,i);t=s?t.projectionNext:t.next}}function af(n,e,t,i,r,o){Xg(t,i,n.firstChild,e,r,o,!1)}function GD(n,e,t,i,r,o){let s=t[Zn],l=s[fi].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];ia(e,n,t[Qr],r,u,i,o,t)}else{let c=l,u=s[nn];vS(i)&&(c.flags|=128),Xg(n,e,c,u,r,o,!0)}}function WD(n,e,t,i,r,o,s){let a=i[to],l=hi(i);a!==l&&ia(e,n,t,o,a,r,s);for(let c=Jt;c<i.length;c++){let u=i[c];af(u[De],u,n,e,o,a)}}function qD(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let o=i.indexOf("-")===-1?void 0:Tr.DashCase;r==null?n.removeStyle(t,i,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=Tr.Important),n.setStyle(t,i,r,o))}}function ZS(n,e,t,i,r){let o=Er(),s=i&2;try{io(-1),s&&e.length>dn&&GS(n,e,dn,!1),Rt(s?2:0,r,t),t(i,r)}finally{io(o),Rt(s?3:1,r,t)}}function KS(n,e,t){KD(n,e,t),(t.flags&64)===64&&QD(n,e,t)}function Jg(n,e,t=Ai){let i=e.localNames;if(i!==null){let r=e.index+1;for(let o=0;o<i.length;o+=2){let s=i[o+1],a=s===-1?t(e,n):n[s];n[r++]=a}}}function $D(n,e,t,i){let o=i.get(bS,wS)||t===Sr.ShadowDom,s=n.selectRootElement(e,o);return YD(s),s}function YD(n){XD(n)}var XD=()=>null;function JD(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function jD(n,e,t,i,r,o){let s=e[De];if(jg(n,s,e,t,i)){no(n)&&ZD(e,n.index);return}n.type&3&&(t=JD(t)),QS(n,e,t,i,r,o)}function QS(n,e,t,i,r,o){if(n.type&3){let s=Ai(n,e);i=o!=null?o(i,n.value||"",t):i,r.setProperty(s,t,i)}else n.type&12}function ZD(n,e){let t=pi(e,n);t[Fe]&16||(t[Fe]|=64)}function KD(n,e,t){let i=t.directiveStart,r=t.directiveEnd;no(t)&&SD(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||uS(t,e);let o=t.initialInputs;for(let s=i;s<r;s++){let a=n.data[s],l=Ld(e,n,s,t);if(oa(l,e),o!==null&&rR(e,s-i,l,a,t,o),Jo(a)){let c=pi(t.index,e);c[Wt]=Ld(e,n,s,t)}}}function QD(n,e,t){let i=t.directiveStart,r=t.directiveEnd,o=t.index,s=px();try{io(o);for(let a=i;a<r;a++){let l=n.data[a],c=e[a];gd(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&eR(l,c)}}finally{io(-1),gd(s)}}function eR(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function tR(n,e){let t=n.directiveRegistry,i=null;if(t)for(let r=0;r<t.length;r++){let o=t[r];uD(e,o.selectors,!1)&&(i??=[],Jo(o)?i.unshift(o):i.push(o))}return i}function nR(n,e,t,i,r,o){let s=Ai(n,e);iR(e[Ht],s,o,n.value,t,i,r)}function iR(n,e,t,i,r,o,s){if(o==null)n.removeAttribute(e,r,t);else{let a=s==null?Go(o):s(o,i||"",r);n.setAttribute(e,r,a,t)}}function rR(n,e,t,i,r,o){let s=o[e];if(s!==null)for(let a=0;a<s.length;a+=2){let l=s[a],c=s[a+1];ug(i,t,l,c)}}function eT(n,e,t,i,r){let o=dn+t,s=e[De],a=r(s,e,n,i,t);e[o]=a,ta(n,!0);let l=n.type===2;return l?(VS(e[Ht],a,n),(nx()===0||hd(n))&&oa(a,e),ix()):oa(a,e),xd()&&(!l||!Fg(n))&&Yg(s,e,a,n),n}function tT(n){let e=n;return Wm()?ax():(e=e.parent,ta(e,!1)),e}function oR(n,e){let t=n[Qr];if(!t)return;let i;try{i=t.get(mi,null)}catch{i=null}i?.(e)}function jg(n,e,t,i,r){let o=n.inputs?.[i],s=n.hostDirectiveInputs?.[i],a=!1;if(s)for(let l=0;l<s.length;l+=2){let c=s[l],u=s[l+1],f=e.data[c];ug(f,t[c],u,r),a=!0}if(o)for(let l of o){let c=t[l],u=e.data[l];ug(u,c,i,r),a=!0}return a}function sR(n,e){let t=pi(e,n),i=t[De];aR(i,t);let r=t[bi];r!==null&&t[Zs]===null&&(t[Zs]=IS(r,t[Qr])),Rt(18),Zg(i,t,t[Wt]),Rt(19,t[Wt])}function aR(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function Zg(n,e,t){vd(e);try{let i=n.viewQuery;i!==null&&cg(1,i,t);let r=n.template;r!==null&&ZS(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[Xi]?.finishViewCreation(n),n.staticContentQueries&&AS(n,e),n.staticViewQueries&&cg(2,n.viewQuery,t);let o=n.components;o!==null&&lR(e,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[Fe]&=-5,_d()}}function lR(n,e){for(let t=0;t<e.length;t++)sR(n,e[t])}function lf(n,e,t,i){let r=Pe(null);try{let o=e.tView,a=n[Fe]&4096?4096:16,l=Vg(n,o,t,a,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),c=n[e.index];l[eo]=c;let u=n[Xi];return u!==null&&(l[Xi]=u.createEmbeddedView(o)),Zg(o,l,t),l}finally{Pe(r)}}function sc(n,e){return!e||e.firstChild===null||vS(n)}function ac(n,e,t,i,r=!1){for(;t!==null;){if(t.type===128){t=r?t.projectionNext:t.next;continue}let o=e[t.index];o!==null&&i.push(hi(o)),Ii(o)&&nT(o,i);let s=t.type;if(s&8)ac(n,e,t.child,i);else if(s&32){let a=zg(t,e),l;for(;l=a();)i.push(l)}else if(s&16){let a=jS(e,t);if(Array.isArray(a))i.push(...a);else{let l=jr(e[Zn]);ac(l[De],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function nT(n,e){for(let t=Jt;t<n.length;t++){let i=n[t],r=i[De].firstChild;r!==null&&ac(i[De],i,r,e)}n[to]!==n[bi]&&e.push(n[to])}function iT(n){if(n[fd]!==null){for(let e of n[fd])e.impl.addSequence(e);n[fd].length=0}}var rT=[];function cR(n){return n[Kn]??uR(n)}function uR(n){let e=rT.pop()??Object.create(fR);return e.lView=n,e}function dR(n){n.lView[Kn]!==n&&(n.lView=null,rT.push(n))}var fR=it(ue({},Ro),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Zo(n.lView)},consumerOnSignalRead(){this.lView[Kn]=this}});function hR(n){let e=n[Kn]??Object.create(pR);return e.lView=n,e}var pR=it(ue({},Ro),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=jr(n.lView);for(;e&&!oT(e[De]);)e=jr(e);e&&Om(e)},consumerOnSignalRead(){this.lView[Kn]=this}});function oT(n){return n.type!==2}function sT(n){if(n[_r]===null)return;let e=!0;for(;e;){let t=!1;for(let i of n[_r])i.dirty&&(t=!0,i.zone===null||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));e=t&&!!(n[Fe]&8192)}}var mR=100;function aT(n,e=0){let i=n[Yi].rendererFactory,r=!1;r||i.begin?.();try{gR(n,e)}finally{r||i.end?.()}}function gR(n,e){let t=qm();try{na(!0),pg(n,e);let i=0;for(;Zl(n);){if(i===mR)throw new Te(103,!1);i++,pg(n,1)}}finally{na(t)}}function yR(n,e,t,i){if(jo(e))return;let r=e[Fe],o=!1,s=!1;vd(e);let a=!0,l=null,c=null;o||(oT(n)?(c=cR(e),l=No(c)):Au()===null?(a=!1,c=hR(e),l=No(c)):e[Kn]&&(Po(e[Kn]),e[Kn]=null));try{Fm(e),dx(n.bindingStartIndex),t!==null&&ZS(n,e,t,2,i);let u=(r&3)===3;if(!o)if(u){let m=n.preOrderCheckHooks;m!==null&&wd(e,m,null)}else{let m=n.preOrderHooks;m!==null&&bd(e,m,0,null),Km(e,0)}if(s||vR(e),sT(e),lT(e,0),n.contentQueries!==null&&AS(n,e),!o)if(u){let m=n.contentCheckHooks;m!==null&&wd(e,m)}else{let m=n.contentHooks;m!==null&&bd(e,m,1),Km(e,1)}ER(n,e);let f=n.components;f!==null&&uT(e,f,0);let p=n.viewQuery;if(p!==null&&cg(2,p,i),!o)if(u){let m=n.viewCheckHooks;m!==null&&wd(e,m)}else{let m=n.viewHooks;m!==null&&bd(e,m,2),Km(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[dd]){for(let m of e[dd])m();e[dd]=null}o||(iT(e),e[Fe]&=-73)}catch(u){throw o||Zo(e),u}finally{c!==null&&(Ps(c,l),a&&dR(c)),_d()}}function lT(n,e){for(let t=ES(n);t!==null;t=xS(t))for(let i=Jt;i<t.length;i++){let r=t[i];cT(r,e)}}function vR(n){for(let e=ES(n);e!==null;e=xS(e)){if(!(e[Fe]&2))continue;let t=e[Xo];for(let i=0;i<t.length;i++){let r=t[i];Om(r)}}}function _R(n,e,t){Rt(18);let i=pi(e,n);cT(i,t),Rt(19,i[Wt])}function cT(n,e){pd(n)&&pg(n,e)}function pg(n,e){let i=n[De],r=n[Fe],o=n[Kn],s=!!(e===0&&r&16);if(s||=!!(r&64&&e===0),s||=!!(r&1024),s||=!!(o?.dirty&&Ls(o)),s||=!1,o&&(o.dirty=!1),n[Fe]&=-9217,s)yR(i,n,i.template,n[Wt]);else if(r&8192){let a=Pe(null);try{sT(n),lT(n,1);let l=i.components;l!==null&&uT(n,l,1),iT(n)}finally{Pe(a)}}}function uT(n,e,t){for(let i=0;i<e.length;i++)_R(n,e[i],t)}function ER(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let i=0;i<t.length;i++){let r=t[i];if(r<0)io(~r);else{let o=r,s=t[++i],a=t[++i];hx(s,o);let l=e[o];Rt(24,l),a(2,l),Rt(25,l)}}}finally{io(-1)}}function Kg(n,e){let t=qm()?64:1088;for(n[Yi].changeDetectionScheduler?.notify(e);n;){n[Fe]|=t;let i=jr(n);if(ea(n)&&!i)return n;n=i}return null}function dT(n,e,t,i){return[n,!0,0,e,null,i,null,t,null,null]}function fT(n,e){let t=Jt+e;if(t<n.length)return n[t]}function cf(n,e,t,i=!0){let r=e[De];if(xR(r,e,n,t),i){let s=hg(t,n),a=e[Ht],l=a.parentNode(n[to]);l!==null&&PD(r,n[fi],a,e,l,s)}let o=e[Zs];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function hT(n,e){let t=lc(n,e);return t!==void 0&&sf(t[De],t),t}function lc(n,e){if(n.length<=Jt)return;let t=Jt+e,i=n[t];if(i){let r=i[eo];r!==null&&r!==n&&$g(r,i),e>0&&(n[t-1][di]=i[di]);let o=Wl(n,Jt+e);ND(i[De],i);let s=o[Xi];s!==null&&s.detachView(o[De]),i[nn]=null,i[di]=null,i[Fe]&=-129}return i}function xR(n,e,t,i){let r=Jt+i,o=t.length;i>0&&(t[r-1][di]=e),i<o-Jt?(e[di]=t[r],Sm(t,Jt+i,e)):(t.push(e),e[di]=null),e[nn]=t;let s=e[eo];s!==null&&t!==s&&pT(s,e);let a=e[Xi];a!==null&&a.insertView(n),md(e),e[Fe]|=128}function pT(n,e){let t=n[Xo],i=e[nn];if(Ji(i))n[Fe]|=2;else{let r=i[nn][Zn];e[Zn]!==r&&(n[Fe]|=2)}t===null?n[Xo]=[e]:t.push(e)}var so=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let e=this._lView,t=e[De];return ac(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[Wt]}set context(e){this._lView[Wt]=e}get destroyed(){return jo(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[nn];if(Ii(e)){let t=e[Jl],i=t?t.indexOf(this):-1;i>-1&&(lc(e,i),Wl(t,i))}this._attachedToViewContainer=!1}sf(this._lView[De],this._lView)}onDestroy(e){km(this._lView,e)}markForCheck(){Kg(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Fe]&=-129}reattach(){md(this._lView),this._lView[Fe]|=128}detectChanges(){this._lView[Fe]|=1024,aT(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Te(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=ea(this._lView),t=this._lView[eo];t!==null&&!e&&$g(t,this._lView),JS(this._lView[De],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Te(902,!1);this._appRef=e;let t=ea(this._lView),i=this._lView[eo];i!==null&&!t&&pT(i,this._lView),md(this._lView)}};var aa=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=SR;constructor(t,i,r){this._declarationLView=t,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,r){let o=lf(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:i,dehydratedView:r});return new so(o)}}return n})();function SR(){return Qg(vn(),Xe())}function Qg(n,e){return n.type&4?new aa(e,n,da(n,e)):null}function uf(n,e,t,i,r){let o=n.data[e];if(o===null)o=TR(n,e,t,i,r),fx()&&(o.flags|=32);else if(o.type&64){o.type=t,o.value=i,o.attrs=r;let s=sx();o.injectorIndex=s===null?-1:s.injectorIndex}return ta(o,!0),o}function TR(n,e,t,i,r){let o=Gm(),s=Wm(),a=s?o:o&&o.parent,l=n.data[e]=CR(n,a,t,e,i,r);return MR(n,l,o,s),l}function MR(n,e,t,i){n.firstChild===null&&(n.firstChild=e),t!==null&&(i?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function CR(n,e,t,i,r,o){let s=e?e.injectorIndex:-1,a=0;return ox()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var k7=new RegExp(`^(\\d+)*(${KA}|${ZA})*(.*)`);function wR(n){let e=n[Rm]??[],i=n[nn][Ht],r=[];for(let o of e)o.data[CS]!==void 0?r.push(o):bR(o,i);n[Rm]=r}function bR(n,e){let t=0,i=n.firstChild;if(i){let r=n.data[MS];for(;t<r;){let o=i.nextSibling;BS(e,i,!1),i=o,t++}}}var IR=()=>null,AR=()=>null;function mg(n,e){return IR(n,e)}function mT(n,e,t){return AR(n,e,t)}var gT=class{},df=class{},gg=class{resolveComponentFactory(e){throw new Te(917,!1)}},mc=class{static NULL=new gg},ts=class{},gc=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>DR()}return n})();function DR(){let n=Xe(),e=vn(),t=pi(e.index,n);return(Ji(t)?t:n)[Ht]}var yT=(()=>{class n{static \u0275prov=Ae({token:n,providedIn:"root",factory:()=>null})}return n})();var Ad={},yg=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){let r=this.injector.get(e,Ad,i);return r!==Ad||t===Ad?r:this.parentInjector.get(e,t,i)}};function Bd(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,o=0;if(e!==null)for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")o=a;else if(o==1)r=fm(r,a);else if(o==2){let l=a,c=e[++s];i=fm(i,l+": "+c+";")}}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function Gn(n,e=0){let t=Xe();if(t===null)return Ue(n,e);let i=vn();return pS(i,t,zn(n),e)}function RR(n,e,t,i,r){let o=i===null?null:{"":-1},s=r(n,t);if(s!==null){let a=s,l=null,c=null;for(let u of s)if(u.resolveHostDirectives!==null){[a,l,c]=u.resolveHostDirectives(s);break}LR(n,e,t,a,o,l,c)}o!==null&&i!==null&&NR(t,i,o)}function NR(n,e,t){let i=n.localNames=[];for(let r=0;r<e.length;r+=2){let o=t[e[r+1]];if(o==null)throw new Te(-301,!1);i.push(e[r],o)}}function PR(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function LR(n,e,t,i,r,o,s){let a=i.length,l=!1;for(let p=0;p<a;p++){let m=i[p];!l&&Jo(m)&&(l=!0,PR(n,t,p)),BA(uS(t,e),n,m.type)}VR(t,n.data.length,a);for(let p=0;p<a;p++){let m=i[p];m.providersResolver&&m.providersResolver(m)}let c=!1,u=!1,f=zS(n,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let p=0;p<a;p++){let m=i[p];if(t.mergedAttrs=Zd(t.mergedAttrs,m.hostAttrs),OR(n,t,e,f,m),BR(f,m,r),s!==null&&s.has(m)){let[_,y]=s.get(m);t.directiveToIndex.set(m.type,[f,_+t.directiveStart,y+t.directiveStart])}else(o===null||!o.has(m))&&t.directiveToIndex.set(m.type,f);m.contentQueries!==null&&(t.flags|=4),(m.hostBindings!==null||m.hostAttrs!==null||m.hostVars!==0)&&(t.flags|=64);let v=m.type.prototype;!c&&(v.ngOnChanges||v.ngOnInit||v.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),c=!0),!u&&(v.ngOnChanges||v.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),u=!0),f++}FR(n,t,o)}function FR(n,e,t){for(let i=e.directiveStart;i<e.directiveEnd;i++){let r=n.data[i];if(t===null||!t.has(r))Vx(0,e,r,i),Vx(1,e,r,i),zx(e,i,!1);else{let o=t.get(r);Hx(0,e,o,i),Hx(1,e,o,i),zx(e,i,!0)}}}function Vx(n,e,t,i){let r=n===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s;n===0?s=e.inputs??={}:s=e.outputs??={},s[o]??=[],s[o].push(i),vT(e,o)}}function Hx(n,e,t,i){let r=n===0?t.inputs:t.outputs;for(let o in r)if(r.hasOwnProperty(o)){let s=r[o],a;n===0?a=e.hostDirectiveInputs??={}:a=e.hostDirectiveOutputs??={},a[s]??=[],a[s].push(i,o),vT(e,s)}}function vT(n,e){e==="class"?n.flags|=8:e==="style"&&(n.flags|=16)}function zx(n,e,t){let{attrs:i,inputs:r,hostDirectiveInputs:o}=n;if(i===null||!t&&r===null||t&&o===null||Ug(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let s=null,a=0;for(;a<i.length;){let l=i[a];if(l===0){a+=4;continue}else if(l===5){a+=2;continue}else if(typeof l=="number")break;if(!t&&r.hasOwnProperty(l)){let c=r[l];for(let u of c)if(u===e){s??=[],s.push(l,i[a+1]);break}}else if(t&&o.hasOwnProperty(l)){let c=o[l];for(let u=0;u<c.length;u+=2)if(c[u]===e){s??=[],s.push(c[u+1],i[a+1]);break}}a+=2}n.initialInputs??=[],n.initialInputs.push(s)}function OR(n,e,t,i,r){n.data[i]=r;let o=r.factory||(r.factory=Vo(r.type,!0)),s=new rc(o,Jo(r),Gn,null);n.blueprint[i]=s,t[i]=s,kR(n,e,i,zS(n,t,r.hostVars,gi),r)}function kR(n,e,t,i,r){let o=r.hostBindings;if(o){let s=n.hostBindingOpCodes;s===null&&(s=n.hostBindingOpCodes=[]);let a=~e.index;UR(s)!=a&&s.push(a),s.push(t,i,o)}}function UR(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function BR(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Jo(e)&&(t[""]=n)}}function VR(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function _T(n,e,t,i,r,o,s,a){let l=e[De],c=l.consts,u=ji(c,s),f=uf(l,n,t,i,u);return o&&RR(l,e,f,ji(c,a),r),f.mergedAttrs=Zd(f.mergedAttrs,f.attrs),f.attrs!==null&&Bd(f,f.attrs,!1),f.mergedAttrs!==null&&Bd(f,f.mergedAttrs,!0),l.queries!==null&&l.queries.elementStart(l,f),f}function ET(n,e){AA(n,e),Nm(e)&&n.queries.elementEnd(e)}function HR(n,e,t,i,r,o){let s=e.consts,a=ji(s,r),l=uf(e,n,t,i,a);if(l.mergedAttrs=Zd(l.mergedAttrs,l.attrs),o!=null){let c=ji(s,o);l.localNames=[];for(let u=0;u<c.length;u+=2)l.localNames.push(c[u],-1)}return l.attrs!==null&&Bd(l,l.attrs,!1),l.mergedAttrs!==null&&Bd(l,l.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,l),l}function zR(n,e,t){return n[e]=t}function GR(n,e){return n[e]}function Mr(n,e,t){if(t===gi)return!1;let i=n[e];return Object.is(i,t)?!1:(n[e]=t,!0)}function WR(n,e,t,i){let r=Mr(n,e,t);return Mr(n,e+1,i)||r}function Dd(n,e,t){return function i(r){let o=no(n)?pi(n.index,e):e;Kg(o,5);let s=e[Wt],a=Gx(e,s,t,r),l=i.__ngNextListenerFn__;for(;l;)a=Gx(e,s,l,r)&&a,l=l.__ngNextListenerFn__;return a}}function Gx(n,e,t,i){let r=Pe(null);try{return Rt(6,e,t),t(i)!==!1}catch(o){return oR(n,o),!1}finally{Rt(7,e,t),Pe(r)}}function xT(n,e,t,i,r,o,s,a){let l=hd(n),c=!1,u=null;if(!i&&l&&(u=$R(e,t,o,n.index)),u!==null){let f=u.__ngLastListenerFn__||u;f.__ngNextListenerFn__=s,u.__ngLastListenerFn__=s,c=!0}else{let f=Ai(n,t),p=i?i(f):f;eD(t,p,o,a);let m=r.listen(p,o,a);if(!qR(o)){let v=i?_=>i(hi(_[n.index])):n.index;ST(v,e,t,o,a,m,!1)}}return c}function qR(n){return n.startsWith("animation")||n.startsWith("transition")}function $R(n,e,t,i){let r=n.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let s=r[o];if(s===t&&r[o+1]===i){let a=e[Ks],l=r[o+2];return a&&a.length>l?a[l]:null}typeof s=="string"&&(o+=2)}return null}function ST(n,e,t,i,r,o,s){let a=e.firstCreatePass?Bm(e):null,l=Um(t),c=l.length;l.push(r,o),a&&a.push(i,n,c,(c+1)*(s?-1:1))}function Wx(n,e,t,i,r,o){let s=e[t],a=e[De],c=a.data[t].outputs[i],f=s[c].subscribe(o);ST(n.index,a,e,r,o,f,!0)}var vg=Symbol("BINDING");var Vd=class extends mc{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Kr(e);return new la(t,this.ngModule)}};function YR(n){return Object.keys(n).map(e=>{let[t,i,r]=n[e],o={propName:t,templateName:e,isSignal:(i&of.SignalBased)!==0};return r&&(o.transform=r),o})}function XR(n){return Object.keys(n).map(e=>({propName:n[e],templateName:e}))}function JR(n,e,t){let i=e instanceof un?e:e?.injector;return i&&n.getStandaloneInjector!==null&&(i=n.getStandaloneInjector(i)||i),i?new yg(t,i):t}function jR(n){let e=n.get(ts,null);if(e===null)throw new Te(407,!1);let t=n.get(yT,null),i=n.get($i,null);return{rendererFactory:e,sanitizer:t,changeDetectionScheduler:i,ngReflect:!1}}function ZR(n,e){let t=TT(n);return kS(e,t,t==="svg"?Pm:t==="math"?JE:null)}function TT(n){return(n.selectors[0][0]||"div").toLowerCase()}var la=class extends df{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=YR(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=XR(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=pD(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,i,r,o,s){Rt(22);let a=Pe(null);try{let l=this.componentDef,c=KR(i,l,s,o),u=JR(l,r||this.ngModule,e),f=jR(u),p=f.rendererFactory.createRenderer(null,l),m=i?$D(p,i,l.encapsulation,u):ZR(l,p),v=s?.some(qx)||o?.some(g=>typeof g!="function"&&g.bindings.some(qx)),_=Vg(null,c,null,512|HS(l),null,null,f,p,u,null,IS(m,u,!0));_[dn]=m,vd(_);let y=null;try{let g=_T(dn,_,2,"#host",()=>c.directiveRegistry,!0,0);VS(p,m,g),oa(m,_),KS(c,_,g),DS(c,g,_),ET(c,g),t!==void 0&&eN(g,this.ngContentSelectors,t),y=pi(g.index,_),_[Wt]=y[Wt],Zg(c,_,null)}catch(g){throw y!==null&&ag(y),ag(_),g}finally{Rt(23),_d()}return new Hd(this.componentType,_,!!v)}finally{Pe(a)}}};function KR(n,e,t,i){let r=n?["ng-version","20.3.7"]:mD(e.selectors[0]),o=null,s=null,a=0;if(t)for(let u of t)a+=u[vg].requiredVars,u.create&&(u.targetIdx=0,(o??=[]).push(u)),u.update&&(u.targetIdx=0,(s??=[]).push(u));if(i)for(let u=0;u<i.length;u++){let f=i[u];if(typeof f!="function")for(let p of f.bindings){a+=p[vg].requiredVars;let m=u+1;p.create&&(p.targetIdx=m,(o??=[]).push(p)),p.update&&(p.targetIdx=m,(s??=[]).push(p))}}let l=[e];if(i)for(let u of i){let f=typeof u=="function"?u:u.type,p=wm(f);l.push(p)}return Bg(0,null,QR(o,s),1,a,l,null,null,null,[r],null)}function QR(n,e){return!n&&!e?null:t=>{if(t&1&&n)for(let i of n)i.create();if(t&2&&e)for(let i of e)i.update()}}function qx(n){let e=n[vg].kind;return e==="input"||e==="twoWay"}var Hd=class extends gT{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,i){super(),this._rootLView=t,this._hasInputBindings=i,this._tNode=jl(t[De],dn),this.location=da(this._tNode,t),this.instance=pi(this._tNode.index,t)[Wt],this.hostView=this.changeDetectorRef=new so(t,void 0),this.componentType=e}setInput(e,t){this._hasInputBindings;let i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let r=this._rootLView,o=jg(i,r[De],r,e,t);this.previousInputValues.set(e,t);let s=pi(i.index,r);Kg(s,1)}get injector(){return new es(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function eN(n,e,t){let i=n.projection=[];for(let r=0;r<e.length;r++){let o=t[r];i.push(o!=null&&o.length?Array.from(o):null)}}var rs=(()=>{class n{static __NG_ELEMENT_ID__=tN}return n})();function tN(){let n=vn();return CT(n,Xe())}var nN=rs,MT=class extends nN{_lContainer;_hostTNode;_hostLView;constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return da(this._hostTNode,this._hostLView)}get injector(){return new es(this._hostTNode,this._hostLView)}get parentInjector(){let e=Ng(this._hostTNode,this._hostLView);if(aS(e)){let t=Pd(e,this._hostLView),i=Nd(e),r=t[De].data[i+8];return new es(r,t)}else return new es(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=$x(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Jt}createEmbeddedView(e,t,i){let r,o;typeof i=="number"?r=i:i!=null&&(r=i.index,o=i.injector);let s=mg(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},o,s);return this.insertImpl(a,r,sc(this._hostTNode,s)),a}createComponent(e,t,i,r,o,s,a){let l=e&&!MA(e),c;if(l)c=t;else{let y=t||{};c=y.index,i=y.injector,r=y.projectableNodes,o=y.environmentInjector||y.ngModuleRef,s=y.directives,a=y.bindings}let u=l?e:new la(Kr(e)),f=i||this.parentInjector;if(!o&&u.ngModule==null){let g=(l?f:this.parentInjector).get(un,null);g&&(o=g)}let p=Kr(u.componentType??{}),m=mg(this._lContainer,p?.id??null),v=m?.firstChild??null,_=u.create(f,r,v,o,s,a);return this.insertImpl(_.hostView,c,sc(this._hostTNode,m)),_}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,i){let r=e._lView;if(KE(r)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let l=r[nn],c=new MT(l,l[fi],l[nn]);c.detach(c.indexOf(e))}}let o=this._adjustIndex(t),s=this._lContainer;return cf(s,r,o,i),e.attachToViewContainerRef(),Sm(tg(s),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=$x(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),i=lc(this._lContainer,t);i&&(Wl(tg(this._lContainer),t),sf(i[De],i))}detach(e){let t=this._adjustIndex(e,-1),i=lc(this._lContainer,t);return i&&Wl(tg(this._lContainer),t)!=null?new so(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function $x(n){return n[Jl]}function tg(n){return n[Jl]||(n[Jl]=[])}function CT(n,e){let t,i=e[n.index];return Ii(i)?t=i:(t=dT(i,e,null,n),e[n.index]=t,Hg(e,t)),rN(t,e,n,i),new MT(t,n,e)}function iN(n,e){let t=n[Ht],i=t.createComment(""),r=Ai(e,n),o=t.parentNode(r);return kd(t,o,i,t.nextSibling(r),!1),i}var rN=aN,oN=()=>!1;function sN(n,e,t){return oN(n,e,t)}function aN(n,e,t,i){if(n[to])return;let r;t.type&8?r=hi(i):r=iN(e,t),n[to]=r}var _g=class n{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},Eg=class n{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let i=e.contentQueries!==null?e.contentQueries[0]:t.length,r=[];for(let o=0;o<i;o++){let s=t.getByIndex(o),a=this.queries[s.indexInDeclarationView];r.push(a.clone())}return new n(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)ty(e,t).matches!==null&&this.queries[t].setDirty()}},zd=class{flags;read;predicate;constructor(e,t,i=null){this.flags=t,this.read=i,typeof e=="string"?this.predicate=pN(e):this.predicate=e}},xg=class n{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){let r=t!==null?t.length:0,o=this.getByIndex(i).embeddedTView(e,r);o&&(o.indexInDeclarationView=i,t!==null?t.push(o):t=[o])}return t!==null?new n(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},Sg=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new n(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==t;)i=i.parent;return t===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];this.matchTNodeWithReadOption(e,t,lN(t,o)),this.matchTNodeWithReadOption(e,t,Id(t,e,o,!1,!1))}else i===aa?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Id(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Cr||r===rs||r===aa&&t.type&4)this.addMatch(t.index,-2);else{let o=Id(t,e,r,!1,!1);o!==null&&this.addMatch(t.index,o)}else this.addMatch(t.index,i)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function lN(n,e){let t=n.localNames;if(t!==null){for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1]}return null}function cN(n,e){return n.type&11?da(n,e):n.type&4?Qg(n,e):null}function uN(n,e,t,i){return t===-1?cN(e,n):t===-2?dN(n,e,i):Ld(n,n[De],t,e)}function dN(n,e,t){if(t===Cr)return da(e,n);if(t===aa)return Qg(e,n);if(t===rs)return CT(e,n)}function wT(n,e,t,i){let r=e[Xi].queries[i];if(r.matches===null){let o=n.data,s=t.matches,a=[];for(let l=0;s!==null&&l<s.length;l+=2){let c=s[l];if(c<0)a.push(null);else{let u=o[c];a.push(uN(e,u,s[l+1],t.metadata.read))}}r.matches=a}return r.matches}function Tg(n,e,t,i){let r=n.queries.getByIndex(t),o=r.matches;if(o!==null){let s=wT(n,e,r,t);for(let a=0;a<o.length;a+=2){let l=o[a];if(l>0)i.push(s[a/2]);else{let c=o[a+1],u=e[-l];for(let f=Jt;f<u.length;f++){let p=u[f];p[eo]===p[nn]&&Tg(p[De],p,c,i)}if(u[Xo]!==null){let f=u[Xo];for(let p=0;p<f.length;p++){let m=f[p];Tg(m[De],m,c,i)}}}}}return i}function ey(n,e){return n[Xi].queries[e].queryList}function bT(n,e,t){let i=new Fd((t&4)===4);return tx(n,e,i,i.destroy),(e[Xi]??=new Eg).queries.push(new _g(i))-1}function fN(n,e,t){let i=Cn();return i.firstCreatePass&&(IT(i,new zd(n,e,t),-1),(e&2)===2&&(i.staticViewQueries=!0)),bT(i,Xe(),e)}function hN(n,e,t,i){let r=Cn();if(r.firstCreatePass){let o=vn();IT(r,new zd(e,t,i),o.index),mN(r,n),(t&2)===2&&(r.staticContentQueries=!0)}return bT(r,Xe(),t)}function pN(n){return n.split(",").map(e=>e.trim())}function IT(n,e,t){n.queries===null&&(n.queries=new xg),n.queries.track(new Sg(e,t))}function mN(n,e){let t=n.contentQueries||(n.contentQueries=[]),i=t.length?t[t.length-1]:-1;e!==i&&t.push(n.queries.length-1,e)}function ty(n,e){return n.queries.getByIndex(e)}function AT(n,e){let t=n[De],i=ty(t,e);return i.crossesNgTemplate?Tg(t,n,e,[]):wT(t,n,i,e)}function DT(n,e,t){let i,r=Pu(()=>{i._dirtyCounter();let o=yN(i,n);if(e&&o===void 0)throw new Te(-951,!1);return o});return i=r[gn],i._dirtyCounter=Dt(0),i._flatValue=void 0,r}function RT(n){return DT(!0,!1,n)}function NT(n){return DT(!0,!0,n)}function gN(n,e){let t=n[gn];t._lView=Xe(),t._queryIndex=e,t._queryList=ey(t._lView,e),t._queryList.onDirty(()=>t._dirtyCounter.update(i=>i+1))}function yN(n,e){let t=n._lView,i=n._queryIndex;if(t===void 0||i===void 0||t[Fe]&4)return e?void 0:vr;let r=ey(t,i),o=AT(t,i);return r.reset(o,yS),e?r.first:r._changesDetected||n._flatValue===void 0?n._flatValue=r.toArray():n._flatValue}var ca=class{},ff=class{};var Gd=class extends ca{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Vd(this);constructor(e,t,i,r=!0){super(),this.ngModuleType=e,this._parent=t;let o=Cm(e);this._bootstrapComponents=FS(o.bootstrap),this._r3Injector=Jm(e,t,[{provide:ca,useValue:this},{provide:mc,useValue:this.componentFactoryResolver},...i],yr(e),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},Wd=class extends ff{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new Gd(this.moduleType,e,[])}};var cc=class extends ca{injector;componentFactoryResolver=new Vd(this);instance=null;constructor(e){super();let t=new Ho([...e.providers,{provide:ca,useValue:this},{provide:mc,useValue:this.componentFactoryResolver}],e.parent||Yl(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function yc(n,e,t=null){return new cc({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var vN=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let i=bm(!1,t.type),r=i.length>0?yc([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,r)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ae({token:n,providedIn:"environment",factory:()=>new n(Ue(un))})}return n})();function Ln(n){return jd(()=>{let e=PT(n),t=it(ue({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Pg.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?r=>r.get(vN).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Sr.Emulated,styles:n.styles||vr,_:null,schemas:n.schemas||null,tView:null,id:""});e.standalone&&ao("NgStandalone"),LT(t);let i=n.dependencies;return t.directiveDefs=Yx(i,_N),t.pipeDefs=Yx(i,zE),t.id=SN(t),t})}function _N(n){return Kr(n)||wm(n)}function EN(n,e){if(n==null)return Wo;let t={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],o,s,a,l;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o,l=r[3]||null):(o=r,s=r,a=of.None,l=null),t[o]=[i,a,l],e[o]=s}return t}function xN(n){if(n==null)return Wo;let e={};for(let t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function os(n){return jd(()=>{let e=PT(n);return LT(e),e})}function PT(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputConfig:n.inputs||Wo,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||vr,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:EN(n.inputs,e),outputs:xN(n.outputs),debugInfo:null}}function LT(n){n.features?.forEach(e=>e(n))}function Yx(n,e){return n?()=>{let t=typeof n=="function"?n():n,i=[];for(let r of t){let o=e(r);o!==null&&i.push(o)}return i}:null}function SN(n){let e=0,t=typeof n.consts=="function"?"":n.consts,i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,t,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of i.join("|"))e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function TN(n,e,t,i,r,o,s,a){if(t.firstCreatePass){n.mergedAttrs=Zd(n.mergedAttrs,n.attrs);let u=n.tView=Bg(2,n,r,o,s,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);t.queries!==null&&(t.queries.template(t,n),u.queries=t.queries.embeddedTView(n))}a&&(n.flags|=a),ta(n,!1);let l=MN(t,e,n,i);xd()&&Yg(t,e,l,n),oa(l,e);let c=dT(l,e,l,n);e[i+dn]=c,Hg(e,c),sN(c,n,e)}function qd(n,e,t,i,r,o,s,a,l,c,u){let f=t+dn,p;if(e.firstCreatePass){if(p=uf(e,f,4,s||null,a||null),c!=null){let m=ji(e.consts,c);p.localNames=[];for(let v=0;v<m.length;v+=2)p.localNames.push(m[v],-1)}}else p=e.data[f];return TN(p,n,e,t,i,r,o,l),c!=null&&Jg(n,p,u),p}var MN=CN;function CN(n,e,t,i){return Sd(!0),e[Ht].createComment("")}var ny=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var iy=new Oe("");function vc(n){return!!n&&typeof n.then=="function"}function FT(n){return!!n&&typeof n.subscribe=="function"}var OT=new Oe("");var ry=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i});appInits=se(OT,{optional:!0})??[];injector=se(ui);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let r of this.appInits){let o=Pn(this.injector,r);if(vc(o))t.push(o);else if(FT(o)){let s=new Promise((a,l)=>{o.subscribe({complete:a,error:l})});t.push(s)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),t.length===0&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),hf=new Oe("");function kT(){Vp(()=>{let n="";throw new Te(600,n)})}function UT(n){return n.isBoundToModule}var wN=10;var ss=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=se(mi);afterRenderManager=se(YS);zonelessEnabled=se(ec);rootEffectScheduler=se(tc);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new tn;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=se(xr);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(gt(t=>!t))}constructor(){se(pc,{optional:!0})}whenStable(){let t;return new Promise(i=>{t=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{t.unsubscribe()})}_injector=se(un);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,i){return this.bootstrapImpl(t,i)}bootstrapImpl(t,i,r=ui.NULL){return this._injector.get(rn).run(()=>{Rt(10);let s=t instanceof df;if(!this._injector.get(ry).done){let v="";throw new Te(405,v)}let l;s?l=t:l=this._injector.get(mc).resolveComponentFactory(t),this.componentTypes.push(l.componentType);let c=UT(l)?void 0:this._injector.get(ca),u=i||l.selector,f=l.create(r,[],u,c),p=f.location.nativeElement,m=f.injector.get(iy,null);return m?.registerApplication(p),f.onDestroy(()=>{this.detachView(f.hostView),ic(this.components,f),m?.unregisterApplication(p)}),this._loadComponent(f),Rt(11,f),f})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){Rt(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(Gg.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Te(101,!1);let t=Pe(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Pe(t),this.afterTick.next(),Rt(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(ts,null,{optional:!0}));let t=0;for(;this.dirtyFlags!==0&&t++<wN;)Rt(14),this.synchronizeOnce(),Rt(15)}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!i&&!Zl(r))continue;let o=i&&!this.zonelessEnabled?0:1;aT(r,o),t=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>Zl(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){let i=t;ic(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(t),this._injector.get(hf,[]).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>ic(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Te(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ic(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Bt(n,e,t,i){let r=Xe(),o=Ko();if(Mr(r,o,e)){let s=Cn(),a=Ed();nR(a,r,n,e,t,i)}return Bt}var W7=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var Mg=class{destroy(e){}updateValue(e,t){}swap(e,t){let i=Math.min(e,t),r=Math.max(e,t),o=this.detach(r);if(r-i>1){let s=this.detach(i);this.attach(i,o),this.attach(r,s)}else this.attach(i,o)}move(e,t){this.attach(t,this.detach(e,!0))}};function ng(n,e,t,i,r){return n===t&&Object.is(e,i)?1:Object.is(r(n,e),r(t,i))?-1:0}function bN(n,e,t){let i,r,o=0,s=n.length-1,a=void 0;if(Array.isArray(e)){let l=e.length-1;for(;o<=s&&o<=l;){let c=n.at(o),u=e[o],f=ng(o,c,o,u,t);if(f!==0){f<0&&n.updateValue(o,u),o++;continue}let p=n.at(s),m=e[l],v=ng(s,p,l,m,t);if(v!==0){v<0&&n.updateValue(s,m),s--,l--;continue}let _=t(o,c),y=t(s,p),g=t(o,u);if(Object.is(g,y)){let T=t(l,m);Object.is(T,_)?(n.swap(o,s),n.updateValue(s,m),l--,s--):n.move(s,o),n.updateValue(o,u),o++;continue}if(i??=new $d,r??=Jx(n,o,s,t),Cg(n,i,o,g))n.updateValue(o,u),o++,s++;else if(r.has(g))i.set(_,n.detach(o)),s--;else{let T=n.create(o,e[o]);n.attach(o,T),o++,s++}}for(;o<=l;)Xx(n,i,t,o,e[o]),o++}else if(e!=null){let l=e[Symbol.iterator](),c=l.next();for(;!c.done&&o<=s;){let u=n.at(o),f=c.value,p=ng(o,u,o,f,t);if(p!==0)p<0&&n.updateValue(o,f),o++,c=l.next();else{i??=new $d,r??=Jx(n,o,s,t);let m=t(o,f);if(Cg(n,i,o,m))n.updateValue(o,f),o++,s++,c=l.next();else if(!r.has(m))n.attach(o,n.create(o,f)),o++,s++,c=l.next();else{let v=t(o,u);i.set(v,n.detach(o)),s--}}}for(;!c.done;)Xx(n,i,t,n.length,c.value),c=l.next()}for(;o<=s;)n.destroy(n.detach(s--));i?.forEach(l=>{n.destroy(l)})}function Cg(n,e,t,i){return e!==void 0&&e.has(i)?(n.attach(t,e.get(i)),e.delete(i),!0):!1}function Xx(n,e,t,i,r){if(Cg(n,e,i,t(i,r)))n.updateValue(i,r);else{let o=n.create(i,r);n.attach(i,o)}}function Jx(n,e,t,i){let r=new Set;for(let o=e;o<=t;o++)r.add(i(o,n.at(o)));return r}var $d=class{kvMap=new Map;_vMap=void 0;has(e){return this.kvMap.has(e)}delete(e){if(!this.has(e))return!1;let t=this.kvMap.get(e);return this._vMap!==void 0&&this._vMap.has(t)?(this.kvMap.set(e,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(e),!0}get(e){return this.kvMap.get(e)}set(e,t){if(this.kvMap.has(e)){let i=this.kvMap.get(e);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,t)}else this.kvMap.set(e,t)}forEach(e){for(let[t,i]of this.kvMap)if(e(i,t),this._vMap!==void 0){let r=this._vMap;for(;r.has(i);)i=r.get(i),e(i,t)}}};function jt(n,e,t,i,r,o,s,a){ao("NgControlFlow");let l=Xe(),c=Cn(),u=ji(c.consts,o);return qd(l,c,n,e,t,i,r,u,256,s,a),oy}function oy(n,e,t,i,r,o,s,a){ao("NgControlFlow");let l=Xe(),c=Cn(),u=ji(c.consts,o);return qd(l,c,n,e,t,i,r,u,512,s,a),oy}function Zt(n,e){ao("NgControlFlow");let t=Xe(),i=Ko(),r=t[i]!==gi?t[i]:-1,o=r!==-1?Yd(t,dn+r):void 0,s=0;if(Mr(t,i,n)){let a=Pe(null);try{if(o!==void 0&&hT(o,s),n!==-1){let l=dn+n,c=Yd(t,l),u=Ag(t[De],l),f=mT(c,u,t),p=lf(t,u,e,{dehydratedView:f});cf(c,p,s,sc(u,f))}}finally{Pe(a)}}else if(o!==void 0){let a=fT(o,s);a!==void 0&&(a[Wt]=e)}}var wg=class{lContainer;$implicit;$index;constructor(e,t,i){this.lContainer=e,this.$implicit=t,this.$index=i}get $count(){return this.lContainer.length-Jt}};function sy(n,e){return e}var bg=class{hasEmptyBlock;trackByFn;liveCollection;constructor(e,t,i){this.hasEmptyBlock=e,this.trackByFn=t,this.liveCollection=i}};function ha(n,e,t,i,r,o,s,a,l,c,u,f,p){ao("NgControlFlow");let m=Xe(),v=Cn(),_=l!==void 0,y=Xe(),g=a?s.bind(y[Zn][Wt]):s,T=new bg(_,g);y[dn+n]=T,qd(m,v,n+1,e,t,i,r,ji(v.consts,o),256),_&&qd(m,v,n+2,l,c,u,f,ji(v.consts,p),512)}var Ig=class extends Mg{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(e,t,i){super(),this.lContainer=e,this.hostLView=t,this.templateTNode=i}get length(){return this.lContainer.length-Jt}at(e){return this.getLView(e)[Wt].$implicit}attach(e,t){let i=t[Zs];this.needsIndexUpdate||=e!==this.length,cf(this.lContainer,t,e,sc(this.templateTNode,i))}detach(e,t){return this.needsIndexUpdate||=e!==this.length-1,t&&IN(this.lContainer,e),AN(this.lContainer,e)}create(e,t){let i=mg(this.lContainer,this.templateTNode.tView.ssrId),r=lf(this.hostLView,this.templateTNode,new wg(this.lContainer,t,e),{dehydratedView:i});return this.operationsCounter?.recordCreate(),r}destroy(e){sf(e[De],e),this.operationsCounter?.recordDestroy()}updateValue(e,t){this.getLView(e)[Wt].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let e=0;e<this.length;e++)this.getLView(e)[Wt].$index=e}getLView(e){return DN(this.lContainer,e)}};function pa(n){let e=Pe(null),t=Er();try{let i=Xe(),r=i[De],o=i[t],s=t+1,a=Yd(i,s);if(o.liveCollection===void 0){let c=Ag(r,s);o.liveCollection=new Ig(a,i,c)}else o.liveCollection.reset();let l=o.liveCollection;if(bN(l,n,o.trackByFn),l.updateIndexes(),o.hasEmptyBlock){let c=Ko(),u=l.length===0;if(Mr(i,c,u)){let f=t+2,p=Yd(i,f);if(u){let m=Ag(r,f),v=mT(p,m,i),_=lf(i,m,void 0,{dehydratedView:v});cf(p,_,0,sc(m,v))}else r.firstUpdatePass&&wR(p),hT(p,0)}}}finally{Pe(e)}}function Yd(n,e){return n[e]}function IN(n,e){if(n.length<=Jt)return;let t=Jt+e,i=n[t];i&&i[Yo]&&(i[Yo].skipLeaveAnimations=!0)}function AN(n,e){return lc(n,e)}function DN(n,e){return fT(n,e)}function Ag(n,e){return jl(n,e)}function _c(n,e,t){let i=Xe(),r=Ko();if(Mr(i,r,e)){let o=Cn(),s=Ed();jD(s,i,n,e,i[Ht],t)}return _c}function jx(n,e,t,i,r){jg(e,n,t,r?"class":"style",i)}function ct(n,e,t,i){let r=Xe(),o=r[De],s=n+dn,a=o.firstCreatePass?_T(s,r,2,e,tR,rx(),t,i):o.data[s];if(eT(a,r,n,e,BT),hd(a)){let l=r[De];KS(l,r,a),DS(l,a,r)}return i!=null&&Jg(r,a),ct}function vt(){let n=Cn(),e=vn(),t=tT(e);return n.firstCreatePass&&ET(n,t),Hm(t)&&zm(),Vm(),t.classesWithoutHost!=null&&RA(t)&&jx(n,t,Xe(),t.classesWithoutHost,!0),t.stylesWithoutHost!=null&&NA(t)&&jx(n,t,Xe(),t.stylesWithoutHost,!1),vt}function yi(n,e,t,i){return ct(n,e,t,i),vt(),yi}function j(n,e,t,i){let r=Xe(),o=r[De],s=n+dn,a=o.firstCreatePass?HR(s,o,2,e,t,i):o.data[s];return eT(a,r,n,e,BT),i!=null&&Jg(r,a),j}function J(){let n=vn(),e=tT(n);return Hm(e)&&zm(),Vm(),J}function Fn(n,e,t,i){return j(n,e,t,i),J(),Fn}var BT=(n,e,t,i,r)=>(Sd(!0),kS(e[Ht],i,Ex()));function En(){return Xe()}function Kt(n,e,t){let i=Xe(),r=Ko();if(Mr(i,r,e)){let o=Cn(),s=Ed();QS(s,i,n,e,i[Ht],t)}return Kt}var Ec="en-US";var RN=Ec;function VT(n){typeof n=="string"&&(RN=n.toLowerCase().replace(/_/g,"-"))}function Ri(n,e,t){let i=Xe(),r=Cn(),o=vn();return NN(r,i,i[Ht],o,n,e,t),Ri}function Mt(n,e,t){let i=Xe(),r=Cn(),o=vn();return(o.type&3||t)&&xT(o,r,i,t,i[Ht],n,e,Dd(o,i,e)),Mt}function NN(n,e,t,i,r,o,s){let a=!0,l=null;if((i.type&3||s)&&(l??=Dd(i,e,o),xT(i,n,e,s,t,r,o,l)&&(a=!1)),a){let c=i.outputs?.[r],u=i.hostDirectiveOutputs?.[r];if(u&&u.length)for(let f=0;f<u.length;f+=2){let p=u[f],m=u[f+1];l??=Dd(i,e,o),Wx(i,e,p,m,r,l)}if(c&&c.length)for(let f of c)l??=Dd(i,e,o),Wx(i,e,f,r,r,l)}}function ut(n=1){return _x(n)}function ay(n,e,t,i){hN(n,e,t,i)}function ly(n){let e=Xe(),t=Cn(),i=yd();Kl(i+1);let r=ty(t,i);if(n.dirty&&ZE(e)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let o=AT(e,i);n.reset(o,yS),n.notifyOnChanges()}return!0}return!1}function cy(){return ey(Xe(),yd())}function ma(n,e,t,i){gN(n,fN(e,t,i))}function xc(n=1){Kl(yd()+n)}function uy(n){let e=lx();return jE(e,dn+n)}function Cd(n,e){return n<<17|e<<2}function ns(n){return n>>17&32767}function PN(n){return(n&2)==2}function LN(n,e){return n&131071|e<<17}function Dg(n){return n|2}function ua(n){return(n&131068)>>2}function ig(n,e){return n&-131069|e<<2}function FN(n){return(n&1)===1}function Rg(n){return n|1}function ON(n,e,t,i,r,o){let s=o?e.classBindings:e.styleBindings,a=ns(s),l=ua(s);n[i]=t;let c=!1,u;if(Array.isArray(t)){let f=t;u=f[1],(u===null||js(f,u)>0)&&(c=!0)}else u=t;if(r)if(l!==0){let p=ns(n[a+1]);n[i+1]=Cd(p,a),p!==0&&(n[p+1]=ig(n[p+1],i)),n[a+1]=LN(n[a+1],i)}else n[i+1]=Cd(a,0),a!==0&&(n[a+1]=ig(n[a+1],i)),a=i;else n[i+1]=Cd(l,0),a===0?a=i:n[l+1]=ig(n[l+1],i),l=i;c&&(n[i+1]=Dg(n[i+1])),Zx(n,u,i,!0),Zx(n,u,i,!1),kN(e,u,n,i,o),s=Cd(a,l),o?e.classBindings=s:e.styleBindings=s}function kN(n,e,t,i,r){let o=r?n.residualClasses:n.residualStyles;o!=null&&typeof e=="string"&&js(o,e)>=0&&(t[i+1]=Rg(t[i+1]))}function Zx(n,e,t,i){let r=n[t+1],o=e===null,s=i?ns(r):ua(r),a=!1;for(;s!==0&&(a===!1||o);){let l=n[s],c=n[s+1];UN(l,e)&&(a=!0,n[s+1]=i?Rg(c):Dg(c)),s=i?ns(c):ua(c)}a&&(n[t+1]=i?Dg(r):Rg(r))}function UN(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?js(n,e)>=0:!1}function Qn(n,e){return BN(n,e,null,!0),Qn}function BN(n,e,t,i){let r=Xe(),o=Cn(),s=$m(2);if(o.firstUpdatePass&&HN(o,n,s,i),e!==gi&&Mr(r,s,e)){let a=o.data[Er()];$N(o,a,r,r[Ht],n,r[s+1]=YN(e,t),i,s)}}function VN(n,e){return e>=n.expandoStartIndex}function HN(n,e,t,i){let r=n.data;if(r[t+1]===null){let o=r[Er()],s=VN(n,t);XN(o,i)&&e===null&&!s&&(e=!1),e=zN(r,o,e,i),ON(r,o,e,t,s,i)}}function zN(n,e,t,i){let r=mx(n),o=i?e.residualClasses:e.residualStyles;if(r===null)(i?e.classBindings:e.styleBindings)===0&&(t=rg(null,n,e,t,i),t=uc(t,e.attrs,i),o=null);else{let s=e.directiveStylingLast;if(s===-1||n[s]!==r)if(t=rg(r,n,e,t,i),o===null){let l=GN(n,e,i);l!==void 0&&Array.isArray(l)&&(l=rg(null,n,e,l[1],i),l=uc(l,e.attrs,i),WN(n,e,i,l))}else o=qN(n,e,i)}return o!==void 0&&(i?e.residualClasses=o:e.residualStyles=o),t}function GN(n,e,t){let i=t?e.classBindings:e.styleBindings;if(ua(i)!==0)return n[ns(i)]}function WN(n,e,t,i){let r=t?e.classBindings:e.styleBindings;n[ns(r)]=i}function qN(n,e,t){let i,r=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<r;o++){let s=n[o].hostAttrs;i=uc(i,s,t)}return uc(i,e.attrs,t)}function rg(n,e,t,i,r){let o=null,s=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<s&&(o=e[a],i=uc(i,o.hostAttrs,r),o!==n);)a++;return n!==null&&(t.directiveStylingLast=a),i}function uc(n,e,t){let i=t?1:2,r=-1;if(e!==null)for(let o=0;o<e.length;o++){let s=e[o];typeof s=="number"?r=s:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),HE(n,s,t?!0:e[++o]))}return n===void 0?null:n}function $N(n,e,t,i,r,o,s,a){if(!(e.type&3))return;let l=n.data,c=l[a+1],u=FN(c)?Kx(l,e,t,r,ua(c),s):void 0;if(!Xd(u)){Xd(o)||PN(c)&&(o=Kx(l,null,t,r,a,s));let f=Lm(Er(),t);qD(i,s,f,r,o)}}function Kx(n,e,t,i,r,o){let s=e===null,a;for(;r>0;){let l=n[r],c=Array.isArray(l),u=c?l[1]:l,f=u===null,p=t[r+1];p===gi&&(p=f?vr:void 0);let m=f?ud(p,i):u===i?p:void 0;if(c&&!Xd(m)&&(m=ud(l,i)),Xd(m)&&(a=m,s))return a;let v=n[r+1];r=s?ns(v):ua(v)}if(e!==null){let l=o?e.residualClasses:e.residualStyles;l!=null&&(a=ud(l,i))}return a}function Xd(n){return n!==void 0}function YN(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=yr(nf(n)))),n}function XN(n,e){return(n.flags&(e?8:16))!==0}function Z(n,e=""){let t=Xe(),i=Cn(),r=n+dn,o=i.firstCreatePass?uf(i,r,1,e,null):i.data[r],s=JN(i,t,o,e,n);t[r]=s,xd()&&Yg(i,t,s,o),ta(o,!1)}var JN=(n,e,t,i,r)=>(Sd(!0),gD(e[Ht],i));function HT(n,e,t,i=""){return Mr(n,Ko(),t)?e+Go(t)+i:gi}function zT(n,e,t,i,r,o=""){let s=ux(),a=WR(n,s,t,r);return $m(2),a?e+Go(t)+i+Go(r)+o:gi}function Wn(n){return as("",n),Wn}function as(n,e,t){let i=Xe(),r=HT(i,n,e,t);return r!==gi&&GT(i,Er(),r),as}function pf(n,e,t,i,r){let o=Xe(),s=zT(o,n,e,t,i,r);return s!==gi&&GT(o,Er(),s),pf}function GT(n,e,t){let i=Lm(e,n);yD(n[Ht],i,t)}function mf(n,e,t=""){return HT(Xe(),n,e,t)}function dy(n,e,t,i,r=""){return zT(Xe(),n,e,t,i,r)}function ga(n,e,t){let i=cx()+n,r=Xe();return r[i]===gi?zR(r,i,t?e.call(t):e()):GR(r,i)}var Jd=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},fy=(()=>{class n{compileModuleSync(t){return new Wd(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let i=this.compileModuleSync(t),r=Cm(t),o=FS(r.declarations).reduce((s,a)=>{let l=Kr(a);return l&&s.push(new la(l)),s},[]);return new Jd(i,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var jN=(()=>{class n{zone=se(rn);changeDetectionScheduler=se($i);applicationRef=se(ss);applicationErrorHandler=se(mi);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function WT({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new rn(it(ue({},qT()),{scheduleInRootZone:t})),[{provide:rn,useFactory:n},{provide:Zr,multi:!0,useFactory:()=>{let i=se(jN,{optional:!0});return()=>i.initialize()}},{provide:Zr,multi:!0,useFactory:()=>{let i=se(ZN);return()=>{i.initialize()}}},e===!0?{provide:Zm,useValue:!0}:[],{provide:Td,useValue:t??WS},{provide:mi,useFactory:()=>{let i=se(rn),r=se(un),o;return s=>{i.runOutsideAngular(()=>{r.destroyed&&!o?setTimeout(()=>{throw s}):(o??=r.get(wi),o.handleError(s))})}}}]}function qT(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var ZN=(()=>{class n{subscription=new Yt;initialized=!1;zone=se(rn);pendingTasks=se(xr);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{rn.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{rn.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var hy=(()=>{class n{applicationErrorHandler=se(mi);appRef=se(ss);taskService=se(xr);ngZone=se(rn);zonelessEnabled=se(ec);tracing=se(pc,{optional:!0});disableScheduling=se(Zm,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Yt;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ud):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(se(Td,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof oc||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let i=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,i=!0;break}case 12:{this.appRef.dirtyFlags|=16,i=!0;break}case 13:{this.appRef.dirtyFlags|=2,i=!0;break}case 11:{i=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;let r=this.useMicrotaskScheduler?Lx:qS;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>r(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>r(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ud+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.taskService.remove(t),this.applicationErrorHandler(i)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,Lx(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function py(){return ao("NgZoneless"),ql([{provide:$i,useExisting:hy},{provide:rn,useClass:oc},{provide:ec,useValue:!0},{provide:Td,useValue:!1},[]])}function KN(){return typeof $localize<"u"&&$localize.locale||Ec}var my=new Oe("",{providedIn:"root",factory:()=>se(my,{optional:!0,skipSelf:!0})||KN()});function wr(n){return AE(n)}var gy=class{[gn];constructor(e){this[gn]=e}destroy(){this[gn].destroy()}};function lo(n,e){let t=e?.injector??se(ui),i=e?.manualCleanup!==!0?t.get(oo):null,r,o=t.get(Ql,null,{optional:!0}),s=t.get($i);return o!==null?(r=t1(o.view,s,n),i instanceof Hl&&i._lView===o.view&&(i=null)):r=n1(n,t.get(tc),s),r.injector=t,i!==null&&(r.onDestroyFn=i.onDestroy(()=>r.destroy())),new gy(r)}var $T=it(ue({},DE),{cleanupFns:void 0,zone:null,onDestroyFn:Qo,run(){let n=na(!1);try{RE(this)}finally{na(n)}},cleanup(){if(!this.cleanupFns?.length)return;let n=Pe(null);try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[],Pe(n)}}}),QN=it(ue({},$T),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){Po(this),this.onDestroyFn(),this.cleanup(),this.scheduler.remove(this)}}),e1=it(ue({},$T),{consumerMarkedDirty(){this.view[Fe]|=8192,Zo(this.view),this.notifier.notify(13)},destroy(){Po(this),this.onDestroyFn(),this.cleanup(),this.view[_r]?.delete(this)}});function t1(n,e,t){let i=Object.create(e1);return i.view=n,i.zone=typeof Zone<"u"?Zone.current:null,i.notifier=e,i.fn=YT(i,t),n[_r]??=new Set,n[_r].add(i),i.consumerMarkedDirty(i),i}function n1(n,e,t){let i=Object.create(QN);return i.fn=YT(i,n),i.scheduler=e,i.notifier=t,i.zone=typeof Zone<"u"?Zone.current:null,i.scheduler.add(i),i.notifier.notify(12),i}function YT(n,e){return()=>{e(t=>(n.cleanupFns??=[]).push(t))}}var jT=Symbol("InputSignalNode#UNSET"),p1=it(ue({},Lu),{transformFn:void 0,applyValueToInputSignal(n,e){Os(n,e)}});function ZT(n,e){let t=Object.create(p1);t.value=n,t.transformFn=e?.transform;function i(){if(Ns(t),t.value===jT){let r=null;throw new Te(-950,r)}return t.value}return i[gn]=t,i}var yf=class{attributeName;constructor(e){this.attributeName=e}__NG_ELEMENT_ID__=()=>fc(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},m1=new Oe("");m1.__NG_ELEMENT_ID__=n=>{let e=vn();if(e===null)throw new Te(204,!1);if(e.type&2)return e.value;if(n&8)return null;throw new Te(204,!1)};function XT(n,e){return ZT(n,e)}function g1(n){return ZT(jT,n)}var KT=(XT.required=g1,XT);function JT(n,e){return RT(e)}function y1(n,e){return NT(e)}var Tc=(JT.required=y1,JT);var yy=new Oe(""),v1=new Oe("");function Sc(n){return!n.moduleRef}function _1(n){let e=Sc(n)?n.r3Injector:n.moduleRef.injector,t=e.get(rn);return t.run(()=>{Sc(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=e.get(mi),r;if(t.runOutsideAngular(()=>{r=t.onError.subscribe({next:i})}),Sc(n)){let o=()=>e.destroy(),s=n.platformInjector.get(yy);s.add(o),e.onDestroy(()=>{r.unsubscribe(),s.delete(o)})}else{let o=()=>n.moduleRef.destroy(),s=n.platformInjector.get(yy);s.add(o),n.moduleRef.onDestroy(()=>{ic(n.allPlatformModules,n.moduleRef),r.unsubscribe(),s.delete(o)})}return x1(i,t,()=>{let o=e.get(xr),s=o.add(),a=e.get(ry);return a.runInitializers(),a.donePromise.then(()=>{let l=e.get(my,Ec);if(VT(l||Ec),!e.get(v1,!0))return Sc(n)?e.get(ss):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(Sc(n)){let u=e.get(ss);return n.rootComponent!==void 0&&u.bootstrap(n.rootComponent),u}else return E1?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>void o.remove(s))})})}var E1;function x1(n,e,t){try{let i=t();return vc(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n(i)),i}}var gf=null;function S1(n=[],e){return ui.create({name:e,providers:[{provide:$l,useValue:"platform"},{provide:yy,useValue:new Set([()=>gf=null])},...n]})}function T1(n=[]){if(gf)return gf;let e=S1(n);return gf=e,kT(),M1(e),e}function M1(n){let e=n.get(ef,null);Pn(n,()=>{e?.forEach(t=>t())})}var Mc=(()=>{class n{static __NG_ELEMENT_ID__=C1}return n})();function C1(n){return w1(vn(),Xe(),(n&16)===16)}function w1(n,e,t){if(no(n)&&!t){let i=pi(n.index,e);return new so(i,i)}else if(n.type&175){let i=e[Zn];return new so(i,e)}return null}function QT(n){let{rootComponent:e,appProviders:t,platformProviders:i,platformRef:r}=n;Rt(8);try{let o=r?.injector??T1(i),s=[WT({}),{provide:$i,useExisting:hy},Sx,...t||[]],a=new cc({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return _1({r3Injector:a.injector,platformInjector:o,rootComponent:e})}catch(o){return Promise.reject(o)}finally{Rt(9)}}function _f(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}var nM=null;function br(){return nM}function vy(n){nM??=n}var Cc=class{},wc=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(iM),providedIn:"platform"})}return n})();var iM=(()=>{class n extends wc{_location;_history;_doc=se(_n);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return br().getBaseHref(this._doc)}onPopState(t){let i=br().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){let i=br().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,i,r){this._history.pushState(t,i,r)}replaceState(t,i,r){this._history.replaceState(t,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function Ef(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function eM(n){let e=n.search(/#|\?|$/);return n[e-1]==="/"?n.slice(0,e-1)+n.slice(e):n}function Ni(n){return n&&n[0]!=="?"?`?${n}`:n}var Qi=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(_y),providedIn:"root"})}return n})(),xf=new Oe(""),_y=(()=>{class n extends Qi{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,i){super(),this._platformLocation=t,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??se(_n).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Ef(this._baseHref,t)}path(t=!1){let i=this._platformLocation.pathname+Ni(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,o){let s=this.prepareExternalUrl(r+Ni(o));this._platformLocation.pushState(t,i,s)}replaceState(t,i,r,o){let s=this.prepareExternalUrl(r+Ni(o));this._platformLocation.replaceState(t,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(i){return new(i||n)(Ue(wc),Ue(xf,8))};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ls=(()=>{class n{_subject=new tn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let i=this._locationStrategy.getBaseHref();this._basePath=A1(eM(tM(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Ni(i))}normalize(t){return n.stripTrailingSlash(I1(this._basePath,tM(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ni(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ni(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=Ni;static joinWithSlash=Ef;static stripTrailingSlash=eM;static \u0275fac=function(i){return new(i||n)(Ue(Qi))};static \u0275prov=Ae({token:n,factory:()=>b1(),providedIn:"root"})}return n})();function b1(){return new ls(Ue(Qi))}function I1(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function tM(n){return n.replace(/\/index.html$/,"")}function A1(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var Ey=(()=>{class n extends Qi{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(t,i){super(),this._platformLocation=t,i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(t){let i=Ef(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,o){let s=this.prepareExternalUrl(r+Ni(o))||this._platformLocation.pathname;this._platformLocation.pushState(t,i,s)}replaceState(t,i,r,o){let s=this.prepareExternalUrl(r+Ni(o))||this._platformLocation.pathname;this._platformLocation.replaceState(t,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(i){return new(i||n)(Ue(wc),Ue(xf,8))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})();function xy(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let i=t.indexOf("="),[r,o]=i==-1?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}var bc=class{};var rM="browser";var Ic=class{_doc;constructor(e){this._doc=e}manager},Sf=(()=>{class n extends Ic{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r,o){return t.addEventListener(i,r,o),()=>this.removeEventListener(t,i,r,o)}removeEventListener(t,i,r,o){return t.removeEventListener(i,r,o)}static \u0275fac=function(i){return new(i||n)(Ue(_n))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})(),Mf=new Oe(""),wy=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,i){this._zone=i,t.forEach(s=>{s.manager=this});let r=t.filter(s=>!(s instanceof Sf));this._plugins=r.slice().reverse();let o=t.find(s=>s instanceof Sf);o&&this._plugins.push(o)}addEventListener(t,i,r,o){return this._findPluginFor(i).addEventListener(t,i,r,o)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(o=>o.supports(t)),!i)throw new Te(5101,!1);return this._eventNameToPlugin.set(t,i),i}static \u0275fac=function(i){return new(i||n)(Ue(Mf),Ue(rn))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})(),Sy="ng-app-id";function oM(n){for(let e of n)e.remove()}function sM(n,e){let t=e.createElement("style");return t.textContent=n,t}function L1(n,e,t,i){let r=n.head?.querySelectorAll(`style[${Sy}="${e}"],link[${Sy}="${e}"]`);if(r)for(let o of r)o.removeAttribute(Sy),o instanceof HTMLLinkElement?i.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&t.set(o.textContent,{usage:0,elements:[o]})}function My(n,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var by=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,i,r,o={}){this.doc=t,this.appId=i,this.nonce=r,L1(t,i,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,i){for(let r of t)this.addUsage(r,this.inline,sM);i?.forEach(r=>this.addUsage(r,this.external,My))}removeStyles(t,i){for(let r of t)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(t,i,r){let o=i.get(t);o?o.usage++:i.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,r(t,this.doc)))})}removeUsage(t,i){let r=i.get(t);r&&(r.usage--,r.usage<=0&&(oM(r.elements),i.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])oM(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[i,{elements:r}]of this.inline)r.push(this.addElement(t,sM(i,this.doc)));for(let[i,{elements:r}]of this.external)r.push(this.addElement(t,My(i,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,i){return this.nonce&&i.setAttribute("nonce",this.nonce),t.appendChild(i)}static \u0275fac=function(i){return new(i||n)(Ue(_n),Ue(Qd),Ue(tf,8),Ue(fa))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})(),Ty={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Iy=/%COMP%/g;var lM="%COMP%",F1=`_nghost-${lM}`,O1=`_ngcontent-${lM}`,k1=!0,U1=new Oe("",{providedIn:"root",factory:()=>k1});function B1(n){return O1.replace(Iy,n)}function V1(n){return F1.replace(Iy,n)}function cM(n,e){return e.map(t=>t.replace(Iy,n))}var Ay=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,i,r,o,s,a,l,c=null,u=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=!1,this.defaultRenderer=new Ac(t,s,l,this.platformIsServer,this.tracingService)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;let r=this.getOrCreateRenderer(t,i);return r instanceof Tf?r.applyToHost(t):r instanceof Dc&&r.applyStyles(),r}getOrCreateRenderer(t,i){let r=this.rendererByCompId,o=r.get(i.id);if(!o){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,f=this.platformIsServer,p=this.tracingService;switch(i.encapsulation){case Sr.Emulated:o=new Tf(l,c,i,this.appId,u,s,a,f,p);break;case Sr.ShadowDom:return new Cy(l,c,t,i,s,a,this.nonce,f,p);default:o=new Dc(l,c,i,u,s,a,f,p);break}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(i){return new(i||n)(Ue(wy),Ue(by),Ue(Qd),Ue(U1),Ue(_n),Ue(fa),Ue(rn),Ue(tf),Ue(pc,8))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})(),Ac=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,i,r,o){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.tracingService=o}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(Ty[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(aM(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(aM(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){t.remove()}selectRootElement(e,t){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new Te(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;let o=Ty[r];o?e.setAttributeNS(o,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){let r=Ty[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Tr.DashCase|Tr.Important)?e.style.setProperty(t,i,r&Tr.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Tr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e!=null&&(e[t]=i)}setValue(e,t){e.nodeValue=t}listen(e,t,i,r){if(typeof e=="string"&&(e=br().getGlobalEventTarget(this.doc,e),!e))throw new Te(5102,!1);let o=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(e,t,o)),this.eventManager.addEventListener(e,t,o,r)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;e(t)===!1&&t.preventDefault()}}};function aM(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Cy=class extends Ac{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,i,r,o,s,a,l,c){super(e,o,s,l,c),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=r.styles;u=cM(r.id,u);for(let p of u){let m=document.createElement("style");a&&m.setAttribute("nonce",a),m.textContent=p,this.shadowRoot.appendChild(m)}let f=r.getExternalStyles?.();if(f)for(let p of f){let m=My(p,o);a&&m.setAttribute("nonce",a),this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Dc=class extends Ac{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,i,r,o,s,a,l,c){super(e,o,s,a,l),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r;let u=i.styles;this.styles=c?cM(c,u):u,this.styleUrls=i.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&sa.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Tf=class extends Dc{contentAttr;hostAttr;constructor(e,t,i,r,o,s,a,l,c){let u=r+"-"+i.id;super(e,t,i,o,s,a,l,c,u),this.contentAttr=B1(u),this.hostAttr=V1(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}};var Cf=class n extends Cc{supportsDOMEvents=!0;static makeCurrent(){vy(new n)}onAndCancel(e,t,i,r){return e.addEventListener(t,i,r),()=>{e.removeEventListener(t,i,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=H1();return t==null?null:z1(t)}resetBaseElement(){Rc=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return xy(document.cookie,e)}},Rc=null;function H1(){return Rc=Rc||document.head.querySelector("base"),Rc?Rc.getAttribute("href"):null}function z1(n){return new URL(n,document.baseURI).pathname}var G1=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})(),uM=["alt","control","meta","shift"],W1={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},q1={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},dM=(()=>{class n extends Ic{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,i,r,o){let s=n.parseEventName(i),a=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>br().onAndCancel(t,s.domEventName,a,o))}static parseEventName(t){let i=t.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let o=n._normalizeKey(i.pop()),s="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),s="code."),uM.forEach(c=>{let u=i.indexOf(c);u>-1&&(i.splice(u,1),s+=c+".")}),s+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=r,l.fullKey=s,l}static matchEventFullKeyCode(t,i){let r=W1[t.key]||t.key,o="";return i.indexOf("code.")>-1&&(r=t.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),uM.forEach(s=>{if(s!==r){let a=q1[s];a(t)&&(o+=s+".")}}),o+=r,o===i)}static eventCallback(t,i,r){return o=>{n.matchEventFullKeyCode(o,t)&&r.runGuarded(()=>i(o))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(i){return new(i||n)(Ue(_n))};static \u0275prov=Ae({token:n,factory:n.\u0275fac})}return n})();function Dy(n,e,t){let i=ue({rootComponent:n,platformRef:t?.platformRef},$1(e));return QT(i)}function $1(n){return{appProviders:[...Z1,...n?.providers??[]],platformProviders:j1}}function Y1(){Cf.makeCurrent()}function X1(){return new wi}function J1(){return Lg(document),document}var j1=[{provide:fa,useValue:rM},{provide:ef,useValue:Y1,multi:!0},{provide:_n,useFactory:J1}];var Z1=[{provide:$l,useValue:"root"},{provide:wi,useFactory:X1},{provide:Mf,useClass:Sf,multi:!0,deps:[_n]},{provide:Mf,useClass:dM,multi:!0,deps:[_n]},Ay,by,wy,{provide:ts,useExisting:Ay},{provide:bc,useClass:G1},[]];var fM=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(i){return new(i||n)(Ue(_n))};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var He="primary",$c=Symbol("RouteTitle"),Fy=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function ds(n){return new Fy(n)}function EM(n,e,t){let i=t.path.split("/");if(i.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||i.length<n.length))return null;let r={};for(let o=0;o<i.length;o++){let s=i[o],a=n[o];if(s[0]===":")r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function Q1(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!er(n[t],e[t]))return!1;return!0}function er(n,e){let t=n?Oy(n):void 0,i=e?Oy(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let o=0;o<t.length;o++)if(r=t[o],!xM(n[r],e[r]))return!1;return!0}function Oy(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function xM(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),i=[...e].sort();return t.every((r,o)=>i[o]===r)}else return n===e}function SM(n){return n.length>0?n[n.length-1]:null}function Dr(n){return Kp(n)?n:vc(n)?Gt(Promise.resolve(n)):Le(n)}var eP={exact:MM,subset:CM},TM={exact:tP,subset:nP,ignored:()=>!0};function hM(n,e,t){return eP[t.paths](n.root,e.root,t.matrixParams)&&TM[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function tP(n,e){return er(n,e)}function MM(n,e,t){if(!cs(n.segments,e.segments)||!If(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let i in e.children)if(!n.children[i]||!MM(n.children[i],e.children[i],t))return!1;return!0}function nP(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>xM(n[t],e[t]))}function CM(n,e,t){return wM(n,e,e.segments,t)}function wM(n,e,t,i){if(n.segments.length>t.length){let r=n.segments.slice(0,t.length);return!(!cs(r,t)||e.hasChildren()||!If(r,t,i))}else if(n.segments.length===t.length){if(!cs(n.segments,t)||!If(n.segments,t,i))return!1;for(let r in e.children)if(!n.children[r]||!CM(n.children[r],e.children[r],i))return!1;return!0}else{let r=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!cs(n.segments,r)||!If(n.segments,r,i)||!n.children[He]?!1:wM(n.children[He],e,o,i)}}function If(n,e,t){return e.every((i,r)=>TM[t](n[r].parameters,i.parameters))}var nr=class{root;queryParams;fragment;_queryParamMap;constructor(e=new xt([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap??=ds(this.queryParams),this._queryParamMap}toString(){return oP.serialize(this)}},xt=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Af(this)}},co=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=ds(this.parameters),this._parameterMap}toString(){return IM(this)}};function iP(n,e){return cs(n,e)&&n.every((t,i)=>er(t.parameters,e[i].parameters))}function cs(n,e){return n.length!==e.length?!1:n.every((t,i)=>t.path===e[i].path)}function rP(n,e){let t=[];return Object.entries(n.children).forEach(([i,r])=>{i===He&&(t=t.concat(e(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==He&&(t=t.concat(e(r,i)))}),t}var Yc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>new fs,providedIn:"root"})}return n})(),fs=class{parse(e){let t=new Uy(e);return new nr(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Nc(e.root,!0)}`,i=lP(e.queryParams),r=typeof e.fragment=="string"?`#${sP(e.fragment)}`:"";return`${t}${i}${r}`}},oP=new fs;function Af(n){return n.segments.map(e=>IM(e)).join("/")}function Nc(n,e){if(!n.hasChildren())return Af(n);if(e){let t=n.children[He]?Nc(n.children[He],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==He&&i.push(`${r}:${Nc(o,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}else{let t=rP(n,(i,r)=>r===He?[Nc(n.children[He],!1)]:[`${r}:${Nc(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[He]!=null?`${Af(n)}/${t[0]}`:`${Af(n)}/(${t.join("//")})`}}function bM(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function wf(n){return bM(n).replace(/%3B/gi,";")}function sP(n){return encodeURI(n)}function ky(n){return bM(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Df(n){return decodeURIComponent(n)}function pM(n){return Df(n.replace(/\+/g,"%20"))}function IM(n){return`${ky(n.path)}${aP(n.parameters)}`}function aP(n){return Object.entries(n).map(([e,t])=>`;${ky(e)}=${ky(t)}`).join("")}function lP(n){let e=Object.entries(n).map(([t,i])=>Array.isArray(i)?i.map(r=>`${wf(t)}=${wf(r)}`).join("&"):`${wf(t)}=${wf(i)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var cP=/^[^\/()?;#]+/;function Ry(n){let e=n.match(cP);return e?e[0]:""}var uP=/^[^\/()?;=#]+/;function dP(n){let e=n.match(uP);return e?e[0]:""}var fP=/^[^=?&#]+/;function hP(n){let e=n.match(fP);return e?e[0]:""}var pP=/^[^&#]+/;function mP(n){let e=n.match(pP);return e?e[0]:""}var Uy=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new xt([],{}):new xt([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[He]=new xt(e,t)),i}parseSegment(){let e=Ry(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Te(4009,!1);return this.capture(e),new co(Df(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=dP(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let r=Ry(this.remaining);r&&(i=r,this.capture(i))}e[Df(t)]=Df(i)}parseQueryParam(e){let t=hP(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){let s=mP(this.remaining);s&&(i=s,this.capture(i))}let r=pM(t),o=pM(i);if(e.hasOwnProperty(r)){let s=e[r];Array.isArray(s)||(s=[s],e[r]=s),s.push(o)}else e[r]=o}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=Ry(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new Te(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=He);let s=this.parseChildren();t[o]=Object.keys(s).length===1&&s[He]?s[He]:new xt([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Te(4011,!1)}};function AM(n){return n.segments.length>0?new xt([],{[He]:n}):n}function DM(n){let e={};for(let[i,r]of Object.entries(n.children)){let o=DM(r);if(i===He&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))e[s]=a;else(o.segments.length>0||o.hasChildren())&&(e[i]=o)}let t=new xt(n.segments,e);return gP(t)}function gP(n){if(n.numberOfChildren===1&&n.children[He]){let e=n.children[He];return new xt(n.segments.concat(e.segments),e.children)}return n}function uo(n){return n instanceof nr}function RM(n,e,t=null,i=null){let r=NM(n);return PM(r,e,t,i)}function NM(n){let e;function t(o){let s={};for(let l of o.children){let c=t(l);s[l.outlet]=c}let a=new xt(o.url,s);return o===n&&(e=a),a}let i=t(n.root),r=AM(i);return e??r}function PM(n,e,t,i){let r=n;for(;r.parent;)r=r.parent;if(e.length===0)return Ny(r,r,r,t,i);let o=yP(e);if(o.toRoot())return Ny(r,r,new xt([],{}),t,i);let s=vP(o,r,n),a=s.processChildren?Lc(s.segmentGroup,s.index,o.commands):FM(s.segmentGroup,s.index,o.commands);return Ny(r,s.segmentGroup,a,t,i)}function Rf(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function kc(n){return typeof n=="object"&&n!=null&&n.outlets}function Ny(n,e,t,i,r){let o={};i&&Object.entries(i).forEach(([l,c])=>{o[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;n===e?s=t:s=LM(n,e,t);let a=AM(DM(s));return new nr(a,o,r)}function LM(n,e,t){let i={};return Object.entries(n.children).forEach(([r,o])=>{o===e?i[r]=t:i[r]=LM(o,e,t)}),new xt(n.segments,i)}var Nf=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&Rf(i[0]))throw new Te(4003,!1);let r=i.find(kc);if(r&&r!==SM(i))throw new Te(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function yP(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Nf(!0,0,n);let e=0,t=!1,i=n.reduce((r,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:s===0?(o.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&r.push(a))}),r):[...r,o]},[]);return new Nf(t,e,i)}var Ea=class{segmentGroup;processChildren;index;constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}};function vP(n,e,t){if(n.isAbsolute)return new Ea(e,!0,0);if(!t)return new Ea(e,!1,NaN);if(t.parent===null)return new Ea(t,!0,0);let i=Rf(n.commands[0])?0:1,r=t.segments.length-1+i;return _P(t,r,n.numberOfDoubleDots)}function _P(n,e,t){let i=n,r=e,o=t;for(;o>r;){if(o-=r,i=i.parent,!i)throw new Te(4005,!1);r=i.segments.length}return new Ea(i,!1,r-o)}function EP(n){return kc(n[0])?n[0].outlets:{[He]:n}}function FM(n,e,t){if(n??=new xt([],{}),n.segments.length===0&&n.hasChildren())return Lc(n,e,t);let i=xP(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let o=new xt(n.segments.slice(0,i.pathIndex),{});return o.children[He]=new xt(n.segments.slice(i.pathIndex),n.children),Lc(o,0,r)}else return i.match&&r.length===0?new xt(n.segments,{}):i.match&&!n.hasChildren()?By(n,e,t):i.match?Lc(n,0,r):By(n,e,t)}function Lc(n,e,t){if(t.length===0)return new xt(n.segments,{});{let i=EP(t),r={};if(Object.keys(i).some(o=>o!==He)&&n.children[He]&&n.numberOfChildren===1&&n.children[He].segments.length===0){let o=Lc(n.children[He],e,t);return new xt(n.segments,o.children)}return Object.entries(i).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(r[o]=FM(n.children[o],e,s))}),Object.entries(n.children).forEach(([o,s])=>{i[o]===void 0&&(r[o]=s)}),new xt(n.segments,r)}}function xP(n,e,t){let i=0,r=e,o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return o;let s=n.segments[r],a=t[i];if(kc(a))break;let l=`${a}`,c=i<t.length-1?t[i+1]:null;if(r>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!gM(l,c,s))return o;i+=2}else{if(!gM(l,{},s))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function By(n,e,t){let i=n.segments.slice(0,e),r=0;for(;r<t.length;){let o=t[r];if(kc(o)){let l=SP(o.outlets);return new xt(i,l)}if(r===0&&Rf(t[0])){let l=n.segments[e];i.push(new co(l.path,mM(t[0]))),r++;continue}let s=kc(o)?o.outlets[He]:`${o}`,a=r<t.length-1?t[r+1]:null;s&&a&&Rf(a)?(i.push(new co(s,mM(a))),r+=2):(i.push(new co(s,{})),r++)}return new xt(i,{})}function SP(n){let e={};return Object.entries(n).forEach(([t,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(e[t]=By(new xt([],{}),0,i))}),e}function mM(n){let e={};return Object.entries(n).forEach(([t,i])=>e[t]=`${i}`),e}function gM(n,e,t){return n==t.path&&er(e,t.parameters)}var Fc="imperative",fn=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})(fn||{}),ni=class{id;url;constructor(e,t){this.id=e,this.url=t}},hs=class extends ni{type=fn.NavigationStart;navigationTrigger;restoredState;constructor(e,t,i="imperative",r=null){super(e,t),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Li=class extends ni{urlAfterRedirects;type=fn.NavigationEnd;constructor(e,t,i){super(e,t),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},On=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(On||{}),Uc=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(Uc||{}),tr=class extends ni{reason;code;type=fn.NavigationCancel;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ir=class extends ni{reason;code;type=fn.NavigationSkipped;constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r}},Sa=class extends ni{error;target;type=fn.NavigationError;constructor(e,t,i,r){super(e,t),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Bc=class extends ni{urlAfterRedirects;state;type=fn.RoutesRecognized;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Pf=class extends ni{urlAfterRedirects;state;type=fn.GuardsCheckStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lf=class extends ni{urlAfterRedirects;state;shouldActivate;type=fn.GuardsCheckEnd;constructor(e,t,i,r,o){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Ff=class extends ni{urlAfterRedirects;state;type=fn.ResolveStart;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Of=class extends ni{urlAfterRedirects;state;type=fn.ResolveEnd;constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},kf=class{route;type=fn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Uf=class{route;type=fn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Bf=class{snapshot;type=fn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Vf=class{snapshot;type=fn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Hf=class{snapshot;type=fn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},zf=class{snapshot;type=fn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Vc=class{},Ta=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function TP(n){return!(n instanceof Vc)&&!(n instanceof Ta)}function MP(n,e){return n.providers&&!n._injector&&(n._injector=yc(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Pi(n){return n.outlet||He}function CP(n,e){let t=n.filter(i=>Pi(i)===e);return t.push(...n.filter(i=>Pi(i)!==e)),t}function wa(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Gf=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return wa(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new ba(this.rootInjector)}},ba=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,i){let r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){let i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new Gf(this.rootInjector),this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(i){return new(i||n)(Ue(un))};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Wf=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Vy(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){let t=Vy(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Hy(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return Hy(e,this._root).map(t=>t.value)}};function Vy(n,e){if(n===e.value)return e;for(let t of e.children){let i=Vy(n,t);if(i)return i}return null}function Hy(n,e){if(n===e.value)return[e];for(let t of e.children){let i=Hy(n,t);if(i.length)return i.unshift(e),i}return[]}var ti=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function _a(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Hc=class extends Wf{snapshot;constructor(e,t){super(e),this.snapshot=t,Jy(this,e)}toString(){return this.snapshot.toString()}};function OM(n){let e=wP(n),t=new yn([new co("",{})]),i=new yn({}),r=new yn({}),o=new yn({}),s=new yn(""),a=new Ar(t,i,o,s,r,He,n,e.root);return a.snapshot=e.root,new Hc(new ti(a,[]),e)}function wP(n){let e={},t={},i={},o=new us([],e,i,"",t,He,n,null,{});return new zc("",new ti(o,[]))}var Ar=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,i,r,o,s,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(gt(c=>c[$c]))??Le(void 0),this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(gt(e=>ds(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(gt(e=>ds(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function qf(n,e,t="emptyOnly"){let i,{routeConfig:r}=n;return e!==null&&(t==="always"||r?.path===""||!e.component&&!e.routeConfig?.loadComponent)?i={params:ue(ue({},e.params),n.params),data:ue(ue({},e.data),n.data),resolve:ue(ue(ue(ue({},n.data),e.data),r?.data),n._resolvedData)}:i={params:ue({},n.params),data:ue({},n.data),resolve:ue(ue({},n.data),n._resolvedData??{})},r&&UM(r)&&(i.resolve[$c]=r.title),i}var us=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[$c]}constructor(e,t,i,r,o,s,a,l,c){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=ds(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=ds(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(i=>i.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},zc=class extends Wf{url;constructor(e,t){super(t),this.url=e,Jy(this,t)}toString(){return kM(this._root)}};function Jy(n,e){e.value._routerState=n,e.children.forEach(t=>Jy(n,t))}function kM(n){let e=n.children.length>0?` { ${n.children.map(kM).join(", ")} } `:"";return`${n.value}${e}`}function Py(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,er(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),er(e.params,t.params)||n.paramsSubject.next(t.params),Q1(e.url,t.url)||n.urlSubject.next(t.url),er(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function zy(n,e){let t=er(n.params,e.params)&&iP(n.url,e.url),i=!n.parent!=!e.parent;return t&&!i&&(!n.parent||zy(n.parent,e.parent))}function UM(n){return typeof n.title=="string"||n.title===null}var BM=new Oe(""),Xc=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=He;activateEvents=new wn;deactivateEvents=new wn;attachEvents=new wn;detachEvents=new wn;routerOutletData=KT(void 0);parentContexts=se(ba);location=se(rs);changeDetector=se(Mc);inputBinder=se(Jf,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Te(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Te(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Te(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new Te(4013,!1);this._activatedRoute=t;let r=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new Gy(t,a,r.injector,this.routerOutletData);this.activated=r.createComponent(s,{index:r.length,injector:l,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=os({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[is]})}return n})(),Gy=class{route;childContexts;parent;outletData;constructor(e,t,i,r){this.route=e,this.childContexts=t,this.parent=i,this.outletData=r}get(e,t){return e===Ar?this.route:e===ba?this.childContexts:e===BM?this.outletData:this.parent.get(e,t)}},Jf=new Oe("");var jy=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Ln({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){i&1&&yi(0,"router-outlet")},dependencies:[Xc],encapsulation:2})}return n})();function Zy(n){let e=n.children&&n.children.map(Zy),t=e?it(ue({},n),{children:e}):ue({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==He&&(t.component=jy),t}function bP(n,e,t){let i=Gc(n,e._root,t?t._root:void 0);return new Hc(i,e)}function Gc(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let i=t.value;i._futureSnapshot=e.value;let r=IP(n,e,t);return new ti(i,r)}else{if(n.shouldAttach(e.value)){let o=n.retrieve(e.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>Gc(n,a)),s}}let i=AP(e.value),r=e.children.map(o=>Gc(n,o));return new ti(i,r)}}function IP(n,e,t){return e.children.map(i=>{for(let r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Gc(n,i,r);return Gc(n,i)})}function AP(n){return new Ar(new yn(n.url),new yn(n.params),new yn(n.queryParams),new yn(n.fragment),new yn(n.data),n.outlet,n.component,n)}var Ma=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},VM="ngNavigationCancelingError";function $f(n,e){let{redirectTo:t,navigationBehaviorOptions:i}=uo(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=HM(!1,On.Redirect);return r.url=t,r.navigationBehaviorOptions=i,r}function HM(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[VM]=!0,t.cancellationCode=e,t}function DP(n){return zM(n)&&uo(n.url)}function zM(n){return!!n&&n[VM]}var RP=(n,e,t,i)=>gt(r=>(new Wy(e,r.targetRouterState,r.currentRouterState,t,i).activate(n),r)),Wy=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,i,r,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(e){let t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),Py(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){let r=_a(t);e.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,r[s],i),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(e,t,i){let r=e.value,o=t?t.value:null;if(r===o)if(r.component){let s=i.getContext(r.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,i);else o&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=_a(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(i&&i.outlet){let s=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=_a(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(e,t,i){let r=_a(t);e.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new zf(o.value.snapshot))}),e.children.length&&this.forwardEvent(new Vf(e.value.snapshot))}activateRoutes(e,t,i){let r=e.value,o=t?t.value:null;if(Py(r),r===o)if(r.component){let s=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,i);else if(r.component){let s=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),Py(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=r,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,i)}},Yf=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},xa=class{component;route;constructor(e,t){this.component=e,this.route=t}};function NP(n,e,t){let i=n._root,r=e?e._root:null;return Pc(i,r,t,[i.value])}function PP(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Ia(n,e){let t=Symbol(),i=e.get(n,t);return i===t?typeof n=="function"&&!pm(n)?n:e.get(n):i}function Pc(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=_a(e);return n.children.forEach(s=>{LP(s,o[s.value.outlet],t,i.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>Oc(a,t.getContext(s),r)),r}function LP(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,s=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let l=FP(s,o,o.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new Yf(i)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?Pc(n,e,a?a.children:null,i,r):Pc(n,e,t,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new xa(a.outlet.component,s))}else s&&Oc(e,a,r),r.canActivateChecks.push(new Yf(i)),o.component?Pc(n,null,a?a.children:null,i,r):Pc(n,null,t,i,r);return r}function FP(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!cs(n.url,e.url);case"pathParamsOrQueryParamsChange":return!cs(n.url,e.url)||!er(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!zy(n,e)||!er(n.queryParams,e.queryParams);case"paramsChange":default:return!zy(n,e)}}function Oc(n,e,t){let i=_a(n),r=n.value;Object.entries(i).forEach(([o,s])=>{r.component?e?Oc(s,e.children.getContext(o),t):Oc(s,null,t):Oc(s,e,t)}),r.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new xa(e.outlet.component,r)):t.canDeactivateChecks.push(new xa(null,r)):t.canDeactivateChecks.push(new xa(null,r))}function Jc(n){return typeof n=="function"}function OP(n){return typeof n=="boolean"}function kP(n){return n&&Jc(n.canLoad)}function UP(n){return n&&Jc(n.canActivate)}function BP(n){return n&&Jc(n.canActivateChild)}function VP(n){return n&&Jc(n.canDeactivate)}function HP(n){return n&&Jc(n.canMatch)}function GM(n){return n instanceof fr||n?.name==="EmptyError"}var bf=Symbol("INITIAL_VALUE");function Ca(){return Hn(n=>Ku(n.map(e=>e.pipe(pr(1),tm(bf)))).pipe(gt(e=>{for(let t of e)if(t!==!0){if(t===bf)return bf;if(t===!1||zP(t))return t}return!0}),Jn(e=>e!==bf),pr(1)))}function zP(n){return uo(n)||n instanceof Ma}function GP(n,e){return Xt(t=>{let{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=t;return s.length===0&&o.length===0?Le(it(ue({},t),{guardsResult:!0})):WP(s,i,r,n).pipe(Xt(a=>a&&OP(a)?qP(i,o,n,e):Le(a)),gt(a=>it(ue({},t),{guardsResult:a})))})}function WP(n,e,t,i){return Gt(n).pipe(Xt(r=>jP(r.component,r.route,t,e,i)),mr(r=>r!==!0,!0))}function qP(n,e,t,i){return Gt(e).pipe(ko(r=>$s(YP(r.route.parent,i),$P(r.route,i),JP(n,r.path,t),XP(n,r.route,t))),mr(r=>r!==!0,!0))}function $P(n,e){return n!==null&&e&&e(new Hf(n)),Le(!0)}function YP(n,e){return n!==null&&e&&e(new Bf(n)),Le(!0)}function XP(n,e,t){let i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||i.length===0)return Le(!0);let r=i.map(o=>Ol(()=>{let s=wa(e)??t,a=Ia(o,s),l=UP(a)?a.canActivate(e,n):Pn(s,()=>a(e,n));return Dr(l).pipe(mr())}));return Le(r).pipe(Ca())}function JP(n,e,t){let i=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(s=>PP(s)).filter(s=>s!==null).map(s=>Ol(()=>{let a=s.guards.map(l=>{let c=wa(s.node)??t,u=Ia(l,c),f=BP(u)?u.canActivateChild(i,n):Pn(c,()=>u(i,n));return Dr(f).pipe(mr())});return Le(a).pipe(Ca())}));return Le(o).pipe(Ca())}function jP(n,e,t,i,r){let o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||o.length===0)return Le(!0);let s=o.map(a=>{let l=wa(e)??r,c=Ia(a,l),u=VP(c)?c.canDeactivate(n,e,t,i):Pn(l,()=>c(n,e,t,i));return Dr(u).pipe(mr())});return Le(s).pipe(Ca())}function ZP(n,e,t,i){let r=e.canLoad;if(r===void 0||r.length===0)return Le(!0);let o=r.map(s=>{let a=Ia(s,n),l=kP(a)?a.canLoad(e,t):Pn(n,()=>a(e,t));return Dr(l)});return Le(o).pipe(Ca(),WM(i))}function WM(n){return Xp(cn(e=>{if(typeof e!="boolean")throw $f(n,e)}),gt(e=>e===!0))}function KP(n,e,t,i){let r=e.canMatch;if(!r||r.length===0)return Le(!0);let o=r.map(s=>{let a=Ia(s,n),l=HP(a)?a.canMatch(e,t):Pn(n,()=>a(e,t));return Dr(l)});return Le(o).pipe(Ca(),WM(i))}var Wc=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},qc=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function va(n){return Ws(new Wc(n))}function QP(n){return Ws(new Te(4e3,!1))}function eL(n){return Ws(HM(!1,On.GuardRejected))}var qy=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return Le(i);if(r.numberOfChildren>1||!r.children[He])return QP(`${e.redirectTo}`);r=r.children[He]}}applyRedirectCommands(e,t,i,r,o){return tL(t,r,o).pipe(gt(s=>{if(s instanceof nr)throw new qc(s);let a=this.applyRedirectCreateUrlTree(s,this.urlSerializer.parse(s),e,i);if(s[0]==="/")throw new qc(a);return a}))}applyRedirectCreateUrlTree(e,t,i,r){let o=this.createSegmentGroup(e,t.root,i,r);return new nr(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let i={};return Object.entries(e).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);i[r]=t[a]}else i[r]=o}),i}createSegmentGroup(e,t,i,r){let o=this.createSegments(e,t.segments,i,r),s={};return Object.entries(t.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(e,l,i,r)}),new xt(o,s)}createSegments(e,t,i,r){return t.map(o=>o.path[0]===":"?this.findPosParam(e,o,r):this.findOrReturn(o,i))}findPosParam(e,t,i){let r=i[t.path.substring(1)];if(!r)throw new Te(4001,!1);return r}findOrReturn(e,t){let i=0;for(let r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}};function tL(n,e,t){if(typeof n=="string")return Le(n);let i=n,{queryParams:r,fragment:o,routeConfig:s,url:a,outlet:l,params:c,data:u,title:f}=e;return Dr(Pn(t,()=>i({params:c,data:u,queryParams:r,fragment:o,routeConfig:s,url:a,outlet:l,title:f})))}var $y={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function nL(n,e,t,i,r){let o=qM(n,e,t);return o.matched?(i=MP(e,i),KP(i,e,t,r).pipe(gt(s=>s===!0?o:ue({},$y)))):Le(o)}function qM(n,e,t){if(e.path==="**")return iL(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?ue({},$y):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let r=(e.matcher||EM)(t,n,e);if(!r)return ue({},$y);let o={};Object.entries(r.posParams??{}).forEach(([a,l])=>{o[a]=l.path});let s=r.consumed.length>0?ue(ue({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function iL(n){return{matched:!0,parameters:n.length>0?SM(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function yM(n,e,t,i){return t.length>0&&sL(n,t,i)?{segmentGroup:new xt(e,oL(i,new xt(t,n.children))),slicedSegments:[]}:t.length===0&&aL(n,t,i)?{segmentGroup:new xt(n.segments,rL(n,t,i,n.children)),slicedSegments:t}:{segmentGroup:new xt(n.segments,n.children),slicedSegments:t}}function rL(n,e,t,i){let r={};for(let o of t)if(jf(n,e,o)&&!i[Pi(o)]){let s=new xt([],{});r[Pi(o)]=s}return ue(ue({},i),r)}function oL(n,e){let t={};t[He]=e;for(let i of n)if(i.path===""&&Pi(i)!==He){let r=new xt([],{});t[Pi(i)]=r}return t}function sL(n,e,t){return t.some(i=>jf(n,e,i)&&Pi(i)!==He)}function aL(n,e,t){return t.some(i=>jf(n,e,i))}function jf(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function lL(n,e,t){return e.length===0&&!n.children[t]}var Yy=class{};function cL(n,e,t,i,r,o,s="emptyOnly"){return new Xy(n,e,t,i,r,s,o).recognize()}var uL=31,Xy=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,i,r,o,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new qy(this.urlSerializer,this.urlTree)}noMatchError(e){return new Te(4002,`'${e.segmentGroup}'`)}recognize(){let e=yM(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(gt(({children:t,rootSnapshot:i})=>{let r=new ti(i,t),o=new zc("",r),s=RM(i,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(e){let t=new us([],Object.freeze({}),Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),He,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,He,t).pipe(gt(i=>({children:i,rootSnapshot:t})),hr(i=>{if(i instanceof qc)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof Wc?this.noMatchError(i):i}))}processSegmentGroup(e,t,i,r,o){return i.segments.length===0&&i.hasChildren()?this.processChildren(e,t,i,o):this.processSegment(e,t,i,i.segments,r,!0,o).pipe(gt(s=>s instanceof ti?[s]:[]))}processChildren(e,t,i,r){let o=[];for(let s of Object.keys(i.children))s==="primary"?o.unshift(s):o.push(s);return Gt(o).pipe(ko(s=>{let a=i.children[s],l=CP(t,s);return this.processSegmentGroup(e,l,a,s,r)}),em((s,a)=>(s.push(...a),s)),Jr(null),Qp(),Xt(s=>{if(s===null)return va(i);let a=$M(s);return dL(a),Le(a)}))}processSegment(e,t,i,r,o,s,a){return Gt(t).pipe(ko(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,i,r,o,s,a).pipe(hr(c=>{if(c instanceof Wc)return Le(null);throw c}))),mr(l=>!!l),hr(l=>{if(GM(l))return lL(i,r,o)?Le(new Yy):va(i);throw l}))}processSegmentAgainstRoute(e,t,i,r,o,s,a,l){return Pi(i)!==s&&(s===He||!jf(r,o,i))?va(r):i.redirectTo===void 0?this.matchSegmentAgainstRoute(e,r,i,o,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,r,t,i,o,s,l):va(r)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,o,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:f,remainingSegments:p}=qM(t,r,o);if(!l)return va(t);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>uL&&(this.allowRedirects=!1));let m=new us(o,c,Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,vM(r),Pi(r),r.component??r._loadedComponent??null,r,_M(r)),v=qf(m,a,this.paramsInheritanceStrategy);return m.params=Object.freeze(v.params),m.data=Object.freeze(v.data),this.applyRedirects.applyRedirectCommands(u,r.redirectTo,f,m,e).pipe(Hn(y=>this.applyRedirects.lineralizeSegments(r,y)),Xt(y=>this.processSegment(e,i,t,y.concat(p),s,!1,a)))}matchSegmentAgainstRoute(e,t,i,r,o,s){let a=nL(t,i,r,e,this.urlSerializer);return i.path==="**"&&(t.children={}),a.pipe(Hn(l=>l.matched?(e=i._injector??e,this.getChildConfig(e,i,r).pipe(Hn(({routes:c})=>{let u=i._loadedInjector??e,{parameters:f,consumedSegments:p,remainingSegments:m}=l,v=new us(p,f,Object.freeze(ue({},this.urlTree.queryParams)),this.urlTree.fragment,vM(i),Pi(i),i.component??i._loadedComponent??null,i,_M(i)),_=qf(v,s,this.paramsInheritanceStrategy);v.params=Object.freeze(_.params),v.data=Object.freeze(_.data);let{segmentGroup:y,slicedSegments:g}=yM(t,p,m,c);if(g.length===0&&y.hasChildren())return this.processChildren(u,c,y,v).pipe(gt(x=>new ti(v,x)));if(c.length===0&&g.length===0)return Le(new ti(v,[]));let T=Pi(i)===o;return this.processSegment(u,c,y,g,T?He:o,!0,v).pipe(gt(x=>new ti(v,x instanceof ti?[x]:[])))}))):va(t)))}getChildConfig(e,t,i){return t.children?Le({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Le({routes:t._loadedRoutes,injector:t._loadedInjector}):ZP(e,t,i,this.urlSerializer).pipe(Xt(r=>r?this.configLoader.loadChildren(e,t).pipe(cn(o=>{t._loadedRoutes=o.routes,t._loadedInjector=o.injector})):eL(t))):Le({routes:[],injector:e})}};function dL(n){n.sort((e,t)=>e.value.outlet===He?-1:t.value.outlet===He?1:e.value.outlet.localeCompare(t.value.outlet))}function fL(n){let e=n.value.routeConfig;return e&&e.path===""}function $M(n){let e=[],t=new Set;for(let i of n){if(!fL(i)){e.push(i);continue}let r=e.find(o=>i.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...i.children),t.add(r)):e.push(i)}for(let i of t){let r=$M(i.children);e.push(new ti(i.value,r))}return e.filter(i=>!t.has(i))}function vM(n){return n.data||{}}function _M(n){return n.resolve||{}}function hL(n,e,t,i,r,o){return Xt(s=>cL(n,e,t,i,s.extractedUrl,r,o).pipe(gt(({state:a,tree:l})=>it(ue({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function pL(n,e){return Xt(t=>{let{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return Le(t);let o=new Set(r.map(l=>l.route)),s=new Set;for(let l of o)if(!s.has(l))for(let c of YM(l))s.add(c);let a=0;return Gt(s).pipe(ko(l=>o.has(l)?mL(l,i,n,e):(l.data=qf(l,l.parent,n).resolve,Le(void 0))),cn(()=>a++),Ys(1),Xt(l=>a===s.size?Le(t):Bn))})}function YM(n){let e=n.children.map(t=>YM(t)).flat();return[n,...e]}function mL(n,e,t,i){let r=n.routeConfig,o=n._resolve;return r?.title!==void 0&&!UM(r)&&(o[$c]=r.title),Ol(()=>(n.data=qf(n,n.parent,t).resolve,gL(o,n,e,i).pipe(gt(s=>(n._resolvedData=s,n.data=ue(ue({},n.data),s),null)))))}function gL(n,e,t,i){let r=Oy(n);if(r.length===0)return Le({});let o={};return Gt(r).pipe(Xt(s=>yL(n[s],e,t,i).pipe(mr(),cn(a=>{if(a instanceof Ma)throw $f(new fs,a);o[s]=a}))),Ys(1),gt(()=>o),hr(s=>GM(s)?Bn:Ws(s)))}function yL(n,e,t,i){let r=wa(e)??i,o=Ia(n,r),s=o.resolve?o.resolve(e,t):Pn(r,()=>o(e,t));return Dr(s)}function Ly(n){return Hn(e=>{let t=n(e);return t?Gt(t).pipe(gt(()=>e)):Le(e)})}var Ky=(()=>{class n{buildTitle(t){let i,r=t.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===He);return i}getResolvedTitleForRoute(t){return t.data[$c]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(XM),providedIn:"root"})}return n})(),XM=(()=>{class n extends Ky{title;constructor(t){super(),this.title=t}updateTitle(t){let i=this.buildTitle(t);i!==void 0&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(Ue(fM))};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Aa=new Oe("",{providedIn:"root",factory:()=>({})}),jc=new Oe(""),JM=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=se(fy);loadComponent(t,i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Le(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=Dr(Pn(t,()=>i.loadComponent())).pipe(gt(ZM),Hn(KM),cn(s=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=s}),kl(()=>{this.componentLoaders.delete(i)})),o=new Gs(r,()=>new tn).pipe(zs());return this.componentLoaders.set(i,o),o}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Le({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=jM(i,this.compiler,t,this.onLoadEndListener).pipe(kl(()=>{this.childrenLoaders.delete(i)})),s=new Gs(o,()=>new tn).pipe(zs());return this.childrenLoaders.set(i,s),s}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function jM(n,e,t,i){return Dr(Pn(t,()=>n.loadChildren())).pipe(gt(ZM),Hn(KM),Xt(r=>r instanceof ff||Array.isArray(r)?Le(r):Gt(e.compileModuleAsync(r))),gt(r=>{i&&i(n);let o,s,a=!1;return Array.isArray(r)?(s=r,a=!0):(o=r.create(t).injector,s=o.get(jc,[],{optional:!0,self:!0}).flat()),{routes:s.map(Zy),injector:o}}))}function vL(n){return n&&typeof n=="object"&&"default"in n}function ZM(n){return vL(n)?n.default:n}function KM(n){return Le(n)}var Zf=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(_L),providedIn:"root"})}return n})(),_L=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),QM=new Oe("");var eC=new Oe(""),tC=(()=>{class n{currentNavigation=Dt(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new tn;transitionAbortWithErrorSubject=new tn;configLoader=se(JM);environmentInjector=se(un);destroyRef=se(oo);urlSerializer=se(Yc);rootContexts=se(ba);location=se(ls);inputBindingEnabled=se(Jf,{optional:!0})!==null;titleStrategy=se(Ky);options=se(Aa,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=se(Zf);createViewTransition=se(QM,{optional:!0});navigationErrorHandler=se(eC,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Le(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=r=>this.events.next(new kf(r)),i=r=>this.events.next(new Uf(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let i=++this.navigationId;wr(()=>{this.transitions?.next(it(ue({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:i}))})}setupNavigations(t){return this.transitions=new yn(null),this.transitions.pipe(Jn(i=>i!==null),Hn(i=>{let r=!1;return Le(i).pipe(Hn(o=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",On.SupersededByNewNavigation),Bn;this.currentTransition=i,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?it(ue({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let s=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),a=o.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!s&&a!=="reload")return this.events.next(new Ir(o.id,this.urlSerializer.serialize(o.rawUrl),"",Uc.IgnoredSameUrlNavigation)),o.resolve(!1),Bn;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return Le(o).pipe(Hn(l=>(this.events.next(new hs(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),l.id!==this.navigationId?Bn:Promise.resolve(l))),hL(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),cn(l=>{i.targetSnapshot=l.targetSnapshot,i.urlAfterRedirects=l.urlAfterRedirects,this.currentNavigation.update(u=>(u.finalUrl=l.urlAfterRedirects,u));let c=new Bc(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}));if(s&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:l,extractedUrl:c,source:u,restoredState:f,extras:p}=o,m=new hs(l,this.urlSerializer.serialize(c),u,f);this.events.next(m);let v=OM(this.rootComponentType).snapshot;return this.currentTransition=i=it(ue({},o),{targetSnapshot:v,urlAfterRedirects:c,extras:it(ue({},p),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(_=>(_.finalUrl=c,_)),Le(i)}else return this.events.next(new Ir(o.id,this.urlSerializer.serialize(o.extractedUrl),"",Uc.IgnoredByUrlHandlingStrategy)),o.resolve(!1),Bn}),cn(o=>{let s=new Pf(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(s)}),gt(o=>(this.currentTransition=i=it(ue({},o),{guards:NP(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),i)),GP(this.environmentInjector,o=>this.events.next(o)),cn(o=>{if(i.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw $f(this.urlSerializer,o.guardsResult);let s=new Lf(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(s)}),Jn(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",On.GuardRejected),!1)),Ly(o=>{if(o.guards.canActivateChecks.length!==0)return Le(o).pipe(cn(s=>{let a=new Ff(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),Hn(s=>{let a=!1;return Le(s).pipe(pL(this.paramsInheritanceStrategy,this.environmentInjector),cn({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(s,"",On.NoDataFromResolver)}}))}),cn(s=>{let a=new Of(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}))}),Ly(o=>{let s=a=>{let l=[];if(a.routeConfig?.loadComponent){let c=wa(a)??this.environmentInjector;l.push(this.configLoader.loadComponent(c,a.routeConfig).pipe(cn(u=>{a.component=u}),gt(()=>{})))}for(let c of a.children)l.push(...s(c));return l};return Ku(s(o.targetSnapshot.root)).pipe(Jr(null),pr(1))}),Ly(()=>this.afterPreactivation()),Hn(()=>{let{currentSnapshot:o,targetSnapshot:s}=i,a=this.createViewTransition?.(this.environmentInjector,o.root,s.root);return a?Gt(a).pipe(gt(()=>i)):Le(i)}),gt(o=>{let s=bP(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=i=it(ue({},o),{targetRouterState:s}),this.currentNavigation.update(a=>(a.targetRouterState=s,a)),i}),cn(()=>{this.events.next(new Vc)}),RP(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),pr(1),ed(new yt(o=>{let s=i.abortController.signal,a=()=>o.next();return s.addEventListener("abort",a),()=>s.removeEventListener("abort",a)}).pipe(Jn(()=>!r&&!i.targetRouterState),cn(()=>{this.cancelNavigationTransition(i,i.abortController.signal.reason+"",On.Aborted)}))),cn({next:o=>{r=!0,this.lastSuccessfulNavigation=wr(this.currentNavigation),this.events.next(new Li(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),ed(this.transitionAbortWithErrorSubject.pipe(cn(o=>{throw o}))),kl(()=>{r||this.cancelNavigationTransition(i,"",On.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),hr(o=>{if(this.destroyed)return i.resolve(!1),Bn;if(r=!0,zM(o))this.events.next(new tr(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode)),DP(o)?this.events.next(new Ta(o.url,o.navigationBehaviorOptions)):i.resolve(!1);else{let s=new Sa(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);try{let a=Pn(this.environmentInjector,()=>this.navigationErrorHandler?.(s));if(a instanceof Ma){let{message:l,cancellationCode:c}=$f(this.urlSerializer,a);this.events.next(new tr(i.id,this.urlSerializer.serialize(i.extractedUrl),l,c)),this.events.next(new Ta(a.redirectTo,a.navigationBehaviorOptions))}else throw this.events.next(s),o}catch(a){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(a)}}return Bn}))}))}cancelNavigationTransition(t,i,r){let o=new tr(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(o),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=wr(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return t.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function EL(n){return n!==Fc}var nC=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(xL),providedIn:"root"})}return n})(),Xf=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},xL=(()=>{class n extends Xf{static \u0275fac=(()=>{let t;return function(r){return(t||(t=Kd(n)))(r||n)}})();static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),iC=(()=>{class n{urlSerializer=se(Yc);options=se(Aa,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=se(ls);urlHandlingStrategy=se(Zf);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new nr;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:i,targetBrowserUrl:r}){let o=t!==void 0?this.urlHandlingStrategy.merge(t,i):i,s=r??o;return s instanceof nr?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:t,finalUrl:i,initialUrl:r}){i&&t?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=t):this.rawUrlTree=r}routerState=OM(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:()=>se(SL),providedIn:"root"})}return n})(),SL=(()=>{class n extends iC{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(i=>{i.type==="popstate"&&setTimeout(()=>{t(i.url,i.state,"popstate")})})}handleRouterEvent(t,i){t instanceof hs?this.updateStateMemento():t instanceof Ir?this.commitTransition(i):t instanceof Bc?this.urlUpdateStrategy==="eager"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof Vc?(this.commitTransition(i),this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):t instanceof tr&&t.code!==On.SupersededByNewNavigation&&t.code!==On.Redirect?this.restoreHistory(i):t instanceof Sa?this.restoreHistory(i,!0):t instanceof Li&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:i,id:r}){let{replaceUrl:o,state:s}=i;if(this.location.isCurrentPathEqualTo(t)||o){let a=this.browserPageId,l=ue(ue({},s),this.generateNgRouterState(r,a));this.location.replaceState(t,"",l)}else{let a=ue(ue({},s),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(t,"",a)}}restoreHistory(t,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===t.finalUrl&&o===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(r){return(t||(t=Kd(n)))(r||n)}})();static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Qy(n,e){n.events.pipe(Jn(t=>t instanceof Li||t instanceof tr||t instanceof Sa||t instanceof Ir),gt(t=>t instanceof Li||t instanceof Ir?0:(t instanceof tr?t.code===On.Redirect||t.code===On.SupersededByNewNavigation:!1)?2:1),Jn(t=>t!==2),pr(1)).subscribe(()=>{e()})}var TL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ML={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Da=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=se(ny);stateManager=se(iC);options=se(Aa,{optional:!0})||{};pendingTasks=se(xr);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=se(tC);urlSerializer=se(Yc);location=se(ls);urlHandlingStrategy=se(Zf);injector=se(un);_events=new tn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=se(nC);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=se(jc,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!se(Jf,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Yt;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,o=wr(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof tr&&i.code!==On.Redirect&&i.code!==On.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Li)this.navigated=!0;else if(i instanceof Ta){let s=i.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),l=ue({browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||EL(r.source)},s);this.scheduleNavigation(a,Fc,null,l,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}TP(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Fc,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,i,r)=>{this.navigateToSyncWithBrowser(t,r,i)})}navigateToSyncWithBrowser(t,i,r){let o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){let l=ue({},r);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,i,s,o).catch(l=>{this.disposed||this.injector.get(mi)(l)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return wr(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(Zy),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,i={}){let{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:l}=i,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=ue(ue({},this.currentUrlTree.queryParams),o);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=o||null}u!==null&&(u=this.removeEmptyProps(u));let f;try{let p=r?r.snapshot:this.routerState.snapshot.root;f=NM(p)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),f=this.currentUrlTree.root}return PM(f,t,u,c??null)}navigateByUrl(t,i={skipLocationChange:!1}){let r=uo(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Fc,null,i)}navigate(t,i={skipLocationChange:!1}){return CL(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.console.warn(Js(4018,!1)),this.urlSerializer.parse("/")}}isActive(t,i){let r;if(i===!0?r=ue({},TL):i===!1?r=ue({},ML):r=i,uo(t))return hM(this.currentUrlTree,t,r);let o=this.parseUrl(t);return hM(this.currentUrlTree,o,r)}removeEmptyProps(t){return Object.entries(t).reduce((i,[r,o])=>(o!=null&&(i[r]=o),i),{})}scheduleNavigation(t,i,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((f,p)=>{a=f,l=p});let u=this.pendingTasks.add();return Qy(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:o,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(f=>Promise.reject(f))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function CL(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Te(4008,!1)}var fo=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Dt(null);get href(){return wr(this.reactiveHref)}set href(t){this.reactiveHref.set(t)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new tn;applicationErrorHandler=se(mi);options=se(Aa,{optional:!0});constructor(t,i,r,o,s,a){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=s,this.locationStrategy=a,this.reactiveHref.set(se(new yf("href"),{optional:!0}));let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area"||!!(typeof customElements=="object"&&customElements.get(l)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let t=this.preserveFragment,i=r=>r==="merge"||r==="preserve";t||=i(this.queryParamsHandling),t||=!this.queryParamsHandling&&!i(this.options?.defaultQueryParamsHandling),t&&(this.subscription=this.router.events.subscribe(r=>{r instanceof Li&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(t){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(t){t==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(uo(t)?this.routerLinkInput=t:this.routerLinkInput=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0"))}onClick(t,i,r,o,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(t!==0||i||r||o||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l)?.catch(c=>{this.applicationErrorHandler(c)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let t=this.urlTree;this.reactiveHref.set(t!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(t))??"":null)}applyAttributeValue(t,i){let r=this.renderer,o=this.el.nativeElement;i!==null?r.setAttribute(o,t,i):r.removeAttribute(o,t)}get urlTree(){return this.routerLinkInput===null?null:uo(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(Gn(Da),Gn(Ar),fc("tabindex"),Gn(gc),Gn(Cr),Gn(Qi))};static \u0275dir=os({type:n,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(i,r){i&1&&Ri("click",function(s){return r.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),i&2&&Bt("href",r.reactiveHref(),kg)("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",_f],skipLocationChange:[2,"skipLocationChange","skipLocationChange",_f],replaceUrl:[2,"replaceUrl","replaceUrl",_f],routerLink:"routerLink"},features:[is]})}return n})(),ev=(()=>{class n{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new wn;constructor(t,i,r,o,s){this.router=t,this.element=i,this.renderer=r,this.cdr=o,this.link=s,this.routerEventsSubscription=t.events.subscribe(a=>{a instanceof Li&&this.update()})}ngAfterContentInit(){Le(this.links.changes,Le(null)).pipe(qs()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let t=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Gt(t).pipe(qs()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(t){let i=Array.isArray(t)?t:t.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let t=this.hasActiveLinks();this.classes.forEach(i=>{t?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),t&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.isActiveChange.emit(t))})}isLinkActive(t){let i=bL(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{let o=r.urlTree;return o?t.isActive(o,i):!1}}hasActiveLinks(){let t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}static \u0275fac=function(i){return new(i||n)(Gn(Da),Gn(Cr),Gn(gc),Gn(Mc),Gn(fo,8))};static \u0275dir=os({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(i&1&&ay(o,fo,5),i&2){let s;ly(s=cy())&&(r.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[is]})}return n})();function bL(n){return!!n.paths}var IL=new Oe("");function tv(n,...e){return ql([{provide:jc,multi:!0,useValue:n},[],{provide:Ar,useFactory:AL,deps:[Da]},{provide:hf,multi:!0,useFactory:RL},e.map(t=>t.\u0275providers)])}function AL(n){return n.routerState.root}function DL(n,e){return{\u0275kind:n,\u0275providers:e}}function RL(){let n=se(ui);return e=>{let t=n.get(ss);if(e!==t.components[0])return;let i=n.get(Da),r=n.get(NL);n.get(PL)===1&&i.initialNavigation(),n.get(LL,null,{optional:!0})?.setUpPreloading(),n.get(IL,null,{optional:!0})?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var NL=new Oe("",{factory:()=>new tn}),PL=new Oe("",{providedIn:"root",factory:()=>1});var LL=new Oe("");function nv(){return DL(6,[{provide:Qi,useClass:Ey}])}var FL=["mobileMenuButton"],rC=()=>({exact:!0}),Ra=class Ra{constructor(){this.mobileMenuOpen=Dt(!1);this.mobileMenuButton=Tc("mobileMenuButton");lo(()=>{})}toggleMobileMenu(){this.mobileMenuOpen.update(t=>!t);let e=this.mobileMenuButton()?.nativeElement;e&&e.setAttribute("aria-expanded",this.mobileMenuOpen().toString())}closeMobileMenu(){this.mobileMenuOpen.set(!1);let e=this.mobileMenuButton()?.nativeElement;e&&(e.setAttribute("aria-expanded","false"),e.focus())}};Ra.\u0275fac=function(t){return new(t||Ra)},Ra.\u0275cmp=Ln({type:Ra,selectors:[["app-root"]],viewQuery:function(t,i){t&1&&ma(i.mobileMenuButton,FL,5),t&2&&xc()},hostAttrs:[1,"flex","flex-col","h-screen","w-screen","bg-gray-900"],decls:35,vars:9,consts:[["mobileMenuButton",""],["role","banner",1,"bg-gray-800","text-white","shadow-lg","flex-shrink-0","z-10"],["role","navigation","aria-label","Main navigation",1,"container","mx-auto","px-4","sm:px-6","py-4","flex","justify-between","items-center"],["routerLink","/","aria-label","3D Viewer - Home",1,"text-2xl","font-bold","text-white","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded"],["aria-hidden","true",1,"text-indigo-400"],["type","button","aria-label","Toggle navigation menu","aria-expanded","false","aria-controls","mobile-menu",1,"md:hidden","p-2","rounded-md","text-gray-300","hover:text-white","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],["role","menubar",1,"hidden","md:flex","items-center","space-x-6"],["routerLink","/","routerLinkActive","text-indigo-400 font-semibold","role","menuitem","aria-label","Navigate to Home page",1,"text-gray-300","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded","px-2","py-1",3,"routerLinkActiveOptions"],["routerLink","/configurator","routerLinkActive","text-indigo-400 font-semibold","role","menuitem","aria-label","Navigate to 3D Configurator",1,"text-gray-300","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded","px-2","py-1"],["routerLink","/about","routerLinkActive","text-indigo-400 font-semibold","role","menuitem","aria-label","Navigate to About page",1,"text-gray-300","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded","px-2","py-1"],["routerLink","/faq","routerLinkActive","text-indigo-400 font-semibold","role","menuitem","aria-label","Navigate to FAQ page",1,"text-gray-300","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded","px-2","py-1"],["routerLink","/contact","routerLinkActive","text-indigo-400 font-semibold","role","menuitem","aria-label","Navigate to Contact page",1,"text-gray-300","hover:text-indigo-400","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800","rounded","px-2","py-1"],["id","mobile-menu","role","menu",1,"md:hidden","absolute","top-full","left-0","right-0","bg-gray-800","border-t","border-gray-700","shadow-lg","transition-all","duration-300"],[1,"container","mx-auto","px-4","py-4","space-y-2"],["routerLink","/","routerLinkActive","text-indigo-400 font-semibold bg-gray-700","role","menuitem","aria-label","Navigate to Home page",1,"block","px-4","py-2","text-gray-300","hover:text-indigo-400","hover:bg-gray-700","rounded","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click","routerLinkActiveOptions"],["routerLink","/configurator","routerLinkActive","text-indigo-400 font-semibold bg-gray-700","role","menuitem","aria-label","Navigate to 3D Configurator",1,"block","px-4","py-2","text-gray-300","hover:text-indigo-400","hover:bg-gray-700","rounded","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click"],["routerLink","/about","routerLinkActive","text-indigo-400 font-semibold bg-gray-700","role","menuitem","aria-label","Navigate to About page",1,"block","px-4","py-2","text-gray-300","hover:text-indigo-400","hover:bg-gray-700","rounded","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click"],["routerLink","/faq","routerLinkActive","text-indigo-400 font-semibold bg-gray-700","role","menuitem","aria-label","Navigate to FAQ page",1,"block","px-4","py-2","text-gray-300","hover:text-indigo-400","hover:bg-gray-700","rounded","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click"],["routerLink","/contact","routerLinkActive","text-indigo-400 font-semibold bg-gray-700","role","menuitem","aria-label","Navigate to Contact page",1,"block","px-4","py-2","text-gray-300","hover:text-indigo-400","hover:bg-gray-700","rounded","transition-colors","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-800",3,"click"],["id","main-content","role","main",1,"flex-grow","overflow-y-auto"]],template:function(t,i){if(t&1){let r=En();ct(0,"header",1)(1,"nav",2)(2,"a",3)(3,"span",4),Z(4,"3D"),vt(),Z(5," Viewer "),vt(),ct(6,"button",5,0),Ri("click",function(){return at(r),lt(i.toggleMobileMenu())}),Zi(),ct(8,"svg",6),yi(9,"path",7),vt()(),ro(),ct(10,"div",8)(11,"a",9),Z(12,"Home"),vt(),ct(13,"a",10),Z(14,"Configurator"),vt(),ct(15,"a",11),Z(16,"About"),vt(),ct(17,"a",12),Z(18,"FAQ"),vt(),ct(19,"a",13),Z(20,"Contact"),vt()(),ct(21,"div",14)(22,"div",15)(23,"a",16),Ri("click",function(){return at(r),lt(i.closeMobileMenu())}),Z(24,"Home"),vt(),ct(25,"a",17),Ri("click",function(){return at(r),lt(i.closeMobileMenu())}),Z(26,"Configurator"),vt(),ct(27,"a",18),Ri("click",function(){return at(r),lt(i.closeMobileMenu())}),Z(28,"About"),vt(),ct(29,"a",19),Ri("click",function(){return at(r),lt(i.closeMobileMenu())}),Z(30,"FAQ"),vt(),ct(31,"a",20),Ri("click",function(){return at(r),lt(i.closeMobileMenu())}),Z(32,"Contact"),vt()()()()(),ct(33,"main",21),yi(34,"router-outlet"),vt()}t&2&&(de(11),_c("routerLinkActiveOptions",ga(7,rC)),de(10),Qn("hidden",!i.mobileMenuOpen())("block",i.mobileMenuOpen()),Bt("aria-hidden",!i.mobileMenuOpen()),de(2),_c("routerLinkActiveOptions",ga(8,rC)))},dependencies:[Xc,fo,ev],encapsulation:2,changeDetection:0});var Kf=Ra;var Na=class Na{};Na.\u0275fac=function(t){return new(t||Na)},Na.\u0275cmp=Ln({type:Na,selectors:[["app-home"]],decls:43,vars:0,consts:[[1,"relative","overflow-hidden"],[1,"relative","pt-24","pb-32","text-center"],[1,"absolute","inset-0","bg-gray-900","opacity-50"],[1,"absolute","inset-0",2,"background-image","url('https://picsum.photos/1920/1080?grayscale&blur=2')","background-size","cover","background-position","center","filter","blur(4px)"],[1,"relative","container","mx-auto","px-4"],[1,"text-4xl","md:text-6xl","font-extrabold","text-white","leading-tight","mb-4","animate-fade-in-down"],[1,"text-lg","md:text-xl","text-gray-300","max-w-3xl","mx-auto","mb-8","animate-fade-in-up"],["routerLink","/configurator",1,"bg-indigo-600","hover:bg-indigo-700","text-white","font-bold","py-3","px-8","rounded-lg","text-lg","shadow-xl","transition-transform","transform","hover:scale-105","inline-block","animate-bounce"],[1,"bg-gray-900","py-20"],[1,"container","mx-auto","px-4"],[1,"text-center","mb-12"],[1,"text-3xl","font-bold","text-white"],[1,"text-gray-400","mt-2"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-8"],[1,"bg-gray-800","p-8","rounded-xl","shadow-lg","text-center"],[1,"bg-indigo-500","rounded-full","w-16","h-16","flex","items-center","justify-center","mx-auto","mb-6"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-8","w-8","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"]],template:function(t,i){t&1&&(ct(0,"div",0)(1,"section",1),yi(2,"div",2)(3,"div",3),ct(4,"div",4)(5,"h1",5),Z(6," Bring Your 3D Models to Life "),vt(),ct(7,"p",6),Z(8," Our powerful online configurator lets you customize materials, lighting, and textures in real-time. Powered by AI for limitless creativity. "),vt(),ct(9,"a",7),Z(10," Launch Configurator Now "),vt()()(),ct(11,"section",8)(12,"div",9)(13,"div",10)(14,"h2",11),Z(15,"Why Use Our Configurator?"),vt(),ct(16,"p",12),Z(17,"The ultimate tool for artists, designers, and developers."),vt()(),ct(18,"div",13)(19,"div",14)(20,"div",15),Zi(),ct(21,"svg",16),yi(22,"path",17),vt()(),ro(),ct(23,"h3",18),Z(24,"Instant OBJ Loading"),vt(),ct(25,"p",19),Z(26,"Simply drag and drop or upload your .obj files. Our viewer centers and scales your model automatically for the perfect view."),vt()(),ct(27,"div",14)(28,"div",15),Zi(),ct(29,"svg",16),yi(30,"path",20),vt()(),ro(),ct(31,"h3",18),Z(32,"AI-Powered Materials"),vt(),ct(33,"p",19),Z(34,'Describe any material you can imagine, from "rusty metal" to "glowing alien rock", and our AI will generate PBR texture maps for you.'),vt()(),ct(35,"div",14)(36,"div",15),Zi(),ct(37,"svg",16),yi(38,"path",21),vt()(),ro(),ct(39,"h3",18),Z(40,"Export to GLB"),vt(),ct(41,"p",19),Z(42,"Once you're happy with your creation, export the entire scene, including your custom materials and lighting, into a single .glb file."),vt()()()()()())},dependencies:[fo],encapsulation:2,changeDetection:0});var Qf=Na;var Is={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},As={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},OL=0,oC=1,kL=2;var kw=1,g_=2,kr=3,So=0,$n=1,Bi=2,Eo=0,el=1,sC=2,aC=3,lC=4,UL=5,xs=100,BL=101,VL=102,HL=103,zL=104,GL=200,WL=201,qL=202,$L=203,Fv=204,Ov=205,YL=206,XL=207,JL=208,jL=209,ZL=210,KL=211,QL=212,eF=213,tF=214,nF=0,iF=1,rF=2,wh=3,oF=4,sF=5,aF=6,lF=7,y_=0,cF=1,uF=2,xo=0,dF=1,fF=2,hF=3,pF=4,mF=5,gF=6,yF=7;var cC=300,rl=301,ol=302,kv=303,Uv=304,Kh=306,sr=1e3,Ur=1001,au=1002,qn=1003,v_=1004;var Za=1005;var Rn=1006,iu=1007;var _i=1008;var To=1009,vF=1010,_F=1011,Uw=1012,Bw=1013,sl=1014,_o=1015,Qh=1016,Vw=1017,Hw=1018,gu=1020,EF=35902,xF=1021,SF=1022,Ei=1023,TF=1024,MF=1025,tl=1026,lu=1027,CF=1028,zw=1029,wF=1030,Gw=1031,Ww=1033,iv=33776,rv=33777,ov=33778,sv=33779,uC=35840,dC=35841,fC=35842,hC=35843,pC=36196,mC=37492,gC=37496,yC=37808,vC=37809,_C=37810,EC=37811,xC=37812,SC=37813,TC=37814,MC=37815,CC=37816,wC=37817,bC=37818,IC=37819,AC=37820,DC=37821,av=36492,RC=36494,NC=36495,bF=36283,PC=36284,LC=36285,FC=36286;var al=2300,ll=2301,lv=2302,OC=2400,kC=2401,UC=2402;var IF=3200,AF=3201,__=0,DF=1,rr="",An="srgb",bo="srgb-linear",E_="display-p3",ep="display-p3-linear",bh="linear",Lt="srgb",Ih="rec709",Ah="p3";var Pa=7680;var BC=519,RF=512,NF=513,PF=514,qw=515,LF=516,FF=517,OF=518,kF=519,VC=35044;var HC="300 es",Br=2e3,Dh=2001,ar=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let r=this._listeners[e];if(r!==void 0){let o=r.indexOf(t);o!==-1&&r.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let i=this._listeners[e.type];if(i!==void 0){e.target=this;let r=i.slice(0);for(let o=0,s=r.length;o<s;o++)r[o].call(this,e);e.target=null}}},bn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],zC=1234567,ru=Math.PI/180,cu=180/Math.PI;function ml(){let n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(bn[n&255]+bn[n>>8&255]+bn[n>>16&255]+bn[n>>24&255]+"-"+bn[e&255]+bn[e>>8&255]+"-"+bn[e>>16&15|64]+bn[e>>24&255]+"-"+bn[t&63|128]+bn[t>>8&255]+"-"+bn[t>>16&255]+bn[t>>24&255]+bn[i&255]+bn[i>>8&255]+bn[i>>16&255]+bn[i>>24&255]).toLowerCase()}function Dn(n,e,t){return Math.max(e,Math.min(t,n))}function x_(n,e){return(n%e+e)%e}function UF(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function BF(n,e,t){return n!==e?(t-n)/(e-n):0}function ou(n,e,t){return(1-t)*n+t*e}function VF(n,e,t,i){return ou(n,e,1-Math.exp(-t*i))}function HF(n,e=1){return e-Math.abs(x_(n,e*2)-e)}function zF(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function GF(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function WF(n,e){return n+Math.floor(Math.random()*(e-n+1))}function qF(n,e){return n+Math.random()*(e-n)}function $F(n){return n*(.5-Math.random())}function YF(n){n!==void 0&&(zC=n);let e=zC+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function XF(n){return n*ru}function JF(n){return n*cu}function jF(n){return(n&n-1)===0&&n!==0}function ZF(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function KF(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function QF(n,e,t,i,r){let o=Math.cos,s=Math.sin,a=o(t/2),l=s(t/2),c=o((e+i)/2),u=s((e+i)/2),f=o((e-i)/2),p=s((e-i)/2),m=o((i-e)/2),v=s((i-e)/2);switch(r){case"XYX":n.set(a*u,l*f,l*p,a*c);break;case"YZY":n.set(l*p,a*u,l*f,a*c);break;case"ZXZ":n.set(l*f,l*p,a*u,a*c);break;case"XZX":n.set(a*u,l*v,l*m,a*c);break;case"YXY":n.set(l*m,a*u,l*v,a*c);break;case"ZYZ":n.set(l*v,l*m,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function ja(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function kn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}var gl={DEG2RAD:ru,RAD2DEG:cu,generateUUID:ml,clamp:Dn,euclideanModulo:x_,mapLinear:UF,inverseLerp:BF,lerp:ou,damp:VF,pingpong:HF,smoothstep:zF,smootherstep:GF,randInt:WF,randFloat:qF,randFloatSpread:$F,seededRandom:YF,degToRad:XF,radToDeg:JF,isPowerOfTwo:jF,ceilPowerOfTwo:ZF,floorPowerOfTwo:KF,setQuaternionFromProperEuler:QF,normalize:kn,denormalize:ja},Ne=class n{constructor(e=0,t=0){n.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Dn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*i-s*r+e.x,this.y=o*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ke=class n{constructor(e,t,i,r,o,s,a,l,c){n.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,o,s,a,l,c)}set(e,t,i,r,o,s,a,l,c){let u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=o,u[5]=l,u[6]=i,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,o=this.elements,s=i[0],a=i[3],l=i[6],c=i[1],u=i[4],f=i[7],p=i[2],m=i[5],v=i[8],_=r[0],y=r[3],g=r[6],T=r[1],x=r[4],M=r[7],D=r[2],I=r[5],A=r[8];return o[0]=s*_+a*T+l*D,o[3]=s*y+a*x+l*I,o[6]=s*g+a*M+l*A,o[1]=c*_+u*T+f*D,o[4]=c*y+u*x+f*I,o[7]=c*g+u*M+f*A,o[2]=p*_+m*T+v*D,o[5]=p*y+m*x+v*I,o[8]=p*g+m*M+v*A,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-i*o*u+i*a*l+r*o*c-r*s*l}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=u*s-a*c,p=a*l-u*o,m=c*o-s*l,v=t*f+i*p+r*m;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);let _=1/v;return e[0]=f*_,e[1]=(r*c-u*i)*_,e[2]=(a*i-r*s)*_,e[3]=p*_,e[4]=(u*t-r*l)*_,e[5]=(r*o-a*t)*_,e[6]=m*_,e[7]=(i*l-c*t)*_,e[8]=(s*t-i*o)*_,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,o,s,a){let l=Math.cos(o),c=Math.sin(o);return this.set(i*l,i*c,-i*(l*s+c*a)+s+e,-r*c,r*l,-r*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(cv.makeScale(e,t)),this}rotate(e){return this.premultiply(cv.makeRotation(-e)),this}translate(e,t){return this.premultiply(cv.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},cv=new Ke;function $w(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function uu(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function eO(){let n=uu("canvas");return n.style.display="block",n}var GC={};function tO(n){n in GC||(GC[n]=!0,console.warn(n))}var WC=new Ke().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qC=new Ke().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),eh={[bo]:{transfer:bh,primaries:Ih,toReference:n=>n,fromReference:n=>n},[An]:{transfer:Lt,primaries:Ih,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[ep]:{transfer:bh,primaries:Ah,toReference:n=>n.applyMatrix3(qC),fromReference:n=>n.applyMatrix3(WC)},[E_]:{transfer:Lt,primaries:Ah,toReference:n=>n.convertSRGBToLinear().applyMatrix3(qC),fromReference:n=>n.applyMatrix3(WC).convertLinearToSRGB()}},nO=new Set([bo,ep]),At={enabled:!0,_workingColorSpace:bo,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!nO.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;let i=eh[e].toReference,r=eh[t].fromReference;return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return eh[n].primaries},getTransfer:function(n){return n===rr?bh:eh[n].transfer}};function nl(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function uv(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}var La,Bv=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{La===void 0&&(La=uu("canvas")),La.width=e.width,La.height=e.height;let i=La.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=La}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=uu("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),o=r.data;for(let s=0;s<o.length;s++)o[s]=nl(o[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(nl(t[i]/255)*255):t[i]=nl(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},iO=0,cl=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:iO++}),this.uuid=ml(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?o.push(dv(r[s].image)):o.push(dv(r[s]))}else o=dv(r);i.url=o}return t||(e.images[this.uuid]=i),i}};function dv(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Bv.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var rO=0,cr=(()=>{class n extends ar{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=Ur,o=Ur,s=Rn,a=_i,l=Ei,c=To,u=n.DEFAULT_ANISOTROPY,f=rr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rO++}),this.uuid=ml(),this.name="",this.source=new cl(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=o,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Ne(0,0),this.repeat=new Ne(1,1),this.center=new Ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ke,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==cC)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case sr:t.x=t.x-Math.floor(t.x);break;case Ur:t.x=t.x<0?0:1;break;case au:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case sr:t.y=t.y-Math.floor(t.y);break;case Ur:t.y=t.y<0?0:1;break;case au:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=cC,n.DEFAULT_ANISOTROPY=1,n})(),pn=class n{constructor(e=0,t=0,i=0,r=1){n.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*o,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*o,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*o,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,o,l=e.elements,c=l[0],u=l[4],f=l[8],p=l[1],m=l[5],v=l[9],_=l[2],y=l[6],g=l[10];if(Math.abs(u-p)<.01&&Math.abs(f-_)<.01&&Math.abs(v-y)<.01){if(Math.abs(u+p)<.1&&Math.abs(f+_)<.1&&Math.abs(v+y)<.1&&Math.abs(c+m+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let x=(c+1)/2,M=(m+1)/2,D=(g+1)/2,I=(u+p)/4,A=(f+_)/4,k=(v+y)/4;return x>M&&x>D?x<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(x),r=I/i,o=A/i):M>D?M<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(M),i=I/r,o=k/r):D<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(D),i=A/o,r=k/o),this.set(i,r,o,t),this}let T=Math.sqrt((y-v)*(y-v)+(f-_)*(f-_)+(p-u)*(p-u));return Math.abs(T)<.001&&(T=1),this.x=(y-v)/T,this.y=(f-_)/T,this.z=(p-u)/T,this.w=Math.acos((c+m+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Vv=class extends ar{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new pn(0,0,e,t),this.scissorTest=!1,this.viewport=new pn(0,0,e,t);let r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Rn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);let o=new cr(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);o.flipY=!1,o.generateMipmaps=i.generateMipmaps,o.internalFormat=i.internalFormat,this.textures=[];let s=i.count;for(let a=0;a<s;a++)this.textures[a]=o.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,o=this.textures.length;r<o;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new cl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Vr=class extends Vv{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}},Rh=class extends cr{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=qn,this.minFilter=qn,this.wrapR=Ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var Hv=class extends cr{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=qn,this.minFilter=qn,this.wrapR=Ur,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var oi=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,o,s,a){let l=i[r+0],c=i[r+1],u=i[r+2],f=i[r+3],p=o[s+0],m=o[s+1],v=o[s+2],_=o[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=f;return}if(a===1){e[t+0]=p,e[t+1]=m,e[t+2]=v,e[t+3]=_;return}if(f!==_||l!==p||c!==m||u!==v){let y=1-a,g=l*p+c*m+u*v+f*_,T=g>=0?1:-1,x=1-g*g;if(x>Number.EPSILON){let D=Math.sqrt(x),I=Math.atan2(D,g*T);y=Math.sin(y*I)/D,a=Math.sin(a*I)/D}let M=a*T;if(l=l*y+p*M,c=c*y+m*M,u=u*y+v*M,f=f*y+_*M,y===1-a){let D=1/Math.sqrt(l*l+c*c+u*u+f*f);l*=D,c*=D,u*=D,f*=D}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,r,o,s){let a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],f=o[s],p=o[s+1],m=o[s+2],v=o[s+3];return e[t]=a*v+u*f+l*m-c*p,e[t+1]=l*v+u*p+c*f-a*m,e[t+2]=c*v+u*m+a*p-l*f,e[t+3]=u*v-a*f-l*p-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let i=e._x,r=e._y,o=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),f=a(o/2),p=l(i/2),m=l(r/2),v=l(o/2);switch(s){case"XYZ":this._x=p*u*f+c*m*v,this._y=c*m*f-p*u*v,this._z=c*u*v+p*m*f,this._w=c*u*f-p*m*v;break;case"YXZ":this._x=p*u*f+c*m*v,this._y=c*m*f-p*u*v,this._z=c*u*v-p*m*f,this._w=c*u*f+p*m*v;break;case"ZXY":this._x=p*u*f-c*m*v,this._y=c*m*f+p*u*v,this._z=c*u*v+p*m*f,this._w=c*u*f-p*m*v;break;case"ZYX":this._x=p*u*f-c*m*v,this._y=c*m*f+p*u*v,this._z=c*u*v-p*m*f,this._w=c*u*f+p*m*v;break;case"YZX":this._x=p*u*f+c*m*v,this._y=c*m*f+p*u*v,this._z=c*u*v-p*m*f,this._w=c*u*f-p*m*v;break;case"XZY":this._x=p*u*f-c*m*v,this._y=c*m*f-p*u*v,this._z=c*u*v+p*m*f,this._w=c*u*f+p*m*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],o=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],f=t[10],p=i+a+f;if(p>0){let m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(u-l)*m,this._y=(o-c)*m,this._z=(s-r)*m}else if(i>a&&i>f){let m=2*Math.sqrt(1+i-a-f);this._w=(u-l)/m,this._x=.25*m,this._y=(r+s)/m,this._z=(o+c)/m}else if(a>f){let m=2*Math.sqrt(1+a-i-f);this._w=(o-c)/m,this._x=(r+s)/m,this._y=.25*m,this._z=(l+u)/m}else{let m=2*Math.sqrt(1+f-i-a);this._w=(s-r)/m,this._x=(o+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Dn(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,o=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+s*a+r*c-o*l,this._y=r*u+s*l+o*a-i*c,this._z=o*u+s*c+i*l-r*a,this._w=s*u-i*a-r*l-o*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,o=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=o,this;let l=1-a*a;if(l<=Number.EPSILON){let m=1-t;return this._w=m*s+t*this._w,this._x=m*i+t*this._x,this._y=m*r+t*this._y,this._z=m*o+t*this._z,this.normalize(),this}let c=Math.sqrt(l),u=Math.atan2(c,a),f=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=s*f+this._w*p,this._x=i*f+this._x*p,this._y=r*f+this._y*p,this._z=o*f+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),o=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},P=class n{constructor(e=0,t=0,i=0){n.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion($C.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion($C.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,o=e.elements,s=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*s,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*s,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,o=e.x,s=e.y,a=e.z,l=e.w,c=2*(s*r-a*i),u=2*(a*t-o*r),f=2*(o*i-s*t);return this.x=t+l*c+s*f-a*u,this.y=i+l*u+a*c-o*f,this.z=r+l*f+o*u-s*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,o=e.z,s=t.x,a=t.y,l=t.z;return this.x=r*l-o*a,this.y=o*s-i*l,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return fv.copy(this).projectOnVector(e),this.sub(fv)}reflect(e){return this.sub(fv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Dn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},fv=new P,$C=new oi,lr=class{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Fi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Fi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Fi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0){let o=i.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let s=0,a=o.count;s<a;s++)e.isMesh===!0?e.getVertexPosition(s,Fi):Fi.fromBufferAttribute(o,s),Fi.applyMatrix4(e.matrixWorld),this.expandByPoint(Fi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),th.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),th.copy(i.boundingBox)),th.applyMatrix4(e.matrixWorld),this.union(th)}let r=e.children;for(let o=0,s=r.length;o<s;o++)this.expandByObject(r[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Fi),Fi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Zc),nh.subVectors(this.max,Zc),Fa.subVectors(e.a,Zc),Oa.subVectors(e.b,Zc),ka.subVectors(e.c,Zc),ho.subVectors(Oa,Fa),po.subVectors(ka,Oa),ps.subVectors(Fa,ka);let t=[0,-ho.z,ho.y,0,-po.z,po.y,0,-ps.z,ps.y,ho.z,0,-ho.x,po.z,0,-po.x,ps.z,0,-ps.x,-ho.y,ho.x,0,-po.y,po.x,0,-ps.y,ps.x,0];return!hv(t,Fa,Oa,ka,nh)||(t=[1,0,0,0,1,0,0,0,1],!hv(t,Fa,Oa,ka,nh))?!1:(ih.crossVectors(ho,po),t=[ih.x,ih.y,ih.z],hv(t,Fa,Oa,ka,nh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Fi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Fi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Rr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Rr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Rr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Rr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Rr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Rr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Rr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Rr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Rr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Rr=[new P,new P,new P,new P,new P,new P,new P,new P],Fi=new P,th=new lr,Fa=new P,Oa=new P,ka=new P,ho=new P,po=new P,ps=new P,Zc=new P,nh=new P,ih=new P,ms=new P;function hv(n,e,t,i,r){for(let o=0,s=n.length-3;o<=s;o+=3){ms.fromArray(n,o);let a=r.x*Math.abs(ms.x)+r.y*Math.abs(ms.y)+r.z*Math.abs(ms.z),l=e.dot(ms),c=t.dot(ms),u=i.dot(ms);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}var oO=new lr,Kc=new P,pv=new P,Ts=class{constructor(e=new P,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):oO.setFromPoints(e).getCenter(i);let r=0;for(let o=0,s=e.length;o<s;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Kc.subVectors(e,this.center);let t=Kc.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Kc,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(pv.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Kc.copy(e.center).add(pv)),this.expandByPoint(Kc.copy(e.center).sub(pv))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Nr=new P,mv=new P,rh=new P,mo=new P,gv=new P,oh=new P,yv=new P,Ms=class{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Nr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Nr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Nr.copy(this.origin).addScaledVector(this.direction,t),Nr.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){mv.copy(e).add(t).multiplyScalar(.5),rh.copy(t).sub(e).normalize(),mo.copy(this.origin).sub(mv);let o=e.distanceTo(t)*.5,s=-this.direction.dot(rh),a=mo.dot(this.direction),l=-mo.dot(rh),c=mo.lengthSq(),u=Math.abs(1-s*s),f,p,m,v;if(u>0)if(f=s*l-a,p=s*a-l,v=o*u,f>=0)if(p>=-v)if(p<=v){let _=1/u;f*=_,p*=_,m=f*(f+s*p+2*a)+p*(s*f+p+2*l)+c}else p=o,f=Math.max(0,-(s*p+a)),m=-f*f+p*(p+2*l)+c;else p=-o,f=Math.max(0,-(s*p+a)),m=-f*f+p*(p+2*l)+c;else p<=-v?(f=Math.max(0,-(-s*o+a)),p=f>0?-o:Math.min(Math.max(-o,-l),o),m=-f*f+p*(p+2*l)+c):p<=v?(f=0,p=Math.min(Math.max(-o,-l),o),m=p*(p+2*l)+c):(f=Math.max(0,-(s*o+a)),p=f>0?o:Math.min(Math.max(-o,-l),o),m=-f*f+p*(p+2*l)+c);else p=s>0?-o:o,f=Math.max(0,-(s*p+a)),m=-f*f+p*(p+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,f),r&&r.copy(mv).addScaledVector(rh,p),m}intersectSphere(e,t){Nr.subVectors(e.center,this.origin);let i=Nr.dot(this.direction),r=Nr.dot(Nr)-i*i,o=e.radius*e.radius;if(r>o)return null;let s=Math.sqrt(o-r),a=i-s,l=i+s;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,o,s,a,l,c=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,p=this.origin;return c>=0?(i=(e.min.x-p.x)*c,r=(e.max.x-p.x)*c):(i=(e.max.x-p.x)*c,r=(e.min.x-p.x)*c),u>=0?(o=(e.min.y-p.y)*u,s=(e.max.y-p.y)*u):(o=(e.max.y-p.y)*u,s=(e.min.y-p.y)*u),i>s||o>r||((o>i||isNaN(i))&&(i=o),(s<r||isNaN(r))&&(r=s),f>=0?(a=(e.min.z-p.z)*f,l=(e.max.z-p.z)*f):(a=(e.max.z-p.z)*f,l=(e.min.z-p.z)*f),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Nr)!==null}intersectTriangle(e,t,i,r,o){gv.subVectors(t,e),oh.subVectors(i,e),yv.crossVectors(gv,oh);let s=this.direction.dot(yv),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;mo.subVectors(this.origin,e);let l=a*this.direction.dot(oh.crossVectors(mo,oh));if(l<0)return null;let c=a*this.direction.dot(gv.cross(mo));if(c<0||l+c>s)return null;let u=-a*mo.dot(yv);return u<0?null:this.at(u/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Ft=class n{constructor(e,t,i,r,o,s,a,l,c,u,f,p,m,v,_,y){n.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,o,s,a,l,c,u,f,p,m,v,_,y)}set(e,t,i,r,o,s,a,l,c,u,f,p,m,v,_,y){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=o,g[5]=s,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=f,g[14]=p,g[3]=m,g[7]=v,g[11]=_,g[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new n().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/Ua.setFromMatrixColumn(e,0).length(),o=1/Ua.setFromMatrixColumn(e,1).length(),s=1/Ua.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,r=e.y,o=e.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(o),f=Math.sin(o);if(e.order==="XYZ"){let p=s*u,m=s*f,v=a*u,_=a*f;t[0]=l*u,t[4]=-l*f,t[8]=c,t[1]=m+v*c,t[5]=p-_*c,t[9]=-a*l,t[2]=_-p*c,t[6]=v+m*c,t[10]=s*l}else if(e.order==="YXZ"){let p=l*u,m=l*f,v=c*u,_=c*f;t[0]=p+_*a,t[4]=v*a-m,t[8]=s*c,t[1]=s*f,t[5]=s*u,t[9]=-a,t[2]=m*a-v,t[6]=_+p*a,t[10]=s*l}else if(e.order==="ZXY"){let p=l*u,m=l*f,v=c*u,_=c*f;t[0]=p-_*a,t[4]=-s*f,t[8]=v+m*a,t[1]=m+v*a,t[5]=s*u,t[9]=_-p*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){let p=s*u,m=s*f,v=a*u,_=a*f;t[0]=l*u,t[4]=v*c-m,t[8]=p*c+_,t[1]=l*f,t[5]=_*c+p,t[9]=m*c-v,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){let p=s*l,m=s*c,v=a*l,_=a*c;t[0]=l*u,t[4]=_-p*f,t[8]=v*f+m,t[1]=f,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*f+v,t[10]=p-_*f}else if(e.order==="XZY"){let p=s*l,m=s*c,v=a*l,_=a*c;t[0]=l*u,t[4]=-f,t[8]=c*u,t[1]=p*f+_,t[5]=s*u,t[9]=m*f-v,t[2]=v*f-m,t[6]=a*u,t[10]=_*f+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(sO,e,aO)}lookAt(e,t,i){let r=this.elements;return ii.subVectors(e,t),ii.lengthSq()===0&&(ii.z=1),ii.normalize(),go.crossVectors(i,ii),go.lengthSq()===0&&(Math.abs(i.z)===1?ii.x+=1e-4:ii.z+=1e-4,ii.normalize(),go.crossVectors(i,ii)),go.normalize(),sh.crossVectors(ii,go),r[0]=go.x,r[4]=sh.x,r[8]=ii.x,r[1]=go.y,r[5]=sh.y,r[9]=ii.y,r[2]=go.z,r[6]=sh.z,r[10]=ii.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,o=this.elements,s=i[0],a=i[4],l=i[8],c=i[12],u=i[1],f=i[5],p=i[9],m=i[13],v=i[2],_=i[6],y=i[10],g=i[14],T=i[3],x=i[7],M=i[11],D=i[15],I=r[0],A=r[4],k=r[8],w=r[12],S=r[1],L=r[5],z=r[9],N=r[13],$=r[2],Y=r[6],Q=r[10],re=r[14],q=r[3],oe=r[7],ie=r[11],xe=r[15];return o[0]=s*I+a*S+l*$+c*q,o[4]=s*A+a*L+l*Y+c*oe,o[8]=s*k+a*z+l*Q+c*ie,o[12]=s*w+a*N+l*re+c*xe,o[1]=u*I+f*S+p*$+m*q,o[5]=u*A+f*L+p*Y+m*oe,o[9]=u*k+f*z+p*Q+m*ie,o[13]=u*w+f*N+p*re+m*xe,o[2]=v*I+_*S+y*$+g*q,o[6]=v*A+_*L+y*Y+g*oe,o[10]=v*k+_*z+y*Q+g*ie,o[14]=v*w+_*N+y*re+g*xe,o[3]=T*I+x*S+M*$+D*q,o[7]=T*A+x*L+M*Y+D*oe,o[11]=T*k+x*z+M*Q+D*ie,o[15]=T*w+x*N+M*re+D*xe,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],f=e[6],p=e[10],m=e[14],v=e[3],_=e[7],y=e[11],g=e[15];return v*(+o*l*f-r*c*f-o*a*p+i*c*p+r*a*m-i*l*m)+_*(+t*l*m-t*c*p+o*s*p-r*s*m+r*c*u-o*l*u)+y*(+t*c*f-t*a*m-o*s*f+i*s*m+o*a*u-i*c*u)+g*(-r*a*u-t*l*f+t*a*p+r*s*f-i*s*p+i*l*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],p=e[10],m=e[11],v=e[12],_=e[13],y=e[14],g=e[15],T=f*y*c-_*p*c+_*l*m-a*y*m-f*l*g+a*p*g,x=v*p*c-u*y*c-v*l*m+s*y*m+u*l*g-s*p*g,M=u*_*c-v*f*c+v*a*m-s*_*m-u*a*g+s*f*g,D=v*f*l-u*_*l-v*a*p+s*_*p+u*a*y-s*f*y,I=t*T+i*x+r*M+o*D;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let A=1/I;return e[0]=T*A,e[1]=(_*p*o-f*y*o-_*r*m+i*y*m+f*r*g-i*p*g)*A,e[2]=(a*y*o-_*l*o+_*r*c-i*y*c-a*r*g+i*l*g)*A,e[3]=(f*l*o-a*p*o-f*r*c+i*p*c+a*r*m-i*l*m)*A,e[4]=x*A,e[5]=(u*y*o-v*p*o+v*r*m-t*y*m-u*r*g+t*p*g)*A,e[6]=(v*l*o-s*y*o-v*r*c+t*y*c+s*r*g-t*l*g)*A,e[7]=(s*p*o-u*l*o+u*r*c-t*p*c-s*r*m+t*l*m)*A,e[8]=M*A,e[9]=(v*f*o-u*_*o-v*i*m+t*_*m+u*i*g-t*f*g)*A,e[10]=(s*_*o-v*a*o+v*i*c-t*_*c-s*i*g+t*a*g)*A,e[11]=(u*a*o-s*f*o-u*i*c+t*f*c+s*i*m-t*a*m)*A,e[12]=D*A,e[13]=(u*_*r-v*f*r+v*i*p-t*_*p-u*i*y+t*f*y)*A,e[14]=(v*a*r-s*_*r-v*i*l+t*_*l+s*i*y-t*a*y)*A,e[15]=(s*f*r-u*a*r+u*i*l-t*f*l-s*i*p+t*a*p)*A,this}scale(e){let t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),o=1-i,s=e.x,a=e.y,l=e.z,c=o*s,u=o*a;return this.set(c*s+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*s,0,c*l-r*a,u*l+r*s,o*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,o,s){return this.set(1,i,o,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,o=t._x,s=t._y,a=t._z,l=t._w,c=o+o,u=s+s,f=a+a,p=o*c,m=o*u,v=o*f,_=s*u,y=s*f,g=a*f,T=l*c,x=l*u,M=l*f,D=i.x,I=i.y,A=i.z;return r[0]=(1-(_+g))*D,r[1]=(m+M)*D,r[2]=(v-x)*D,r[3]=0,r[4]=(m-M)*I,r[5]=(1-(p+g))*I,r[6]=(y+T)*I,r[7]=0,r[8]=(v+x)*A,r[9]=(y-T)*A,r[10]=(1-(p+_))*A,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,o=Ua.set(r[0],r[1],r[2]).length(),s=Ua.set(r[4],r[5],r[6]).length(),a=Ua.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Oi.copy(this);let c=1/o,u=1/s,f=1/a;return Oi.elements[0]*=c,Oi.elements[1]*=c,Oi.elements[2]*=c,Oi.elements[4]*=u,Oi.elements[5]*=u,Oi.elements[6]*=u,Oi.elements[8]*=f,Oi.elements[9]*=f,Oi.elements[10]*=f,t.setFromRotationMatrix(Oi),i.x=o,i.y=s,i.z=a,this}makePerspective(e,t,i,r,o,s,a=Br){let l=this.elements,c=2*o/(t-e),u=2*o/(i-r),f=(t+e)/(t-e),p=(i+r)/(i-r),m,v;if(a===Br)m=-(s+o)/(s-o),v=-2*s*o/(s-o);else if(a===Dh)m=-s/(s-o),v=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=v,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,o,s,a=Br){let l=this.elements,c=1/(t-e),u=1/(i-r),f=1/(s-o),p=(t+e)*c,m=(i+r)*u,v,_;if(a===Br)v=(s+o)*f,_=-2*f;else if(a===Dh)v=o*f,_=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=_,l[14]=-v,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},Ua=new P,Oi=new Ft,sO=new P(0,0,0),aO=new P(1,1,1),go=new P,sh=new P,ii=new P,YC=new Ft,XC=new oi,Mo=(()=>{class n{constructor(t=0,i=0,r=0,o=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=o}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,o=this._order){return this._x=t,this._y=i,this._z=r,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){let o=t.elements,s=o[0],a=o[4],l=o[8],c=o[1],u=o[5],f=o[9],p=o[2],m=o[6],v=o[10];switch(i){case"XYZ":this._y=Math.asin(Dn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,v),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Dn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,v),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(Dn(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-p,v),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Dn(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(m,v),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Dn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,u),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(l,v));break;case"XZY":this._z=Math.asin(-Dn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-f,v),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return YC.makeRotationFromQuaternion(t),this.setFromRotationMatrix(YC,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return XC.setFromEuler(this),this.setFromQuaternion(XC,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})(),Nh=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},lO=0,JC=new P,Ba=new oi,Pr=new Ft,ah=new P,Qc=new P,cO=new P,uO=new oi,jC=new P(1,0,0),ZC=new P(0,1,0),KC=new P(0,0,1),QC={type:"added"},dO={type:"removed"},Va={type:"childadded",child:null},vv={type:"childremoved",child:null},Vi=(()=>{class n extends ar{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:lO++}),this.uuid=ml(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();let t=new P,i=new Mo,r=new oi,o=new P(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Ft},normalMatrix:{value:new Ke}}),this.matrix=new Ft,this.matrixWorld=new Ft,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Nh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Ba.setFromAxisAngle(t,i),this.quaternion.multiply(Ba),this}rotateOnWorldAxis(t,i){return Ba.setFromAxisAngle(t,i),this.quaternion.premultiply(Ba),this}rotateX(t){return this.rotateOnAxis(jC,t)}rotateY(t){return this.rotateOnAxis(ZC,t)}rotateZ(t){return this.rotateOnAxis(KC,t)}translateOnAxis(t,i){return JC.copy(t).applyQuaternion(this.quaternion),this.position.add(JC.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(jC,t)}translateY(t){return this.translateOnAxis(ZC,t)}translateZ(t){return this.translateOnAxis(KC,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Pr.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?ah.copy(t):ah.set(t,i,r);let o=this.parent;this.updateWorldMatrix(!0,!1),Qc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pr.lookAt(Qc,ah,this.up):Pr.lookAt(ah,Qc,this.up),this.quaternion.setFromRotationMatrix(Pr),o&&(Pr.extractRotation(o.matrixWorld),Ba.setFromRotationMatrix(Pr),this.quaternion.premultiply(Ba.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(QC),Va.child=t,this.dispatchEvent(Va),Va.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(dO),vv.child=t,this.dispatchEvent(vv),vv.child=null),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Pr.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Pr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Pr),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(QC),Va.child=t,this.dispatchEvent(Va),Va.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,o=this.children.length;r<o;r++){let a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);let o=this.children;for(let s=0,a=o.length;s<a;s++)o[s].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qc,t,cO),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qc,uO,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);let i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].traverseVisible(t)}traverseAncestors(t){let i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let i=this.children;for(let r=0,o=i.length;r<o;r++){let s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){let r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){let o=this.children;for(let s=0,a=o.length;s<a;s++){let l=o[s];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(t){let i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),o.maxGeometryCount=this._maxGeometryCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}));function s(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=s(t.geometries,this.geometry);let l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){let c=l.shapes;if(Array.isArray(c))for(let u=0,f=c.length;u<f;u++){let p=c[u];s(t.shapes,p)}else s(t.shapes,c)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(s(t.materials,this.material[c]));o.material=l}else o.material=s(t.materials,this.material);if(this.children.length>0){o.children=[];for(let l=0;l<this.children.length;l++)o.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){o.animations=[];for(let l=0;l<this.animations.length;l++){let c=this.animations[l];o.animations.push(s(t.animations,c))}}if(i){let l=a(t.geometries),c=a(t.materials),u=a(t.textures),f=a(t.images),p=a(t.shapes),m=a(t.skeletons),v=a(t.animations),_=a(t.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),f.length>0&&(r.images=f),p.length>0&&(r.shapes=p),m.length>0&&(r.skeletons=m),v.length>0&&(r.animations=v),_.length>0&&(r.nodes=_)}return r.object=o,r;function a(l){let c=[];for(let u in l){let f=l[u];delete f.metadata,c.push(f)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){let o=t.children[r];this.add(o.clone())}return this}}return n.DEFAULT_UP=new P(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})(),ki=new P,Lr=new P,_v=new P,Fr=new P,Ha=new P,za=new P,ew=new P,Ev=new P,xv=new P,Sv=new P,Ka=class n{constructor(e=new P,t=new P,i=new P){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ki.subVectors(e,t),r.cross(ki);let o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,i,r,o){ki.subVectors(r,t),Lr.subVectors(i,t),_v.subVectors(e,t);let s=ki.dot(ki),a=ki.dot(Lr),l=ki.dot(_v),c=Lr.dot(Lr),u=Lr.dot(_v),f=s*c-a*a;if(f===0)return o.set(0,0,0),null;let p=1/f,m=(c*l-a*u)*p,v=(s*u-a*l)*p;return o.set(1-m-v,v,m)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Fr)===null?!1:Fr.x>=0&&Fr.y>=0&&Fr.x+Fr.y<=1}static getInterpolation(e,t,i,r,o,s,a,l){return this.getBarycoord(e,t,i,r,Fr)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(o,Fr.x),l.addScaledVector(s,Fr.y),l.addScaledVector(a,Fr.z),l)}static isFrontFacing(e,t,i,r){return ki.subVectors(i,t),Lr.subVectors(e,t),ki.cross(Lr).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ki.subVectors(this.c,this.b),Lr.subVectors(this.a,this.b),ki.cross(Lr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return n.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return n.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,o){return n.getInterpolation(e,this.a,this.b,this.c,t,i,r,o)}containsPoint(e){return n.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return n.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,o=this.c,s,a;Ha.subVectors(r,i),za.subVectors(o,i),Ev.subVectors(e,i);let l=Ha.dot(Ev),c=za.dot(Ev);if(l<=0&&c<=0)return t.copy(i);xv.subVectors(e,r);let u=Ha.dot(xv),f=za.dot(xv);if(u>=0&&f<=u)return t.copy(r);let p=l*f-u*c;if(p<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(i).addScaledVector(Ha,s);Sv.subVectors(e,o);let m=Ha.dot(Sv),v=za.dot(Sv);if(v>=0&&m<=v)return t.copy(o);let _=m*c-l*v;if(_<=0&&c>=0&&v<=0)return a=c/(c-v),t.copy(i).addScaledVector(za,a);let y=u*v-m*f;if(y<=0&&f-u>=0&&m-v>=0)return ew.subVectors(o,r),a=(f-u)/(f-u+(m-v)),t.copy(r).addScaledVector(ew,a);let g=1/(y+_+p);return s=_*g,a=p*g,t.copy(i).addScaledVector(Ha,s).addScaledVector(za,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Yw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yo={h:0,s:0,l:0},lh={h:0,s:0,l:0};function Tv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}var ke=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){let r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=An){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,At.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=At.workingColorSpace){return this.r=e,this.g=t,this.b=i,At.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=At.workingColorSpace){if(e=x_(e,1),t=Dn(t,0,1),i=Dn(i,0,1),t===0)this.r=this.g=this.b=i;else{let o=i<=.5?i*(1+t):i+t-i*t,s=2*i-o;this.r=Tv(s,o,e+1/3),this.g=Tv(s,o,e),this.b=Tv(s,o,e-1/3)}return At.toWorkingColorSpace(this,r),this}setStyle(e,t=An){function i(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let o,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let o=r[1],s=o.length;if(s===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=An){let i=Yw[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nl(e.r),this.g=nl(e.g),this.b=nl(e.b),this}copyLinearToSRGB(e){return this.r=uv(e.r),this.g=uv(e.g),this.b=uv(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=An){return At.fromWorkingColorSpace(In.copy(this),e),Math.round(Dn(In.r*255,0,255))*65536+Math.round(Dn(In.g*255,0,255))*256+Math.round(Dn(In.b*255,0,255))}getHexString(e=An){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=At.workingColorSpace){At.fromWorkingColorSpace(In.copy(this),t);let i=In.r,r=In.g,o=In.b,s=Math.max(i,r,o),a=Math.min(i,r,o),l,c,u=(a+s)/2;if(a===s)l=0,c=0;else{let f=s-a;switch(c=u<=.5?f/(s+a):f/(2-s-a),s){case i:l=(r-o)/f+(r<o?6:0);break;case r:l=(o-i)/f+2;break;case o:l=(i-r)/f+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=At.workingColorSpace){return At.fromWorkingColorSpace(In.copy(this),t),e.r=In.r,e.g=In.g,e.b=In.b,e}getStyle(e=An){At.fromWorkingColorSpace(In.copy(this),e);let t=In.r,i=In.g,r=In.b;return e!==An?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(yo),this.setHSL(yo.h+e,yo.s+t,yo.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(yo),e.getHSL(lh);let i=ou(yo.h,lh.h,t),r=ou(yo.s,lh.s,t),o=ou(yo.l,lh.l,t);return this.setHSL(i,r,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,i=this.g,r=this.b,o=e.elements;return this.r=o[0]*t+o[3]*i+o[6]*r,this.g=o[1]*t+o[4]*i+o[7]*r,this.b=o[2]*t+o[5]*i+o[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},In=new ke;ke.NAMES=Yw;var fO=0,si=class extends ar{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:fO++}),this.uuid=ml(),this.name="",this.type="Material",this.blending=el,this.side=So,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Fv,this.blendDst=Ov,this.blendEquation=xs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ke(0,0,0),this.blendAlpha=0,this.depthFunc=wh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=BC,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Pa,this.stencilZFail=Pa,this.stencilZPass=Pa,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==el&&(i.blending=this.blending),this.side!==So&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Fv&&(i.blendSrc=this.blendSrc),this.blendDst!==Ov&&(i.blendDst=this.blendDst),this.blendEquation!==xs&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==wh&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==BC&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Pa&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Pa&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Pa&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(o){let s=[];for(let a in o){let l=o[a];delete l.metadata,s.push(l)}return s}if(t){let o=r(e.textures),s=r(e.images);o.length>0&&(i.textures=o),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Ph=class extends si{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ke(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.combine=y_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};var Qt=new P,ch=new Ne,en=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=VC,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=_o,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return tO("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)ch.fromBufferAttribute(this,t),ch.applyMatrix3(e),this.setXY(t,ch.x,ch.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Qt.fromBufferAttribute(this,t),Qt.applyMatrix3(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Qt.fromBufferAttribute(this,t),Qt.applyMatrix4(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Qt.fromBufferAttribute(this,t),Qt.applyNormalMatrix(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Qt.fromBufferAttribute(this,t),Qt.transformDirection(e),this.setXYZ(t,Qt.x,Qt.y,Qt.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ja(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=kn(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ja(t,this.array)),t}setX(e,t){return this.normalized&&(t=kn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ja(t,this.array)),t}setY(e,t){return this.normalized&&(t=kn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ja(t,this.array)),t}setZ(e,t){return this.normalized&&(t=kn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ja(t,this.array)),t}setW(e,t){return this.normalized&&(t=kn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=kn(t,this.array),i=kn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=kn(t,this.array),i=kn(i,this.array),r=kn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.normalized&&(t=kn(t,this.array),i=kn(i,this.array),r=kn(r,this.array),o=kn(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==VC&&(e.usage=this.usage),e}};var Lh=class extends en{constructor(e,t,i){super(new Uint16Array(e),t,i)}};var Fh=class extends en{constructor(e,t,i){super(new Uint32Array(e),t,i)}};var mn=class extends en{constructor(e,t,i){super(new Float32Array(e),t,i)}},hO=0,vi=new Ft,Mv=new Vi,Ga=new P,ri=new lr,eu=new lr,hn=new P,xi=class n extends ar{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:hO++}),this.uuid=ml(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($w(e)?Fh:Lh)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let o=new Ke().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return vi.makeRotationFromQuaternion(e),this.applyMatrix4(vi),this}rotateX(e){return vi.makeRotationX(e),this.applyMatrix4(vi),this}rotateY(e){return vi.makeRotationY(e),this.applyMatrix4(vi),this}rotateZ(e){return vi.makeRotationZ(e),this.applyMatrix4(vi),this}translate(e,t,i){return vi.makeTranslation(e,t,i),this.applyMatrix4(vi),this}scale(e,t,i){return vi.makeScale(e,t,i),this.applyMatrix4(vi),this}lookAt(e){return Mv.lookAt(e),Mv.updateMatrix(),this.applyMatrix4(Mv.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ga).negate(),this.translate(Ga.x,Ga.y,Ga.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new mn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new lr);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let o=t[i];ri.setFromBufferAttribute(o),this.morphTargetsRelative?(hn.addVectors(this.boundingBox.min,ri.min),this.boundingBox.expandByPoint(hn),hn.addVectors(this.boundingBox.max,ri.max),this.boundingBox.expandByPoint(hn)):(this.boundingBox.expandByPoint(ri.min),this.boundingBox.expandByPoint(ri.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ts);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new P,1/0);return}if(e){let i=this.boundingSphere.center;if(ri.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){let a=t[o];eu.setFromBufferAttribute(a),this.morphTargetsRelative?(hn.addVectors(ri.min,eu.min),ri.expandByPoint(hn),hn.addVectors(ri.max,eu.max),ri.expandByPoint(hn)):(ri.expandByPoint(eu.min),ri.expandByPoint(eu.max))}ri.getCenter(i);let r=0;for(let o=0,s=e.count;o<s;o++)hn.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(hn));if(t)for(let o=0,s=t.length;o<s;o++){let a=t[o],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)hn.fromBufferAttribute(a,c),l&&(Ga.fromBufferAttribute(e,c),hn.add(Ga)),r=Math.max(r,i.distanceToSquared(hn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.position,r=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new en(new Float32Array(4*i.count),4));let s=this.getAttribute("tangent"),a=[],l=[];for(let k=0;k<i.count;k++)a[k]=new P,l[k]=new P;let c=new P,u=new P,f=new P,p=new Ne,m=new Ne,v=new Ne,_=new P,y=new P;function g(k,w,S){c.fromBufferAttribute(i,k),u.fromBufferAttribute(i,w),f.fromBufferAttribute(i,S),p.fromBufferAttribute(o,k),m.fromBufferAttribute(o,w),v.fromBufferAttribute(o,S),u.sub(c),f.sub(c),m.sub(p),v.sub(p);let L=1/(m.x*v.y-v.x*m.y);isFinite(L)&&(_.copy(u).multiplyScalar(v.y).addScaledVector(f,-m.y).multiplyScalar(L),y.copy(f).multiplyScalar(m.x).addScaledVector(u,-v.x).multiplyScalar(L),a[k].add(_),a[w].add(_),a[S].add(_),l[k].add(y),l[w].add(y),l[S].add(y))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let k=0,w=T.length;k<w;++k){let S=T[k],L=S.start,z=S.count;for(let N=L,$=L+z;N<$;N+=3)g(e.getX(N+0),e.getX(N+1),e.getX(N+2))}let x=new P,M=new P,D=new P,I=new P;function A(k){D.fromBufferAttribute(r,k),I.copy(D);let w=a[k];x.copy(w),x.sub(D.multiplyScalar(D.dot(w))).normalize(),M.crossVectors(I,w);let L=M.dot(l[k])<0?-1:1;s.setXYZW(k,x.x,x.y,x.z,L)}for(let k=0,w=T.length;k<w;++k){let S=T[k],L=S.start,z=S.count;for(let N=L,$=L+z;N<$;N+=3)A(e.getX(N+0)),A(e.getX(N+1)),A(e.getX(N+2))}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new en(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let p=0,m=i.count;p<m;p++)i.setXYZ(p,0,0,0);let r=new P,o=new P,s=new P,a=new P,l=new P,c=new P,u=new P,f=new P;if(e)for(let p=0,m=e.count;p<m;p+=3){let v=e.getX(p+0),_=e.getX(p+1),y=e.getX(p+2);r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,_),s.fromBufferAttribute(t,y),u.subVectors(s,o),f.subVectors(r,o),u.cross(f),a.fromBufferAttribute(i,v),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,y),a.add(u),l.add(u),c.add(u),i.setXYZ(v,a.x,a.y,a.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(y,c.x,c.y,c.z)}else for(let p=0,m=t.count;p<m;p+=3)r.fromBufferAttribute(t,p+0),o.fromBufferAttribute(t,p+1),s.fromBufferAttribute(t,p+2),u.subVectors(s,o),f.subVectors(r,o),u.cross(f),i.setXYZ(p+0,u.x,u.y,u.z),i.setXYZ(p+1,u.x,u.y,u.z),i.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)hn.fromBufferAttribute(e,t),hn.normalize(),e.setXYZ(t,hn.x,hn.y,hn.z)}toNonIndexed(){function e(a,l){let c=a.array,u=a.itemSize,f=a.normalized,p=new c.constructor(l.length*u),m=0,v=0;for(let _=0,y=l.length;_<y;_++){a.isInterleavedBufferAttribute?m=l[_]*a.data.stride+a.offset:m=l[_]*u;for(let g=0;g<u;g++)p[v++]=c[m++]}return new en(p,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new n,i=this.index.array,r=this.attributes;for(let a in r){let l=r[a],c=e(l,i);t.setAttribute(a,c)}let o=this.morphAttributes;for(let a in o){let l=[],c=o[a];for(let u=0,f=c.length;u<f;u++){let p=c[u],m=e(p,i);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,l=s.length;a<l;a++){let c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let l in i){let c=i[l];e.data.attributes[l]=c.toJSON(e.data)}let r={},o=!1;for(let l in this.morphAttributes){let c=this.morphAttributes[l],u=[];for(let f=0,p=c.length;f<p;f++){let m=c[f];u.push(m.toJSON(e.data))}u.length>0&&(r[l]=u,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let c in r){let u=r[c];this.setAttribute(c,u.clone(t))}let o=e.morphAttributes;for(let c in o){let u=[],f=o[c];for(let p=0,m=f.length;p<m;p++)u.push(f[p].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let c=0,u=s.length;c<u;c++){let f=s[c];this.addGroup(f.start,f.count,f.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},tw=new Ft,gs=new Ms,uh=new Ts,nw=new P,Wa=new P,qa=new P,$a=new P,Cv=new P,dh=new P,fh=new Ne,hh=new Ne,ph=new Ne,iw=new P,rw=new P,ow=new P,mh=new P,gh=new P,zt=class extends Vi{constructor(e=new xi,t=new Ph){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=r.length;o<s;o++){let a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,o=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(o&&a){dh.set(0,0,0);for(let l=0,c=o.length;l<c;l++){let u=a[l],f=o[l];u!==0&&(Cv.fromBufferAttribute(f,e),s?dh.addScaledVector(Cv,u):dh.addScaledVector(Cv.sub(t),u))}t.add(dh)}return t}raycast(e,t){let i=this.geometry,r=this.material,o=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),uh.copy(i.boundingSphere),uh.applyMatrix4(o),gs.copy(e.ray).recast(e.near),!(uh.containsPoint(gs.origin)===!1&&(gs.intersectSphere(uh,nw)===null||gs.origin.distanceToSquared(nw)>(e.far-e.near)**2))&&(tw.copy(o).invert(),gs.copy(e.ray).applyMatrix4(tw),!(i.boundingBox!==null&&gs.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,gs)))}_computeIntersections(e,t,i){let r,o=this.geometry,s=this.material,a=o.index,l=o.attributes.position,c=o.attributes.uv,u=o.attributes.uv1,f=o.attributes.normal,p=o.groups,m=o.drawRange;if(a!==null)if(Array.isArray(s))for(let v=0,_=p.length;v<_;v++){let y=p[v],g=s[y.materialIndex],T=Math.max(y.start,m.start),x=Math.min(a.count,Math.min(y.start+y.count,m.start+m.count));for(let M=T,D=x;M<D;M+=3){let I=a.getX(M),A=a.getX(M+1),k=a.getX(M+2);r=yh(this,g,e,i,c,u,f,I,A,k),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=y.materialIndex,t.push(r))}}else{let v=Math.max(0,m.start),_=Math.min(a.count,m.start+m.count);for(let y=v,g=_;y<g;y+=3){let T=a.getX(y),x=a.getX(y+1),M=a.getX(y+2);r=yh(this,s,e,i,c,u,f,T,x,M),r&&(r.faceIndex=Math.floor(y/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(s))for(let v=0,_=p.length;v<_;v++){let y=p[v],g=s[y.materialIndex],T=Math.max(y.start,m.start),x=Math.min(l.count,Math.min(y.start+y.count,m.start+m.count));for(let M=T,D=x;M<D;M+=3){let I=M,A=M+1,k=M+2;r=yh(this,g,e,i,c,u,f,I,A,k),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=y.materialIndex,t.push(r))}}else{let v=Math.max(0,m.start),_=Math.min(l.count,m.start+m.count);for(let y=v,g=_;y<g;y+=3){let T=y,x=y+1,M=y+2;r=yh(this,s,e,i,c,u,f,T,x,M),r&&(r.faceIndex=Math.floor(y/3),t.push(r))}}}};function pO(n,e,t,i,r,o,s,a){let l;if(e.side===$n?l=i.intersectTriangle(s,o,r,!0,a):l=i.intersectTriangle(r,o,s,e.side===So,a),l===null)return null;gh.copy(a),gh.applyMatrix4(n.matrixWorld);let c=t.ray.origin.distanceTo(gh);return c<t.near||c>t.far?null:{distance:c,point:gh.clone(),object:n}}function yh(n,e,t,i,r,o,s,a,l,c){n.getVertexPosition(a,Wa),n.getVertexPosition(l,qa),n.getVertexPosition(c,$a);let u=pO(n,e,t,i,Wa,qa,$a,mh);if(u){r&&(fh.fromBufferAttribute(r,a),hh.fromBufferAttribute(r,l),ph.fromBufferAttribute(r,c),u.uv=Ka.getInterpolation(mh,Wa,qa,$a,fh,hh,ph,new Ne)),o&&(fh.fromBufferAttribute(o,a),hh.fromBufferAttribute(o,l),ph.fromBufferAttribute(o,c),u.uv1=Ka.getInterpolation(mh,Wa,qa,$a,fh,hh,ph,new Ne)),s&&(iw.fromBufferAttribute(s,a),rw.fromBufferAttribute(s,l),ow.fromBufferAttribute(s,c),u.normal=Ka.getInterpolation(mh,Wa,qa,$a,iw,rw,ow,new P),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));let f={a,b:l,c,normal:new P,materialIndex:0};Ka.getNormal(Wa,qa,$a,f.normal),u.face=f}return u}var du=class n extends xi{constructor(e=1,t=1,i=1,r=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:o,depthSegments:s};let a=this;r=Math.floor(r),o=Math.floor(o),s=Math.floor(s);let l=[],c=[],u=[],f=[],p=0,m=0;v("z","y","x",-1,-1,i,t,e,s,o,0),v("z","y","x",1,-1,i,t,-e,s,o,1),v("x","z","y",1,1,e,i,t,r,s,2),v("x","z","y",1,-1,e,i,-t,r,s,3),v("x","y","z",1,-1,e,t,i,r,o,4),v("x","y","z",-1,-1,e,t,-i,r,o,5),this.setIndex(l),this.setAttribute("position",new mn(c,3)),this.setAttribute("normal",new mn(u,3)),this.setAttribute("uv",new mn(f,2));function v(_,y,g,T,x,M,D,I,A,k,w){let S=M/A,L=D/k,z=M/2,N=D/2,$=I/2,Y=A+1,Q=k+1,re=0,q=0,oe=new P;for(let ie=0;ie<Q;ie++){let xe=ie*L-N;for(let rt=0;rt<Y;rt++){let Ct=rt*S-z;oe[_]=Ct*T,oe[y]=xe*x,oe[g]=$,c.push(oe.x,oe.y,oe.z),oe[_]=0,oe[y]=0,oe[g]=I>0?1:-1,u.push(oe.x,oe.y,oe.z),f.push(rt/A),f.push(1-ie/k),re+=1}}for(let ie=0;ie<k;ie++)for(let xe=0;xe<A;xe++){let rt=p+xe+Y*ie,Ct=p+xe+Y*(ie+1),X=p+(xe+1)+Y*(ie+1),ae=p+(xe+1)+Y*ie;l.push(rt,Ct,ae),l.push(Ct,X,ae),q+=6}a.addGroup(m,q,w),m+=q,p+=re}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function ul(n){let e={};for(let t in n){e[t]={};for(let i in n[t]){let r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Un(n){let e={};for(let t=0;t<n.length;t++){let i=ul(n[t]);for(let r in i)e[r]=i[r]}return e}function mO(n){let e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function Xw(n){let e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:At.workingColorSpace}var gO={clone:ul,merge:Un},yO=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,vO=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Si=class extends si{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=yO,this.fragmentShader=vO,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ul(e.uniforms),this.uniformsGroups=mO(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let s=this.uniforms[r].value;s&&s.isTexture?t.uniforms[r]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[r]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[r]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[r]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[r]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[r]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[r]={type:"m4",value:s.toArray()}:t.uniforms[r]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Oh=class extends Vi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ft,this.projectionMatrix=new Ft,this.projectionMatrixInverse=new Ft,this.coordinateSystem=Br}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},vo=new P,sw=new Ne,aw=new Ne,xn=class extends Oh{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=cu*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(ru*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return cu*2*Math.atan(Math.tan(ru*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){vo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(vo.x,vo.y).multiplyScalar(-e/vo.z),vo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(vo.x,vo.y).multiplyScalar(-e/vo.z)}getViewSize(e,t){return this.getViewBounds(e,sw,aw),t.subVectors(aw,sw)}setViewOffset(e,t,i,r,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(ru*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let l=s.fullWidth,c=s.fullHeight;o+=s.offsetX*r/l,t-=s.offsetY*i/c,r*=s.width/l,i*=s.height/c}let a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Ya=-90,Xa=1,zv=class extends Vi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;let r=new xn(Ya,Xa,e,t);r.layers=this.layers,this.add(r);let o=new xn(Ya,Xa,e,t);o.layers=this.layers,this.add(o);let s=new xn(Ya,Xa,e,t);s.layers=this.layers,this.add(s);let a=new xn(Ya,Xa,e,t);a.layers=this.layers,this.add(a);let l=new xn(Ya,Xa,e,t);l.layers=this.layers,this.add(l);let c=new xn(Ya,Xa,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[i,r,o,s,a,l]=t;for(let c of t)this.remove(c);if(e===Br)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Dh)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();let{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[o,s,a,l,c,u]=this.children,f=e.getRenderTarget(),p=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;let _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,o),e.setRenderTarget(i,1,r),e.render(t,s),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(f,p,m),e.xr.enabled=v,i.texture.needsPMREMUpdate=!0}},kh=class extends cr{constructor(e,t,i,r,o,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:rl,super(e,t,i,r,o,s,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Gv=class extends Vr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new kh(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Rn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new du(5,5,5),o=new Si({name:"CubemapFromEquirect",uniforms:ul(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:$n,blending:Eo});o.uniforms.tEquirect.value=t;let s=new zt(r,o),a=t.minFilter;return t.minFilter===_i&&(t.minFilter=Rn),new zv(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(o)}},wv=new P,_O=new P,EO=new Ke,Ui=class{constructor(e=new P(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=wv.subVectors(i,t).cross(_O.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let i=e.delta(wv),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(e.start).addScaledVector(i,o)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||EO.getNormalMatrix(e),r=this.coplanarPoint(wv).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},ys=new Ts,vh=new P,fu=class{constructor(e=new Ui,t=new Ui,i=new Ui,r=new Ui,o=new Ui,s=new Ui){this.planes=[e,t,i,r,o,s]}set(e,t,i,r,o,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(o),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Br){let i=this.planes,r=e.elements,o=r[0],s=r[1],a=r[2],l=r[3],c=r[4],u=r[5],f=r[6],p=r[7],m=r[8],v=r[9],_=r[10],y=r[11],g=r[12],T=r[13],x=r[14],M=r[15];if(i[0].setComponents(l-o,p-c,y-m,M-g).normalize(),i[1].setComponents(l+o,p+c,y+m,M+g).normalize(),i[2].setComponents(l+s,p+u,y+v,M+T).normalize(),i[3].setComponents(l-s,p-u,y-v,M-T).normalize(),i[4].setComponents(l-a,p-f,y-_,M-x).normalize(),t===Br)i[5].setComponents(l+a,p+f,y+_,M+x).normalize();else if(t===Dh)i[5].setComponents(a,f,_,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),ys.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),ys.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(ys)}intersectsSprite(e){return ys.center.set(0,0,0),ys.radius=.7071067811865476,ys.applyMatrix4(e.matrixWorld),this.intersectsSphere(ys)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(vh.x=r.normal.x>0?e.max.x:e.min.x,vh.y=r.normal.y>0?e.max.y:e.min.y,vh.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(vh)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Jw(){let n=null,e=!1,t=null,i=null;function r(o,s){t(o,s),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function xO(n){let e=new WeakMap;function t(a,l){let c=a.array,u=a.usage,f=c.byteLength,p=n.createBuffer();n.bindBuffer(l,p),n.bufferData(l,c,u),a.onUploadCallback();let m;if(c instanceof Float32Array)m=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=n.SHORT;else if(c instanceof Uint32Array)m=n.UNSIGNED_INT;else if(c instanceof Int32Array)m=n.INT;else if(c instanceof Int8Array)m=n.BYTE;else if(c instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:f}}function i(a,l,c){let u=l.array,f=l._updateRange,p=l.updateRanges;if(n.bindBuffer(c,a),f.count===-1&&p.length===0&&n.bufferSubData(c,0,u),p.length!==0){for(let m=0,v=p.length;m<v;m++){let _=p[m];n.bufferSubData(c,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}l.clearUpdateRanges()}f.count!==-1&&(n.bufferSubData(c,f.offset*u.BYTES_PER_ELEMENT,u,f.offset,f.count),f.count=-1),l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function o(a){a.isInterleavedBufferAttribute&&(a=a.data);let l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function s(a,l){if(a.isGLBufferAttribute){let u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);let c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:o,update:s}}var Co=class n extends xi{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let o=e/2,s=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,f=e/a,p=t/l,m=[],v=[],_=[],y=[];for(let g=0;g<u;g++){let T=g*p-s;for(let x=0;x<c;x++){let M=x*f-o;v.push(M,-T,0),_.push(0,0,1),y.push(x/a),y.push(1-g/l)}}for(let g=0;g<l;g++)for(let T=0;T<a;T++){let x=T+c*g,M=T+c*(g+1),D=T+1+c*(g+1),I=T+1+c*g;m.push(x,M,I),m.push(M,D,I)}this.setIndex(m),this.setAttribute("position",new mn(v,3)),this.setAttribute("normal",new mn(_,3)),this.setAttribute("uv",new mn(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}},SO=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TO=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,MO=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,CO=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wO=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,bO=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,IO=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,AO=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DO=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,RO=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,NO=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,PO=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,LO=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,FO=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,OO=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,kO=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,UO=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,BO=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,VO=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,HO=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,zO=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,GO=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,WO=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,qO=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,$O=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,YO=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,XO=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,JO=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,jO=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZO=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,KO="gl_FragColor = linearToOutputTexel( gl_FragColor );",QO=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,ek=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,nk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ik=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,rk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ok=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,sk=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,ak=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,lk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ck=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,uk=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,dk=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,fk=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,hk=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,pk=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,mk=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gk=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,yk=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,vk=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,_k=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Ek=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,xk=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Sk=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Tk=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Mk=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Ck=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wk=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,bk=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Ik=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Ak=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Dk=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Rk=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Nk=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Pk=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Lk=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Fk=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Ok=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,kk=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Uk=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Bk=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Vk=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Hk=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,zk=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Gk=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Wk=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,qk=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,$k=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Yk=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Xk=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Jk=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,jk=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Zk=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Kk=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Qk=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,eU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,tU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,nU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,iU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,rU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,oU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,sU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,aU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,lU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,cU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,uU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,fU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,hU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,mU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,gU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,yU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,vU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,_U=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,EU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,xU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,SU=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MU=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,wU=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,IU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,AU=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,DU=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,RU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,NU=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PU=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,LU=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,FU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,OU=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kU=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,UU=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BU=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,VU=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HU=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,zU=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,GU=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WU=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qU=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,$U=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YU=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XU=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JU=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,jU=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ZU=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KU=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,QU=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,e2=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ze={alphahash_fragment:SO,alphahash_pars_fragment:TO,alphamap_fragment:MO,alphamap_pars_fragment:CO,alphatest_fragment:wO,alphatest_pars_fragment:bO,aomap_fragment:IO,aomap_pars_fragment:AO,batching_pars_vertex:DO,batching_vertex:RO,begin_vertex:NO,beginnormal_vertex:PO,bsdfs:LO,iridescence_fragment:FO,bumpmap_pars_fragment:OO,clipping_planes_fragment:kO,clipping_planes_pars_fragment:UO,clipping_planes_pars_vertex:BO,clipping_planes_vertex:VO,color_fragment:HO,color_pars_fragment:zO,color_pars_vertex:GO,color_vertex:WO,common:qO,cube_uv_reflection_fragment:$O,defaultnormal_vertex:YO,displacementmap_pars_vertex:XO,displacementmap_vertex:JO,emissivemap_fragment:jO,emissivemap_pars_fragment:ZO,colorspace_fragment:KO,colorspace_pars_fragment:QO,envmap_fragment:ek,envmap_common_pars_fragment:tk,envmap_pars_fragment:nk,envmap_pars_vertex:ik,envmap_physical_pars_fragment:pk,envmap_vertex:rk,fog_vertex:ok,fog_pars_vertex:sk,fog_fragment:ak,fog_pars_fragment:lk,gradientmap_pars_fragment:ck,lightmap_pars_fragment:uk,lights_lambert_fragment:dk,lights_lambert_pars_fragment:fk,lights_pars_begin:hk,lights_toon_fragment:mk,lights_toon_pars_fragment:gk,lights_phong_fragment:yk,lights_phong_pars_fragment:vk,lights_physical_fragment:_k,lights_physical_pars_fragment:Ek,lights_fragment_begin:xk,lights_fragment_maps:Sk,lights_fragment_end:Tk,logdepthbuf_fragment:Mk,logdepthbuf_pars_fragment:Ck,logdepthbuf_pars_vertex:wk,logdepthbuf_vertex:bk,map_fragment:Ik,map_pars_fragment:Ak,map_particle_fragment:Dk,map_particle_pars_fragment:Rk,metalnessmap_fragment:Nk,metalnessmap_pars_fragment:Pk,morphinstance_vertex:Lk,morphcolor_vertex:Fk,morphnormal_vertex:Ok,morphtarget_pars_vertex:kk,morphtarget_vertex:Uk,normal_fragment_begin:Bk,normal_fragment_maps:Vk,normal_pars_fragment:Hk,normal_pars_vertex:zk,normal_vertex:Gk,normalmap_pars_fragment:Wk,clearcoat_normal_fragment_begin:qk,clearcoat_normal_fragment_maps:$k,clearcoat_pars_fragment:Yk,iridescence_pars_fragment:Xk,opaque_fragment:Jk,packing:jk,premultiplied_alpha_fragment:Zk,project_vertex:Kk,dithering_fragment:Qk,dithering_pars_fragment:eU,roughnessmap_fragment:tU,roughnessmap_pars_fragment:nU,shadowmap_pars_fragment:iU,shadowmap_pars_vertex:rU,shadowmap_vertex:oU,shadowmask_pars_fragment:sU,skinbase_vertex:aU,skinning_pars_vertex:lU,skinning_vertex:cU,skinnormal_vertex:uU,specularmap_fragment:dU,specularmap_pars_fragment:fU,tonemapping_fragment:hU,tonemapping_pars_fragment:pU,transmission_fragment:mU,transmission_pars_fragment:gU,uv_pars_fragment:yU,uv_pars_vertex:vU,uv_vertex:_U,worldpos_vertex:EU,background_vert:xU,background_frag:SU,backgroundCube_vert:TU,backgroundCube_frag:MU,cube_vert:CU,cube_frag:wU,depth_vert:bU,depth_frag:IU,distanceRGBA_vert:AU,distanceRGBA_frag:DU,equirect_vert:RU,equirect_frag:NU,linedashed_vert:PU,linedashed_frag:LU,meshbasic_vert:FU,meshbasic_frag:OU,meshlambert_vert:kU,meshlambert_frag:UU,meshmatcap_vert:BU,meshmatcap_frag:VU,meshnormal_vert:HU,meshnormal_frag:zU,meshphong_vert:GU,meshphong_frag:WU,meshphysical_vert:qU,meshphysical_frag:$U,meshtoon_vert:YU,meshtoon_frag:XU,points_vert:JU,points_frag:jU,shadow_vert:ZU,shadow_frag:KU,sprite_vert:QU,sprite_frag:e2},he={common:{diffuse:{value:new ke(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ke},alphaMap:{value:null},alphaMapTransform:{value:new Ke},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ke}},envmap:{envMap:{value:null},envMapRotation:{value:new Ke},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ke}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ke}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ke},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ke},normalScale:{value:new Ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ke},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ke}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ke}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ke}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ke(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ke(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ke},alphaTest:{value:0},uvTransform:{value:new Ke}},sprite:{diffuse:{value:new ke(16777215)},opacity:{value:1},center:{value:new Ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ke},alphaMap:{value:null},alphaMapTransform:{value:new Ke},alphaTest:{value:0}}},ir={basic:{uniforms:Un([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.fog]),vertexShader:Ze.meshbasic_vert,fragmentShader:Ze.meshbasic_frag},lambert:{uniforms:Un([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.fog,he.lights,{emissive:{value:new ke(0)}}]),vertexShader:Ze.meshlambert_vert,fragmentShader:Ze.meshlambert_frag},phong:{uniforms:Un([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.fog,he.lights,{emissive:{value:new ke(0)},specular:{value:new ke(1118481)},shininess:{value:30}}]),vertexShader:Ze.meshphong_vert,fragmentShader:Ze.meshphong_frag},standard:{uniforms:Un([he.common,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.roughnessmap,he.metalnessmap,he.fog,he.lights,{emissive:{value:new ke(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ze.meshphysical_vert,fragmentShader:Ze.meshphysical_frag},toon:{uniforms:Un([he.common,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.gradientmap,he.fog,he.lights,{emissive:{value:new ke(0)}}]),vertexShader:Ze.meshtoon_vert,fragmentShader:Ze.meshtoon_frag},matcap:{uniforms:Un([he.common,he.bumpmap,he.normalmap,he.displacementmap,he.fog,{matcap:{value:null}}]),vertexShader:Ze.meshmatcap_vert,fragmentShader:Ze.meshmatcap_frag},points:{uniforms:Un([he.points,he.fog]),vertexShader:Ze.points_vert,fragmentShader:Ze.points_frag},dashed:{uniforms:Un([he.common,he.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ze.linedashed_vert,fragmentShader:Ze.linedashed_frag},depth:{uniforms:Un([he.common,he.displacementmap]),vertexShader:Ze.depth_vert,fragmentShader:Ze.depth_frag},normal:{uniforms:Un([he.common,he.bumpmap,he.normalmap,he.displacementmap,{opacity:{value:1}}]),vertexShader:Ze.meshnormal_vert,fragmentShader:Ze.meshnormal_frag},sprite:{uniforms:Un([he.sprite,he.fog]),vertexShader:Ze.sprite_vert,fragmentShader:Ze.sprite_frag},background:{uniforms:{uvTransform:{value:new Ke},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ze.background_vert,fragmentShader:Ze.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ke}},vertexShader:Ze.backgroundCube_vert,fragmentShader:Ze.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ze.cube_vert,fragmentShader:Ze.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ze.equirect_vert,fragmentShader:Ze.equirect_frag},distanceRGBA:{uniforms:Un([he.common,he.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ze.distanceRGBA_vert,fragmentShader:Ze.distanceRGBA_frag},shadow:{uniforms:Un([he.lights,he.fog,{color:{value:new ke(0)},opacity:{value:1}}]),vertexShader:Ze.shadow_vert,fragmentShader:Ze.shadow_frag}};ir.physical={uniforms:Un([ir.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ke},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ke},clearcoatNormalScale:{value:new Ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ke},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ke},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ke},sheen:{value:0},sheenColor:{value:new ke(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ke},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ke},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ke},transmissionSamplerSize:{value:new Ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ke},attenuationDistance:{value:0},attenuationColor:{value:new ke(0)},specularColor:{value:new ke(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ke},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ke},anisotropyVector:{value:new Ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ke}}]),vertexShader:Ze.meshphysical_vert,fragmentShader:Ze.meshphysical_frag};var _h={r:0,b:0,g:0},vs=new Mo,t2=new Ft;function n2(n,e,t,i,r,o,s){let a=new ke(0),l=o===!0?0:1,c,u,f=null,p=0,m=null;function v(T){let x=T.isScene===!0?T.background:null;return x&&x.isTexture&&(x=(T.backgroundBlurriness>0?t:e).get(x)),x}function _(T){let x=!1,M=v(T);M===null?g(a,l):M&&M.isColor&&(g(M,1),x=!0);let D=n.xr.getEnvironmentBlendMode();D==="additive"?i.buffers.color.setClear(0,0,0,1,s):D==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,s),(n.autoClear||x)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil)}function y(T,x){let M=v(x);M&&(M.isCubeTexture||M.mapping===Kh)?(u===void 0&&(u=new zt(new du(1,1,1),new Si({name:"BackgroundCubeMaterial",uniforms:ul(ir.backgroundCube.uniforms),vertexShader:ir.backgroundCube.vertexShader,fragmentShader:ir.backgroundCube.fragmentShader,side:$n,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(D,I,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),vs.copy(x.backgroundRotation),vs.x*=-1,vs.y*=-1,vs.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(vs.y*=-1,vs.z*=-1),u.material.uniforms.envMap.value=M,u.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(t2.makeRotationFromEuler(vs)),u.material.toneMapped=At.getTransfer(M.colorSpace)!==Lt,(f!==M||p!==M.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,f=M,p=M.version,m=n.toneMapping),u.layers.enableAll(),T.unshift(u,u.geometry,u.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new zt(new Co(2,2),new Si({name:"BackgroundMaterial",uniforms:ul(ir.background.uniforms),vertexShader:ir.background.vertexShader,fragmentShader:ir.background.fragmentShader,side:So,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=At.getTransfer(M.colorSpace)!==Lt,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(f!==M||p!==M.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,f=M,p=M.version,m=n.toneMapping),c.layers.enableAll(),T.unshift(c,c.geometry,c.material,0,0,null))}function g(T,x){T.getRGB(_h,Xw(n)),i.buffers.color.setClear(_h.r,_h.g,_h.b,x,s)}return{getClearColor:function(){return a},setClearColor:function(T,x=1){a.set(T),l=x,g(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(T){l=T,g(a,l)},render:_,addToRenderList:y}}function i2(n,e){let t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=p(null),o=r,s=!1;function a(S,L,z,N,$){let Y=!1,Q=f(N,z,L);o!==Q&&(o=Q,c(o.object)),Y=m(S,N,z,$),Y&&v(S,N,z,$),$!==null&&e.update($,n.ELEMENT_ARRAY_BUFFER),(Y||s)&&(s=!1,M(S,L,z,N),$!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get($).buffer))}function l(){return n.createVertexArray()}function c(S){return n.bindVertexArray(S)}function u(S){return n.deleteVertexArray(S)}function f(S,L,z){let N=z.wireframe===!0,$=i[S.id];$===void 0&&($={},i[S.id]=$);let Y=$[L.id];Y===void 0&&(Y={},$[L.id]=Y);let Q=Y[N];return Q===void 0&&(Q=p(l()),Y[N]=Q),Q}function p(S){let L=[],z=[],N=[];for(let $=0;$<t;$++)L[$]=0,z[$]=0,N[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:z,attributeDivisors:N,object:S,attributes:{},index:null}}function m(S,L,z,N){let $=o.attributes,Y=L.attributes,Q=0,re=z.getAttributes();for(let q in re)if(re[q].location>=0){let ie=$[q],xe=Y[q];if(xe===void 0&&(q==="instanceMatrix"&&S.instanceMatrix&&(xe=S.instanceMatrix),q==="instanceColor"&&S.instanceColor&&(xe=S.instanceColor)),ie===void 0||ie.attribute!==xe||xe&&ie.data!==xe.data)return!0;Q++}return o.attributesNum!==Q||o.index!==N}function v(S,L,z,N){let $={},Y=L.attributes,Q=0,re=z.getAttributes();for(let q in re)if(re[q].location>=0){let ie=Y[q];ie===void 0&&(q==="instanceMatrix"&&S.instanceMatrix&&(ie=S.instanceMatrix),q==="instanceColor"&&S.instanceColor&&(ie=S.instanceColor));let xe={};xe.attribute=ie,ie&&ie.data&&(xe.data=ie.data),$[q]=xe,Q++}o.attributes=$,o.attributesNum=Q,o.index=N}function _(){let S=o.newAttributes;for(let L=0,z=S.length;L<z;L++)S[L]=0}function y(S){g(S,0)}function g(S,L){let z=o.newAttributes,N=o.enabledAttributes,$=o.attributeDivisors;z[S]=1,N[S]===0&&(n.enableVertexAttribArray(S),N[S]=1),$[S]!==L&&(n.vertexAttribDivisor(S,L),$[S]=L)}function T(){let S=o.newAttributes,L=o.enabledAttributes;for(let z=0,N=L.length;z<N;z++)L[z]!==S[z]&&(n.disableVertexAttribArray(z),L[z]=0)}function x(S,L,z,N,$,Y,Q){Q===!0?n.vertexAttribIPointer(S,L,z,$,Y):n.vertexAttribPointer(S,L,z,N,$,Y)}function M(S,L,z,N){_();let $=N.attributes,Y=z.getAttributes(),Q=L.defaultAttributeValues;for(let re in Y){let q=Y[re];if(q.location>=0){let oe=$[re];if(oe===void 0&&(re==="instanceMatrix"&&S.instanceMatrix&&(oe=S.instanceMatrix),re==="instanceColor"&&S.instanceColor&&(oe=S.instanceColor)),oe!==void 0){let ie=oe.normalized,xe=oe.itemSize,rt=e.get(oe);if(rt===void 0)continue;let Ct=rt.buffer,X=rt.type,ae=rt.bytesPerElement,_e=X===n.INT||X===n.UNSIGNED_INT||oe.gpuType===Bw;if(oe.isInterleavedBufferAttribute){let fe=oe.data,ot=fe.stride,Qe=oe.offset;if(fe.isInstancedInterleavedBuffer){for(let U=0;U<q.locationSize;U++)g(q.location+U,fe.meshPerAttribute);S.isInstancedMesh!==!0&&N._maxInstanceCount===void 0&&(N._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let U=0;U<q.locationSize;U++)y(q.location+U);n.bindBuffer(n.ARRAY_BUFFER,Ct);for(let U=0;U<q.locationSize;U++)x(q.location+U,xe/q.locationSize,X,ie,ot*ae,(Qe+xe/q.locationSize*U)*ae,_e)}else{if(oe.isInstancedBufferAttribute){for(let fe=0;fe<q.locationSize;fe++)g(q.location+fe,oe.meshPerAttribute);S.isInstancedMesh!==!0&&N._maxInstanceCount===void 0&&(N._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let fe=0;fe<q.locationSize;fe++)y(q.location+fe);n.bindBuffer(n.ARRAY_BUFFER,Ct);for(let fe=0;fe<q.locationSize;fe++)x(q.location+fe,xe/q.locationSize,X,ie,xe*ae,xe/q.locationSize*fe*ae,_e)}}else if(Q!==void 0){let ie=Q[re];if(ie!==void 0)switch(ie.length){case 2:n.vertexAttrib2fv(q.location,ie);break;case 3:n.vertexAttrib3fv(q.location,ie);break;case 4:n.vertexAttrib4fv(q.location,ie);break;default:n.vertexAttrib1fv(q.location,ie)}}}}T()}function D(){k();for(let S in i){let L=i[S];for(let z in L){let N=L[z];for(let $ in N)u(N[$].object),delete N[$];delete L[z]}delete i[S]}}function I(S){if(i[S.id]===void 0)return;let L=i[S.id];for(let z in L){let N=L[z];for(let $ in N)u(N[$].object),delete N[$];delete L[z]}delete i[S.id]}function A(S){for(let L in i){let z=i[L];if(z[S.id]===void 0)continue;let N=z[S.id];for(let $ in N)u(N[$].object),delete N[$];delete z[S.id]}}function k(){w(),s=!0,o!==r&&(o=r,c(o.object))}function w(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:k,resetDefaultState:w,dispose:D,releaseStatesOfGeometry:I,releaseStatesOfProgram:A,initAttributes:_,enableAttribute:y,disableUnusedAttributes:T}}function r2(n,e,t){let i;function r(c){i=c}function o(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function s(c,u,f){f!==0&&(n.drawArraysInstanced(i,c,u,f),t.update(u,i,f))}function a(c,u,f){if(f===0)return;let p=e.get("WEBGL_multi_draw");if(p===null)for(let m=0;m<f;m++)this.render(c[m],u[m]);else{p.multiDrawArraysWEBGL(i,c,0,u,0,f);let m=0;for(let v=0;v<f;v++)m+=u[v];t.update(m,i,1)}}function l(c,u,f,p){if(f===0)return;let m=e.get("WEBGL_multi_draw");if(m===null)for(let v=0;v<c.length;v++)s(c[v],u[v],p[v]);else{m.multiDrawArraysInstancedWEBGL(i,c,0,u,0,p,0,f);let v=0;for(let _=0;_<f;_++)v+=u[_];for(let _=0;_<p.length;_++)t.update(v,i,p[_])}}this.setMode=r,this.render=o,this.renderInstances=s,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function o2(n,e,t,i){let r;function o(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let I=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(I){return!(I!==Ei&&i.convert(I)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(I){let A=I===Qh&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(I!==To&&i.convert(I)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&I!==_o&&!A)}function l(I){if(I==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return I==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp",u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);let f=t.logarithmicDepthBuffer===!0,p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=n.getParameter(n.MAX_TEXTURE_SIZE),_=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),T=n.getParameter(n.MAX_VARYING_VECTORS),x=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),M=m>0,D=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:f,maxTextures:p,maxVertexTextures:m,maxTextureSize:v,maxCubemapSize:_,maxAttributes:y,maxVertexUniforms:g,maxVaryings:T,maxFragmentUniforms:x,vertexTextures:M,maxSamples:D}}function s2(n){let e=this,t=null,i=0,r=!1,o=!1,s=new Ui,a=new Ke,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p){let m=f.length!==0||p||i!==0||r;return r=p,i=f.length,m},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(f,p){t=u(f,p,0)},this.setState=function(f,p,m){let v=f.clippingPlanes,_=f.clipIntersection,y=f.clipShadows,g=n.get(f);if(!r||v===null||v.length===0||o&&!y)o?u(null):c();else{let T=o?0:i,x=T*4,M=g.clippingState||null;l.value=M,M=u(v,p,x,m);for(let D=0;D!==x;++D)M[D]=t[D];g.clippingState=M,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=T}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(f,p,m,v){let _=f!==null?f.length:0,y=null;if(_!==0){if(y=l.value,v!==!0||y===null){let g=m+_*4,T=p.matrixWorldInverse;a.getNormalMatrix(T),(y===null||y.length<g)&&(y=new Float32Array(g));for(let x=0,M=m;x!==_;++x,M+=4)s.copy(f[x]).applyMatrix4(T,a),s.normal.toArray(y,M),y[M+3]=s.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,y}}function a2(n){let e=new WeakMap;function t(s,a){return a===kv?s.mapping=rl:a===Uv&&(s.mapping=ol),s}function i(s){if(s&&s.isTexture){let a=s.mapping;if(a===kv||a===Uv)if(e.has(s)){let l=e.get(s).texture;return t(l,s.mapping)}else{let l=s.image;if(l&&l.height>0){let c=new Gv(l.height);return c.fromEquirectangularTexture(n,s),e.set(s,c),s.addEventListener("dispose",r),t(c.texture,s.mapping)}else return null}}return s}function r(s){let a=s.target;a.removeEventListener("dispose",r);let l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}var Uh=class extends Oh{constructor(e=-1,t=1,i=1,r=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=i-e,s=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){let c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Qa=4,lw=[.125,.215,.35,.446,.526,.582],Ss=20,bv=new Uh,cw=new ke,Iv=null,Av=0,Dv=0,Rv=!1,Es=(1+Math.sqrt(5))/2,Ja=1/Es,uw=[new P(-Es,Ja,0),new P(Es,Ja,0),new P(-Ja,0,Es),new P(Ja,0,Es),new P(0,Es,-Ja),new P(0,Es,Ja),new P(-1,1,-1),new P(1,1,-1),new P(-1,1,1),new P(1,1,1)],Bh=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Iv=this._renderer.getRenderTarget(),Av=this._renderer.getActiveCubeFace(),Dv=this._renderer.getActiveMipmapLevel(),Rv=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);let o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=hw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=fw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Iv,Av,Dv),this._renderer.xr.enabled=Rv,e.scissorTest=!1,Eh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===rl||e.mapping===ol?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Iv=this._renderer.getRenderTarget(),Av=this._renderer.getActiveCubeFace(),Dv=this._renderer.getActiveMipmapLevel(),Rv=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Rn,minFilter:Rn,generateMipmaps:!1,type:Qh,format:Ei,colorSpace:bo,depthBuffer:!1},r=dw(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=dw(e,t,i);let{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=l2(o)),this._blurMaterial=c2(o,e,t)}return r}_compileMaterial(e){let t=new zt(this._lodPlanes[0],e);this._renderer.compile(t,bv)}_sceneToCubeUV(e,t,i,r){let a=new xn(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,f=u.autoClear,p=u.toneMapping;u.getClearColor(cw),u.toneMapping=xo,u.autoClear=!1;let m=new Ph({name:"PMREM.Background",side:$n,depthWrite:!1,depthTest:!1}),v=new zt(new du,m),_=!1,y=e.background;y?y.isColor&&(m.color.copy(y),e.background=null,_=!0):(m.color.copy(cw),_=!0);for(let g=0;g<6;g++){let T=g%3;T===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):T===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));let x=this._cubeSize;Eh(r,T*x,g>2?x:0,x,x),u.setRenderTarget(r),_&&u.render(v,a),u.render(e,a)}v.geometry.dispose(),v.material.dispose(),u.toneMapping=p,u.autoClear=f,e.background=y}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===rl||e.mapping===ol;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=hw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=fw());let o=r?this._cubemapMaterial:this._equirectMaterial,s=new zt(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;let l=this._cubeSize;Eh(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(s,bv)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;let r=this._lodPlanes.length;for(let o=1;o<r;o++){let s=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),a=uw[(r-o-1)%uw.length];this._blur(e,o-1,o,s,a)}t.autoClear=i}_blur(e,t,i,r,o){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",o),this._halfBlur(s,e,i,i,r,"longitudinal",o)}_halfBlur(e,t,i,r,o,s,a){let l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,f=new zt(this._lodPlanes[r],c),p=c.uniforms,m=this._sizeLods[i]-1,v=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Ss-1),_=o/v,y=isFinite(o)?1+Math.floor(u*_):Ss;y>Ss&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Ss}`);let g=[],T=0;for(let A=0;A<Ss;++A){let k=A/_,w=Math.exp(-k*k/2);g.push(w),A===0?T+=w:A<y&&(T+=2*w)}for(let A=0;A<g.length;A++)g[A]=g[A]/T;p.envMap.value=e.texture,p.samples.value=y,p.weights.value=g,p.latitudinal.value=s==="latitudinal",a&&(p.poleAxis.value=a);let{_lodMax:x}=this;p.dTheta.value=v,p.mipInt.value=x-i;let M=this._sizeLods[r],D=3*M*(r>x-Qa?r-x+Qa:0),I=4*(this._cubeSize-M);Eh(t,D,I,3*M,2*M),l.setRenderTarget(t),l.render(f,bv)}};function l2(n){let e=[],t=[],i=[],r=n,o=n-Qa+1+lw.length;for(let s=0;s<o;s++){let a=Math.pow(2,r);t.push(a);let l=1/a;s>n-Qa?l=lw[s-n+Qa-1]:s===0&&(l=0),i.push(l);let c=1/(a-2),u=-c,f=1+c,p=[u,u,f,u,f,f,u,u,f,f,u,f],m=6,v=6,_=3,y=2,g=1,T=new Float32Array(_*v*m),x=new Float32Array(y*v*m),M=new Float32Array(g*v*m);for(let I=0;I<m;I++){let A=I%3*2/3-1,k=I>2?0:-1,w=[A,k,0,A+2/3,k,0,A+2/3,k+1,0,A,k,0,A+2/3,k+1,0,A,k+1,0];T.set(w,_*v*I),x.set(p,y*v*I);let S=[I,I,I,I,I,I];M.set(S,g*v*I)}let D=new xi;D.setAttribute("position",new en(T,_)),D.setAttribute("uv",new en(x,y)),D.setAttribute("faceIndex",new en(M,g)),e.push(D),r>Qa&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function dw(n,e,t){let i=new Vr(n,e,t);return i.texture.mapping=Kh,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Eh(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function c2(n,e,t){let i=new Float32Array(Ss),r=new P(0,1,0);return new Si({name:"SphericalGaussianBlur",defines:{n:Ss,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:S_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Eo,depthTest:!1,depthWrite:!1})}function fw(){return new Si({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:S_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Eo,depthTest:!1,depthWrite:!1})}function hw(){return new Si({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:S_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Eo,depthTest:!1,depthWrite:!1})}function S_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function u2(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){let l=a.mapping,c=l===kv||l===Uv,u=l===rl||l===ol;if(c||u){let f=e.get(a),p=f!==void 0?f.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==p)return t===null&&(t=new Bh(n)),f=c?t.fromEquirectangular(a,f):t.fromCubemap(a,f),f.texture.pmremVersion=a.pmremVersion,e.set(a,f),f.texture;if(f!==void 0)return f.texture;{let m=a.image;return c&&m&&m.height>0||u&&m&&r(m)?(t===null&&(t=new Bh(n)),f=c?t.fromEquirectangular(a):t.fromCubemap(a),f.texture.pmremVersion=a.pmremVersion,e.set(a,f),a.addEventListener("dispose",o),f.texture):null}}}return a}function r(a){let l=0,c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function o(a){let l=a.target;l.removeEventListener("dispose",o);let c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:s}}function d2(n){let e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){let r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function f2(n,e,t,i){let r={},o=new WeakMap;function s(f){let p=f.target;p.index!==null&&e.remove(p.index);for(let v in p.attributes)e.remove(p.attributes[v]);for(let v in p.morphAttributes){let _=p.morphAttributes[v];for(let y=0,g=_.length;y<g;y++)e.remove(_[y])}p.removeEventListener("dispose",s),delete r[p.id];let m=o.get(p);m&&(e.remove(m),o.delete(p)),i.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function a(f,p){return r[p.id]===!0||(p.addEventListener("dispose",s),r[p.id]=!0,t.memory.geometries++),p}function l(f){let p=f.attributes;for(let v in p)e.update(p[v],n.ARRAY_BUFFER);let m=f.morphAttributes;for(let v in m){let _=m[v];for(let y=0,g=_.length;y<g;y++)e.update(_[y],n.ARRAY_BUFFER)}}function c(f){let p=[],m=f.index,v=f.attributes.position,_=0;if(m!==null){let T=m.array;_=m.version;for(let x=0,M=T.length;x<M;x+=3){let D=T[x+0],I=T[x+1],A=T[x+2];p.push(D,I,I,A,A,D)}}else if(v!==void 0){let T=v.array;_=v.version;for(let x=0,M=T.length/3-1;x<M;x+=3){let D=x+0,I=x+1,A=x+2;p.push(D,I,I,A,A,D)}}else return;let y=new($w(p)?Fh:Lh)(p,1);y.version=_;let g=o.get(f);g&&e.remove(g),o.set(f,y)}function u(f){let p=o.get(f);if(p){let m=f.index;m!==null&&p.version<m.version&&c(f)}else c(f);return o.get(f)}return{get:a,update:l,getWireframeAttribute:u}}function h2(n,e,t){let i;function r(p){i=p}let o,s;function a(p){o=p.type,s=p.bytesPerElement}function l(p,m){n.drawElements(i,m,o,p*s),t.update(m,i,1)}function c(p,m,v){v!==0&&(n.drawElementsInstanced(i,m,o,p*s,v),t.update(m,i,v))}function u(p,m,v){if(v===0)return;let _=e.get("WEBGL_multi_draw");if(_===null)for(let y=0;y<v;y++)this.render(p[y]/s,m[y]);else{_.multiDrawElementsWEBGL(i,m,0,o,p,0,v);let y=0;for(let g=0;g<v;g++)y+=m[g];t.update(y,i,1)}}function f(p,m,v,_){if(v===0)return;let y=e.get("WEBGL_multi_draw");if(y===null)for(let g=0;g<p.length;g++)c(p[g]/s,m[g],_[g]);else{y.multiDrawElementsInstancedWEBGL(i,m,0,o,p,0,_,0,v);let g=0;for(let T=0;T<v;T++)g+=m[T];for(let T=0;T<_.length;T++)t.update(g,i,_[T])}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=f}function p2(n){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,s,a){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function m2(n,e,t){let i=new WeakMap,r=new pn;function o(s,a,l){let c=s.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,f=u!==void 0?u.length:0,p=i.get(a);if(p===void 0||p.count!==f){let w=function(){A.dispose(),i.delete(a),a.removeEventListener("dispose",w)};p!==void 0&&p.texture.dispose();let m=a.morphAttributes.position!==void 0,v=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,y=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],T=a.morphAttributes.color||[],x=0;m===!0&&(x=1),v===!0&&(x=2),_===!0&&(x=3);let M=a.attributes.position.count*x,D=1;M>e.maxTextureSize&&(D=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);let I=new Float32Array(M*D*4*f),A=new Rh(I,M,D,f);A.type=_o,A.needsUpdate=!0;let k=x*4;for(let S=0;S<f;S++){let L=y[S],z=g[S],N=T[S],$=M*D*4*S;for(let Y=0;Y<L.count;Y++){let Q=Y*k;m===!0&&(r.fromBufferAttribute(L,Y),I[$+Q+0]=r.x,I[$+Q+1]=r.y,I[$+Q+2]=r.z,I[$+Q+3]=0),v===!0&&(r.fromBufferAttribute(z,Y),I[$+Q+4]=r.x,I[$+Q+5]=r.y,I[$+Q+6]=r.z,I[$+Q+7]=0),_===!0&&(r.fromBufferAttribute(N,Y),I[$+Q+8]=r.x,I[$+Q+9]=r.y,I[$+Q+10]=r.z,I[$+Q+11]=N.itemSize===4?r.w:1)}}p={count:f,texture:A,size:new Ne(M,D)},i.set(a,p),a.addEventListener("dispose",w)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",s.morphTexture,t);else{let m=0;for(let _=0;_<c.length;_++)m+=c[_];let v=a.morphTargetsRelative?1:1-m;l.getUniforms().setValue(n,"morphTargetBaseInfluence",v),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",p.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",p.size)}return{update:o}}function g2(n,e,t,i){let r=new WeakMap;function o(l){let c=i.render.frame,u=l.geometry,f=e.get(l,u);if(r.get(f)!==c&&(e.update(f),r.set(f,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){let p=l.skeleton;r.get(p)!==c&&(p.update(),r.set(p,c))}return f}function s(){r=new WeakMap}function a(l){let c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:o,dispose:s}}var Vh=class extends cr{constructor(e,t,i,r,o,s,a,l,c,u){if(u=u!==void 0?u:tl,u!==tl&&u!==lu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===tl&&(i=sl),i===void 0&&u===lu&&(i=gu),super(null,r,o,s,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:qn,this.minFilter=l!==void 0?l:qn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}},jw=new cr,Zw=new Vh(1,1);Zw.compareFunction=qw;var Kw=new Rh,Qw=new Hv,eb=new kh,pw=[],mw=[],gw=new Float32Array(16),yw=new Float32Array(9),vw=new Float32Array(4);function yl(n,e,t){let i=n[0];if(i<=0||i>0)return n;let r=e*t,o=pw[r];if(o===void 0&&(o=new Float32Array(r),pw[r]=o),e!==0){i.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,n[s].toArray(o,a)}return o}function on(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function sn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function tp(n,e){let t=mw[e];t===void 0&&(t=new Int32Array(e),mw[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function y2(n,e){let t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function v2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(on(t,e))return;n.uniform2fv(this.addr,e),sn(t,e)}}function _2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(on(t,e))return;n.uniform3fv(this.addr,e),sn(t,e)}}function E2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(on(t,e))return;n.uniform4fv(this.addr,e),sn(t,e)}}function x2(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(on(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),sn(t,e)}else{if(on(t,i))return;vw.set(i),n.uniformMatrix2fv(this.addr,!1,vw),sn(t,i)}}function S2(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(on(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),sn(t,e)}else{if(on(t,i))return;yw.set(i),n.uniformMatrix3fv(this.addr,!1,yw),sn(t,i)}}function T2(n,e){let t=this.cache,i=e.elements;if(i===void 0){if(on(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),sn(t,e)}else{if(on(t,i))return;gw.set(i),n.uniformMatrix4fv(this.addr,!1,gw),sn(t,i)}}function M2(n,e){let t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function C2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(on(t,e))return;n.uniform2iv(this.addr,e),sn(t,e)}}function w2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(on(t,e))return;n.uniform3iv(this.addr,e),sn(t,e)}}function b2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(on(t,e))return;n.uniform4iv(this.addr,e),sn(t,e)}}function I2(n,e){let t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function A2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(on(t,e))return;n.uniform2uiv(this.addr,e),sn(t,e)}}function D2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(on(t,e))return;n.uniform3uiv(this.addr,e),sn(t,e)}}function R2(n,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(on(t,e))return;n.uniform4uiv(this.addr,e),sn(t,e)}}function N2(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let o=this.type===n.SAMPLER_2D_SHADOW?Zw:jw;t.setTexture2D(e||o,r)}function P2(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||Qw,r)}function L2(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||eb,r)}function F2(n,e,t){let i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||Kw,r)}function O2(n){switch(n){case 5126:return y2;case 35664:return v2;case 35665:return _2;case 35666:return E2;case 35674:return x2;case 35675:return S2;case 35676:return T2;case 5124:case 35670:return M2;case 35667:case 35671:return C2;case 35668:case 35672:return w2;case 35669:case 35673:return b2;case 5125:return I2;case 36294:return A2;case 36295:return D2;case 36296:return R2;case 35678:case 36198:case 36298:case 36306:case 35682:return N2;case 35679:case 36299:case 36307:return P2;case 35680:case 36300:case 36308:case 36293:return L2;case 36289:case 36303:case 36311:case 36292:return F2}}function k2(n,e){n.uniform1fv(this.addr,e)}function U2(n,e){let t=yl(e,this.size,2);n.uniform2fv(this.addr,t)}function B2(n,e){let t=yl(e,this.size,3);n.uniform3fv(this.addr,t)}function V2(n,e){let t=yl(e,this.size,4);n.uniform4fv(this.addr,t)}function H2(n,e){let t=yl(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function z2(n,e){let t=yl(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function G2(n,e){let t=yl(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function W2(n,e){n.uniform1iv(this.addr,e)}function q2(n,e){n.uniform2iv(this.addr,e)}function $2(n,e){n.uniform3iv(this.addr,e)}function Y2(n,e){n.uniform4iv(this.addr,e)}function X2(n,e){n.uniform1uiv(this.addr,e)}function J2(n,e){n.uniform2uiv(this.addr,e)}function j2(n,e){n.uniform3uiv(this.addr,e)}function Z2(n,e){n.uniform4uiv(this.addr,e)}function K2(n,e,t){let i=this.cache,r=e.length,o=tp(t,r);on(i,o)||(n.uniform1iv(this.addr,o),sn(i,o));for(let s=0;s!==r;++s)t.setTexture2D(e[s]||jw,o[s])}function Q2(n,e,t){let i=this.cache,r=e.length,o=tp(t,r);on(i,o)||(n.uniform1iv(this.addr,o),sn(i,o));for(let s=0;s!==r;++s)t.setTexture3D(e[s]||Qw,o[s])}function eB(n,e,t){let i=this.cache,r=e.length,o=tp(t,r);on(i,o)||(n.uniform1iv(this.addr,o),sn(i,o));for(let s=0;s!==r;++s)t.setTextureCube(e[s]||eb,o[s])}function tB(n,e,t){let i=this.cache,r=e.length,o=tp(t,r);on(i,o)||(n.uniform1iv(this.addr,o),sn(i,o));for(let s=0;s!==r;++s)t.setTexture2DArray(e[s]||Kw,o[s])}function nB(n){switch(n){case 5126:return k2;case 35664:return U2;case 35665:return B2;case 35666:return V2;case 35674:return H2;case 35675:return z2;case 35676:return G2;case 5124:case 35670:return W2;case 35667:case 35671:return q2;case 35668:case 35672:return $2;case 35669:case 35673:return Y2;case 5125:return X2;case 36294:return J2;case 36295:return j2;case 36296:return Z2;case 35678:case 36198:case 36298:case 36306:case 35682:return K2;case 35679:case 36299:case 36307:return Q2;case 35680:case 36300:case 36308:case 36293:return eB;case 36289:case 36303:case 36311:case 36292:return tB}}var Wv=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=O2(t.type)}},qv=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=nB(t.type)}},$v=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let o=0,s=r.length;o!==s;++o){let a=r[o];a.setValue(e,t[a.id],i)}}},Nv=/(\w+)(\])?(\[|\.)?/g;function _w(n,e){n.seq.push(e),n.map[e.id]=e}function iB(n,e,t){let i=n.name,r=i.length;for(Nv.lastIndex=0;;){let o=Nv.exec(i),s=Nv.lastIndex,a=o[1],l=o[2]==="]",c=o[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===r){_w(t,c===void 0?new Wv(a,n,e):new qv(a,n,e));break}else{let f=t.map[a];f===void 0&&(f=new $v(a),_w(t,f)),t=f}}}var il=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){let o=e.getActiveUniform(t,r),s=e.getUniformLocation(t,o.name);iB(o,s,this)}}setValue(e,t,i,r){let o=this.map[t];o!==void 0&&o.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let o=0,s=t.length;o!==s;++o){let a=t[o],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,o=e.length;r!==o;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function Ew(n,e,t){let i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}var rB=37297,oB=0;function sB(n,e){let t=n.split(`
`),i=[],r=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=r;s<o;s++){let a=s+1;i.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return i.join(`
`)}function aB(n){let e=At.getPrimaries(At.workingColorSpace),t=At.getPrimaries(n),i;switch(e===t?i="":e===Ah&&t===Ih?i="LinearDisplayP3ToLinearSRGB":e===Ih&&t===Ah&&(i="LinearSRGBToLinearDisplayP3"),n){case bo:case ep:return[i,"LinearTransferOETF"];case An:case E_:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function xw(n,e,t){let i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";let o=/ERROR: 0:(\d+)/.exec(r);if(o){let s=parseInt(o[1]);return t.toUpperCase()+`

`+r+`

`+sB(n.getShaderSource(e),s)}else return r}function lB(n,e){let t=aB(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function cB(n,e){let t;switch(e){case dF:t="Linear";break;case fF:t="Reinhard";break;case hF:t="OptimizedCineon";break;case pF:t="ACESFilmic";break;case gF:t="AgX";break;case yF:t="Neutral";break;case mF:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function uB(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(nu).join(`
`)}function dB(n){let e=[];for(let t in n){let i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function fB(n,e){let t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){let o=n.getActiveAttrib(e,r),s=o.name,a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[s]={type:o.type,location:n.getAttribLocation(e,s),locationSize:a}}return t}function nu(n){return n!==""}function Sw(n,e){let t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Tw(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var hB=/^[ \t]*#include +<([\w\d./]+)>/gm;function Yv(n){return n.replace(hB,mB)}var pB=new Map;function mB(n,e){let t=Ze[e];if(t===void 0){let i=pB.get(e);if(i!==void 0)t=Ze[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Yv(t)}var gB=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Mw(n){return n.replace(gB,yB)}function yB(n,e,t,i){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Cw(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function vB(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===kw?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===g_?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===kr&&(e="SHADOWMAP_TYPE_VSM"),e}function _B(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case rl:case ol:e="ENVMAP_TYPE_CUBE";break;case Kh:e="ENVMAP_TYPE_CUBE_UV";break}return e}function EB(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ol:e="ENVMAP_MODE_REFRACTION";break}return e}function xB(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case y_:e="ENVMAP_BLENDING_MULTIPLY";break;case cF:e="ENVMAP_BLENDING_MIX";break;case uF:e="ENVMAP_BLENDING_ADD";break}return e}function SB(n){let e=n.envMapCubeUVHeight;if(e===null)return null;let t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}function TB(n,e,t,i){let r=n.getContext(),o=t.defines,s=t.vertexShader,a=t.fragmentShader,l=vB(t),c=_B(t),u=EB(t),f=xB(t),p=SB(t),m=uB(t),v=dB(o),_=r.createProgram(),y,g,T=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(nu).join(`
`),y.length>0&&(y+=`
`),g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(nu).join(`
`),g.length>0&&(g+=`
`)):(y=[Cw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(nu).join(`
`),g=[Cw(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==xo?"#define TONE_MAPPING":"",t.toneMapping!==xo?Ze.tonemapping_pars_fragment:"",t.toneMapping!==xo?cB("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ze.colorspace_pars_fragment,lB("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(nu).join(`
`)),s=Yv(s),s=Sw(s,t),s=Tw(s,t),a=Yv(a),a=Sw(a,t),a=Tw(a,t),s=Mw(s),a=Mw(a),t.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,y=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,g=["#define varying in",t.glslVersion===HC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===HC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);let x=T+y+s,M=T+g+a,D=Ew(r,r.VERTEX_SHADER,x),I=Ew(r,r.FRAGMENT_SHADER,M);r.attachShader(_,D),r.attachShader(_,I),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function A(L){if(n.debug.checkShaderErrors){let z=r.getProgramInfoLog(_).trim(),N=r.getShaderInfoLog(D).trim(),$=r.getShaderInfoLog(I).trim(),Y=!0,Q=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(Y=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,_,D,I);else{let re=xw(r,D,"vertex"),q=xw(r,I,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Material Name: `+L.name+`
Material Type: `+L.type+`

Program Info Log: `+z+`
`+re+`
`+q)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(N===""||$==="")&&(Q=!1);Q&&(L.diagnostics={runnable:Y,programLog:z,vertexShader:{log:N,prefix:y},fragmentShader:{log:$,prefix:g}})}r.deleteShader(D),r.deleteShader(I),k=new il(r,_),w=fB(r,_)}let k;this.getUniforms=function(){return k===void 0&&A(this),k};let w;this.getAttributes=function(){return w===void 0&&A(this),w};let S=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=r.getProgramParameter(_,rB)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=oB++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=D,this.fragmentShader=I,this}var MB=0,Xv=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),o=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new Jv(e),t.set(e,i)),i}},Jv=class{constructor(e){this.id=MB++,this.code=e,this.usedTimes=0}};function CB(n,e,t,i,r,o,s){let a=new Nh,l=new Xv,c=new Set,u=[],f=r.logarithmicDepthBuffer,p=r.vertexTextures,m=r.precision,v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(w){return c.add(w),w===0?"uv":`uv${w}`}function y(w,S,L,z,N){let $=z.fog,Y=N.geometry,Q=w.isMeshStandardMaterial?z.environment:null,re=(w.isMeshStandardMaterial?t:e).get(w.envMap||Q),q=re&&re.mapping===Kh?re.image.height:null,oe=v[w.type];w.precision!==null&&(m=r.getMaxPrecision(w.precision),m!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",m,"instead."));let ie=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,xe=ie!==void 0?ie.length:0,rt=0;Y.morphAttributes.position!==void 0&&(rt=1),Y.morphAttributes.normal!==void 0&&(rt=2),Y.morphAttributes.color!==void 0&&(rt=3);let Ct,X,ae,_e;if(oe){let _t=ir[oe];Ct=_t.vertexShader,X=_t.fragmentShader}else Ct=w.vertexShader,X=w.fragmentShader,l.update(w),ae=l.getVertexShaderID(w),_e=l.getFragmentShaderID(w);let fe=n.getRenderTarget(),ot=N.isInstancedMesh===!0,Qe=N.isBatchedMesh===!0,U=!!w.map,wt=!!w.matcap,we=!!re,bt=!!w.aoMap,Ie=!!w.lightMap,st=!!w.bumpMap,qe=!!w.normalMap,ft=!!w.displacementMap,kt=!!w.emissiveMap,R=!!w.metalnessMap,C=!!w.roughnessMap,W=w.anisotropy>0,K=w.clearcoat>0,te=w.dispersion>0,ne=w.iridescence>0,Ce=w.sheen>0,me=w.transmission>0,pe=W&&!!w.anisotropyMap,Be=K&&!!w.clearcoatMap,ce=K&&!!w.clearcoatNormalMap,Me=K&&!!w.clearcoatRoughnessMap,ht=ne&&!!w.iridescenceMap,be=ne&&!!w.iridescenceThicknessMap,ve=Ce&&!!w.sheenColorMap,$e=Ce&&!!w.sheenRoughnessMap,et=!!w.specularMap,It=!!w.specularColorMap,Je=!!w.specularIntensityMap,E=me&&!!w.transmissionMap,F=me&&!!w.thicknessMap,B=!!w.gradientMap,ee=!!w.alphaMap,le=w.alphaTest>0,Ye=!!w.alphaHash,tt=!!w.extensions,Vt=xo;w.toneMapped&&(fe===null||fe.isXRRenderTarget===!0)&&(Vt=n.toneMapping);let an={shaderID:oe,shaderType:w.type,shaderName:w.name,vertexShader:Ct,fragmentShader:X,defines:w.defines,customVertexShaderID:ae,customFragmentShaderID:_e,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:m,batching:Qe,instancing:ot,instancingColor:ot&&N.instanceColor!==null,instancingMorph:ot&&N.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:fe===null?n.outputColorSpace:fe.isXRRenderTarget===!0?fe.texture.colorSpace:bo,alphaToCoverage:!!w.alphaToCoverage,map:U,matcap:wt,envMap:we,envMapMode:we&&re.mapping,envMapCubeUVHeight:q,aoMap:bt,lightMap:Ie,bumpMap:st,normalMap:qe,displacementMap:p&&ft,emissiveMap:kt,normalMapObjectSpace:qe&&w.normalMapType===DF,normalMapTangentSpace:qe&&w.normalMapType===__,metalnessMap:R,roughnessMap:C,anisotropy:W,anisotropyMap:pe,clearcoat:K,clearcoatMap:Be,clearcoatNormalMap:ce,clearcoatRoughnessMap:Me,dispersion:te,iridescence:ne,iridescenceMap:ht,iridescenceThicknessMap:be,sheen:Ce,sheenColorMap:ve,sheenRoughnessMap:$e,specularMap:et,specularColorMap:It,specularIntensityMap:Je,transmission:me,transmissionMap:E,thicknessMap:F,gradientMap:B,opaque:w.transparent===!1&&w.blending===el&&w.alphaToCoverage===!1,alphaMap:ee,alphaTest:le,alphaHash:Ye,combine:w.combine,mapUv:U&&_(w.map.channel),aoMapUv:bt&&_(w.aoMap.channel),lightMapUv:Ie&&_(w.lightMap.channel),bumpMapUv:st&&_(w.bumpMap.channel),normalMapUv:qe&&_(w.normalMap.channel),displacementMapUv:ft&&_(w.displacementMap.channel),emissiveMapUv:kt&&_(w.emissiveMap.channel),metalnessMapUv:R&&_(w.metalnessMap.channel),roughnessMapUv:C&&_(w.roughnessMap.channel),anisotropyMapUv:pe&&_(w.anisotropyMap.channel),clearcoatMapUv:Be&&_(w.clearcoatMap.channel),clearcoatNormalMapUv:ce&&_(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Me&&_(w.clearcoatRoughnessMap.channel),iridescenceMapUv:ht&&_(w.iridescenceMap.channel),iridescenceThicknessMapUv:be&&_(w.iridescenceThicknessMap.channel),sheenColorMapUv:ve&&_(w.sheenColorMap.channel),sheenRoughnessMapUv:$e&&_(w.sheenRoughnessMap.channel),specularMapUv:et&&_(w.specularMap.channel),specularColorMapUv:It&&_(w.specularColorMap.channel),specularIntensityMapUv:Je&&_(w.specularIntensityMap.channel),transmissionMapUv:E&&_(w.transmissionMap.channel),thicknessMapUv:F&&_(w.thicknessMap.channel),alphaMapUv:ee&&_(w.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(qe||W),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:N.isPoints===!0&&!!Y.attributes.uv&&(U||ee),fog:!!$,useFog:w.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:N.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:xe,morphTextureStride:rt,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:w.dithering,shadowMapEnabled:n.shadowMap.enabled&&L.length>0,shadowMapType:n.shadowMap.type,toneMapping:Vt,useLegacyLights:n._useLegacyLights,decodeVideoTexture:U&&w.map.isVideoTexture===!0&&At.getTransfer(w.map.colorSpace)===Lt,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Bi,flipSided:w.side===$n,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionClipCullDistance:tt&&w.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:tt&&w.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return an.vertexUv1s=c.has(1),an.vertexUv2s=c.has(2),an.vertexUv3s=c.has(3),c.clear(),an}function g(w){let S=[];if(w.shaderID?S.push(w.shaderID):(S.push(w.customVertexShaderID),S.push(w.customFragmentShaderID)),w.defines!==void 0)for(let L in w.defines)S.push(L),S.push(w.defines[L]);return w.isRawShaderMaterial===!1&&(T(S,w),x(S,w),S.push(n.outputColorSpace)),S.push(w.customProgramCacheKey),S.join()}function T(w,S){w.push(S.precision),w.push(S.outputColorSpace),w.push(S.envMapMode),w.push(S.envMapCubeUVHeight),w.push(S.mapUv),w.push(S.alphaMapUv),w.push(S.lightMapUv),w.push(S.aoMapUv),w.push(S.bumpMapUv),w.push(S.normalMapUv),w.push(S.displacementMapUv),w.push(S.emissiveMapUv),w.push(S.metalnessMapUv),w.push(S.roughnessMapUv),w.push(S.anisotropyMapUv),w.push(S.clearcoatMapUv),w.push(S.clearcoatNormalMapUv),w.push(S.clearcoatRoughnessMapUv),w.push(S.iridescenceMapUv),w.push(S.iridescenceThicknessMapUv),w.push(S.sheenColorMapUv),w.push(S.sheenRoughnessMapUv),w.push(S.specularMapUv),w.push(S.specularColorMapUv),w.push(S.specularIntensityMapUv),w.push(S.transmissionMapUv),w.push(S.thicknessMapUv),w.push(S.combine),w.push(S.fogExp2),w.push(S.sizeAttenuation),w.push(S.morphTargetsCount),w.push(S.morphAttributeCount),w.push(S.numDirLights),w.push(S.numPointLights),w.push(S.numSpotLights),w.push(S.numSpotLightMaps),w.push(S.numHemiLights),w.push(S.numRectAreaLights),w.push(S.numDirLightShadows),w.push(S.numPointLightShadows),w.push(S.numSpotLightShadows),w.push(S.numSpotLightShadowsWithMaps),w.push(S.numLightProbes),w.push(S.shadowMapType),w.push(S.toneMapping),w.push(S.numClippingPlanes),w.push(S.numClipIntersection),w.push(S.depthPacking)}function x(w,S){a.disableAll(),S.supportsVertexTextures&&a.enable(0),S.instancing&&a.enable(1),S.instancingColor&&a.enable(2),S.instancingMorph&&a.enable(3),S.matcap&&a.enable(4),S.envMap&&a.enable(5),S.normalMapObjectSpace&&a.enable(6),S.normalMapTangentSpace&&a.enable(7),S.clearcoat&&a.enable(8),S.iridescence&&a.enable(9),S.alphaTest&&a.enable(10),S.vertexColors&&a.enable(11),S.vertexAlphas&&a.enable(12),S.vertexUv1s&&a.enable(13),S.vertexUv2s&&a.enable(14),S.vertexUv3s&&a.enable(15),S.vertexTangents&&a.enable(16),S.anisotropy&&a.enable(17),S.alphaHash&&a.enable(18),S.batching&&a.enable(19),S.dispersion&&a.enable(20),w.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.skinning&&a.enable(4),S.morphTargets&&a.enable(5),S.morphNormals&&a.enable(6),S.morphColors&&a.enable(7),S.premultipliedAlpha&&a.enable(8),S.shadowMapEnabled&&a.enable(9),S.useLegacyLights&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.transmission&&a.enable(15),S.sheen&&a.enable(16),S.opaque&&a.enable(17),S.pointsUvs&&a.enable(18),S.decodeVideoTexture&&a.enable(19),S.alphaToCoverage&&a.enable(20),w.push(a.mask)}function M(w){let S=v[w.type],L;if(S){let z=ir[S];L=gO.clone(z.uniforms)}else L=w.uniforms;return L}function D(w,S){let L;for(let z=0,N=u.length;z<N;z++){let $=u[z];if($.cacheKey===S){L=$,++L.usedTimes;break}}return L===void 0&&(L=new TB(n,S,w,o),u.push(L)),L}function I(w){if(--w.usedTimes===0){let S=u.indexOf(w);u[S]=u[u.length-1],u.pop(),w.destroy()}}function A(w){l.remove(w)}function k(){l.dispose()}return{getParameters:y,getProgramCacheKey:g,getUniforms:M,acquireProgram:D,releaseProgram:I,releaseShaderCache:A,programs:u,dispose:k}}function wB(){let n=new WeakMap;function e(o){let s=n.get(o);return s===void 0&&(s={},n.set(o,s)),s}function t(o){n.delete(o)}function i(o,s,a){n.get(o)[s]=a}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function bB(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ww(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function bw(){let n=[],e=0,t=[],i=[],r=[];function o(){e=0,t.length=0,i.length=0,r.length=0}function s(f,p,m,v,_,y){let g=n[e];return g===void 0?(g={id:f.id,object:f,geometry:p,material:m,groupOrder:v,renderOrder:f.renderOrder,z:_,group:y},n[e]=g):(g.id=f.id,g.object=f,g.geometry=p,g.material=m,g.groupOrder=v,g.renderOrder=f.renderOrder,g.z=_,g.group=y),e++,g}function a(f,p,m,v,_,y){let g=s(f,p,m,v,_,y);m.transmission>0?i.push(g):m.transparent===!0?r.push(g):t.push(g)}function l(f,p,m,v,_,y){let g=s(f,p,m,v,_,y);m.transmission>0?i.unshift(g):m.transparent===!0?r.unshift(g):t.unshift(g)}function c(f,p){t.length>1&&t.sort(f||bB),i.length>1&&i.sort(p||ww),r.length>1&&r.sort(p||ww)}function u(){for(let f=e,p=n.length;f<p;f++){let m=n[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:i,transparent:r,init:o,push:a,unshift:l,finish:u,sort:c}}function IB(){let n=new WeakMap;function e(i,r){let o=n.get(i),s;return o===void 0?(s=new bw,n.set(i,[s])):r>=o.length?(s=new bw,o.push(s)):s=o[r],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function AB(){let n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new P,color:new ke};break;case"SpotLight":t={position:new P,direction:new P,color:new ke,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new P,color:new ke,distance:0,decay:0};break;case"HemisphereLight":t={direction:new P,skyColor:new ke,groundColor:new ke};break;case"RectAreaLight":t={color:new ke,position:new P,halfWidth:new P,halfHeight:new P};break}return n[e.id]=t,t}}}function DB(){let n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}var RB=0;function NB(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function PB(n){let e=new AB,t=DB(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new P);let r=new P,o=new Ft,s=new Ft;function a(c,u){let f=0,p=0,m=0;for(let L=0;L<9;L++)i.probe[L].set(0,0,0);let v=0,_=0,y=0,g=0,T=0,x=0,M=0,D=0,I=0,A=0,k=0;c.sort(NB);let w=u===!0?Math.PI:1;for(let L=0,z=c.length;L<z;L++){let N=c[L],$=N.color,Y=N.intensity,Q=N.distance,re=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)f+=$.r*Y*w,p+=$.g*Y*w,m+=$.b*Y*w;else if(N.isLightProbe){for(let q=0;q<9;q++)i.probe[q].addScaledVector(N.sh.coefficients[q],Y);k++}else if(N.isDirectionalLight){let q=e.get(N);if(q.color.copy(N.color).multiplyScalar(N.intensity*w),N.castShadow){let oe=N.shadow,ie=t.get(N);ie.shadowBias=oe.bias,ie.shadowNormalBias=oe.normalBias,ie.shadowRadius=oe.radius,ie.shadowMapSize=oe.mapSize,i.directionalShadow[v]=ie,i.directionalShadowMap[v]=re,i.directionalShadowMatrix[v]=N.shadow.matrix,x++}i.directional[v]=q,v++}else if(N.isSpotLight){let q=e.get(N);q.position.setFromMatrixPosition(N.matrixWorld),q.color.copy($).multiplyScalar(Y*w),q.distance=Q,q.coneCos=Math.cos(N.angle),q.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),q.decay=N.decay,i.spot[y]=q;let oe=N.shadow;if(N.map&&(i.spotLightMap[I]=N.map,I++,oe.updateMatrices(N),N.castShadow&&A++),i.spotLightMatrix[y]=oe.matrix,N.castShadow){let ie=t.get(N);ie.shadowBias=oe.bias,ie.shadowNormalBias=oe.normalBias,ie.shadowRadius=oe.radius,ie.shadowMapSize=oe.mapSize,i.spotShadow[y]=ie,i.spotShadowMap[y]=re,D++}y++}else if(N.isRectAreaLight){let q=e.get(N);q.color.copy($).multiplyScalar(Y),q.halfWidth.set(N.width*.5,0,0),q.halfHeight.set(0,N.height*.5,0),i.rectArea[g]=q,g++}else if(N.isPointLight){let q=e.get(N);if(q.color.copy(N.color).multiplyScalar(N.intensity*w),q.distance=N.distance,q.decay=N.decay,N.castShadow){let oe=N.shadow,ie=t.get(N);ie.shadowBias=oe.bias,ie.shadowNormalBias=oe.normalBias,ie.shadowRadius=oe.radius,ie.shadowMapSize=oe.mapSize,ie.shadowCameraNear=oe.camera.near,ie.shadowCameraFar=oe.camera.far,i.pointShadow[_]=ie,i.pointShadowMap[_]=re,i.pointShadowMatrix[_]=N.shadow.matrix,M++}i.point[_]=q,_++}else if(N.isHemisphereLight){let q=e.get(N);q.skyColor.copy(N.color).multiplyScalar(Y*w),q.groundColor.copy(N.groundColor).multiplyScalar(Y*w),i.hemi[T]=q,T++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=he.LTC_FLOAT_1,i.rectAreaLTC2=he.LTC_FLOAT_2):(i.rectAreaLTC1=he.LTC_HALF_1,i.rectAreaLTC2=he.LTC_HALF_2)),i.ambient[0]=f,i.ambient[1]=p,i.ambient[2]=m;let S=i.hash;(S.directionalLength!==v||S.pointLength!==_||S.spotLength!==y||S.rectAreaLength!==g||S.hemiLength!==T||S.numDirectionalShadows!==x||S.numPointShadows!==M||S.numSpotShadows!==D||S.numSpotMaps!==I||S.numLightProbes!==k)&&(i.directional.length=v,i.spot.length=y,i.rectArea.length=g,i.point.length=_,i.hemi.length=T,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=M,i.pointShadowMap.length=M,i.spotShadow.length=D,i.spotShadowMap.length=D,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=M,i.spotLightMatrix.length=D+I-A,i.spotLightMap.length=I,i.numSpotLightShadowsWithMaps=A,i.numLightProbes=k,S.directionalLength=v,S.pointLength=_,S.spotLength=y,S.rectAreaLength=g,S.hemiLength=T,S.numDirectionalShadows=x,S.numPointShadows=M,S.numSpotShadows=D,S.numSpotMaps=I,S.numLightProbes=k,i.version=RB++)}function l(c,u){let f=0,p=0,m=0,v=0,_=0,y=u.matrixWorldInverse;for(let g=0,T=c.length;g<T;g++){let x=c[g];if(x.isDirectionalLight){let M=i.directional[f];M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(y),f++}else if(x.isSpotLight){let M=i.spot[m];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(y),M.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(y),m++}else if(x.isRectAreaLight){let M=i.rectArea[v];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(y),s.identity(),o.copy(x.matrixWorld),o.premultiply(y),s.extractRotation(o),M.halfWidth.set(x.width*.5,0,0),M.halfHeight.set(0,x.height*.5,0),M.halfWidth.applyMatrix4(s),M.halfHeight.applyMatrix4(s),v++}else if(x.isPointLight){let M=i.point[p];M.position.setFromMatrixPosition(x.matrixWorld),M.position.applyMatrix4(y),p++}else if(x.isHemisphereLight){let M=i.hemi[_];M.direction.setFromMatrixPosition(x.matrixWorld),M.direction.transformDirection(y),_++}}}return{setup:a,setupView:l,state:i}}function Iw(n){let e=new PB(n),t=[],i=[];function r(u){c.camera=u,t.length=0,i.length=0}function o(u){t.push(u)}function s(u){i.push(u)}function a(u){e.setup(t,u)}function l(u){e.setupView(t,u)}let c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:o,pushShadow:s}}function LB(n){let e=new WeakMap;function t(r,o=0){let s=e.get(r),a;return s===void 0?(a=new Iw(n),e.set(r,[a])):o>=s.length?(a=new Iw(n),s.push(a)):a=s[o],a}function i(){e=new WeakMap}return{get:t,dispose:i}}var jv=class extends si{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=IF,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},Zv=class extends si{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},FB=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,OB=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function kB(n,e,t){let i=new fu,r=new Ne,o=new Ne,s=new pn,a=new jv({depthPacking:AF}),l=new Zv,c={},u=t.maxTextureSize,f={[So]:$n,[$n]:So,[Bi]:Bi},p=new Si({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ne},radius:{value:4}},vertexShader:FB,fragmentShader:OB}),m=p.clone();m.defines.HORIZONTAL_PASS=1;let v=new xi;v.setAttribute("position",new en(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let _=new zt(v,p),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=kw;let g=this.type;this.render=function(I,A,k){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||I.length===0)return;let w=n.getRenderTarget(),S=n.getActiveCubeFace(),L=n.getActiveMipmapLevel(),z=n.state;z.setBlending(Eo),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);let N=g!==kr&&this.type===kr,$=g===kr&&this.type!==kr;for(let Y=0,Q=I.length;Y<Q;Y++){let re=I[Y],q=re.shadow;if(q===void 0){console.warn("THREE.WebGLShadowMap:",re,"has no shadow.");continue}if(q.autoUpdate===!1&&q.needsUpdate===!1)continue;r.copy(q.mapSize);let oe=q.getFrameExtents();if(r.multiply(oe),o.copy(q.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/oe.x),r.x=o.x*oe.x,q.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/oe.y),r.y=o.y*oe.y,q.mapSize.y=o.y)),q.map===null||N===!0||$===!0){let xe=this.type!==kr?{minFilter:qn,magFilter:qn}:{};q.map!==null&&q.map.dispose(),q.map=new Vr(r.x,r.y,xe),q.map.texture.name=re.name+".shadowMap",q.camera.updateProjectionMatrix()}n.setRenderTarget(q.map),n.clear();let ie=q.getViewportCount();for(let xe=0;xe<ie;xe++){let rt=q.getViewport(xe);s.set(o.x*rt.x,o.y*rt.y,o.x*rt.z,o.y*rt.w),z.viewport(s),q.updateMatrices(re,xe),i=q.getFrustum(),M(A,k,q.camera,re,this.type)}q.isPointLightShadow!==!0&&this.type===kr&&T(q,k),q.needsUpdate=!1}g=this.type,y.needsUpdate=!1,n.setRenderTarget(w,S,L)};function T(I,A){let k=e.update(_);p.defines.VSM_SAMPLES!==I.blurSamples&&(p.defines.VSM_SAMPLES=I.blurSamples,m.defines.VSM_SAMPLES=I.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Vr(r.x,r.y)),p.uniforms.shadow_pass.value=I.map.texture,p.uniforms.resolution.value=I.mapSize,p.uniforms.radius.value=I.radius,n.setRenderTarget(I.mapPass),n.clear(),n.renderBufferDirect(A,null,k,p,_,null),m.uniforms.shadow_pass.value=I.mapPass.texture,m.uniforms.resolution.value=I.mapSize,m.uniforms.radius.value=I.radius,n.setRenderTarget(I.map),n.clear(),n.renderBufferDirect(A,null,k,m,_,null)}function x(I,A,k,w){let S=null,L=k.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(L!==void 0)S=L;else if(S=k.isPointLight===!0?l:a,n.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0){let z=S.uuid,N=A.uuid,$=c[z];$===void 0&&($={},c[z]=$);let Y=$[N];Y===void 0&&(Y=S.clone(),$[N]=Y,A.addEventListener("dispose",D)),S=Y}if(S.visible=A.visible,S.wireframe=A.wireframe,w===kr?S.side=A.shadowSide!==null?A.shadowSide:A.side:S.side=A.shadowSide!==null?A.shadowSide:f[A.side],S.alphaMap=A.alphaMap,S.alphaTest=A.alphaTest,S.map=A.map,S.clipShadows=A.clipShadows,S.clippingPlanes=A.clippingPlanes,S.clipIntersection=A.clipIntersection,S.displacementMap=A.displacementMap,S.displacementScale=A.displacementScale,S.displacementBias=A.displacementBias,S.wireframeLinewidth=A.wireframeLinewidth,S.linewidth=A.linewidth,k.isPointLight===!0&&S.isMeshDistanceMaterial===!0){let z=n.properties.get(S);z.light=k}return S}function M(I,A,k,w,S){if(I.visible===!1)return;if(I.layers.test(A.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&S===kr)&&(!I.frustumCulled||i.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,I.matrixWorld);let N=e.update(I),$=I.material;if(Array.isArray($)){let Y=N.groups;for(let Q=0,re=Y.length;Q<re;Q++){let q=Y[Q],oe=$[q.materialIndex];if(oe&&oe.visible){let ie=x(I,oe,w,S);I.onBeforeShadow(n,I,A,k,N,ie,q),n.renderBufferDirect(k,null,N,ie,I,q),I.onAfterShadow(n,I,A,k,N,ie,q)}}}else if($.visible){let Y=x(I,$,w,S);I.onBeforeShadow(n,I,A,k,N,Y,null),n.renderBufferDirect(k,null,N,Y,I,null),I.onAfterShadow(n,I,A,k,N,Y,null)}}let z=I.children;for(let N=0,$=z.length;N<$;N++)M(z[N],A,k,w,S)}function D(I){I.target.removeEventListener("dispose",D);for(let k in c){let w=c[k],S=I.target.uuid;S in w&&(w[S].dispose(),delete w[S])}}}function UB(n){function e(){let E=!1,F=new pn,B=null,ee=new pn(0,0,0,0);return{setMask:function(le){B!==le&&!E&&(n.colorMask(le,le,le,le),B=le)},setLocked:function(le){E=le},setClear:function(le,Ye,tt,Vt,an){an===!0&&(le*=Vt,Ye*=Vt,tt*=Vt),F.set(le,Ye,tt,Vt),ee.equals(F)===!1&&(n.clearColor(le,Ye,tt,Vt),ee.copy(F))},reset:function(){E=!1,B=null,ee.set(-1,0,0,0)}}}function t(){let E=!1,F=null,B=null,ee=null;return{setTest:function(le){le?_e(n.DEPTH_TEST):fe(n.DEPTH_TEST)},setMask:function(le){F!==le&&!E&&(n.depthMask(le),F=le)},setFunc:function(le){if(B!==le){switch(le){case nF:n.depthFunc(n.NEVER);break;case iF:n.depthFunc(n.ALWAYS);break;case rF:n.depthFunc(n.LESS);break;case wh:n.depthFunc(n.LEQUAL);break;case oF:n.depthFunc(n.EQUAL);break;case sF:n.depthFunc(n.GEQUAL);break;case aF:n.depthFunc(n.GREATER);break;case lF:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}B=le}},setLocked:function(le){E=le},setClear:function(le){ee!==le&&(n.clearDepth(le),ee=le)},reset:function(){E=!1,F=null,B=null,ee=null}}}function i(){let E=!1,F=null,B=null,ee=null,le=null,Ye=null,tt=null,Vt=null,an=null;return{setTest:function(_t){E||(_t?_e(n.STENCIL_TEST):fe(n.STENCIL_TEST))},setMask:function(_t){F!==_t&&!E&&(n.stencilMask(_t),F=_t)},setFunc:function(_t,qt,Pt){(B!==_t||ee!==qt||le!==Pt)&&(n.stencilFunc(_t,qt,Pt),B=_t,ee=qt,le=Pt)},setOp:function(_t,qt,Pt){(Ye!==_t||tt!==qt||Vt!==Pt)&&(n.stencilOp(_t,qt,Pt),Ye=_t,tt=qt,Vt=Pt)},setLocked:function(_t){E=_t},setClear:function(_t){an!==_t&&(n.clearStencil(_t),an=_t)},reset:function(){E=!1,F=null,B=null,ee=null,le=null,Ye=null,tt=null,Vt=null,an=null}}}let r=new e,o=new t,s=new i,a=new WeakMap,l=new WeakMap,c={},u={},f=new WeakMap,p=[],m=null,v=!1,_=null,y=null,g=null,T=null,x=null,M=null,D=null,I=new ke(0,0,0),A=0,k=!1,w=null,S=null,L=null,z=null,N=null,$=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Y=!1,Q=0,re=n.getParameter(n.VERSION);re.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(re)[1]),Y=Q>=1):re.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(re)[1]),Y=Q>=2);let q=null,oe={},ie=n.getParameter(n.SCISSOR_BOX),xe=n.getParameter(n.VIEWPORT),rt=new pn().fromArray(ie),Ct=new pn().fromArray(xe);function X(E,F,B,ee){let le=new Uint8Array(4),Ye=n.createTexture();n.bindTexture(E,Ye),n.texParameteri(E,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(E,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let tt=0;tt<B;tt++)E===n.TEXTURE_3D||E===n.TEXTURE_2D_ARRAY?n.texImage3D(F,0,n.RGBA,1,1,ee,0,n.RGBA,n.UNSIGNED_BYTE,le):n.texImage2D(F+tt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,le);return Ye}let ae={};ae[n.TEXTURE_2D]=X(n.TEXTURE_2D,n.TEXTURE_2D,1),ae[n.TEXTURE_CUBE_MAP]=X(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ae[n.TEXTURE_2D_ARRAY]=X(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ae[n.TEXTURE_3D]=X(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),_e(n.DEPTH_TEST),o.setFunc(wh),st(!1),qe(oC),_e(n.CULL_FACE),bt(Eo);function _e(E){c[E]!==!0&&(n.enable(E),c[E]=!0)}function fe(E){c[E]!==!1&&(n.disable(E),c[E]=!1)}function ot(E,F){return u[E]!==F?(n.bindFramebuffer(E,F),u[E]=F,E===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=F),E===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=F),!0):!1}function Qe(E,F){let B=p,ee=!1;if(E){B=f.get(F),B===void 0&&(B=[],f.set(F,B));let le=E.textures;if(B.length!==le.length||B[0]!==n.COLOR_ATTACHMENT0){for(let Ye=0,tt=le.length;Ye<tt;Ye++)B[Ye]=n.COLOR_ATTACHMENT0+Ye;B.length=le.length,ee=!0}}else B[0]!==n.BACK&&(B[0]=n.BACK,ee=!0);ee&&n.drawBuffers(B)}function U(E){return m!==E?(n.useProgram(E),m=E,!0):!1}let wt={[xs]:n.FUNC_ADD,[BL]:n.FUNC_SUBTRACT,[VL]:n.FUNC_REVERSE_SUBTRACT};wt[HL]=n.MIN,wt[zL]=n.MAX;let we={[GL]:n.ZERO,[WL]:n.ONE,[qL]:n.SRC_COLOR,[Fv]:n.SRC_ALPHA,[ZL]:n.SRC_ALPHA_SATURATE,[JL]:n.DST_COLOR,[YL]:n.DST_ALPHA,[$L]:n.ONE_MINUS_SRC_COLOR,[Ov]:n.ONE_MINUS_SRC_ALPHA,[jL]:n.ONE_MINUS_DST_COLOR,[XL]:n.ONE_MINUS_DST_ALPHA,[KL]:n.CONSTANT_COLOR,[QL]:n.ONE_MINUS_CONSTANT_COLOR,[eF]:n.CONSTANT_ALPHA,[tF]:n.ONE_MINUS_CONSTANT_ALPHA};function bt(E,F,B,ee,le,Ye,tt,Vt,an,_t){if(E===Eo){v===!0&&(fe(n.BLEND),v=!1);return}if(v===!1&&(_e(n.BLEND),v=!0),E!==UL){if(E!==_||_t!==k){if((y!==xs||x!==xs)&&(n.blendEquation(n.FUNC_ADD),y=xs,x=xs),_t)switch(E){case el:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case sC:n.blendFunc(n.ONE,n.ONE);break;case aC:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case lC:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}else switch(E){case el:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case sC:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case aC:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case lC:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}g=null,T=null,M=null,D=null,I.set(0,0,0),A=0,_=E,k=_t}return}le=le||F,Ye=Ye||B,tt=tt||ee,(F!==y||le!==x)&&(n.blendEquationSeparate(wt[F],wt[le]),y=F,x=le),(B!==g||ee!==T||Ye!==M||tt!==D)&&(n.blendFuncSeparate(we[B],we[ee],we[Ye],we[tt]),g=B,T=ee,M=Ye,D=tt),(Vt.equals(I)===!1||an!==A)&&(n.blendColor(Vt.r,Vt.g,Vt.b,an),I.copy(Vt),A=an),_=E,k=!1}function Ie(E,F){E.side===Bi?fe(n.CULL_FACE):_e(n.CULL_FACE);let B=E.side===$n;F&&(B=!B),st(B),E.blending===el&&E.transparent===!1?bt(Eo):bt(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.blendColor,E.blendAlpha,E.premultipliedAlpha),o.setFunc(E.depthFunc),o.setTest(E.depthTest),o.setMask(E.depthWrite),r.setMask(E.colorWrite);let ee=E.stencilWrite;s.setTest(ee),ee&&(s.setMask(E.stencilWriteMask),s.setFunc(E.stencilFunc,E.stencilRef,E.stencilFuncMask),s.setOp(E.stencilFail,E.stencilZFail,E.stencilZPass)),kt(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits),E.alphaToCoverage===!0?_e(n.SAMPLE_ALPHA_TO_COVERAGE):fe(n.SAMPLE_ALPHA_TO_COVERAGE)}function st(E){w!==E&&(E?n.frontFace(n.CW):n.frontFace(n.CCW),w=E)}function qe(E){E!==OL?(_e(n.CULL_FACE),E!==S&&(E===oC?n.cullFace(n.BACK):E===kL?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):fe(n.CULL_FACE),S=E}function ft(E){E!==L&&(Y&&n.lineWidth(E),L=E)}function kt(E,F,B){E?(_e(n.POLYGON_OFFSET_FILL),(z!==F||N!==B)&&(n.polygonOffset(F,B),z=F,N=B)):fe(n.POLYGON_OFFSET_FILL)}function R(E){E?_e(n.SCISSOR_TEST):fe(n.SCISSOR_TEST)}function C(E){E===void 0&&(E=n.TEXTURE0+$-1),q!==E&&(n.activeTexture(E),q=E)}function W(E,F,B){B===void 0&&(q===null?B=n.TEXTURE0+$-1:B=q);let ee=oe[B];ee===void 0&&(ee={type:void 0,texture:void 0},oe[B]=ee),(ee.type!==E||ee.texture!==F)&&(q!==B&&(n.activeTexture(B),q=B),n.bindTexture(E,F||ae[E]),ee.type=E,ee.texture=F)}function K(){let E=oe[q];E!==void 0&&E.type!==void 0&&(n.bindTexture(E.type,null),E.type=void 0,E.texture=void 0)}function te(){try{n.compressedTexImage2D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ne(){try{n.compressedTexImage3D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ce(){try{n.texSubImage2D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function me(){try{n.texSubImage3D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function pe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Be(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ce(){try{n.texStorage2D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Me(){try{n.texStorage3D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ht(){try{n.texImage2D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function be(){try{n.texImage3D.apply(n,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ve(E){rt.equals(E)===!1&&(n.scissor(E.x,E.y,E.z,E.w),rt.copy(E))}function $e(E){Ct.equals(E)===!1&&(n.viewport(E.x,E.y,E.z,E.w),Ct.copy(E))}function et(E,F){let B=l.get(F);B===void 0&&(B=new WeakMap,l.set(F,B));let ee=B.get(E);ee===void 0&&(ee=n.getUniformBlockIndex(F,E.name),B.set(E,ee))}function It(E,F){let ee=l.get(F).get(E);a.get(F)!==ee&&(n.uniformBlockBinding(F,ee,E.__bindingPointIndex),a.set(F,ee))}function Je(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},q=null,oe={},u={},f=new WeakMap,p=[],m=null,v=!1,_=null,y=null,g=null,T=null,x=null,M=null,D=null,I=new ke(0,0,0),A=0,k=!1,w=null,S=null,L=null,z=null,N=null,rt.set(0,0,n.canvas.width,n.canvas.height),Ct.set(0,0,n.canvas.width,n.canvas.height),r.reset(),o.reset(),s.reset()}return{buffers:{color:r,depth:o,stencil:s},enable:_e,disable:fe,bindFramebuffer:ot,drawBuffers:Qe,useProgram:U,setBlending:bt,setMaterial:Ie,setFlipSided:st,setCullFace:qe,setLineWidth:ft,setPolygonOffset:kt,setScissorTest:R,activeTexture:C,bindTexture:W,unbindTexture:K,compressedTexImage2D:te,compressedTexImage3D:ne,texImage2D:ht,texImage3D:be,updateUBOMapping:et,uniformBlockBinding:It,texStorage2D:ce,texStorage3D:Me,texSubImage2D:Ce,texSubImage3D:me,compressedTexSubImage2D:pe,compressedTexSubImage3D:Be,scissor:ve,viewport:$e,reset:Je}}function BB(n,e,t,i,r,o,s){let a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Ne,u=new WeakMap,f,p=new WeakMap,m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(R,C){return m?new OffscreenCanvas(R,C):uu("canvas")}function _(R,C,W){let K=1,te=kt(R);if((te.width>W||te.height>W)&&(K=W/Math.max(te.width,te.height)),K<1)if(typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&R instanceof ImageBitmap||typeof VideoFrame<"u"&&R instanceof VideoFrame){let ne=Math.floor(K*te.width),Ce=Math.floor(K*te.height);f===void 0&&(f=v(ne,Ce));let me=C?v(ne,Ce):f;return me.width=ne,me.height=Ce,me.getContext("2d").drawImage(R,0,0,ne,Ce),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+te.width+"x"+te.height+") to ("+ne+"x"+Ce+")."),me}else return"data"in R&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+te.width+"x"+te.height+")."),R;return R}function y(R){return R.generateMipmaps&&R.minFilter!==qn&&R.minFilter!==Rn}function g(R){n.generateMipmap(R)}function T(R,C,W,K,te=!1){if(R!==null){if(n[R]!==void 0)return n[R];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+R+"'")}let ne=C;if(C===n.RED&&(W===n.FLOAT&&(ne=n.R32F),W===n.HALF_FLOAT&&(ne=n.R16F),W===n.UNSIGNED_BYTE&&(ne=n.R8)),C===n.RED_INTEGER&&(W===n.UNSIGNED_BYTE&&(ne=n.R8UI),W===n.UNSIGNED_SHORT&&(ne=n.R16UI),W===n.UNSIGNED_INT&&(ne=n.R32UI),W===n.BYTE&&(ne=n.R8I),W===n.SHORT&&(ne=n.R16I),W===n.INT&&(ne=n.R32I)),C===n.RG&&(W===n.FLOAT&&(ne=n.RG32F),W===n.HALF_FLOAT&&(ne=n.RG16F),W===n.UNSIGNED_BYTE&&(ne=n.RG8)),C===n.RG_INTEGER&&(W===n.UNSIGNED_BYTE&&(ne=n.RG8UI),W===n.UNSIGNED_SHORT&&(ne=n.RG16UI),W===n.UNSIGNED_INT&&(ne=n.RG32UI),W===n.BYTE&&(ne=n.RG8I),W===n.SHORT&&(ne=n.RG16I),W===n.INT&&(ne=n.RG32I)),C===n.RGB&&W===n.UNSIGNED_INT_5_9_9_9_REV&&(ne=n.RGB9_E5),C===n.RGBA){let Ce=te?bh:At.getTransfer(K);W===n.FLOAT&&(ne=n.RGBA32F),W===n.HALF_FLOAT&&(ne=n.RGBA16F),W===n.UNSIGNED_BYTE&&(ne=Ce===Lt?n.SRGB8_ALPHA8:n.RGBA8),W===n.UNSIGNED_SHORT_4_4_4_4&&(ne=n.RGBA4),W===n.UNSIGNED_SHORT_5_5_5_1&&(ne=n.RGB5_A1)}return(ne===n.R16F||ne===n.R32F||ne===n.RG16F||ne===n.RG32F||ne===n.RGBA16F||ne===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ne}function x(R,C){return y(R)===!0||R.isFramebufferTexture&&R.minFilter!==qn&&R.minFilter!==Rn?Math.log2(Math.max(C.width,C.height))+1:R.mipmaps!==void 0&&R.mipmaps.length>0?R.mipmaps.length:R.isCompressedTexture&&Array.isArray(R.image)?C.mipmaps.length:1}function M(R){let C=R.target;C.removeEventListener("dispose",M),I(C),C.isVideoTexture&&u.delete(C)}function D(R){let C=R.target;C.removeEventListener("dispose",D),k(C)}function I(R){let C=i.get(R);if(C.__webglInit===void 0)return;let W=R.source,K=p.get(W);if(K){let te=K[C.__cacheKey];te.usedTimes--,te.usedTimes===0&&A(R),Object.keys(K).length===0&&p.delete(W)}i.remove(R)}function A(R){let C=i.get(R);n.deleteTexture(C.__webglTexture);let W=R.source,K=p.get(W);delete K[C.__cacheKey],s.memory.textures--}function k(R){let C=i.get(R);if(R.depthTexture&&R.depthTexture.dispose(),R.isWebGLCubeRenderTarget)for(let K=0;K<6;K++){if(Array.isArray(C.__webglFramebuffer[K]))for(let te=0;te<C.__webglFramebuffer[K].length;te++)n.deleteFramebuffer(C.__webglFramebuffer[K][te]);else n.deleteFramebuffer(C.__webglFramebuffer[K]);C.__webglDepthbuffer&&n.deleteRenderbuffer(C.__webglDepthbuffer[K])}else{if(Array.isArray(C.__webglFramebuffer))for(let K=0;K<C.__webglFramebuffer.length;K++)n.deleteFramebuffer(C.__webglFramebuffer[K]);else n.deleteFramebuffer(C.__webglFramebuffer);if(C.__webglDepthbuffer&&n.deleteRenderbuffer(C.__webglDepthbuffer),C.__webglMultisampledFramebuffer&&n.deleteFramebuffer(C.__webglMultisampledFramebuffer),C.__webglColorRenderbuffer)for(let K=0;K<C.__webglColorRenderbuffer.length;K++)C.__webglColorRenderbuffer[K]&&n.deleteRenderbuffer(C.__webglColorRenderbuffer[K]);C.__webglDepthRenderbuffer&&n.deleteRenderbuffer(C.__webglDepthRenderbuffer)}let W=R.textures;for(let K=0,te=W.length;K<te;K++){let ne=i.get(W[K]);ne.__webglTexture&&(n.deleteTexture(ne.__webglTexture),s.memory.textures--),i.remove(W[K])}i.remove(R)}let w=0;function S(){w=0}function L(){let R=w;return R>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+R+" texture units while this GPU supports only "+r.maxTextures),w+=1,R}function z(R){let C=[];return C.push(R.wrapS),C.push(R.wrapT),C.push(R.wrapR||0),C.push(R.magFilter),C.push(R.minFilter),C.push(R.anisotropy),C.push(R.internalFormat),C.push(R.format),C.push(R.type),C.push(R.generateMipmaps),C.push(R.premultiplyAlpha),C.push(R.flipY),C.push(R.unpackAlignment),C.push(R.colorSpace),C.join()}function N(R,C){let W=i.get(R);if(R.isVideoTexture&&qe(R),R.isRenderTargetTexture===!1&&R.version>0&&W.__version!==R.version){let K=R.image;if(K===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(K.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{rt(W,R,C);return}}t.bindTexture(n.TEXTURE_2D,W.__webglTexture,n.TEXTURE0+C)}function $(R,C){let W=i.get(R);if(R.version>0&&W.__version!==R.version){rt(W,R,C);return}t.bindTexture(n.TEXTURE_2D_ARRAY,W.__webglTexture,n.TEXTURE0+C)}function Y(R,C){let W=i.get(R);if(R.version>0&&W.__version!==R.version){rt(W,R,C);return}t.bindTexture(n.TEXTURE_3D,W.__webglTexture,n.TEXTURE0+C)}function Q(R,C){let W=i.get(R);if(R.version>0&&W.__version!==R.version){Ct(W,R,C);return}t.bindTexture(n.TEXTURE_CUBE_MAP,W.__webglTexture,n.TEXTURE0+C)}let re={[sr]:n.REPEAT,[Ur]:n.CLAMP_TO_EDGE,[au]:n.MIRRORED_REPEAT},q={[qn]:n.NEAREST,[v_]:n.NEAREST_MIPMAP_NEAREST,[Za]:n.NEAREST_MIPMAP_LINEAR,[Rn]:n.LINEAR,[iu]:n.LINEAR_MIPMAP_NEAREST,[_i]:n.LINEAR_MIPMAP_LINEAR},oe={[RF]:n.NEVER,[kF]:n.ALWAYS,[NF]:n.LESS,[qw]:n.LEQUAL,[PF]:n.EQUAL,[OF]:n.GEQUAL,[LF]:n.GREATER,[FF]:n.NOTEQUAL};function ie(R,C){if(C.type===_o&&e.has("OES_texture_float_linear")===!1&&(C.magFilter===Rn||C.magFilter===iu||C.magFilter===Za||C.magFilter===_i||C.minFilter===Rn||C.minFilter===iu||C.minFilter===Za||C.minFilter===_i)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(R,n.TEXTURE_WRAP_S,re[C.wrapS]),n.texParameteri(R,n.TEXTURE_WRAP_T,re[C.wrapT]),(R===n.TEXTURE_3D||R===n.TEXTURE_2D_ARRAY)&&n.texParameteri(R,n.TEXTURE_WRAP_R,re[C.wrapR]),n.texParameteri(R,n.TEXTURE_MAG_FILTER,q[C.magFilter]),n.texParameteri(R,n.TEXTURE_MIN_FILTER,q[C.minFilter]),C.compareFunction&&(n.texParameteri(R,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(R,n.TEXTURE_COMPARE_FUNC,oe[C.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(C.magFilter===qn||C.minFilter!==Za&&C.minFilter!==_i||C.type===_o&&e.has("OES_texture_float_linear")===!1)return;if(C.anisotropy>1||i.get(C).__currentAnisotropy){let W=e.get("EXT_texture_filter_anisotropic");n.texParameterf(R,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,r.getMaxAnisotropy())),i.get(C).__currentAnisotropy=C.anisotropy}}}function xe(R,C){let W=!1;R.__webglInit===void 0&&(R.__webglInit=!0,C.addEventListener("dispose",M));let K=C.source,te=p.get(K);te===void 0&&(te={},p.set(K,te));let ne=z(C);if(ne!==R.__cacheKey){te[ne]===void 0&&(te[ne]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,W=!0),te[ne].usedTimes++;let Ce=te[R.__cacheKey];Ce!==void 0&&(te[R.__cacheKey].usedTimes--,Ce.usedTimes===0&&A(C)),R.__cacheKey=ne,R.__webglTexture=te[ne].texture}return W}function rt(R,C,W){let K=n.TEXTURE_2D;(C.isDataArrayTexture||C.isCompressedArrayTexture)&&(K=n.TEXTURE_2D_ARRAY),C.isData3DTexture&&(K=n.TEXTURE_3D);let te=xe(R,C),ne=C.source;t.bindTexture(K,R.__webglTexture,n.TEXTURE0+W);let Ce=i.get(ne);if(ne.version!==Ce.__version||te===!0){t.activeTexture(n.TEXTURE0+W);let me=At.getPrimaries(At.workingColorSpace),pe=C.colorSpace===rr?null:At.getPrimaries(C.colorSpace),Be=C.colorSpace===rr||me===pe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Be);let ce=_(C.image,!1,r.maxTextureSize);ce=ft(C,ce);let Me=o.convert(C.format,C.colorSpace),ht=o.convert(C.type),be=T(C.internalFormat,Me,ht,C.colorSpace,C.isVideoTexture);ie(K,C);let ve,$e=C.mipmaps,et=C.isVideoTexture!==!0,It=Ce.__version===void 0||te===!0,Je=ne.dataReady,E=x(C,ce);if(C.isDepthTexture)be=n.DEPTH_COMPONENT16,C.type===_o?be=n.DEPTH_COMPONENT32F:C.type===sl?be=n.DEPTH_COMPONENT24:C.type===gu&&(be=n.DEPTH24_STENCIL8),It&&(et?t.texStorage2D(n.TEXTURE_2D,1,be,ce.width,ce.height):t.texImage2D(n.TEXTURE_2D,0,be,ce.width,ce.height,0,Me,ht,null));else if(C.isDataTexture)if($e.length>0){et&&It&&t.texStorage2D(n.TEXTURE_2D,E,be,$e[0].width,$e[0].height);for(let F=0,B=$e.length;F<B;F++)ve=$e[F],et?Je&&t.texSubImage2D(n.TEXTURE_2D,F,0,0,ve.width,ve.height,Me,ht,ve.data):t.texImage2D(n.TEXTURE_2D,F,be,ve.width,ve.height,0,Me,ht,ve.data);C.generateMipmaps=!1}else et?(It&&t.texStorage2D(n.TEXTURE_2D,E,be,ce.width,ce.height),Je&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ce.width,ce.height,Me,ht,ce.data)):t.texImage2D(n.TEXTURE_2D,0,be,ce.width,ce.height,0,Me,ht,ce.data);else if(C.isCompressedTexture)if(C.isCompressedArrayTexture){et&&It&&t.texStorage3D(n.TEXTURE_2D_ARRAY,E,be,$e[0].width,$e[0].height,ce.depth);for(let F=0,B=$e.length;F<B;F++)ve=$e[F],C.format!==Ei?Me!==null?et?Je&&t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,F,0,0,0,ve.width,ve.height,ce.depth,Me,ve.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,F,be,ve.width,ve.height,ce.depth,0,ve.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):et?Je&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,F,0,0,0,ve.width,ve.height,ce.depth,Me,ht,ve.data):t.texImage3D(n.TEXTURE_2D_ARRAY,F,be,ve.width,ve.height,ce.depth,0,Me,ht,ve.data)}else{et&&It&&t.texStorage2D(n.TEXTURE_2D,E,be,$e[0].width,$e[0].height);for(let F=0,B=$e.length;F<B;F++)ve=$e[F],C.format!==Ei?Me!==null?et?Je&&t.compressedTexSubImage2D(n.TEXTURE_2D,F,0,0,ve.width,ve.height,Me,ve.data):t.compressedTexImage2D(n.TEXTURE_2D,F,be,ve.width,ve.height,0,ve.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):et?Je&&t.texSubImage2D(n.TEXTURE_2D,F,0,0,ve.width,ve.height,Me,ht,ve.data):t.texImage2D(n.TEXTURE_2D,F,be,ve.width,ve.height,0,Me,ht,ve.data)}else if(C.isDataArrayTexture)et?(It&&t.texStorage3D(n.TEXTURE_2D_ARRAY,E,be,ce.width,ce.height,ce.depth),Je&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ce.width,ce.height,ce.depth,Me,ht,ce.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,be,ce.width,ce.height,ce.depth,0,Me,ht,ce.data);else if(C.isData3DTexture)et?(It&&t.texStorage3D(n.TEXTURE_3D,E,be,ce.width,ce.height,ce.depth),Je&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ce.width,ce.height,ce.depth,Me,ht,ce.data)):t.texImage3D(n.TEXTURE_3D,0,be,ce.width,ce.height,ce.depth,0,Me,ht,ce.data);else if(C.isFramebufferTexture){if(It)if(et)t.texStorage2D(n.TEXTURE_2D,E,be,ce.width,ce.height);else{let F=ce.width,B=ce.height;for(let ee=0;ee<E;ee++)t.texImage2D(n.TEXTURE_2D,ee,be,F,B,0,Me,ht,null),F>>=1,B>>=1}}else if($e.length>0){if(et&&It){let F=kt($e[0]);t.texStorage2D(n.TEXTURE_2D,E,be,F.width,F.height)}for(let F=0,B=$e.length;F<B;F++)ve=$e[F],et?Je&&t.texSubImage2D(n.TEXTURE_2D,F,0,0,Me,ht,ve):t.texImage2D(n.TEXTURE_2D,F,be,Me,ht,ve);C.generateMipmaps=!1}else if(et){if(It){let F=kt(ce);t.texStorage2D(n.TEXTURE_2D,E,be,F.width,F.height)}Je&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Me,ht,ce)}else t.texImage2D(n.TEXTURE_2D,0,be,Me,ht,ce);y(C)&&g(K),Ce.__version=ne.version,C.onUpdate&&C.onUpdate(C)}R.__version=C.version}function Ct(R,C,W){if(C.image.length!==6)return;let K=xe(R,C),te=C.source;t.bindTexture(n.TEXTURE_CUBE_MAP,R.__webglTexture,n.TEXTURE0+W);let ne=i.get(te);if(te.version!==ne.__version||K===!0){t.activeTexture(n.TEXTURE0+W);let Ce=At.getPrimaries(At.workingColorSpace),me=C.colorSpace===rr?null:At.getPrimaries(C.colorSpace),pe=C.colorSpace===rr||Ce===me?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,C.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,C.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,pe);let Be=C.isCompressedTexture||C.image[0].isCompressedTexture,ce=C.image[0]&&C.image[0].isDataTexture,Me=[];for(let B=0;B<6;B++)!Be&&!ce?Me[B]=_(C.image[B],!0,r.maxCubemapSize):Me[B]=ce?C.image[B].image:C.image[B],Me[B]=ft(C,Me[B]);let ht=Me[0],be=o.convert(C.format,C.colorSpace),ve=o.convert(C.type),$e=T(C.internalFormat,be,ve,C.colorSpace),et=C.isVideoTexture!==!0,It=ne.__version===void 0||K===!0,Je=te.dataReady,E=x(C,ht);ie(n.TEXTURE_CUBE_MAP,C);let F;if(Be){et&&It&&t.texStorage2D(n.TEXTURE_CUBE_MAP,E,$e,ht.width,ht.height);for(let B=0;B<6;B++){F=Me[B].mipmaps;for(let ee=0;ee<F.length;ee++){let le=F[ee];C.format!==Ei?be!==null?et?Je&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee,0,0,le.width,le.height,be,le.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee,$e,le.width,le.height,0,le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):et?Je&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee,0,0,le.width,le.height,be,ve,le.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee,$e,le.width,le.height,0,be,ve,le.data)}}}else{if(F=C.mipmaps,et&&It){F.length>0&&E++;let B=kt(Me[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,E,$e,B.width,B.height)}for(let B=0;B<6;B++)if(ce){et?Je&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,0,0,Me[B].width,Me[B].height,be,ve,Me[B].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,$e,Me[B].width,Me[B].height,0,be,ve,Me[B].data);for(let ee=0;ee<F.length;ee++){let Ye=F[ee].image[B].image;et?Je&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee+1,0,0,Ye.width,Ye.height,be,ve,Ye.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee+1,$e,Ye.width,Ye.height,0,be,ve,Ye.data)}}else{et?Je&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,0,0,be,ve,Me[B]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,0,$e,be,ve,Me[B]);for(let ee=0;ee<F.length;ee++){let le=F[ee];et?Je&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee+1,0,0,be,ve,le.image[B]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+B,ee+1,$e,be,ve,le.image[B])}}}y(C)&&g(n.TEXTURE_CUBE_MAP),ne.__version=te.version,C.onUpdate&&C.onUpdate(C)}R.__version=C.version}function X(R,C,W,K,te,ne){let Ce=o.convert(W.format,W.colorSpace),me=o.convert(W.type),pe=T(W.internalFormat,Ce,me,W.colorSpace);if(!i.get(C).__hasExternalTextures){let ce=Math.max(1,C.width>>ne),Me=Math.max(1,C.height>>ne);te===n.TEXTURE_3D||te===n.TEXTURE_2D_ARRAY?t.texImage3D(te,ne,pe,ce,Me,C.depth,0,Ce,me,null):t.texImage2D(te,ne,pe,ce,Me,0,Ce,me,null)}t.bindFramebuffer(n.FRAMEBUFFER,R),st(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,K,te,i.get(W).__webglTexture,0,Ie(C)):(te===n.TEXTURE_2D||te>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&te<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,K,te,i.get(W).__webglTexture,ne),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ae(R,C,W){if(n.bindRenderbuffer(n.RENDERBUFFER,R),C.depthBuffer&&!C.stencilBuffer){let K=n.DEPTH_COMPONENT24;if(W||st(C)){let te=C.depthTexture;te&&te.isDepthTexture&&(te.type===_o?K=n.DEPTH_COMPONENT32F:te.type===sl&&(K=n.DEPTH_COMPONENT24));let ne=Ie(C);st(C)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ne,K,C.width,C.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,ne,K,C.width,C.height)}else n.renderbufferStorage(n.RENDERBUFFER,K,C.width,C.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,R)}else if(C.depthBuffer&&C.stencilBuffer){let K=Ie(C);W&&st(C)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,K,n.DEPTH24_STENCIL8,C.width,C.height):st(C)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,K,n.DEPTH24_STENCIL8,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,C.width,C.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,R)}else{let K=C.textures;for(let te=0;te<K.length;te++){let ne=K[te],Ce=o.convert(ne.format,ne.colorSpace),me=o.convert(ne.type),pe=T(ne.internalFormat,Ce,me,ne.colorSpace),Be=Ie(C);W&&st(C)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Be,pe,C.width,C.height):st(C)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Be,pe,C.width,C.height):n.renderbufferStorage(n.RENDERBUFFER,pe,C.width,C.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function _e(R,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,R),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),N(C.depthTexture,0);let K=i.get(C.depthTexture).__webglTexture,te=Ie(C);if(C.depthTexture.format===tl)st(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,K,0,te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,K,0);else if(C.depthTexture.format===lu)st(C)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,K,0,te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,K,0);else throw new Error("Unknown depthTexture format")}function fe(R){let C=i.get(R),W=R.isWebGLCubeRenderTarget===!0;if(R.depthTexture&&!C.__autoAllocateDepthBuffer){if(W)throw new Error("target.depthTexture not supported in Cube render targets");_e(C.__webglFramebuffer,R)}else if(W){C.__webglDepthbuffer=[];for(let K=0;K<6;K++)t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer[K]),C.__webglDepthbuffer[K]=n.createRenderbuffer(),ae(C.__webglDepthbuffer[K],R,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,C.__webglFramebuffer),C.__webglDepthbuffer=n.createRenderbuffer(),ae(C.__webglDepthbuffer,R,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function ot(R,C,W){let K=i.get(R);C!==void 0&&X(K.__webglFramebuffer,R,R.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),W!==void 0&&fe(R)}function Qe(R){let C=R.texture,W=i.get(R),K=i.get(C);R.addEventListener("dispose",D);let te=R.textures,ne=R.isWebGLCubeRenderTarget===!0,Ce=te.length>1;if(Ce||(K.__webglTexture===void 0&&(K.__webglTexture=n.createTexture()),K.__version=C.version,s.memory.textures++),ne){W.__webglFramebuffer=[];for(let me=0;me<6;me++)if(C.mipmaps&&C.mipmaps.length>0){W.__webglFramebuffer[me]=[];for(let pe=0;pe<C.mipmaps.length;pe++)W.__webglFramebuffer[me][pe]=n.createFramebuffer()}else W.__webglFramebuffer[me]=n.createFramebuffer()}else{if(C.mipmaps&&C.mipmaps.length>0){W.__webglFramebuffer=[];for(let me=0;me<C.mipmaps.length;me++)W.__webglFramebuffer[me]=n.createFramebuffer()}else W.__webglFramebuffer=n.createFramebuffer();if(Ce)for(let me=0,pe=te.length;me<pe;me++){let Be=i.get(te[me]);Be.__webglTexture===void 0&&(Be.__webglTexture=n.createTexture(),s.memory.textures++)}if(R.samples>0&&st(R)===!1){W.__webglMultisampledFramebuffer=n.createFramebuffer(),W.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,W.__webglMultisampledFramebuffer);for(let me=0;me<te.length;me++){let pe=te[me];W.__webglColorRenderbuffer[me]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,W.__webglColorRenderbuffer[me]);let Be=o.convert(pe.format,pe.colorSpace),ce=o.convert(pe.type),Me=T(pe.internalFormat,Be,ce,pe.colorSpace,R.isXRRenderTarget===!0),ht=Ie(R);n.renderbufferStorageMultisample(n.RENDERBUFFER,ht,Me,R.width,R.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+me,n.RENDERBUFFER,W.__webglColorRenderbuffer[me])}n.bindRenderbuffer(n.RENDERBUFFER,null),R.depthBuffer&&(W.__webglDepthRenderbuffer=n.createRenderbuffer(),ae(W.__webglDepthRenderbuffer,R,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ne){t.bindTexture(n.TEXTURE_CUBE_MAP,K.__webglTexture),ie(n.TEXTURE_CUBE_MAP,C);for(let me=0;me<6;me++)if(C.mipmaps&&C.mipmaps.length>0)for(let pe=0;pe<C.mipmaps.length;pe++)X(W.__webglFramebuffer[me][pe],R,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+me,pe);else X(W.__webglFramebuffer[me],R,C,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+me,0);y(C)&&g(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ce){for(let me=0,pe=te.length;me<pe;me++){let Be=te[me],ce=i.get(Be);t.bindTexture(n.TEXTURE_2D,ce.__webglTexture),ie(n.TEXTURE_2D,Be),X(W.__webglFramebuffer,R,Be,n.COLOR_ATTACHMENT0+me,n.TEXTURE_2D,0),y(Be)&&g(n.TEXTURE_2D)}t.unbindTexture()}else{let me=n.TEXTURE_2D;if((R.isWebGL3DRenderTarget||R.isWebGLArrayRenderTarget)&&(me=R.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(me,K.__webglTexture),ie(me,C),C.mipmaps&&C.mipmaps.length>0)for(let pe=0;pe<C.mipmaps.length;pe++)X(W.__webglFramebuffer[pe],R,C,n.COLOR_ATTACHMENT0,me,pe);else X(W.__webglFramebuffer,R,C,n.COLOR_ATTACHMENT0,me,0);y(C)&&g(me),t.unbindTexture()}R.depthBuffer&&fe(R)}function U(R){let C=R.textures;for(let W=0,K=C.length;W<K;W++){let te=C[W];if(y(te)){let ne=R.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Ce=i.get(te).__webglTexture;t.bindTexture(ne,Ce),g(ne),t.unbindTexture()}}}let wt=[],we=[];function bt(R){if(R.samples>0){if(st(R)===!1){let C=R.textures,W=R.width,K=R.height,te=n.COLOR_BUFFER_BIT,ne=R.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ce=i.get(R),me=C.length>1;if(me)for(let pe=0;pe<C.length;pe++)t.bindFramebuffer(n.FRAMEBUFFER,Ce.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+pe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Ce.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+pe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Ce.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ce.__webglFramebuffer);for(let pe=0;pe<C.length;pe++){if(R.resolveDepthBuffer&&(R.depthBuffer&&(te|=n.DEPTH_BUFFER_BIT),R.stencilBuffer&&R.resolveStencilBuffer&&(te|=n.STENCIL_BUFFER_BIT)),me){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Ce.__webglColorRenderbuffer[pe]);let Be=i.get(C[pe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Be,0)}n.blitFramebuffer(0,0,W,K,0,0,W,K,te,n.NEAREST),l===!0&&(wt.length=0,we.length=0,wt.push(n.COLOR_ATTACHMENT0+pe),R.depthBuffer&&R.resolveDepthBuffer===!1&&(wt.push(ne),we.push(ne),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,we)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,wt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),me)for(let pe=0;pe<C.length;pe++){t.bindFramebuffer(n.FRAMEBUFFER,Ce.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+pe,n.RENDERBUFFER,Ce.__webglColorRenderbuffer[pe]);let Be=i.get(C[pe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Ce.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+pe,n.TEXTURE_2D,Be,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ce.__webglMultisampledFramebuffer)}else if(R.depthBuffer&&R.resolveDepthBuffer===!1&&l){let C=R.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[C])}}}function Ie(R){return Math.min(r.maxSamples,R.samples)}function st(R){let C=i.get(R);return R.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&C.__useRenderToTexture!==!1}function qe(R){let C=s.render.frame;u.get(R)!==C&&(u.set(R,C),R.update())}function ft(R,C){let W=R.colorSpace,K=R.format,te=R.type;return R.isCompressedTexture===!0||R.isVideoTexture===!0||W!==bo&&W!==rr&&(At.getTransfer(W)===Lt?(K!==Ei||te!==To)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",W)),C}function kt(R){return typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement?(c.width=R.naturalWidth||R.width,c.height=R.naturalHeight||R.height):typeof VideoFrame<"u"&&R instanceof VideoFrame?(c.width=R.displayWidth,c.height=R.displayHeight):(c.width=R.width,c.height=R.height),c}this.allocateTextureUnit=L,this.resetTextureUnits=S,this.setTexture2D=N,this.setTexture2DArray=$,this.setTexture3D=Y,this.setTextureCube=Q,this.rebindTextures=ot,this.setupRenderTarget=Qe,this.updateRenderTargetMipmap=U,this.updateMultisampleRenderTarget=bt,this.setupDepthRenderbuffer=fe,this.setupFrameBufferTexture=X,this.useMultisampledRTT=st}function VB(n,e){function t(i,r=rr){let o,s=At.getTransfer(r);if(i===To)return n.UNSIGNED_BYTE;if(i===Vw)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Hw)return n.UNSIGNED_SHORT_5_5_5_1;if(i===EF)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===vF)return n.BYTE;if(i===_F)return n.SHORT;if(i===Uw)return n.UNSIGNED_SHORT;if(i===Bw)return n.INT;if(i===sl)return n.UNSIGNED_INT;if(i===_o)return n.FLOAT;if(i===Qh)return n.HALF_FLOAT;if(i===xF)return n.ALPHA;if(i===SF)return n.RGB;if(i===Ei)return n.RGBA;if(i===TF)return n.LUMINANCE;if(i===MF)return n.LUMINANCE_ALPHA;if(i===tl)return n.DEPTH_COMPONENT;if(i===lu)return n.DEPTH_STENCIL;if(i===CF)return n.RED;if(i===zw)return n.RED_INTEGER;if(i===wF)return n.RG;if(i===Gw)return n.RG_INTEGER;if(i===Ww)return n.RGBA_INTEGER;if(i===iv||i===rv||i===ov||i===sv)if(s===Lt)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(i===iv)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===rv)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===ov)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===sv)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(i===iv)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===rv)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===ov)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===sv)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===uC||i===dC||i===fC||i===hC)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(i===uC)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===dC)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===fC)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===hC)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===pC||i===mC||i===gC)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(i===pC||i===mC)return s===Lt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===gC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===yC||i===vC||i===_C||i===EC||i===xC||i===SC||i===TC||i===MC||i===CC||i===wC||i===bC||i===IC||i===AC||i===DC)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(i===yC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===vC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===_C)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===EC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===xC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===SC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===TC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===MC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===CC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===wC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===bC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===IC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===AC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===DC)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===av||i===RC||i===NC)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(i===av)return s===Lt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===RC)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===NC)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===bF||i===PC||i===LC||i===FC)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(i===av)return o.COMPRESSED_RED_RGTC1_EXT;if(i===PC)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===LC)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===FC)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===gu?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}var Kv=class extends xn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},or=class extends Vi{constructor(){super(),this.isGroup=!0,this.type="Group"}},HB={type:"move"},su=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new or,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new or,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new or,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,o=null,s=null,a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){s=!0;for(let _ of e.hand.values()){let y=t.getJointPose(_,i),g=this._getHandJoint(c,_);y!==null&&(g.matrix.fromArray(y.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=y.radius),g.visible=y!==null}let u=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],p=u.position.distanceTo(f.position),m=.02,v=.005;c.inputState.pinching&&p>m+v?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&p<=m-v&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&o!==null&&(r=o),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(HB)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=o!==null),c!==null&&(c.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new or;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},zB=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,GB=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,Qv=class{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){let r=new cr,o=e.properties.get(r);o.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}render(e,t){if(this.texture!==null){if(this.mesh===null){let i=t.cameras[0].viewport,r=new Si({vertexShader:zB,fragmentShader:GB,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new zt(new Co(20,20),r)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}},e_=class extends ar{constructor(e,t){super();let i=this,r=null,o=1,s=null,a="local-floor",l=1,c=null,u=null,f=null,p=null,m=null,v=null,_=new Qv,y=t.getContextAttributes(),g=null,T=null,x=[],M=[],D=new Ne,I=null,A=new xn;A.layers.enable(1),A.viewport=new pn;let k=new xn;k.layers.enable(2),k.viewport=new pn;let w=[A,k],S=new Kv;S.layers.enable(1),S.layers.enable(2);let L=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let ae=x[X];return ae===void 0&&(ae=new su,x[X]=ae),ae.getTargetRaySpace()},this.getControllerGrip=function(X){let ae=x[X];return ae===void 0&&(ae=new su,x[X]=ae),ae.getGripSpace()},this.getHand=function(X){let ae=x[X];return ae===void 0&&(ae=new su,x[X]=ae),ae.getHandSpace()};function N(X){let ae=M.indexOf(X.inputSource);if(ae===-1)return;let _e=x[ae];_e!==void 0&&(_e.update(X.inputSource,X.frame,c||s),_e.dispatchEvent({type:X.type,data:X.inputSource}))}function $(){r.removeEventListener("select",N),r.removeEventListener("selectstart",N),r.removeEventListener("selectend",N),r.removeEventListener("squeeze",N),r.removeEventListener("squeezestart",N),r.removeEventListener("squeezeend",N),r.removeEventListener("end",$),r.removeEventListener("inputsourceschange",Y);for(let X=0;X<x.length;X++){let ae=M[X];ae!==null&&(M[X]=null,x[X].disconnect(ae))}L=null,z=null,_.reset(),e.setRenderTarget(g),m=null,p=null,f=null,r=null,T=null,Ct.stop(),i.isPresenting=!1,e.setPixelRatio(I),e.setSize(D.width,D.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(X){o=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){a=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(X){c=X},this.getBaseLayer=function(){return p!==null?p:m},this.getBinding=function(){return f},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(X){if(r=X,r!==null){if(g=e.getRenderTarget(),r.addEventListener("select",N),r.addEventListener("selectstart",N),r.addEventListener("selectend",N),r.addEventListener("squeeze",N),r.addEventListener("squeezestart",N),r.addEventListener("squeezeend",N),r.addEventListener("end",$),r.addEventListener("inputsourceschange",Y),y.xrCompatible!==!0&&await t.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(D),r.renderState.layers===void 0){let ae={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(r,t,ae),r.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),T=new Vr(m.framebufferWidth,m.framebufferHeight,{format:Ei,type:To,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let ae=null,_e=null,fe=null;y.depth&&(fe=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ae=y.stencil?lu:tl,_e=y.stencil?gu:sl);let ot={colorFormat:t.RGBA8,depthFormat:fe,scaleFactor:o};f=new XRWebGLBinding(r,t),p=f.createProjectionLayer(ot),r.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),T=new Vr(p.textureWidth,p.textureHeight,{format:Ei,type:To,depthTexture:new Vh(p.textureWidth,p.textureHeight,_e,void 0,void 0,void 0,void 0,void 0,void 0,ae),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(l),c=null,s=await r.requestReferenceSpace(a),Ct.setContext(r),Ct.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function Y(X){for(let ae=0;ae<X.removed.length;ae++){let _e=X.removed[ae],fe=M.indexOf(_e);fe>=0&&(M[fe]=null,x[fe].disconnect(_e))}for(let ae=0;ae<X.added.length;ae++){let _e=X.added[ae],fe=M.indexOf(_e);if(fe===-1){for(let Qe=0;Qe<x.length;Qe++)if(Qe>=M.length){M.push(_e),fe=Qe;break}else if(M[Qe]===null){M[Qe]=_e,fe=Qe;break}if(fe===-1)break}let ot=x[fe];ot&&ot.connect(_e)}}let Q=new P,re=new P;function q(X,ae,_e){Q.setFromMatrixPosition(ae.matrixWorld),re.setFromMatrixPosition(_e.matrixWorld);let fe=Q.distanceTo(re),ot=ae.projectionMatrix.elements,Qe=_e.projectionMatrix.elements,U=ot[14]/(ot[10]-1),wt=ot[14]/(ot[10]+1),we=(ot[9]+1)/ot[5],bt=(ot[9]-1)/ot[5],Ie=(ot[8]-1)/ot[0],st=(Qe[8]+1)/Qe[0],qe=U*Ie,ft=U*st,kt=fe/(-Ie+st),R=kt*-Ie;ae.matrixWorld.decompose(X.position,X.quaternion,X.scale),X.translateX(R),X.translateZ(kt),X.matrixWorld.compose(X.position,X.quaternion,X.scale),X.matrixWorldInverse.copy(X.matrixWorld).invert();let C=U+kt,W=wt+kt,K=qe-R,te=ft+(fe-R),ne=we*wt/W*C,Ce=bt*wt/W*C;X.projectionMatrix.makePerspective(K,te,ne,Ce,C,W),X.projectionMatrixInverse.copy(X.projectionMatrix).invert()}function oe(X,ae){ae===null?X.matrixWorld.copy(X.matrix):X.matrixWorld.multiplyMatrices(ae.matrixWorld,X.matrix),X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(r===null)return;_.texture!==null&&(X.near=_.depthNear,X.far=_.depthFar),S.near=k.near=A.near=X.near,S.far=k.far=A.far=X.far,(L!==S.near||z!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),L=S.near,z=S.far,A.near=L,A.far=z,k.near=L,k.far=z,A.updateProjectionMatrix(),k.updateProjectionMatrix(),X.updateProjectionMatrix());let ae=X.parent,_e=S.cameras;oe(S,ae);for(let fe=0;fe<_e.length;fe++)oe(_e[fe],ae);_e.length===2?q(S,A,k):S.projectionMatrix.copy(A.projectionMatrix),ie(X,S,ae)};function ie(X,ae,_e){_e===null?X.matrix.copy(ae.matrixWorld):(X.matrix.copy(_e.matrixWorld),X.matrix.invert(),X.matrix.multiply(ae.matrixWorld)),X.matrix.decompose(X.position,X.quaternion,X.scale),X.updateMatrixWorld(!0),X.projectionMatrix.copy(ae.projectionMatrix),X.projectionMatrixInverse.copy(ae.projectionMatrixInverse),X.isPerspectiveCamera&&(X.fov=cu*2*Math.atan(1/X.projectionMatrix.elements[5]),X.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(p===null&&m===null))return l},this.setFoveation=function(X){l=X,p!==null&&(p.fixedFoveation=X),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=X)},this.hasDepthSensing=function(){return _.texture!==null};let xe=null;function rt(X,ae){if(u=ae.getViewerPose(c||s),v=ae,u!==null){let _e=u.views;m!==null&&(e.setRenderTargetFramebuffer(T,m.framebuffer),e.setRenderTarget(T));let fe=!1;_e.length!==S.cameras.length&&(S.cameras.length=0,fe=!0);for(let Qe=0;Qe<_e.length;Qe++){let U=_e[Qe],wt=null;if(m!==null)wt=m.getViewport(U);else{let bt=f.getViewSubImage(p,U);wt=bt.viewport,Qe===0&&(e.setRenderTargetTextures(T,bt.colorTexture,p.ignoreDepthValues?void 0:bt.depthStencilTexture),e.setRenderTarget(T))}let we=w[Qe];we===void 0&&(we=new xn,we.layers.enable(Qe),we.viewport=new pn,w[Qe]=we),we.matrix.fromArray(U.transform.matrix),we.matrix.decompose(we.position,we.quaternion,we.scale),we.projectionMatrix.fromArray(U.projectionMatrix),we.projectionMatrixInverse.copy(we.projectionMatrix).invert(),we.viewport.set(wt.x,wt.y,wt.width,wt.height),Qe===0&&(S.matrix.copy(we.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),fe===!0&&S.cameras.push(we)}let ot=r.enabledFeatures;if(ot&&ot.includes("depth-sensing")){let Qe=f.getDepthInformation(_e[0]);Qe&&Qe.isValid&&Qe.texture&&_.init(e,Qe,r.renderState)}}for(let _e=0;_e<x.length;_e++){let fe=M[_e],ot=x[_e];fe!==null&&ot!==void 0&&ot.update(fe,ae,c||s)}_.render(e,S),xe&&xe(X,ae),ae.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ae}),v=null}let Ct=new Jw;Ct.setAnimationLoop(rt),this.setAnimationLoop=function(X){xe=X},this.dispose=function(){}}},_s=new Mo,WB=new Ft;function qB(n,e){function t(y,g){y.matrixAutoUpdate===!0&&y.updateMatrix(),g.value.copy(y.matrix)}function i(y,g){g.color.getRGB(y.fogColor.value,Xw(n)),g.isFog?(y.fogNear.value=g.near,y.fogFar.value=g.far):g.isFogExp2&&(y.fogDensity.value=g.density)}function r(y,g,T,x,M){g.isMeshBasicMaterial||g.isMeshLambertMaterial?o(y,g):g.isMeshToonMaterial?(o(y,g),f(y,g)):g.isMeshPhongMaterial?(o(y,g),u(y,g)):g.isMeshStandardMaterial?(o(y,g),p(y,g),g.isMeshPhysicalMaterial&&m(y,g,M)):g.isMeshMatcapMaterial?(o(y,g),v(y,g)):g.isMeshDepthMaterial?o(y,g):g.isMeshDistanceMaterial?(o(y,g),_(y,g)):g.isMeshNormalMaterial?o(y,g):g.isLineBasicMaterial?(s(y,g),g.isLineDashedMaterial&&a(y,g)):g.isPointsMaterial?l(y,g,T,x):g.isSpriteMaterial?c(y,g):g.isShadowMaterial?(y.color.value.copy(g.color),y.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function o(y,g){y.opacity.value=g.opacity,g.color&&y.diffuse.value.copy(g.color),g.emissive&&y.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(y.map.value=g.map,t(g.map,y.mapTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.bumpMap&&(y.bumpMap.value=g.bumpMap,t(g.bumpMap,y.bumpMapTransform),y.bumpScale.value=g.bumpScale,g.side===$n&&(y.bumpScale.value*=-1)),g.normalMap&&(y.normalMap.value=g.normalMap,t(g.normalMap,y.normalMapTransform),y.normalScale.value.copy(g.normalScale),g.side===$n&&y.normalScale.value.negate()),g.displacementMap&&(y.displacementMap.value=g.displacementMap,t(g.displacementMap,y.displacementMapTransform),y.displacementScale.value=g.displacementScale,y.displacementBias.value=g.displacementBias),g.emissiveMap&&(y.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,y.emissiveMapTransform)),g.specularMap&&(y.specularMap.value=g.specularMap,t(g.specularMap,y.specularMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest);let T=e.get(g),x=T.envMap,M=T.envMapRotation;if(x&&(y.envMap.value=x,_s.copy(M),_s.x*=-1,_s.y*=-1,_s.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(_s.y*=-1,_s.z*=-1),y.envMapRotation.value.setFromMatrix4(WB.makeRotationFromEuler(_s)),y.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=g.reflectivity,y.ior.value=g.ior,y.refractionRatio.value=g.refractionRatio),g.lightMap){y.lightMap.value=g.lightMap;let D=n._useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=g.lightMapIntensity*D,t(g.lightMap,y.lightMapTransform)}g.aoMap&&(y.aoMap.value=g.aoMap,y.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,y.aoMapTransform))}function s(y,g){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,g.map&&(y.map.value=g.map,t(g.map,y.mapTransform))}function a(y,g){y.dashSize.value=g.dashSize,y.totalSize.value=g.dashSize+g.gapSize,y.scale.value=g.scale}function l(y,g,T,x){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,y.size.value=g.size*T,y.scale.value=x*.5,g.map&&(y.map.value=g.map,t(g.map,y.uvTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest)}function c(y,g){y.diffuse.value.copy(g.color),y.opacity.value=g.opacity,y.rotation.value=g.rotation,g.map&&(y.map.value=g.map,t(g.map,y.mapTransform)),g.alphaMap&&(y.alphaMap.value=g.alphaMap,t(g.alphaMap,y.alphaMapTransform)),g.alphaTest>0&&(y.alphaTest.value=g.alphaTest)}function u(y,g){y.specular.value.copy(g.specular),y.shininess.value=Math.max(g.shininess,1e-4)}function f(y,g){g.gradientMap&&(y.gradientMap.value=g.gradientMap)}function p(y,g){y.metalness.value=g.metalness,g.metalnessMap&&(y.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,y.metalnessMapTransform)),y.roughness.value=g.roughness,g.roughnessMap&&(y.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,y.roughnessMapTransform)),g.envMap&&(y.envMapIntensity.value=g.envMapIntensity)}function m(y,g,T){y.ior.value=g.ior,g.sheen>0&&(y.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),y.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(y.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,y.sheenColorMapTransform)),g.sheenRoughnessMap&&(y.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,y.sheenRoughnessMapTransform))),g.clearcoat>0&&(y.clearcoat.value=g.clearcoat,y.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(y.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,y.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(y.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===$n&&y.clearcoatNormalScale.value.negate())),g.dispersion>0&&(y.dispersion.value=g.dispersion),g.iridescence>0&&(y.iridescence.value=g.iridescence,y.iridescenceIOR.value=g.iridescenceIOR,y.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(y.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,y.iridescenceMapTransform)),g.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),g.transmission>0&&(y.transmission.value=g.transmission,y.transmissionSamplerMap.value=T.texture,y.transmissionSamplerSize.value.set(T.width,T.height),g.transmissionMap&&(y.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,y.transmissionMapTransform)),y.thickness.value=g.thickness,g.thicknessMap&&(y.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=g.attenuationDistance,y.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(y.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(y.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=g.specularIntensity,y.specularColor.value.copy(g.specularColor),g.specularColorMap&&(y.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,y.specularColorMapTransform)),g.specularIntensityMap&&(y.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,y.specularIntensityMapTransform))}function v(y,g){g.matcap&&(y.matcap.value=g.matcap)}function _(y,g){let T=e.get(g).light;y.referencePosition.value.setFromMatrixPosition(T.matrixWorld),y.nearDistance.value=T.shadow.camera.near,y.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function $B(n,e,t,i){let r={},o={},s=[],a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(T,x){let M=x.program;i.uniformBlockBinding(T,M)}function c(T,x){let M=r[T.id];M===void 0&&(v(T),M=u(T),r[T.id]=M,T.addEventListener("dispose",y));let D=x.program;i.updateUBOMapping(T,D);let I=e.render.frame;o[T.id]!==I&&(p(T),o[T.id]=I)}function u(T){let x=f();T.__bindingPointIndex=x;let M=n.createBuffer(),D=T.__size,I=T.usage;return n.bindBuffer(n.UNIFORM_BUFFER,M),n.bufferData(n.UNIFORM_BUFFER,D,I),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,x,M),M}function f(){for(let T=0;T<a;T++)if(s.indexOf(T)===-1)return s.push(T),T;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(T){let x=r[T.id],M=T.uniforms,D=T.__cache;n.bindBuffer(n.UNIFORM_BUFFER,x);for(let I=0,A=M.length;I<A;I++){let k=Array.isArray(M[I])?M[I]:[M[I]];for(let w=0,S=k.length;w<S;w++){let L=k[w];if(m(L,I,w,D)===!0){let z=L.__offset,N=Array.isArray(L.value)?L.value:[L.value],$=0;for(let Y=0;Y<N.length;Y++){let Q=N[Y],re=_(Q);typeof Q=="number"||typeof Q=="boolean"?(L.__data[0]=Q,n.bufferSubData(n.UNIFORM_BUFFER,z+$,L.__data)):Q.isMatrix3?(L.__data[0]=Q.elements[0],L.__data[1]=Q.elements[1],L.__data[2]=Q.elements[2],L.__data[3]=0,L.__data[4]=Q.elements[3],L.__data[5]=Q.elements[4],L.__data[6]=Q.elements[5],L.__data[7]=0,L.__data[8]=Q.elements[6],L.__data[9]=Q.elements[7],L.__data[10]=Q.elements[8],L.__data[11]=0):(Q.toArray(L.__data,$),$+=re.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,z,L.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(T,x,M,D){let I=T.value,A=x+"_"+M;if(D[A]===void 0)return typeof I=="number"||typeof I=="boolean"?D[A]=I:D[A]=I.clone(),!0;{let k=D[A];if(typeof I=="number"||typeof I=="boolean"){if(k!==I)return D[A]=I,!0}else if(k.equals(I)===!1)return k.copy(I),!0}return!1}function v(T){let x=T.uniforms,M=0,D=16;for(let A=0,k=x.length;A<k;A++){let w=Array.isArray(x[A])?x[A]:[x[A]];for(let S=0,L=w.length;S<L;S++){let z=w[S],N=Array.isArray(z.value)?z.value:[z.value];for(let $=0,Y=N.length;$<Y;$++){let Q=N[$],re=_(Q),q=M%D;q!==0&&D-q<re.boundary&&(M+=D-q),z.__data=new Float32Array(re.storage/Float32Array.BYTES_PER_ELEMENT),z.__offset=M,M+=re.storage}}}let I=M%D;return I>0&&(M+=D-I),T.__size=M,T.__cache={},this}function _(T){let x={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(x.boundary=4,x.storage=4):T.isVector2?(x.boundary=8,x.storage=8):T.isVector3||T.isColor?(x.boundary=16,x.storage=12):T.isVector4?(x.boundary=16,x.storage=16):T.isMatrix3?(x.boundary=48,x.storage=48):T.isMatrix4?(x.boundary=64,x.storage=64):T.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",T),x}function y(T){let x=T.target;x.removeEventListener("dispose",y);let M=s.indexOf(x.__bindingPointIndex);s.splice(M,1),n.deleteBuffer(r[x.id]),delete r[x.id],delete o[x.id]}function g(){for(let T in r)n.deleteBuffer(r[T]);s=[],r={},o={}}return{bind:l,update:c,dispose:g}}var dl=class{constructor(e={}){let{canvas:t=eO(),context:i=null,depth:r=!0,stencil:o=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:f=!1}=e;this.isWebGLRenderer=!0;let p;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=s;let m=new Uint32Array(4),v=new Int32Array(4),_=null,y=null,g=[],T=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=An,this._useLegacyLights=!1,this.toneMapping=xo,this.toneMappingExposure=1;let x=this,M=!1,D=0,I=0,A=null,k=-1,w=null,S=new pn,L=new pn,z=null,N=new ke(0),$=0,Y=t.width,Q=t.height,re=1,q=null,oe=null,ie=new pn(0,0,Y,Q),xe=new pn(0,0,Y,Q),rt=!1,Ct=new fu,X=!1,ae=!1,_e=new Ft,fe=new P,ot={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Qe(){return A===null?re:1}let U=i;function wt(b,O){return t.getContext(b,O)}try{let b={alpha:!0,depth:r,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r164"),t.addEventListener("webglcontextlost",E,!1),t.addEventListener("webglcontextrestored",F,!1),t.addEventListener("webglcontextcreationerror",B,!1),U===null){let O="webgl2";if(U=wt(O,b),U===null)throw wt(O)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(b){throw console.error("THREE.WebGLRenderer: "+b.message),b}let we,bt,Ie,st,qe,ft,kt,R,C,W,K,te,ne,Ce,me,pe,Be,ce,Me,ht,be,ve,$e,et;function It(){we=new d2(U),we.init(),ve=new VB(U,we),bt=new o2(U,we,e,ve),Ie=new UB(U),st=new p2(U),qe=new wB,ft=new BB(U,we,Ie,qe,bt,ve,st),kt=new a2(x),R=new u2(x),C=new xO(U),$e=new i2(U,C),W=new f2(U,C,st,$e),K=new g2(U,W,C,st),Me=new m2(U,bt,ft),pe=new s2(qe),te=new CB(x,kt,R,we,bt,$e,pe),ne=new qB(x,qe),Ce=new IB,me=new LB(we),ce=new n2(x,kt,R,Ie,K,p,l),Be=new kB(x,K,bt),et=new $B(U,st,bt,Ie),ht=new r2(U,we,st),be=new h2(U,we,st),st.programs=te.programs,x.capabilities=bt,x.extensions=we,x.properties=qe,x.renderLists=Ce,x.shadowMap=Be,x.state=Ie,x.info=st}It();let Je=new e_(x,U);this.xr=Je,this.getContext=function(){return U},this.getContextAttributes=function(){return U.getContextAttributes()},this.forceContextLoss=function(){let b=we.get("WEBGL_lose_context");b&&b.loseContext()},this.forceContextRestore=function(){let b=we.get("WEBGL_lose_context");b&&b.restoreContext()},this.getPixelRatio=function(){return re},this.setPixelRatio=function(b){b!==void 0&&(re=b,this.setSize(Y,Q,!1))},this.getSize=function(b){return b.set(Y,Q)},this.setSize=function(b,O,G=!0){if(Je.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=b,Q=O,t.width=Math.floor(b*re),t.height=Math.floor(O*re),G===!0&&(t.style.width=b+"px",t.style.height=O+"px"),this.setViewport(0,0,b,O)},this.getDrawingBufferSize=function(b){return b.set(Y*re,Q*re).floor()},this.setDrawingBufferSize=function(b,O,G){Y=b,Q=O,re=G,t.width=Math.floor(b*G),t.height=Math.floor(O*G),this.setViewport(0,0,b,O)},this.getCurrentViewport=function(b){return b.copy(S)},this.getViewport=function(b){return b.copy(ie)},this.setViewport=function(b,O,G,V){b.isVector4?ie.set(b.x,b.y,b.z,b.w):ie.set(b,O,G,V),Ie.viewport(S.copy(ie).multiplyScalar(re).round())},this.getScissor=function(b){return b.copy(xe)},this.setScissor=function(b,O,G,V){b.isVector4?xe.set(b.x,b.y,b.z,b.w):xe.set(b,O,G,V),Ie.scissor(L.copy(xe).multiplyScalar(re).round())},this.getScissorTest=function(){return rt},this.setScissorTest=function(b){Ie.setScissorTest(rt=b)},this.setOpaqueSort=function(b){q=b},this.setTransparentSort=function(b){oe=b},this.getClearColor=function(b){return b.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(b=!0,O=!0,G=!0){let V=0;if(b){let H=!1;if(A!==null){let ye=A.texture.format;H=ye===Ww||ye===Gw||ye===zw}if(H){let ye=A.texture.type,Ee=ye===To||ye===sl||ye===Uw||ye===gu||ye===Vw||ye===Hw,Se=ce.getClearColor(),Re=ce.getClearAlpha(),ze=Se.r,je=Se.g,nt=Se.b;Ee?(m[0]=ze,m[1]=je,m[2]=nt,m[3]=Re,U.clearBufferuiv(U.COLOR,0,m)):(v[0]=ze,v[1]=je,v[2]=nt,v[3]=Re,U.clearBufferiv(U.COLOR,0,v))}else V|=U.COLOR_BUFFER_BIT}O&&(V|=U.DEPTH_BUFFER_BIT),G&&(V|=U.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),U.clear(V)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",E,!1),t.removeEventListener("webglcontextrestored",F,!1),t.removeEventListener("webglcontextcreationerror",B,!1),Ce.dispose(),me.dispose(),qe.dispose(),kt.dispose(),R.dispose(),K.dispose(),$e.dispose(),et.dispose(),te.dispose(),Je.dispose(),Je.removeEventListener("sessionstart",_t),Je.removeEventListener("sessionend",qt),Pt.stop()};function E(b){b.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function F(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;let b=st.autoReset,O=Be.enabled,G=Be.autoUpdate,V=Be.needsUpdate,H=Be.type;It(),st.autoReset=b,Be.enabled=O,Be.autoUpdate=G,Be.needsUpdate=V,Be.type=H}function B(b){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",b.statusMessage)}function ee(b){let O=b.target;O.removeEventListener("dispose",ee),le(O)}function le(b){Ye(b),qe.remove(b)}function Ye(b){let O=qe.get(b).programs;O!==void 0&&(O.forEach(function(G){te.releaseProgram(G)}),b.isShaderMaterial&&te.releaseShaderCache(b))}this.renderBufferDirect=function(b,O,G,V,H,ye){O===null&&(O=ot);let Ee=H.isMesh&&H.matrixWorld.determinant()<0,Se=cI(b,O,G,V,H);Ie.setMaterial(V,Ee);let Re=G.index,ze=1;if(V.wireframe===!0){if(Re=W.getWireframeAttribute(G),Re===void 0)return;ze=2}let je=G.drawRange,nt=G.attributes.position,$t=je.start*ze,Sn=(je.start+je.count)*ze;ye!==null&&($t=Math.max($t,ye.start*ze),Sn=Math.min(Sn,(ye.start+ye.count)*ze)),Re!==null?($t=Math.max($t,0),Sn=Math.min(Sn,Re.count)):nt!=null&&($t=Math.max($t,0),Sn=Math.min(Sn,nt.count));let Yn=Sn-$t;if(Yn<0||Yn===1/0)return;$e.setup(H,V,Se,G,Re);let dr,St=ht;if(Re!==null&&(dr=C.get(Re),St=be,St.setIndex(dr)),H.isMesh)V.wireframe===!0?(Ie.setLineWidth(V.wireframeLinewidth*Qe()),St.setMode(U.LINES)):St.setMode(U.TRIANGLES);else if(H.isLine){let Ge=V.linewidth;Ge===void 0&&(Ge=1),Ie.setLineWidth(Ge*Qe()),H.isLineSegments?St.setMode(U.LINES):H.isLineLoop?St.setMode(U.LINE_LOOP):St.setMode(U.LINE_STRIP)}else H.isPoints?St.setMode(U.POINTS):H.isSprite&&St.setMode(U.TRIANGLES);if(H.isBatchedMesh)H._multiDrawInstances!==null?St.renderMultiDrawInstances(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount,H._multiDrawInstances):St.renderMultiDraw(H._multiDrawStarts,H._multiDrawCounts,H._multiDrawCount);else if(H.isInstancedMesh)St.renderInstances($t,Yn,H.count);else if(G.isInstancedBufferGeometry){let Ge=G._maxInstanceCount!==void 0?G._maxInstanceCount:1/0,Rl=Math.min(G.instanceCount,Ge);St.renderInstances($t,Yn,Rl)}else St.render($t,Yn)};function tt(b,O,G){b.transparent===!0&&b.side===Bi&&b.forceSinglePass===!1?(b.side=$n,b.needsUpdate=!0,Tu(b,O,G),b.side=So,b.needsUpdate=!0,Tu(b,O,G),b.side=Bi):Tu(b,O,G)}this.compile=function(b,O,G=null){G===null&&(G=b),y=me.get(G),y.init(O),T.push(y),G.traverseVisible(function(H){H.isLight&&H.layers.test(O.layers)&&(y.pushLight(H),H.castShadow&&y.pushShadow(H))}),b!==G&&b.traverseVisible(function(H){H.isLight&&H.layers.test(O.layers)&&(y.pushLight(H),H.castShadow&&y.pushShadow(H))}),y.setupLights(x._useLegacyLights);let V=new Set;return b.traverse(function(H){let ye=H.material;if(ye)if(Array.isArray(ye))for(let Ee=0;Ee<ye.length;Ee++){let Se=ye[Ee];tt(Se,G,H),V.add(Se)}else tt(ye,G,H),V.add(ye)}),T.pop(),y=null,V},this.compileAsync=function(b,O,G=null){let V=this.compile(b,O,G);return new Promise(H=>{function ye(){if(V.forEach(function(Ee){qe.get(Ee).currentProgram.isReady()&&V.delete(Ee)}),V.size===0){H(b);return}setTimeout(ye,10)}we.get("KHR_parallel_shader_compile")!==null?ye():setTimeout(ye,10)})};let Vt=null;function an(b){Vt&&Vt(b)}function _t(){Pt.stop()}function qt(){Pt.start()}let Pt=new Jw;Pt.setAnimationLoop(an),typeof self<"u"&&Pt.setContext(self),this.setAnimationLoop=function(b){Vt=b,Je.setAnimationLoop(b),b===null?Pt.stop():Pt.start()},Je.addEventListener("sessionstart",_t),Je.addEventListener("sessionend",qt),this.render=function(b,O){if(O!==void 0&&O.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;b.matrixWorldAutoUpdate===!0&&b.updateMatrixWorld(),O.parent===null&&O.matrixWorldAutoUpdate===!0&&O.updateMatrixWorld(),Je.enabled===!0&&Je.isPresenting===!0&&(Je.cameraAutoUpdate===!0&&Je.updateCamera(O),O=Je.getCamera()),b.isScene===!0&&b.onBeforeRender(x,b,O,A),y=me.get(b,T.length),y.init(O),T.push(y),_e.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),Ct.setFromProjectionMatrix(_e),ae=this.localClippingEnabled,X=pe.init(this.clippingPlanes,ae),_=Ce.get(b,g.length),_.init(),g.push(_),qr(b,O,0,x.sortObjects),_.finish(),x.sortObjects===!0&&_.sort(q,oe);let G=Je.enabled===!1||Je.isPresenting===!1||Je.hasDepthSensing()===!1;G&&ce.addToRenderList(_,b),this.info.render.frame++,X===!0&&pe.beginShadows();let V=y.state.shadowsArray;Be.render(V,b,O),X===!0&&pe.endShadows(),this.info.autoReset===!0&&this.info.reset();let H=_.opaque,ye=_.transmissive;if(y.setupLights(x._useLegacyLights),O.isArrayCamera){let Ee=O.cameras;if(ye.length>0)for(let Se=0,Re=Ee.length;Se<Re;Se++){let ze=Ee[Se];$r(H,ye,b,ze)}G&&ce.render(b);for(let Se=0,Re=Ee.length;Se<Re;Se++){let ze=Ee[Se];li(_,b,ze,ze.viewport)}}else ye.length>0&&$r(H,ye,b,O),G&&ce.render(b),li(_,b,O);A!==null&&(ft.updateMultisampleRenderTarget(A),ft.updateRenderTargetMipmap(A)),b.isScene===!0&&b.onAfterRender(x,b,O),$e.resetDefaultState(),k=-1,w=null,T.pop(),T.length>0?(y=T[T.length-1],X===!0&&pe.setGlobalState(x.clippingPlanes,y.state.camera)):y=null,g.pop(),g.length>0?_=g[g.length-1]:_=null};function qr(b,O,G,V){if(b.visible===!1)return;if(b.layers.test(O.layers)){if(b.isGroup)G=b.renderOrder;else if(b.isLOD)b.autoUpdate===!0&&b.update(O);else if(b.isLight)y.pushLight(b),b.castShadow&&y.pushShadow(b);else if(b.isSprite){if(!b.frustumCulled||Ct.intersectsSprite(b)){V&&fe.setFromMatrixPosition(b.matrixWorld).applyMatrix4(_e);let Ee=K.update(b),Se=b.material;Se.visible&&_.push(b,Ee,Se,G,fe.z,null)}}else if((b.isMesh||b.isLine||b.isPoints)&&(!b.frustumCulled||Ct.intersectsObject(b))){let Ee=K.update(b),Se=b.material;if(V&&(b.boundingSphere!==void 0?(b.boundingSphere===null&&b.computeBoundingSphere(),fe.copy(b.boundingSphere.center)):(Ee.boundingSphere===null&&Ee.computeBoundingSphere(),fe.copy(Ee.boundingSphere.center)),fe.applyMatrix4(b.matrixWorld).applyMatrix4(_e)),Array.isArray(Se)){let Re=Ee.groups;for(let ze=0,je=Re.length;ze<je;ze++){let nt=Re[ze],$t=Se[nt.materialIndex];$t&&$t.visible&&_.push(b,Ee,$t,G,fe.z,nt)}}else Se.visible&&_.push(b,Ee,Se,G,fe.z,null)}}let ye=b.children;for(let Ee=0,Se=ye.length;Ee<Se;Ee++)qr(ye[Ee],O,G,V)}function li(b,O,G,V){let H=b.opaque,ye=b.transmissive,Ee=b.transparent;y.setupLightsView(G),X===!0&&pe.setGlobalState(x.clippingPlanes,G),V&&Ie.viewport(S.copy(V)),H.length>0&&ur(H,O,G),ye.length>0&&ur(ye,O,G),Ee.length>0&&ur(Ee,O,G),Ie.buffers.depth.setTest(!0),Ie.buffers.depth.setMask(!0),Ie.buffers.color.setMask(!0),Ie.setPolygonOffset(!1)}function $r(b,O,G,V){if((G.isScene===!0?G.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[V.id]===void 0&&(y.state.transmissionRenderTarget[V.id]=new Vr(1,1,{generateMipmaps:!0,type:we.has("EXT_color_buffer_half_float")||we.has("EXT_color_buffer_float")?Qh:To,minFilter:_i,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));let ye=y.state.transmissionRenderTarget[V.id],Ee=V.viewport||S;ye.setSize(Ee.z,Ee.w);let Se=x.getRenderTarget();x.setRenderTarget(ye),x.getClearColor(N),$=x.getClearAlpha(),$<1&&x.setClearColor(16777215,.5),x.clear();let Re=x.toneMapping;x.toneMapping=xo;let ze=V.viewport;if(V.viewport!==void 0&&(V.viewport=void 0),y.setupLightsView(V),X===!0&&pe.setGlobalState(x.clippingPlanes,V),ur(b,G,V),ft.updateMultisampleRenderTarget(ye),ft.updateRenderTargetMipmap(ye),we.has("WEBGL_multisampled_render_to_texture")===!1){let je=!1;for(let nt=0,$t=O.length;nt<$t;nt++){let Sn=O[nt],Yn=Sn.object,dr=Sn.geometry,St=Sn.material,Ge=Sn.group;if(St.side===Bi&&Yn.layers.test(V.layers)){let Rl=St.side;St.side=$n,St.needsUpdate=!0,Dl(Yn,G,V,dr,St,Ge),St.side=Rl,St.needsUpdate=!0,je=!0}}je===!0&&(ft.updateMultisampleRenderTarget(ye),ft.updateRenderTargetMipmap(ye))}x.setRenderTarget(Se),x.setClearColor(N,$),ze!==void 0&&(V.viewport=ze),x.toneMapping=Re}function ur(b,O,G){let V=O.isScene===!0?O.overrideMaterial:null;for(let H=0,ye=b.length;H<ye;H++){let Ee=b[H],Se=Ee.object,Re=Ee.geometry,ze=V===null?Ee.material:V,je=Ee.group;Se.layers.test(G.layers)&&Dl(Se,O,G,Re,ze,je)}}function Dl(b,O,G,V,H,ye){b.onBeforeRender(x,O,G,V,H,ye),b.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,b.matrixWorld),b.normalMatrix.getNormalMatrix(b.modelViewMatrix),H.onBeforeRender(x,O,G,V,b,ye),H.transparent===!0&&H.side===Bi&&H.forceSinglePass===!1?(H.side=$n,H.needsUpdate=!0,x.renderBufferDirect(G,O,V,H,b,ye),H.side=So,H.needsUpdate=!0,x.renderBufferDirect(G,O,V,H,b,ye),H.side=Bi):x.renderBufferDirect(G,O,V,H,b,ye),b.onAfterRender(x,O,G,V,H,ye)}function Tu(b,O,G){O.isScene!==!0&&(O=ot);let V=qe.get(b),H=y.state.lights,ye=y.state.shadowsArray,Ee=H.state.version,Se=te.getParameters(b,H.state,ye,O,G),Re=te.getProgramCacheKey(Se),ze=V.programs;V.environment=b.isMeshStandardMaterial?O.environment:null,V.fog=O.fog,V.envMap=(b.isMeshStandardMaterial?R:kt).get(b.envMap||V.environment),V.envMapRotation=V.environment!==null&&b.envMap===null?O.environmentRotation:b.envMapRotation,ze===void 0&&(b.addEventListener("dispose",ee),ze=new Map,V.programs=ze);let je=ze.get(Re);if(je!==void 0){if(V.currentProgram===je&&V.lightsStateVersion===Ee)return z0(b,Se),je}else Se.uniforms=te.getUniforms(b),b.onBuild(G,Se,x),b.onBeforeCompile(Se,x),je=te.acquireProgram(Se,Re),ze.set(Re,je),V.uniforms=Se.uniforms;let nt=V.uniforms;return(!b.isShaderMaterial&&!b.isRawShaderMaterial||b.clipping===!0)&&(nt.clippingPlanes=pe.uniform),z0(b,Se),V.needsLights=dI(b),V.lightsStateVersion=Ee,V.needsLights&&(nt.ambientLightColor.value=H.state.ambient,nt.lightProbe.value=H.state.probe,nt.directionalLights.value=H.state.directional,nt.directionalLightShadows.value=H.state.directionalShadow,nt.spotLights.value=H.state.spot,nt.spotLightShadows.value=H.state.spotShadow,nt.rectAreaLights.value=H.state.rectArea,nt.ltc_1.value=H.state.rectAreaLTC1,nt.ltc_2.value=H.state.rectAreaLTC2,nt.pointLights.value=H.state.point,nt.pointLightShadows.value=H.state.pointShadow,nt.hemisphereLights.value=H.state.hemi,nt.directionalShadowMap.value=H.state.directionalShadowMap,nt.directionalShadowMatrix.value=H.state.directionalShadowMatrix,nt.spotShadowMap.value=H.state.spotShadowMap,nt.spotLightMatrix.value=H.state.spotLightMatrix,nt.spotLightMap.value=H.state.spotLightMap,nt.pointShadowMap.value=H.state.pointShadowMap,nt.pointShadowMatrix.value=H.state.pointShadowMatrix),V.currentProgram=je,V.uniformsList=null,je}function H0(b){if(b.uniformsList===null){let O=b.currentProgram.getUniforms();b.uniformsList=il.seqWithValue(O.seq,b.uniforms)}return b.uniformsList}function z0(b,O){let G=qe.get(b);G.outputColorSpace=O.outputColorSpace,G.batching=O.batching,G.instancing=O.instancing,G.instancingColor=O.instancingColor,G.instancingMorph=O.instancingMorph,G.skinning=O.skinning,G.morphTargets=O.morphTargets,G.morphNormals=O.morphNormals,G.morphColors=O.morphColors,G.morphTargetsCount=O.morphTargetsCount,G.numClippingPlanes=O.numClippingPlanes,G.numIntersection=O.numClipIntersection,G.vertexAlphas=O.vertexAlphas,G.vertexTangents=O.vertexTangents,G.toneMapping=O.toneMapping}function cI(b,O,G,V,H){O.isScene!==!0&&(O=ot),ft.resetTextureUnits();let ye=O.fog,Ee=V.isMeshStandardMaterial?O.environment:null,Se=A===null?x.outputColorSpace:A.isXRRenderTarget===!0?A.texture.colorSpace:bo,Re=(V.isMeshStandardMaterial?R:kt).get(V.envMap||Ee),ze=V.vertexColors===!0&&!!G.attributes.color&&G.attributes.color.itemSize===4,je=!!G.attributes.tangent&&(!!V.normalMap||V.anisotropy>0),nt=!!G.morphAttributes.position,$t=!!G.morphAttributes.normal,Sn=!!G.morphAttributes.color,Yn=xo;V.toneMapped&&(A===null||A.isXRRenderTarget===!0)&&(Yn=x.toneMapping);let dr=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,St=dr!==void 0?dr.length:0,Ge=qe.get(V),Rl=y.state.lights;if(X===!0&&(ae===!0||b!==w)){let ci=b===w&&V.id===k;pe.setState(V,b,ci)}let Ut=!1;V.version===Ge.__version?(Ge.needsLights&&Ge.lightsStateVersion!==Rl.state.version||Ge.outputColorSpace!==Se||H.isBatchedMesh&&Ge.batching===!1||!H.isBatchedMesh&&Ge.batching===!0||H.isInstancedMesh&&Ge.instancing===!1||!H.isInstancedMesh&&Ge.instancing===!0||H.isSkinnedMesh&&Ge.skinning===!1||!H.isSkinnedMesh&&Ge.skinning===!0||H.isInstancedMesh&&Ge.instancingColor===!0&&H.instanceColor===null||H.isInstancedMesh&&Ge.instancingColor===!1&&H.instanceColor!==null||H.isInstancedMesh&&Ge.instancingMorph===!0&&H.morphTexture===null||H.isInstancedMesh&&Ge.instancingMorph===!1&&H.morphTexture!==null||Ge.envMap!==Re||V.fog===!0&&Ge.fog!==ye||Ge.numClippingPlanes!==void 0&&(Ge.numClippingPlanes!==pe.numPlanes||Ge.numIntersection!==pe.numIntersection)||Ge.vertexAlphas!==ze||Ge.vertexTangents!==je||Ge.morphTargets!==nt||Ge.morphNormals!==$t||Ge.morphColors!==Sn||Ge.toneMapping!==Yn||Ge.morphTargetsCount!==St)&&(Ut=!0):(Ut=!0,Ge.__version=V.version);let Do=Ge.currentProgram;Ut===!0&&(Do=Tu(V,O,H));let G0=!1,Nl=!1,Np=!1,Tn=Do.getUniforms(),Yr=Ge.uniforms;if(Ie.useProgram(Do.program)&&(G0=!0,Nl=!0,Np=!0),V.id!==k&&(k=V.id,Nl=!0),G0||w!==b){Tn.setValue(U,"projectionMatrix",b.projectionMatrix),Tn.setValue(U,"viewMatrix",b.matrixWorldInverse);let ci=Tn.map.cameraPosition;ci!==void 0&&ci.setValue(U,fe.setFromMatrixPosition(b.matrixWorld)),bt.logarithmicDepthBuffer&&Tn.setValue(U,"logDepthBufFC",2/(Math.log(b.far+1)/Math.LN2)),(V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshLambertMaterial||V.isMeshBasicMaterial||V.isMeshStandardMaterial||V.isShaderMaterial)&&Tn.setValue(U,"isOrthographic",b.isOrthographicCamera===!0),w!==b&&(w=b,Nl=!0,Np=!0)}if(H.isSkinnedMesh){Tn.setOptional(U,H,"bindMatrix"),Tn.setOptional(U,H,"bindMatrixInverse");let ci=H.skeleton;ci&&(ci.boneTexture===null&&ci.computeBoneTexture(),Tn.setValue(U,"boneTexture",ci.boneTexture,ft))}H.isBatchedMesh&&(Tn.setOptional(U,H,"batchingTexture"),Tn.setValue(U,"batchingTexture",H._matricesTexture,ft));let Pp=G.morphAttributes;if((Pp.position!==void 0||Pp.normal!==void 0||Pp.color!==void 0)&&Me.update(H,G,Do),(Nl||Ge.receiveShadow!==H.receiveShadow)&&(Ge.receiveShadow=H.receiveShadow,Tn.setValue(U,"receiveShadow",H.receiveShadow)),V.isMeshGouraudMaterial&&V.envMap!==null&&(Yr.envMap.value=Re,Yr.flipEnvMap.value=Re.isCubeTexture&&Re.isRenderTargetTexture===!1?-1:1),V.isMeshStandardMaterial&&V.envMap===null&&O.environment!==null&&(Yr.envMapIntensity.value=O.environmentIntensity),Nl&&(Tn.setValue(U,"toneMappingExposure",x.toneMappingExposure),Ge.needsLights&&uI(Yr,Np),ye&&V.fog===!0&&ne.refreshFogUniforms(Yr,ye),ne.refreshMaterialUniforms(Yr,V,re,Q,y.state.transmissionRenderTarget[b.id]),il.upload(U,H0(Ge),Yr,ft)),V.isShaderMaterial&&V.uniformsNeedUpdate===!0&&(il.upload(U,H0(Ge),Yr,ft),V.uniformsNeedUpdate=!1),V.isSpriteMaterial&&Tn.setValue(U,"center",H.center),Tn.setValue(U,"modelViewMatrix",H.modelViewMatrix),Tn.setValue(U,"normalMatrix",H.normalMatrix),Tn.setValue(U,"modelMatrix",H.matrixWorld),V.isShaderMaterial||V.isRawShaderMaterial){let ci=V.uniformsGroups;for(let Lp=0,fI=ci.length;Lp<fI;Lp++){let W0=ci[Lp];et.update(W0,Do),et.bind(W0,Do)}}return Do}function uI(b,O){b.ambientLightColor.needsUpdate=O,b.lightProbe.needsUpdate=O,b.directionalLights.needsUpdate=O,b.directionalLightShadows.needsUpdate=O,b.pointLights.needsUpdate=O,b.pointLightShadows.needsUpdate=O,b.spotLights.needsUpdate=O,b.spotLightShadows.needsUpdate=O,b.rectAreaLights.needsUpdate=O,b.hemisphereLights.needsUpdate=O}function dI(b){return b.isMeshLambertMaterial||b.isMeshToonMaterial||b.isMeshPhongMaterial||b.isMeshStandardMaterial||b.isShadowMaterial||b.isShaderMaterial&&b.lights===!0}this.getActiveCubeFace=function(){return D},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(b,O,G){qe.get(b.texture).__webglTexture=O,qe.get(b.depthTexture).__webglTexture=G;let V=qe.get(b);V.__hasExternalTextures=!0,V.__autoAllocateDepthBuffer=G===void 0,V.__autoAllocateDepthBuffer||we.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),V.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(b,O){let G=qe.get(b);G.__webglFramebuffer=O,G.__useDefaultFramebuffer=O===void 0},this.setRenderTarget=function(b,O=0,G=0){A=b,D=O,I=G;let V=!0,H=null,ye=!1,Ee=!1;if(b){let Re=qe.get(b);Re.__useDefaultFramebuffer!==void 0?(Ie.bindFramebuffer(U.FRAMEBUFFER,null),V=!1):Re.__webglFramebuffer===void 0?ft.setupRenderTarget(b):Re.__hasExternalTextures&&ft.rebindTextures(b,qe.get(b.texture).__webglTexture,qe.get(b.depthTexture).__webglTexture);let ze=b.texture;(ze.isData3DTexture||ze.isDataArrayTexture||ze.isCompressedArrayTexture)&&(Ee=!0);let je=qe.get(b).__webglFramebuffer;b.isWebGLCubeRenderTarget?(Array.isArray(je[O])?H=je[O][G]:H=je[O],ye=!0):b.samples>0&&ft.useMultisampledRTT(b)===!1?H=qe.get(b).__webglMultisampledFramebuffer:Array.isArray(je)?H=je[G]:H=je,S.copy(b.viewport),L.copy(b.scissor),z=b.scissorTest}else S.copy(ie).multiplyScalar(re).floor(),L.copy(xe).multiplyScalar(re).floor(),z=rt;if(Ie.bindFramebuffer(U.FRAMEBUFFER,H)&&V&&Ie.drawBuffers(b,H),Ie.viewport(S),Ie.scissor(L),Ie.setScissorTest(z),ye){let Re=qe.get(b.texture);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_CUBE_MAP_POSITIVE_X+O,Re.__webglTexture,G)}else if(Ee){let Re=qe.get(b.texture),ze=O||0;U.framebufferTextureLayer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,Re.__webglTexture,G||0,ze)}k=-1},this.readRenderTargetPixels=function(b,O,G,V,H,ye,Ee){if(!(b&&b.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Se=qe.get(b).__webglFramebuffer;if(b.isWebGLCubeRenderTarget&&Ee!==void 0&&(Se=Se[Ee]),Se){Ie.bindFramebuffer(U.FRAMEBUFFER,Se);try{let Re=b.texture,ze=Re.format,je=Re.type;if(!bt.textureFormatReadable(ze)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!bt.textureTypeReadable(je)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}O>=0&&O<=b.width-V&&G>=0&&G<=b.height-H&&U.readPixels(O,G,V,H,ve.convert(ze),ve.convert(je),ye)}finally{let Re=A!==null?qe.get(A).__webglFramebuffer:null;Ie.bindFramebuffer(U.FRAMEBUFFER,Re)}}},this.copyFramebufferToTexture=function(b,O,G=0){let V=Math.pow(2,-G),H=Math.floor(O.image.width*V),ye=Math.floor(O.image.height*V);ft.setTexture2D(O,0),U.copyTexSubImage2D(U.TEXTURE_2D,G,0,0,b.x,b.y,H,ye),Ie.unbindTexture()},this.copyTextureToTexture=function(b,O,G,V=0){let H=O.image.width,ye=O.image.height,Ee=ve.convert(G.format),Se=ve.convert(G.type);ft.setTexture2D(G,0),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,G.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,G.unpackAlignment),O.isDataTexture?U.texSubImage2D(U.TEXTURE_2D,V,b.x,b.y,H,ye,Ee,Se,O.image.data):O.isCompressedTexture?U.compressedTexSubImage2D(U.TEXTURE_2D,V,b.x,b.y,O.mipmaps[0].width,O.mipmaps[0].height,Ee,O.mipmaps[0].data):U.texSubImage2D(U.TEXTURE_2D,V,b.x,b.y,Ee,Se,O.image),V===0&&G.generateMipmaps&&U.generateMipmap(U.TEXTURE_2D),Ie.unbindTexture()},this.copyTextureToTexture3D=function(b,O,G,V,H=0){let ye=b.max.x-b.min.x,Ee=b.max.y-b.min.y,Se=b.max.z-b.min.z,Re=ve.convert(V.format),ze=ve.convert(V.type),je;if(V.isData3DTexture)ft.setTexture3D(V,0),je=U.TEXTURE_3D;else if(V.isDataArrayTexture||V.isCompressedArrayTexture)ft.setTexture2DArray(V,0),je=U.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,V.flipY),U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),U.pixelStorei(U.UNPACK_ALIGNMENT,V.unpackAlignment);let nt=U.getParameter(U.UNPACK_ROW_LENGTH),$t=U.getParameter(U.UNPACK_IMAGE_HEIGHT),Sn=U.getParameter(U.UNPACK_SKIP_PIXELS),Yn=U.getParameter(U.UNPACK_SKIP_ROWS),dr=U.getParameter(U.UNPACK_SKIP_IMAGES),St=G.isCompressedTexture?G.mipmaps[H]:G.image;U.pixelStorei(U.UNPACK_ROW_LENGTH,St.width),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,St.height),U.pixelStorei(U.UNPACK_SKIP_PIXELS,b.min.x),U.pixelStorei(U.UNPACK_SKIP_ROWS,b.min.y),U.pixelStorei(U.UNPACK_SKIP_IMAGES,b.min.z),G.isDataTexture||G.isData3DTexture?U.texSubImage3D(je,H,O.x,O.y,O.z,ye,Ee,Se,Re,ze,St.data):V.isCompressedArrayTexture?U.compressedTexSubImage3D(je,H,O.x,O.y,O.z,ye,Ee,Se,Re,St.data):U.texSubImage3D(je,H,O.x,O.y,O.z,ye,Ee,Se,Re,ze,St),U.pixelStorei(U.UNPACK_ROW_LENGTH,nt),U.pixelStorei(U.UNPACK_IMAGE_HEIGHT,$t),U.pixelStorei(U.UNPACK_SKIP_PIXELS,Sn),U.pixelStorei(U.UNPACK_SKIP_ROWS,Yn),U.pixelStorei(U.UNPACK_SKIP_IMAGES,dr),H===0&&V.generateMipmaps&&U.generateMipmap(je),Ie.unbindTexture()},this.initTexture=function(b){b.isCubeTexture?ft.setTextureCube(b,0):b.isData3DTexture?ft.setTexture3D(b,0):b.isDataArrayTexture||b.isCompressedArrayTexture?ft.setTexture2DArray(b,0):ft.setTexture2D(b,0),Ie.unbindTexture()},this.resetState=function(){D=0,I=0,A=null,Ie.reset(),$e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Br}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===E_?"display-p3":"srgb",t.unpackColorSpace=At.workingColorSpace===ep?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}};var Hr=class extends Vi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Mo,this.environmentIntensity=1,this.environmentRotation=new Mo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};var Cs=class extends si{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ke(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Hh=new P,zh=new P,Aw=new Ft,tu=new Ms,xh=new Ts,Pv=new P,Dw=new P,t_=class extends Vi{constructor(e=new xi,t=new Cs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,o=t.count;r<o;r++)Hh.fromBufferAttribute(t,r-1),zh.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Hh.distanceTo(zh);e.setAttribute("lineDistance",new mn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),xh.copy(i.boundingSphere),xh.applyMatrix4(r),xh.radius+=o,e.ray.intersectsSphere(xh)===!1)return;Aw.copy(r).invert(),tu.copy(e.ray).applyMatrix4(Aw);let a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=i.index,p=i.attributes.position;if(u!==null){let m=Math.max(0,s.start),v=Math.min(u.count,s.start+s.count);for(let _=m,y=v-1;_<y;_+=c){let g=u.getX(_),T=u.getX(_+1),x=Sh(this,e,tu,l,g,T);x&&t.push(x)}if(this.isLineLoop){let _=u.getX(v-1),y=u.getX(m),g=Sh(this,e,tu,l,_,y);g&&t.push(g)}}else{let m=Math.max(0,s.start),v=Math.min(p.count,s.start+s.count);for(let _=m,y=v-1;_<y;_+=c){let g=Sh(this,e,tu,l,_,_+1);g&&t.push(g)}if(this.isLineLoop){let _=Sh(this,e,tu,l,v-1,m);_&&t.push(_)}}}updateMorphTargets(){let t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=r.length;o<s;o++){let a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}};function Sh(n,e,t,i,r,o){let s=n.geometry.attributes.position;if(Hh.fromBufferAttribute(s,r),zh.fromBufferAttribute(s,o),t.distanceSqToSegment(Hh,zh,Pv,Dw)>i)return;Pv.applyMatrix4(n.matrixWorld);let l=e.ray.origin.distanceTo(Pv);if(!(l<e.near||l>e.far))return{distance:l,point:Dw.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,object:n}}var Rw=new P,Nw=new P,hu=class extends t_{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,o=t.count;r<o;r+=2)Rw.fromBufferAttribute(t,r),Nw.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+Rw.distanceTo(Nw);e.setAttribute("lineDistance",new mn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var wo=class extends si{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ke(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},Pw=new Ft,n_=new Ms,Th=new Ts,Mh=new P,fl=class extends Vi{constructor(e=new xi,t=new wo){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Th.copy(i.boundingSphere),Th.applyMatrix4(r),Th.radius+=o,e.ray.intersectsSphere(Th)===!1)return;Pw.copy(r).invert(),n_.copy(e.ray).applyMatrix4(Pw);let a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,f=i.attributes.position;if(c!==null){let p=Math.max(0,s.start),m=Math.min(c.count,s.start+s.count);for(let v=p,_=m;v<_;v++){let y=c.getX(v);Mh.fromBufferAttribute(f,y),Lw(Mh,y,l,r,e,t,this)}}else{let p=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let v=p,_=m;v<_;v++)Mh.fromBufferAttribute(f,v),Lw(Mh,v,l,r,e,t,this)}}updateMorphTargets(){let t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){let r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=r.length;o<s;o++){let a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}};function Lw(n,e,t,i,r,o,s){let a=n_.distanceSqToPoint(n);if(a<t){let l=new P;n_.closestPointToPoint(n,l),l.applyMatrix4(i);let c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:s})}}var hl=class extends cr{constructor(e,t,i,r,o,s,a,l,c,u,f,p){super(null,s,a,l,c,u,r,o,f,p),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};var Gh=class extends cr{constructor(e,t,i,r,o,s,a,l,c){super(e,t,i,r,o,s,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}};var zr=class extends si{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ke(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=__,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}};var Wh=class extends si{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ke(16777215),this.specular=new ke(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ke(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=__,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Mo,this.combine=y_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}};function Ch(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function YB(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}var pl=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],o=t[i-1];n:{e:{let s;t:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(o=r,r=t[++i],e<r)break e}s=t.length;break t}if(!(e>=o)){let a=t[1];e<a&&(i=2,o=a);for(let l=i-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=o,o=t[--i-1],e>=o)break e}s=i,i=0;break t}break n}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let s=0;s!==r;++s)t[s]=i[o+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},i_=class extends pl{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:OC,endingEnd:OC}}intervalChanged_(e,t,i){let r=this.parameterPositions,o=e-2,s=e+1,a=r[o],l=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case kC:o=e,a=2*t-i;break;case UC:o=r.length-2,a=t+r[o]-r[o+1];break;default:o=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case kC:s=e,l=2*i-t;break;case UC:s=1,l=i+r[1]-r[0];break;default:s=e-1,l=t}let c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=o*u,this._offsetNext=s*u}interpolate_(e,t,i,r){let o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,f=this._offsetNext,p=this._weightPrev,m=this._weightNext,v=(i-t)/(r-t),_=v*v,y=_*v,g=-p*y+2*p*_-p*v,T=(1+p)*y+(-1.5-2*p)*_+(-.5+p)*v+1,x=(-1-m)*y+(1.5+m)*_+.5*v,M=m*y-m*_;for(let D=0;D!==a;++D)o[D]=g*s[u+D]+T*s[c+D]+x*s[l+D]+M*s[f+D];return o}},r_=class extends pl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),f=1-u;for(let p=0;p!==a;++p)o[p]=s[c+p]*f+s[l+p]*u;return o}},o_=class extends pl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Hi=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ch(t,this.TimeBufferType),this.values=Ch(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Ch(e.times,Array),values:Ch(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new o_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new r_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new i_(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case al:t=this.InterpolantFactoryMethodDiscrete;break;case ll:t=this.InterpolantFactoryMethodLinear;break;case lv:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return al;case this.InterpolantFactoryMethodLinear:return ll;case this.InterpolantFactoryMethodSmooth:return lv}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,o=0,s=r-1;for(;o!==r&&i[o]<e;)++o;for(;s!==-1&&i[s]>t;)--s;if(++s,o!==0||s!==r){o>=s&&(s=Math.max(s,1),o=s-1);let a=this.getValueSize();this.times=i.slice(o,s),this.values=this.values.slice(o*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==o;a++){let l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(s!==null&&s>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,s),e=!1;break}s=l}if(r!==void 0&&YB(r))for(let a=0,l=r.length;a!==l;++a){let c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===lv,o=e.length-1,s=1;for(let a=1;a<o;++a){let l=!1,c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{let f=a*i,p=f-i,m=f+i;for(let v=0;v!==i;++v){let _=t[f+v];if(_!==t[p+v]||_!==t[m+v]){l=!0;break}}}if(l){if(a!==s){e[s]=e[a];let f=a*i,p=s*i;for(let m=0;m!==i;++m)t[p+m]=t[f+m]}++s}}if(o>0){e[s]=e[o];for(let a=o*i,l=s*i,c=0;c!==i;++c)t[l+c]=t[a+c];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*i)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Hi.prototype.TimeBufferType=Float32Array;Hi.prototype.ValueBufferType=Float32Array;Hi.prototype.DefaultInterpolation=ll;var ws=class extends Hi{};ws.prototype.ValueTypeName="bool";ws.prototype.ValueBufferType=Array;ws.prototype.DefaultInterpolation=al;ws.prototype.InterpolantFactoryMethodLinear=void 0;ws.prototype.InterpolantFactoryMethodSmooth=void 0;var s_=class extends Hi{};s_.prototype.ValueTypeName="color";var a_=class extends Hi{};a_.prototype.ValueTypeName="number";var l_=class extends pl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t),c=e*a;for(let u=c+a;c!==u;c+=4)oi.slerpFlat(o,0,s,c-a,s,c,l);return o}},pu=class extends Hi{InterpolantFactoryMethodLinear(e){return new l_(this.times,this.values,this.getValueSize(),e)}};pu.prototype.ValueTypeName="quaternion";pu.prototype.DefaultInterpolation=ll;pu.prototype.InterpolantFactoryMethodSmooth=void 0;var bs=class extends Hi{};bs.prototype.ValueTypeName="string";bs.prototype.ValueBufferType=Array;bs.prototype.DefaultInterpolation=al;bs.prototype.InterpolantFactoryMethodLinear=void 0;bs.prototype.InterpolantFactoryMethodSmooth=void 0;var c_=class extends Hi{};c_.prototype.ValueTypeName="vector";var qh={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}},u_=class{constructor(e,t,i){let r=this,o=!1,s=0,a=0,l,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,o===!1&&r.onStart!==void 0&&r.onStart(u,s,a),o=!0},this.itemEnd=function(u){s++,r.onProgress!==void 0&&r.onProgress(u,s,a),s===a&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,f){return c.push(u,f),this},this.removeHandler=function(u){let f=c.indexOf(u);return f!==-1&&c.splice(f,2),this},this.getHandler=function(u){for(let f=0,p=c.length;f<p;f+=2){let m=c[f],v=c[f+1];if(m.global&&(m.lastIndex=0),m.test(u))return v}return null}}},XB=new u_,yu=(()=>{class n{constructor(t){this.manager=t!==void 0?t:XB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){let r=this;return new Promise(function(o,s){r.load(t,o,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return n.DEFAULT_MATERIAL_NAME="__DEFAULT",n})(),Or={},d_=class extends Error{constructor(e,t){super(e),this.response=t}},$h=class extends yu{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let o=qh.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(Or[e]!==void 0){Or[e].push({onLoad:t,onProgress:i,onError:r});return}Or[e]=[],Or[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(s).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;let u=Or[e],f=c.body.getReader(),p=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),m=p?parseInt(p):0,v=m!==0,_=0,y=new ReadableStream({start(g){T();function T(){f.read().then(({done:x,value:M})=>{if(x)g.close();else{_+=M.byteLength;let D=new ProgressEvent("progress",{lengthComputable:v,loaded:_,total:m});for(let I=0,A=u.length;I<A;I++){let k=u[I];k.onProgress&&k.onProgress(D)}g.enqueue(M),T()}})}}});return new Response(y)}else throw new d_(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{let f=/charset="?([^;"\s]*)"?/i.exec(a),p=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(p);return c.arrayBuffer().then(v=>m.decode(v))}}}).then(c=>{qh.add(e,c);let u=Or[e];delete Or[e];for(let f=0,p=u.length;f<p;f++){let m=u[f];m.onLoad&&m.onLoad(c)}}).catch(c=>{let u=Or[e];if(u===void 0)throw this.manager.itemError(e),c;delete Or[e];for(let f=0,p=u.length;f<p;f++){let m=u[f];m.onError&&m.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var f_=class extends yu{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let o=this,s=qh.get(e);if(s!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s;let a=uu("img");function l(){u(),qh.add(e,this),t&&t(this),o.manager.itemEnd(e)}function c(f){u(),r&&r(f),o.manager.itemError(e),o.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}};var Yh=class extends yu{constructor(e){super(e)}load(e,t,i,r){let o=new cr,s=new f_(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){o.image=a,o.needsUpdate=!0,t!==void 0&&t(o)},i,r),o}},Xh=class extends Vi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ke(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};var Lv=new Ft,Fw=new P,Ow=new P,h_=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ne(512,512),this.map=null,this.mapPass=null,this.matrix=new Ft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fu,this._frameExtents=new Ne(1,1),this._viewportCount=1,this._viewports=[new pn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;Fw.setFromMatrixPosition(e.matrixWorld),t.position.copy(Fw),Ow.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ow),t.updateMatrixWorld(),Lv.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Lv),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Lv)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}};var p_=class extends h_{constructor(){super(new Uh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Jh=class extends Xh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Vi.DEFAULT_UP),this.updateMatrix(),this.target=new Vi,this.shadow=new p_}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},jh=class extends Xh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}};var T_="\\[\\]\\.:\\/",JB=new RegExp("["+T_+"]","g"),M_="[^"+T_+"]",jB="[^"+T_.replace("\\.","")+"]",ZB=/((?:WC+[\/:])*)/.source.replace("WC",M_),KB=/(WCOD+)?/.source.replace("WCOD",jB),QB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",M_),e3=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",M_),t3=new RegExp("^"+ZB+KB+QB+e3+"$"),n3=["material","materials","bones","map"],m_=class{constructor(e,t,i){let r=i||Nt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Nt=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(JB,"")}static parseTrackName(t){let i=t3.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){let s=r.nodeName.substring(o+1);n3.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){let r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){let r=function(s){for(let a=0;a<s.length;a++){let l=s[a];if(l.name===i||l.uuid===i)return l;let c=r(l.children);if(c)return c}return null},o=r(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){let r=this.resolvedProperty;for(let o=0,s=r.length;o!==s;++o)t[i++]=r[o]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){let r=this.resolvedProperty;for(let o=0,s=r.length;o!==s;++o)r[o]=t[i++]}_setValue_array_setNeedsUpdate(t,i){let r=this.resolvedProperty;for(let o=0,s=r.length;o!==s;++o)r[o]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){let r=this.resolvedProperty;for(let o=0,s=r.length;o!==s;++o)r[o]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node,i=this.parsedPath,r=i.objectName,o=i.propertyName,s=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let f=0;f<t.length;f++)if(t[f].name===u){u=f;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(u!==void 0){if(t[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[u]}}let a=t[o];if(a===void 0){let u=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+o+" but it wasn't found.",t);return}let l=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(o==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=o;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=m_,n})();Nt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Nt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Nt.prototype.GetterByBindingType=[Nt.prototype._getValue_direct,Nt.prototype._getValue_array,Nt.prototype._getValue_arrayElement,Nt.prototype._getValue_toArray];Nt.prototype.SetterByBindingTypeAndVersioning=[[Nt.prototype._setValue_direct,Nt.prototype._setValue_direct_setNeedsUpdate,Nt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Nt.prototype._setValue_array,Nt.prototype._setValue_array_setNeedsUpdate,Nt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Nt.prototype._setValue_arrayElement,Nt.prototype._setValue_arrayElement_setNeedsUpdate,Nt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Nt.prototype._setValue_fromArray,Nt.prototype._setValue_fromArray_setNeedsUpdate,Nt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Fne=new Float32Array(1);var Zh=class n{constructor(e){this.value=e}clone(){return new n(this.value.clone===void 0?this.value:this.value.clone())}};var mu=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Dn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"164"}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="164");var tb={type:"change"},C_={type:"start"},nb={type:"end"},np=new Ms,ib=new Ui,r3=Math.cos(70*gl.DEG2RAD),ip=class extends ar{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new P,this.cursor=new P,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Is.ROTATE,MIDDLE:Is.DOLLY,RIGHT:Is.PAN},this.touches={ONE:As.ROTATE,TWO:As.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(E){E.addEventListener("keydown",Be),this._domElementKeyEvents=E},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Be),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(tb),i.update(),o=r.NONE},this.update=(function(){let E=new P,F=new oi().setFromUnitVectors(e.up,new P(0,1,0)),B=F.clone().invert(),ee=new P,le=new oi,Ye=new P,tt=2*Math.PI;return function(an=null){let _t=i.object.position;E.copy(_t).sub(i.target),E.applyQuaternion(F),a.setFromVector3(E),i.autoRotate&&o===r.NONE&&z(S(an)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let qt=i.minAzimuthAngle,Pt=i.maxAzimuthAngle;isFinite(qt)&&isFinite(Pt)&&(qt<-Math.PI?qt+=tt:qt>Math.PI&&(qt-=tt),Pt<-Math.PI?Pt+=tt:Pt>Math.PI&&(Pt-=tt),qt<=Pt?a.theta=Math.max(qt,Math.min(Pt,a.theta)):a.theta=a.theta>(qt+Pt)/2?Math.max(qt,a.theta):Math.min(Pt,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let qr=!1;if(i.zoomToCursor&&I||i.object.isOrthographicCamera)a.radius=ie(a.radius);else{let li=a.radius;a.radius=ie(a.radius*c),qr=li!=a.radius}if(E.setFromSpherical(a),E.applyQuaternion(B),_t.copy(i.target).add(E),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),i.zoomToCursor&&I){let li=null;if(i.object.isPerspectiveCamera){let $r=E.length();li=ie($r*c);let ur=$r-li;i.object.position.addScaledVector(M,ur),i.object.updateMatrixWorld(),qr=!!ur}else if(i.object.isOrthographicCamera){let $r=new P(D.x,D.y,0);$r.unproject(i.object);let ur=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),qr=ur!==i.object.zoom;let Dl=new P(D.x,D.y,0);Dl.unproject(i.object),i.object.position.sub(Dl).add($r),i.object.updateMatrixWorld(),li=E.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;li!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(li).add(i.object.position):(np.origin.copy(i.object.position),np.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(np.direction))<r3?e.lookAt(i.target):(ib.setFromNormalAndCoplanarPoint(i.object.up,i.target),np.intersectPlane(ib,i.target))))}else if(i.object.isOrthographicCamera){let li=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),li!==i.object.zoom&&(i.object.updateProjectionMatrix(),qr=!0)}return c=1,I=!1,qr||ee.distanceToSquared(i.object.position)>s||8*(1-le.dot(i.object.quaternion))>s||Ye.distanceToSquared(i.target)>s?(i.dispatchEvent(tb),ee.copy(i.object.position),le.copy(i.object.quaternion),Ye.copy(i.target),!0):!1}})(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",ht),i.domElement.removeEventListener("pointerdown",R),i.domElement.removeEventListener("pointercancel",W),i.domElement.removeEventListener("wheel",ne),i.domElement.removeEventListener("pointermove",C),i.domElement.removeEventListener("pointerup",W),i.domElement.getRootNode().removeEventListener("keydown",me,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Be),i._domElementKeyEvents=null)};let i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},o=r.NONE,s=1e-6,a=new mu,l=new mu,c=1,u=new P,f=new Ne,p=new Ne,m=new Ne,v=new Ne,_=new Ne,y=new Ne,g=new Ne,T=new Ne,x=new Ne,M=new P,D=new Ne,I=!1,A=[],k={},w=!1;function S(E){return E!==null?2*Math.PI/60*i.autoRotateSpeed*E:2*Math.PI/60/60*i.autoRotateSpeed}function L(E){let F=Math.abs(E*.01);return Math.pow(.95,i.zoomSpeed*F)}function z(E){l.theta-=E}function N(E){l.phi-=E}let $=(function(){let E=new P;return function(B,ee){E.setFromMatrixColumn(ee,0),E.multiplyScalar(-B),u.add(E)}})(),Y=(function(){let E=new P;return function(B,ee){i.screenSpacePanning===!0?E.setFromMatrixColumn(ee,1):(E.setFromMatrixColumn(ee,0),E.crossVectors(i.object.up,E)),E.multiplyScalar(B),u.add(E)}})(),Q=(function(){let E=new P;return function(B,ee){let le=i.domElement;if(i.object.isPerspectiveCamera){let Ye=i.object.position;E.copy(Ye).sub(i.target);let tt=E.length();tt*=Math.tan(i.object.fov/2*Math.PI/180),$(2*B*tt/le.clientHeight,i.object.matrix),Y(2*ee*tt/le.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?($(B*(i.object.right-i.object.left)/i.object.zoom/le.clientWidth,i.object.matrix),Y(ee*(i.object.top-i.object.bottom)/i.object.zoom/le.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function re(E){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function q(E){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function oe(E,F){if(!i.zoomToCursor)return;I=!0;let B=i.domElement.getBoundingClientRect(),ee=E-B.left,le=F-B.top,Ye=B.width,tt=B.height;D.x=ee/Ye*2-1,D.y=-(le/tt)*2+1,M.set(D.x,D.y,1).unproject(i.object).sub(i.object.position).normalize()}function ie(E){return Math.max(i.minDistance,Math.min(i.maxDistance,E))}function xe(E){f.set(E.clientX,E.clientY)}function rt(E){oe(E.clientX,E.clientX),g.set(E.clientX,E.clientY)}function Ct(E){v.set(E.clientX,E.clientY)}function X(E){p.set(E.clientX,E.clientY),m.subVectors(p,f).multiplyScalar(i.rotateSpeed);let F=i.domElement;z(2*Math.PI*m.x/F.clientHeight),N(2*Math.PI*m.y/F.clientHeight),f.copy(p),i.update()}function ae(E){T.set(E.clientX,E.clientY),x.subVectors(T,g),x.y>0?re(L(x.y)):x.y<0&&q(L(x.y)),g.copy(T),i.update()}function _e(E){_.set(E.clientX,E.clientY),y.subVectors(_,v).multiplyScalar(i.panSpeed),Q(y.x,y.y),v.copy(_),i.update()}function fe(E){oe(E.clientX,E.clientY),E.deltaY<0?q(L(E.deltaY)):E.deltaY>0&&re(L(E.deltaY)),i.update()}function ot(E){let F=!1;switch(E.code){case i.keys.UP:E.ctrlKey||E.metaKey||E.shiftKey?N(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Q(0,i.keyPanSpeed),F=!0;break;case i.keys.BOTTOM:E.ctrlKey||E.metaKey||E.shiftKey?N(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Q(0,-i.keyPanSpeed),F=!0;break;case i.keys.LEFT:E.ctrlKey||E.metaKey||E.shiftKey?z(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Q(i.keyPanSpeed,0),F=!0;break;case i.keys.RIGHT:E.ctrlKey||E.metaKey||E.shiftKey?z(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Q(-i.keyPanSpeed,0),F=!0;break}F&&(E.preventDefault(),i.update())}function Qe(E){if(A.length===1)f.set(E.pageX,E.pageY);else{let F=It(E),B=.5*(E.pageX+F.x),ee=.5*(E.pageY+F.y);f.set(B,ee)}}function U(E){if(A.length===1)v.set(E.pageX,E.pageY);else{let F=It(E),B=.5*(E.pageX+F.x),ee=.5*(E.pageY+F.y);v.set(B,ee)}}function wt(E){let F=It(E),B=E.pageX-F.x,ee=E.pageY-F.y,le=Math.sqrt(B*B+ee*ee);g.set(0,le)}function we(E){i.enableZoom&&wt(E),i.enablePan&&U(E)}function bt(E){i.enableZoom&&wt(E),i.enableRotate&&Qe(E)}function Ie(E){if(A.length==1)p.set(E.pageX,E.pageY);else{let B=It(E),ee=.5*(E.pageX+B.x),le=.5*(E.pageY+B.y);p.set(ee,le)}m.subVectors(p,f).multiplyScalar(i.rotateSpeed);let F=i.domElement;z(2*Math.PI*m.x/F.clientHeight),N(2*Math.PI*m.y/F.clientHeight),f.copy(p)}function st(E){if(A.length===1)_.set(E.pageX,E.pageY);else{let F=It(E),B=.5*(E.pageX+F.x),ee=.5*(E.pageY+F.y);_.set(B,ee)}y.subVectors(_,v).multiplyScalar(i.panSpeed),Q(y.x,y.y),v.copy(_)}function qe(E){let F=It(E),B=E.pageX-F.x,ee=E.pageY-F.y,le=Math.sqrt(B*B+ee*ee);T.set(0,le),x.set(0,Math.pow(T.y/g.y,i.zoomSpeed)),re(x.y),g.copy(T);let Ye=(E.pageX+F.x)*.5,tt=(E.pageY+F.y)*.5;oe(Ye,tt)}function ft(E){i.enableZoom&&qe(E),i.enablePan&&st(E)}function kt(E){i.enableZoom&&qe(E),i.enableRotate&&Ie(E)}function R(E){i.enabled!==!1&&(A.length===0&&(i.domElement.setPointerCapture(E.pointerId),i.domElement.addEventListener("pointermove",C),i.domElement.addEventListener("pointerup",W)),!$e(E)&&(be(E),E.pointerType==="touch"?ce(E):K(E)))}function C(E){i.enabled!==!1&&(E.pointerType==="touch"?Me(E):te(E))}function W(E){switch(ve(E),A.length){case 0:i.domElement.releasePointerCapture(E.pointerId),i.domElement.removeEventListener("pointermove",C),i.domElement.removeEventListener("pointerup",W),i.dispatchEvent(nb),o=r.NONE;break;case 1:let F=A[0],B=k[F];ce({pointerId:F,pageX:B.x,pageY:B.y});break}}function K(E){let F;switch(E.button){case 0:F=i.mouseButtons.LEFT;break;case 1:F=i.mouseButtons.MIDDLE;break;case 2:F=i.mouseButtons.RIGHT;break;default:F=-1}switch(F){case Is.DOLLY:if(i.enableZoom===!1)return;rt(E),o=r.DOLLY;break;case Is.ROTATE:if(E.ctrlKey||E.metaKey||E.shiftKey){if(i.enablePan===!1)return;Ct(E),o=r.PAN}else{if(i.enableRotate===!1)return;xe(E),o=r.ROTATE}break;case Is.PAN:if(E.ctrlKey||E.metaKey||E.shiftKey){if(i.enableRotate===!1)return;xe(E),o=r.ROTATE}else{if(i.enablePan===!1)return;Ct(E),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent(C_)}function te(E){switch(o){case r.ROTATE:if(i.enableRotate===!1)return;X(E);break;case r.DOLLY:if(i.enableZoom===!1)return;ae(E);break;case r.PAN:if(i.enablePan===!1)return;_e(E);break}}function ne(E){i.enabled===!1||i.enableZoom===!1||o!==r.NONE||(E.preventDefault(),i.dispatchEvent(C_),fe(Ce(E)),i.dispatchEvent(nb))}function Ce(E){let F=E.deltaMode,B={clientX:E.clientX,clientY:E.clientY,deltaY:E.deltaY};switch(F){case 1:B.deltaY*=16;break;case 2:B.deltaY*=100;break}return E.ctrlKey&&!w&&(B.deltaY*=10),B}function me(E){E.key==="Control"&&(w=!0,i.domElement.getRootNode().addEventListener("keyup",pe,{passive:!0,capture:!0}))}function pe(E){E.key==="Control"&&(w=!1,i.domElement.getRootNode().removeEventListener("keyup",pe,{passive:!0,capture:!0}))}function Be(E){i.enabled===!1||i.enablePan===!1||ot(E)}function ce(E){switch(et(E),A.length){case 1:switch(i.touches.ONE){case As.ROTATE:if(i.enableRotate===!1)return;Qe(E),o=r.TOUCH_ROTATE;break;case As.PAN:if(i.enablePan===!1)return;U(E),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(i.touches.TWO){case As.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;we(E),o=r.TOUCH_DOLLY_PAN;break;case As.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;bt(E),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&i.dispatchEvent(C_)}function Me(E){switch(et(E),o){case r.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ie(E),i.update();break;case r.TOUCH_PAN:if(i.enablePan===!1)return;st(E),i.update();break;case r.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ft(E),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;kt(E),i.update();break;default:o=r.NONE}}function ht(E){i.enabled!==!1&&E.preventDefault()}function be(E){A.push(E.pointerId)}function ve(E){delete k[E.pointerId];for(let F=0;F<A.length;F++)if(A[F]==E.pointerId){A.splice(F,1);return}}function $e(E){for(let F=0;F<A.length;F++)if(A[F]==E.pointerId)return!0;return!1}function et(E){let F=k[E.pointerId];F===void 0&&(F=new Ne,k[E.pointerId]=F),F.set(E.pageX,E.pageY)}function It(E){let F=E.pointerId===A[0]?A[1]:A[0];return k[F]}i.domElement.addEventListener("contextmenu",ht),i.domElement.addEventListener("pointerdown",R),i.domElement.addEventListener("pointercancel",W),i.domElement.addEventListener("wheel",ne,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",me,{passive:!0,capture:!0}),this.update()}};var o3=/^[og]\s*(.+)?/,s3=/^mtllib /,a3=/^usemtl /,l3=/^usemap /,rb=/\s+/,ob=new P,w_=new P,sb=new P,ab=new P,Ti=new P,rp=new ke;function c3(){let n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}let i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){let s=this._finalize(!1);s&&(s.inherited||s.groupCount<=0)&&this.materials.splice(s.index,1);let a={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:s!==void 0?s.smooth:this.smooth,groupStart:s!==void 0?s.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){let c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){let o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let s=this.materials.length-1;s>=0;s--)this.materials[s].groupCount<=0&&this.materials.splice(s,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},i&&i.name&&typeof i.clone=="function"){let r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){let i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){let i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){let i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){let r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){let r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[i+0],r[i+1],r[i+2])},addFaceNormal:function(e,t,i){let r=this.vertices,o=this.object.geometry.normals;ob.fromArray(r,e),w_.fromArray(r,t),sb.fromArray(r,i),Ti.subVectors(sb,w_),ab.subVectors(ob,w_),Ti.cross(ab),Ti.normalize(),o.push(Ti.x,Ti.y,Ti.z),o.push(Ti.x,Ti.y,Ti.z),o.push(Ti.x,Ti.y,Ti.z)},addColor:function(e,t,i){let r=this.colors,o=this.object.geometry.colors;r[e]!==void 0&&o.push(r[e+0],r[e+1],r[e+2]),r[t]!==void 0&&o.push(r[t+0],r[t+1],r[t+2]),r[i]!==void 0&&o.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){let r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[i+0],r[i+1])},addDefaultUV:function(){let e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){let t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,o,s,a,l,c){let u=this.vertices.length,f=this.parseVertexIndex(e,u),p=this.parseVertexIndex(t,u),m=this.parseVertexIndex(i,u);if(this.addVertex(f,p,m),this.addColor(f,p,m),a!==void 0&&a!==""){let v=this.normals.length;f=this.parseNormalIndex(a,v),p=this.parseNormalIndex(l,v),m=this.parseNormalIndex(c,v),this.addNormal(f,p,m)}else this.addFaceNormal(f,p,m);if(r!==void 0&&r!==""){let v=this.uvs.length;f=this.parseUVIndex(r,v),p=this.parseUVIndex(o,v),m=this.parseUVIndex(s,v),this.addUV(f,p,m),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";let t=this.vertices.length;for(let i=0,r=e.length;i<r;i++){let o=this.parseVertexIndex(e[i],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";let i=this.vertices.length,r=this.uvs.length;for(let o=0,s=e.length;o<s;o++)this.addVertexLine(this.parseVertexIndex(e[o],i));for(let o=0,s=t.length;o<s;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return n.startObject("",!1),n}var op=class extends yu{constructor(e){super(e),this.materials=null}load(e,t,i,r){let o=this,s=new $h(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{t(o.parse(a))}catch(l){r?r(l):console.error(l),o.manager.itemError(e)}},i,r)}setMaterials(e){return this.materials=e,this}parse(e){let t=new c3;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));let i=e.split(`
`),r=[];for(let a=0,l=i.length;a<l;a++){let c=i[a].trimStart();if(c.length===0)continue;let u=c.charAt(0);if(u!=="#")if(u==="v"){let f=c.split(rb);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(rp.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),t.colors.push(rp.r,rp.g,rp.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(u==="f"){let p=c.slice(1).trim().split(rb),m=[];for(let _=0,y=p.length;_<y;_++){let g=p[_];if(g.length>0){let T=g.split("/");m.push(T)}}let v=m[0];for(let _=1,y=m.length-1;_<y;_++){let g=m[_],T=m[_+1];t.addFace(v[0],g[0],T[0],v[1],g[1],T[1],v[2],g[2],T[2])}}else if(u==="l"){let f=c.substring(1).trim().split(" "),p=[],m=[];if(c.indexOf("/")===-1)p=f;else for(let v=0,_=f.length;v<_;v++){let y=f[v].split("/");y[0]!==""&&p.push(y[0]),y[1]!==""&&m.push(y[1])}t.addLineGeometry(p,m)}else if(u==="p"){let p=c.slice(1).trim().split(" ");t.addPointGeometry(p)}else if((r=o3.exec(c))!==null){let f=(" "+r[0].slice(1).trim()).slice(1);t.startObject(f)}else if(a3.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(s3.test(c))t.materialLibraries.push(c.substring(7).trim());else if(l3.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(r=c.split(" "),r.length>1){let p=r[1].trim().toLowerCase();t.object.smooth=p!=="0"&&p!=="off"}else t.object.smooth=!0;let f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();let o=new or;if(o.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){let c=t.objects[a],u=c.geometry,f=c.materials,p=u.type==="Line",m=u.type==="Points",v=!1;if(u.vertices.length===0)continue;let _=new xi;_.setAttribute("position",new mn(u.vertices,3)),u.normals.length>0&&_.setAttribute("normal",new mn(u.normals,3)),u.colors.length>0&&(v=!0,_.setAttribute("color",new mn(u.colors,3))),u.hasUVIndices===!0&&_.setAttribute("uv",new mn(u.uvs,2));let y=[];for(let T=0,x=f.length;T<x;T++){let M=f[T],D=M.name+"_"+M.smooth+"_"+v,I=t.materials[D];if(this.materials!==null){if(I=this.materials.create(M.name),p&&I&&!(I instanceof Cs)){let A=new Cs;si.prototype.copy.call(A,I),A.color.copy(I.color),I=A}else if(m&&I&&!(I instanceof wo)){let A=new wo({size:10,sizeAttenuation:!1});si.prototype.copy.call(A,I),A.color.copy(I.color),A.map=I.map,I=A}}I===void 0&&(p?I=new Cs:m?I=new wo({size:1,sizeAttenuation:!1}):I=new Wh,I.name=M.name,I.flatShading=!M.smooth,I.vertexColors=v,t.materials[D]=I),y.push(I)}let g;if(y.length>1){for(let T=0,x=f.length;T<x;T++){let M=f[T];_.addGroup(M.groupStart,M.groupCount,T)}p?g=new hu(_,y):m?g=new fl(_,y):g=new zt(_,y)}else p?g=new hu(_,y[0]):m?g=new fl(_,y[0]):g=new zt(_,y[0]);g.name=c.name,o.add(g)}else if(t.vertices.length>0){let a=new wo({size:1,sizeAttenuation:!1}),l=new xi;l.setAttribute("position",new mn(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new mn(t.colors,3)),a.vertexColors=!0);let c=new fl(l,a);o.add(c)}return o}};var vu,b_,vl,sp;function ap(n,e=1/0,t=null){b_||(b_=new Co(2,2,1,1)),vl||(vl=new Si({uniforms:{blitTexture:new Zh(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),vl.uniforms.blitTexture.value=n,vl.defines.IS_SRGB=n.colorSpace==An,vl.needsUpdate=!0,sp||(sp=new zt(b_,vl),sp.frustumCulled=!1);let i=new xn,r=new Hr;r.add(sp),t===null&&(t=vu=new dl({antialias:!1}));let o=Math.min(n.image.width,e),s=Math.min(n.image.height,e);t.setSize(o,s),t.clear(),t.render(r,i);let a=document.createElement("canvas"),l=a.getContext("2d");a.width=o,a.height=s,l.drawImage(t.domElement,0,0,o,s);let c=new Gh(a);return c.minFilter=n.minFilter,c.magFilter=n.magFilter,c.wrapS=n.wrapS,c.wrapT=n.wrapT,c.name=n.name,vu&&(vu.forceContextLoss(),vu.dispose(),vu=null),c}var lb={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]},_l=class{constructor(){this.pluginCallbacks=[],this.register(function(e){return new R_(e)}),this.register(function(e){return new N_(e)}),this.register(function(e){return new O_(e)}),this.register(function(e){return new k_(e)}),this.register(function(e){return new U_(e)}),this.register(function(e){return new B_(e)}),this.register(function(e){return new P_(e)}),this.register(function(e){return new L_(e)}),this.register(function(e){return new F_(e)}),this.register(function(e){return new V_(e)}),this.register(function(e){return new H_(e)}),this.register(function(e){return new z_(e)}),this.register(function(e){return new G_(e)}),this.register(function(e){return new W_(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let o=new D_,s=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)s.push(this.pluginCallbacks[a](o));o.setPlugins(s),o.write(e,t,r).catch(i)}parseAsync(e,t){let i=this;return new Promise(function(r,o){i.parse(e,r,o,t)})}},dt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},I_="KHR_mesh_quantization",ai={};ai[qn]=dt.NEAREST;ai[v_]=dt.NEAREST_MIPMAP_NEAREST;ai[Za]=dt.NEAREST_MIPMAP_LINEAR;ai[Rn]=dt.LINEAR;ai[iu]=dt.LINEAR_MIPMAP_NEAREST;ai[_i]=dt.LINEAR_MIPMAP_LINEAR;ai[Ur]=dt.CLAMP_TO_EDGE;ai[sr]=dt.REPEAT;ai[au]=dt.MIRRORED_REPEAT;var cb={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},d3=new ke,ub=12,f3=1179937895,h3=2,db=8,p3=1313821514,m3=5130562;function _u(n,e){return n.length===e.length&&n.every(function(t,i){return t===e[i]})}function g3(n){return new TextEncoder().encode(n).buffer}function y3(n){return _u(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function v3(n,e,t){let i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+t;r++)for(let o=0;o<n.itemSize;o++){let s;n.itemSize>4?s=n.array[r*n.itemSize+o]:(o===0?s=n.getX(r):o===1?s=n.getY(r):o===2?s=n.getZ(r):o===3&&(s=n.getW(r)),n.normalized===!0&&(s=gl.normalize(s,n.array))),i.min[o]=Math.min(i.min[o],s),i.max[o]=Math.max(i.max[o],s)}return i}function pb(n){return Math.ceil(n/4)*4}function A_(n,e=0){let t=pb(n.byteLength);if(t!==n.byteLength){let i=new Uint8Array(t);if(i.set(new Uint8Array(n)),e!==0)for(let r=n.byteLength;r<t;r++)i[r]=e;return i.buffer}return n}function fb(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function hb(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}var D_=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r164"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);let r=this,o=r.buffers,s=r.json;i=r.options;let a=r.extensionsUsed,l=r.extensionsRequired,c=new Blob(o,{type:"application/octet-stream"}),u=Object.keys(a),f=Object.keys(l);if(u.length>0&&(s.extensionsUsed=u),f.length>0&&(s.extensionsRequired=f),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=c.size),i.binary===!0){let p=new FileReader;p.readAsArrayBuffer(c),p.onloadend=function(){let m=A_(p.result),v=new DataView(new ArrayBuffer(db));v.setUint32(0,m.byteLength,!0),v.setUint32(4,m3,!0);let _=A_(g3(JSON.stringify(s)),32),y=new DataView(new ArrayBuffer(db));y.setUint32(0,_.byteLength,!0),y.setUint32(4,p3,!0);let g=new ArrayBuffer(ub),T=new DataView(g);T.setUint32(0,f3,!0),T.setUint32(4,h3,!0);let x=ub+y.byteLength+_.byteLength+v.byteLength+m.byteLength;T.setUint32(8,x,!0);let M=new Blob([g,y,_,v,m],{type:"application/octet-stream"}),D=new FileReader;D.readAsArrayBuffer(M),D.onloadend=function(){t(D.result)}}}else if(s.buffers&&s.buffers.length>0){let p=new FileReader;p.readAsDataURL(c),p.onloadend=function(){let m=p.result;s.buffers[0].uri=m,t(s)}}else t(s)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;let i=this.options,r=this.extensionsUsed;try{let o=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(let s in o.gltfExtensions)t.extensions[s]=o.gltfExtensions[s],r[s]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){let r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let i=new P;for(let r=0,o=e.count;r<o;r++)if(Math.abs(i.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let i=e.clone(),r=new P;for(let o=0,s=i.count;o<s;o++)r.fromBufferAttribute(i,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),i.setXYZ(o,r.x,r.y,r.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1,r={};(t.offset.x!==0||t.offset.y!==0)&&(r.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(r.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(m){return m.colorSpace===An?function(_){return _<.04045?_*.0773993808:Math.pow(_*.9478672986+.0521327014,2.4)}:function(_){return _}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof hl&&(e=ap(e)),t instanceof hl&&(t=ap(t));let r=e?e.image:null,o=t?t.image:null,s=Math.max(r?r.width:0,o?o.width:0),a=Math.max(r?r.height:0,o?o.height:0),l=fb();l.width=s,l.height=a;let c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,s,a);let u=c.getImageData(0,0,s,a);if(r){c.drawImage(r,0,0,s,a);let m=i(e),v=c.getImageData(0,0,s,a).data;for(let _=2;_<v.length;_+=4)u.data[_]=m(v[_]/256)*256}if(o){c.drawImage(o,0,0,s,a);let m=i(t),v=c.getImageData(0,0,s,a).data;for(let _=1;_<v.length;_+=4)u.data[_]=m(v[_]/256)*256}c.putImageData(u,0,0);let p=(e||t).clone();return p.source=new cl(l),p.colorSpace=rr,p.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),p}processBuffer(e){let t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,r,o){let s=this.json;s.bufferViews||(s.bufferViews=[]);let a;switch(t){case dt.BYTE:case dt.UNSIGNED_BYTE:a=1;break;case dt.SHORT:case dt.UNSIGNED_SHORT:a=2;break;default:a=4}let l=e.itemSize*a;o===dt.ARRAY_BUFFER&&(l=Math.ceil(l/4)*4);let c=pb(r*l),u=new DataView(new ArrayBuffer(c)),f=0;for(let v=i;v<i+r;v++){for(let _=0;_<e.itemSize;_++){let y;e.itemSize>4?y=e.array[v*e.itemSize+_]:(_===0?y=e.getX(v):_===1?y=e.getY(v):_===2?y=e.getZ(v):_===3&&(y=e.getW(v)),e.normalized===!0&&(y=gl.normalize(y,e.array))),t===dt.FLOAT?u.setFloat32(f,y,!0):t===dt.INT?u.setInt32(f,y,!0):t===dt.UNSIGNED_INT?u.setUint32(f,y,!0):t===dt.SHORT?u.setInt16(f,y,!0):t===dt.UNSIGNED_SHORT?u.setUint16(f,y,!0):t===dt.BYTE?u.setInt8(f,y):t===dt.UNSIGNED_BYTE&&u.setUint8(f,y),f+=a}f%l!==0&&(f+=l-f%l)}let p={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:c};return o!==void 0&&(p.target=o),o===dt.ARRAY_BUFFER&&(p.byteStride=l),this.byteOffset+=c,s.bufferViews.push(p),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(r){let o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){let s=A_(o.result),a={buffer:t.processBuffer(s),byteOffset:t.byteOffset,byteLength:s.byteLength};t.byteOffset+=s.byteLength,r(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,r){let o=this.json,s={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"},a;if(e.array.constructor===Float32Array)a=dt.FLOAT;else if(e.array.constructor===Int32Array)a=dt.INT;else if(e.array.constructor===Uint32Array)a=dt.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=dt.SHORT;else if(e.array.constructor===Uint16Array)a=dt.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=dt.BYTE;else if(e.array.constructor===Uint8Array)a=dt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(r===void 0||r===1/0)&&(r=e.count),r===0)return null;let l=v3(e,i,r),c;t!==void 0&&(c=e===t.index?dt.ELEMENT_ARRAY_BUFFER:dt.ARRAY_BUFFER);let u=this.processBufferView(e,a,i,r,c),f={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:r,max:l.max,min:l.min,type:s[e.itemSize]};return e.normalized===!0&&(f.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(f)-1}processImage(e,t,i,r="image/png"){if(e!==null){let o=this,s=o.cache,a=o.json,l=o.options,c=o.pending;s.images.has(e)||s.images.set(e,{});let u=s.images.get(e),f=r+":flipY/"+i.toString();if(u[f]!==void 0)return u[f];a.images||(a.images=[]);let p={mimeType:r},m=fb();m.width=Math.min(e.width,l.maxTextureSize),m.height=Math.min(e.height,l.maxTextureSize);let v=m.getContext("2d");if(i===!0&&(v.translate(0,m.height),v.scale(1,-1)),e.data!==void 0){t!==Ei&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let y=new Uint8ClampedArray(e.height*e.width*4);for(let g=0;g<y.length;g+=4)y[g+0]=e.data[g+0],y[g+1]=e.data[g+1],y[g+2]=e.data[g+2],y[g+3]=e.data[g+3];v.putImageData(new ImageData(y,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)v.drawImage(e,0,0,m.width,m.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(hb(m,r).then(y=>o.processBufferViewImage(y)).then(y=>{p.bufferView=y})):m.toDataURL!==void 0?p.uri=m.toDataURL(r):c.push(hb(m,r).then(y=>new FileReader().readAsDataURL(y)).then(y=>{p.uri=y}));let _=a.images.push(p)-1;return u[f]=_,_}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let i={magFilter:ai[e.magFilter],minFilter:ai[e.minFilter],wrapS:ai[e.wrapS],wrapT:ai[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){let i=this.options,r=this.cache,o=this.json;if(r.textures.has(e))return r.textures.get(e);o.textures||(o.textures=[]),e instanceof hl&&(e=ap(e,i.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");let a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(a.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,a)});let l=o.textures.push(a)-1;return r.textures.set(e,l),l}processMaterial(e){let t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);let r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let o=e.color.toArray().concat([e.opacity]);if(_u(o,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(l,a),r.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){let a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),r.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){let a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let c={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(c,e.emissiveMap),r.emissiveTexture=c}}if(e.normalMap){let a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),r.normalTexture=a}if(e.aoMap){let a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),r.occlusionTexture=a}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===Bi&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,r)});let s=i.materials.push(r)-1;return t.materials.set(e,s),s}processMesh(e){let t=this.cache,i=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let M=0,D=e.material.length;M<D;M++)r.push(e.material[M].uuid);else r.push(e.material.uuid);let o=r.join(":");if(t.meshes.has(o))return t.meshes.get(o);let s=e.geometry,a;e.isLineSegments?a=dt.LINES:e.isLineLoop?a=dt.LINE_LOOP:e.isLine?a=dt.LINE_STRIP:e.isPoints?a=dt.POINTS:a=e.material.wireframe?dt.LINES:dt.TRIANGLES;let l={},c={},u=[],f=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=s.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let v=null;for(let M in s.attributes){if(M.slice(0,5)==="morph")continue;let D=s.attributes[M];if(M=p[M]||M.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(M)||(M="_"+M),t.attributes.has(this.getUID(D))){c[M]=t.attributes.get(this.getUID(D));continue}v=null;let A=D.array;M==="JOINTS_0"&&!(A instanceof Uint16Array)&&!(A instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new en(new Uint16Array(A),D.itemSize,D.normalized));let k=this.processAccessor(v||D,s);k!==null&&(M.startsWith("_")||this.detectMeshQuantization(M,D),c[M]=k,t.attributes.set(this.getUID(D),k))}if(m!==void 0&&s.setAttribute("normal",m),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){let M=[],D=[],I={};if(e.morphTargetDictionary!==void 0)for(let A in e.morphTargetDictionary)I[e.morphTargetDictionary[A]]=A;for(let A=0;A<e.morphTargetInfluences.length;++A){let k={},w=!1;for(let S in s.morphAttributes){if(S!=="position"&&S!=="normal"){w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);continue}let L=s.morphAttributes[S][A],z=S.toUpperCase(),N=s.attributes[S];if(t.attributes.has(this.getUID(L,!0))){k[z]=t.attributes.get(this.getUID(L,!0));continue}let $=L.clone();if(!s.morphTargetsRelative)for(let Y=0,Q=L.count;Y<Q;Y++)for(let re=0;re<L.itemSize;re++)re===0&&$.setX(Y,L.getX(Y)-N.getX(Y)),re===1&&$.setY(Y,L.getY(Y)-N.getY(Y)),re===2&&$.setZ(Y,L.getZ(Y)-N.getZ(Y)),re===3&&$.setW(Y,L.getW(Y)-N.getW(Y));k[z]=this.processAccessor($,s),t.attributes.set(this.getUID(N,!0),k[z])}f.push(k),M.push(e.morphTargetInfluences[A]),e.morphTargetDictionary!==void 0&&D.push(I[A])}l.weights=M,D.length>0&&(l.extras={},l.extras.targetNames=D)}let _=Array.isArray(e.material);if(_&&s.groups.length===0)return null;let y=!1;if(_&&s.index===null){let M=[];for(let D=0,I=s.attributes.position.count;D<I;D++)M[D]=D;s.setIndex(M),y=!0}let g=_?e.material:[e.material],T=_?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let M=0,D=T.length;M<D;M++){let I={mode:a,attributes:c};if(this.serializeUserData(s,I),f.length>0&&(I.targets=f),s.index!==null){let k=this.getUID(s.index);(T[M].start!==void 0||T[M].count!==void 0)&&(k+=":"+T[M].start+":"+T[M].count),t.attributes.has(k)?I.indices=t.attributes.get(k):(I.indices=this.processAccessor(s.index,s,T[M].start,T[M].count),t.attributes.set(k,I.indices)),I.indices===null&&delete I.indices}let A=this.processMaterial(g[T[M].materialIndex]);A!==null&&(I.material=A),u.push(I)}y===!0&&s.setIndex(null),l.primitives=u,i.meshes||(i.meshes=[]),this._invokeAll(function(M){M.writeMesh&&M.writeMesh(e,l)});let x=i.meshes.push(l)-1;return t.meshes.set(o,x),x}detectMeshQuantization(e,t){if(this.extensionsUsed[I_])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");let r=e.split("_",1)[0];lb[r]&&lb[r].includes(i)&&(this.extensionsUsed[I_]=!0,this.extensionsRequired[I_]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let i=e.isOrthographicCamera,r={type:i?"orthographic":"perspective"};return i?r.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:gl.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){let i=this.json,r=this.nodeMap;i.animations||(i.animations=[]),e=_l.Utils.mergeMorphTargetTracks(e.clone(),t);let o=e.tracks,s=[],a=[];for(let l=0;l<o.length;++l){let c=o[l],u=Nt.parseTrackName(c.name),f=Nt.findNode(t,u.nodeName),p=cb[u.propertyName];if(u.objectName==="bones"&&(f.isSkinnedMesh===!0?f=f.skeleton.getBoneByName(u.objectIndex):f=void 0),!f||!p)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;let m=1,v=c.values.length/c.times.length;p===cb.morphTargetInfluences&&(v/=f.morphTargetInfluences.length);let _;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(_="CUBICSPLINE",v/=3):c.getInterpolation()===al?_="STEP":_="LINEAR",a.push({input:this.processAccessor(new en(c.times,m)),output:this.processAccessor(new en(c.values,v)),interpolation:_}),s.push({sampler:a.length-1,target:{node:r.get(f),path:p}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:s}),i.animations.length-1}processSkin(e){let t=this.json,i=this.nodeMap,r=t.nodes[i.get(e)],o=e.skeleton;if(o===void 0)return null;let s=e.skeleton.bones[0];if(s===void 0)return null;let a=[],l=new Float32Array(o.bones.length*16),c=new Ft;for(let f=0;f<o.bones.length;++f)a.push(i.get(o.bones[f])),c.copy(o.boneInverses[f]),c.multiply(e.bindMatrix).toArray(l,f*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new en(l,16)),joints:a,skeleton:i.get(s)}),r.skin=t.skins.length-1}processNode(e){let t=this.json,i=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);let o={};if(i.trs){let a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();_u(a,[0,0,0,1])||(o.rotation=a),_u(l,[0,0,0])||(o.translation=l),_u(c,[1,1,1])||(o.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),y3(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){let a=this.processMesh(e);a!==null&&(o.mesh=a)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let a=[];for(let l=0,c=e.children.length;l<c;l++){let u=e.children[l];if(u.visible||i.onlyVisible===!1){let f=this.processNode(u);f!==null&&a.push(f)}}a.length>0&&(o.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,o)});let s=t.nodes.push(o)-1;return r.set(e,s),s}processScene(e){let t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);let r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);let o=[];for(let s=0,a=e.children.length;s<a;s++){let l=e.children[s];if(l.visible||i.onlyVisible===!1){let c=this.processNode(l);c!==null&&o.push(c)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){let t=new Hr;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});let i=[];for(let r=0;r<e.length;r++)e[r]instanceof Hr?this.processScene(e[r]):i.push(e[r]);i.length>0&&this.processObjects(i);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}},R_=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let i=this.writer,r=i.json,o=i.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(1-e.penumbra)*e.angle,s.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);let a=r.extensions[this.name].lights;a.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}},N_=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},P_=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){let s={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(s,e.clearcoatMap),o.clearcoatTexture=s}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let s={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(s,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=s}if(e.clearcoatNormalMap){let s={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(s.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(s,e.clearcoatNormalMap),o.clearcoatNormalTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},L_=class{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;let r=this.writer.extensionsUsed,o={};o.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},F_=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){let s={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(s,e.iridescenceMap),o.iridescenceTexture=s}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let s={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(s,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},O_=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){let s={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(s,e.transmissionMap),o.transmissionTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},k_=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;let i=this.writer,r=i.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){let s={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(s,e.thicknessMap),o.thicknessTexture=s}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},U_=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;let r=this.writer.extensionsUsed,o={};o.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},B_=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(d3)&&!e.specularIntensityMap&&!e.specularColorMap)return;let i=this.writer,r=i.extensionsUsed,o={};if(e.specularIntensityMap){let s={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(s,e.specularIntensityMap),o.specularTexture=s}if(e.specularColorMap){let s={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(s,e.specularColorMap),o.specularColorTexture=s}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},V_=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;let i=this.writer,r=i.extensionsUsed,o={};if(e.sheenRoughnessMap){let s={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(s,e.sheenRoughnessMap),o.sheenRoughnessTexture=s}if(e.sheenColorMap){let s={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(s,e.sheenColorMap),o.sheenColorTexture=s}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},H_=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;let i=this.writer,r=i.extensionsUsed,o={};if(e.anisotropyMap){let s={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(s,e.anisotropyMap),o.anisotropyTexture=s}o.anisotropyStrength=e.anisotropy,o.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},z_=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;let r=this.writer.extensionsUsed,o={};o.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},G_=class{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;let i=this.writer,r=i.extensionsUsed,o={};if(e.bumpMap){let s={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(s,e.bumpMap),o.bumpTexture=s}o.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}},W_=class{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;let i=this.writer,r=e,o=new Float32Array(r.count*3),s=new Float32Array(r.count*4),a=new Float32Array(r.count*3),l=new Ft,c=new P,u=new oi,f=new P;for(let m=0;m<r.count;m++)r.getMatrixAt(m,l),l.decompose(c,u,f),c.toArray(o,m*3),u.toArray(s,m*4),f.toArray(a,m*3);let p={TRANSLATION:i.processAccessor(new en(o,3)),ROTATION:i.processAccessor(new en(s,4)),SCALE:i.processAccessor(new en(a,3))};r.instanceColor&&(p._COLOR_0=i.processAccessor(r.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:p},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}};_l.Utils={insertKeyframe:function(n,e){let i=n.getValueSize(),r=new n.TimeBufferType(n.times.length+1),o=new n.ValueBufferType(n.values.length+i),s=n.createInterpolant(new n.ValueBufferType(i)),a;if(n.times.length===0){r[0]=e;for(let l=0;l<i;l++)o[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;r[0]=e,r.set(n.times,1),o.set(s.evaluate(e),0),o.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;r[r.length-1]=e,r.set(n.times,0),o.set(n.values,0),o.set(s.evaluate(e),n.values.length),a=r.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){r.set(n.times.slice(0,l+1),0),r[l+1]=e,r.set(n.times.slice(l+1),l+2),o.set(n.values.slice(0,(l+1)*i),0),o.set(s.evaluate(e),(l+1)*i),o.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=r,n.values=o,a},mergeMorphTargetTracks:function(n,e){let t=[],i={},r=n.tracks;for(let o=0;o<r.length;++o){let s=r[o],a=Nt.parseTrackName(s.name),l=Nt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),s=s.clone(),s.setInterpolation(ll)}let c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let f;if(i[l.uuid]===void 0){f=s.clone();let m=new f.ValueBufferType(c*f.times.length);for(let v=0;v<f.times.length;v++)m[v*c+u]=f.values[v];f.name=(a.nodeName||"")+".morphTargetInfluences",f.values=m,i[l.uuid]=f,t.push(f);continue}let p=s.createInterpolant(new s.ValueBufferType(1));f=i[l.uuid];for(let m=0;m<f.times.length;m++)f.values[m*c+u]=p.evaluate(f.times[m]);for(let m=0;m<s.times.length;m++){let v=this.insertKeyframe(f,s.times[m]);f.values[v*c+u]=s.values[m]}}return n.tracks=t,n}};var lp=class{parse(e,t={}){t=Object.assign({binary:!1},t);let i=t.binary,r=[],o=0;e.traverse(function(g){if(g.isMesh){let T=g.geometry,x=T.index,M=T.getAttribute("position");o+=x!==null?x.count/3:M.count/3,r.push({object3d:g,geometry:T})}});let s,a=80;if(i===!0){let g=o*2+o*3*4*4+80+4,T=new ArrayBuffer(g);s=new DataView(T),s.setUint32(a,o,!0),a+=4}else s="",s+=`solid exported
`;let l=new P,c=new P,u=new P,f=new P,p=new P,m=new P;for(let g=0,T=r.length;g<T;g++){let x=r[g].object3d,M=r[g].geometry,D=M.index,I=M.getAttribute("position");if(D!==null)for(let A=0;A<D.count;A+=3){let k=D.getX(A+0),w=D.getX(A+1),S=D.getX(A+2);v(k,w,S,I,x)}else for(let A=0;A<I.count;A+=3){let k=A+0,w=A+1,S=A+2;v(k,w,S,I,x)}}return i===!1&&(s+=`endsolid exported
`),s;function v(g,T,x,M,D){l.fromBufferAttribute(M,g),c.fromBufferAttribute(M,T),u.fromBufferAttribute(M,x),D.isSkinnedMesh===!0&&(D.applyBoneTransform(g,l),D.applyBoneTransform(T,c),D.applyBoneTransform(x,u)),l.applyMatrix4(D.matrixWorld),c.applyMatrix4(D.matrixWorld),u.applyMatrix4(D.matrixWorld),_(l,c,u),y(l),y(c),y(u),i===!0?(s.setUint16(a,0,!0),a+=2):(s+=`		endloop
`,s+=`	endfacet
`)}function _(g,T,x){f.subVectors(x,T),p.subVectors(g,T),f.cross(p).normalize(),m.copy(f).normalize(),i===!0?(s.setFloat32(a,m.x,!0),a+=4,s.setFloat32(a,m.y,!0),a+=4,s.setFloat32(a,m.z,!0),a+=4):(s+="	facet normal "+m.x+" "+m.y+" "+m.z+`
`,s+=`		outer loop
`)}function y(g){i===!0?(s.setFloat32(a,g.x,!0),a+=4,s.setFloat32(a,g.y,!0),a+=4,s.setFloat32(a,g.z,!0),a+=4):s+="			vertex "+g.x+" "+g.y+" "+g.z+`
`}}};var _3,E3;function x3(){return{geminiUrl:_3,vertexUrl:E3}}function S3(n,e,t,i){var r,o;if(!n?.baseUrl){let s=x3();return e?(r=s.vertexUrl)!==null&&r!==void 0?r:t:(o=s.geminiUrl)!==null&&o!==void 0?o:i}return n.baseUrl}var Gi=class{};function ge(n,e){let t=/\{([^}]+)\}/g;return n.replace(t,(i,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){let o=e[r];return o!=null?String(o):""}else throw new Error(`Key '${r}' not found in valueMap.`)})}function h(n,e,t){for(let o=0;o<e.length-1;o++){let s=e[o];if(s.endsWith("[]")){let a=s.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[a])){let l=n[a];if(Array.isArray(t))for(let c=0;c<l.length;c++){let u=l[c];h(u,e.slice(o+1),t[c])}else for(let c of l)h(c,e.slice(o+1),t)}return}else if(s.endsWith("[0]")){let a=s.slice(0,-3);a in n||(n[a]=[{}]);let l=n[a];h(l[0],e.slice(o+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}let i=e[e.length-1],r=n[i];if(r!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===r)return;if(typeof r=="object"&&typeof t=="object"&&r!==null&&t!==null)Object.assign(r,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function d(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;let r=e[i];if(r.endsWith("[]")){let o=r.slice(0,-2);if(o in n){let s=n[o];return Array.isArray(s)?s.map(a=>d(a,e.slice(i+1),t)):t}else return t}else n=n[r]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function T3(n,e){for(let[t,i]of Object.entries(e)){let r=t.split("."),o=i.split("."),s=new Set,a=-1;for(let l=0;l<r.length;l++)if(r[l]==="*"){a=l;break}if(a!==-1&&o.length>a)for(let l=a;l<o.length;l++){let c=o[l];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&s.add(c)}q_(n,r,o,0,s)}}function q_(n,e,t,i,r){if(i>=e.length||typeof n!="object"||n===null)return;let o=e[i];if(o.endsWith("[]")){let s=o.slice(0,-2),a=n;if(s in a&&Array.isArray(a[s]))for(let l of a[s])q_(l,e,t,i+1,r)}else if(o==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let s=n,a=Object.keys(s).filter(c=>!c.startsWith("_")&&!r.has(c)),l={};for(let c of a)l[c]=s[c];for(let[c,u]of Object.entries(l)){let f=[];for(let p of t.slice(i))p==="*"?f.push(c):f.push(p);h(s,f,u)}for(let c of a)delete s[c]}}else{let s=n;o in s&&q_(s[o],e,t,i+1,r)}}function O0(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function M3(n){let e={},t=d(n,["operationName"]);t!=null&&h(e,["operationName"],t);let i=d(n,["resourceName"]);return i!=null&&h(e,["_url","resourceName"],i),e}function C3(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response","generateVideoResponse"]);return s!=null&&h(e,["response"],b3(s)),e}function w3(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response"]);return s!=null&&h(e,["response"],I3(s)),e}function b3(n){let e={},t=d(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>A3(s))),h(e,["generatedVideos"],o)}let i=d(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=d(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function I3(n){let e={},t=d(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>D3(s))),h(e,["generatedVideos"],o)}let i=d(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=d(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function A3(n){let e={},t=d(n,["video"]);return t!=null&&h(e,["video"],O3(t)),e}function D3(n){let e={},t=d(n,["_self"]);return t!=null&&h(e,["video"],k3(t)),e}function R3(n){let e={},t=d(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function N3(n){let e={},t=d(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function P3(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response"]);return s!=null&&h(e,["response"],L3(s)),e}function L3(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["parent"]);i!=null&&h(e,["parent"],i);let r=d(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function Lb(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response"]);return s!=null&&h(e,["response"],F3(s)),e}function F3(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["parent"]);i!=null&&h(e,["parent"],i);let r=d(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function O3(n){let e={},t=d(n,["uri"]);t!=null&&h(e,["uri"],t);let i=d(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],O0(i));let r=d(n,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function k3(n){let e={},t=d(n,["gcsUri"]);t!=null&&h(e,["uri"],t);let i=d(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],O0(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}var zi=(function(n){return n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL",n})(zi||{});var $_=(function(n){return n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO",n})($_||{});var Fb=(function(n){return n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",n})(Fb||{});var Eu=(function(n){return n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT",n})(Eu||{});var Su=class{constructor(e){let t={};for(let i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var Ds=class{get text(){var e,t,i,r,o,s,a,l;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",u=!1,f=[];for(let p of(l=(a=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[m,v]of Object.entries(p))m!=="text"&&m!=="thought"&&(v!==null||v!==void 0)&&f.push(m);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;u=!0,c+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?c:void 0}get data(){var e,t,i,r,o,s,a,l;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",u=[];for(let f of(l=(a=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(let[p,m]of Object.entries(f))p!=="inlineData"&&(m!==null||m!==void 0)&&u.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(c+=atob(f.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,i,r,o,s,a,l;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(l=(a=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if(c?.length!==0)return c}get executableCode(){var e,t,i,r,o,s,a,l,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=(l=(a=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if(u?.length!==0)return(c=u?.[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,i,r,o,s,a,l,c;if(((r=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||r===void 0?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=(l=(a=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if(u?.length!==0)return(c=u?.[0])===null||c===void 0?void 0:c.output}},dp=class{},fp=class{},Y_=class{},X_=class{},J_=class{},j_=class{},hp=class{},pp=class{},mp=class{},Z_=class{};var gp=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,r,o=e;return t?r=w3(o):r=C3(o),Object.assign(i,r),i}},yp=class{},vp=class{},_p=class{},K_=class{},Q_=class{},e0=class{};var t0=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,o=P3(e);return Object.assign(i,o),i}},n0=class{},i0=class{},r0=class{};var Ep=class{};var o0=class{get text(){var e,t,i;let r="",o=!1,s=[];for(let a of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[l,c]of Object.entries(a))l!=="text"&&l!=="thought"&&c!==null&&s.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;o=!0,r+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?r:void 0}get data(){var e,t,i;let r="",o=[];for(let s of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(let[a,l]of Object.entries(s))a!=="inlineData"&&l!==null&&o.push(a);s.inlineData&&typeof s.inlineData.data=="string"&&(r+=atob(s.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}};var s0=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var a0=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let i=new n,o=Lb(e);return Object.assign(i,o),i}};function Et(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Ob(n,e){let t=Et(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function kb(n){return Array.isArray(n)?n.map(e=>xp(e)):[xp(n)]}function xp(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function Ub(n){let e=xp(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Bb(n){let e=xp(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function mb(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function Vb(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>mb(e)):[mb(n)]}function l0(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function gb(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function yb(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Nn(n){if(n==null)throw new Error("ContentUnion is required");return l0(n)?n:{role:"user",parts:Vb(n)}}function k0(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let i=Nn(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){let t=Nn(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Nn(t)):[Nn(e)]}function Mi(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(gb(n)||yb(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Nn(n)]}let e=[],t=[],i=l0(n[0]);for(let r of n){let o=l0(r);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(r);else{if(gb(r)||yb(r))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(r)}}return i||e.push({role:"user",parts:Vb(t)}),e}function U3(n,e){n.includes("null")&&(e.nullable=!0);let t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(zi).includes(t[0].toUpperCase())?t[0].toUpperCase():zi.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let i of t)e.anyOf.push({type:Object.values(zi).includes(i.toUpperCase())?i.toUpperCase():zi.TYPE_UNSPECIFIED})}}function El(n){let e={},t=["items"],i=["anyOf"],r=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&U3(n.type,e);for(let[s,a]of Object.entries(n))if(a!=null)if(s=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(zi).includes(a.toUpperCase())?a.toUpperCase():zi.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=El(a);else if(i.includes(s)){let l=[];for(let c of a){if(c.type=="null"){e.nullable=!0;continue}l.push(El(c))}e[s]=l}else if(r.includes(s)){let l={};for(let[c,u]of Object.entries(a))l[c]=El(u);e[s]=l}else{if(s==="additionalProperties")continue;e[s]=a}return e}function U0(n){return El(n)}function B0(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function V0(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Tl(n){if(n.functionDeclarations)for(let e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=El(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=El(e.response));return n}function Ml(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of n)e.push(t);return e}function B3(n,e,t,i=1){let r=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:r?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:r?`${t}/${e}`:e}function Wr(n,e){if(typeof e!="string")throw new Error("name must be a string");return B3(n,e,"cachedContents")}function Hb(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Io(n){return O0(n)}function V3(n){return n!=null&&typeof n=="object"&&"name"in n}function H3(n){return n!=null&&typeof n=="object"&&"video"in n}function z3(n){return n!=null&&typeof n=="object"&&"uri"in n}function zb(n){var e;let t;if(V3(n)&&(t=n.name),!(z3(n)&&(t=n.uri,t===void 0))&&!(H3(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let r=t.split("files/")[1].match(/[a-z0-9]+/);if(r===null)throw new Error(`Could not extract file name from URI ${t}`);t=r[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Gb(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Wb(n){for(let e of["models","tunedModels","publisherModels"])if(G3(n,e))return n[e];return[]}function G3(n,e){return n!==null&&typeof n=="object"&&e in n}function W3(n,e={}){let t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function q3(n,e={}){let t=[],i=new Set;for(let r of n){let o=r.name;if(i.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);i.add(o);let s=W3(r,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function qb(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,r=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(r>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||r!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function $3(n){if(typeof n!="string")return n;let e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function $b(n){if(typeof n!="object"||n===null)return{};let e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;let r=t.inlinedResponses;if(!Array.isArray(r)||r.length===0)return n;let o=!1;for(let s of r){if(typeof s!="object"||s===null)continue;let l=s.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function Cl(n,e){let t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Yb(n){let e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function Y3(n){let e={},t=d(n,["responsesFile"]);t!=null&&h(e,["fileName"],t);let i=d(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>MV(s))),h(e,["inlinedResponses"],o)}let r=d(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["inlinedEmbedContentResponses"],o)}return e}function X3(n){let e={},t=d(n,["predictionsFormat"]);t!=null&&h(e,["format"],t);let i=d(n,["gcsDestination","outputUriPrefix"]);i!=null&&h(e,["gcsUri"],i);let r=d(n,["bigqueryDestination","outputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function J3(n){let e={},t=d(n,["format"]);t!=null&&h(e,["predictionsFormat"],t);let i=d(n,["gcsUri"]);i!=null&&h(e,["gcsDestination","outputUriPrefix"],i);let r=d(n,["bigqueryUri"]);if(r!=null&&h(e,["bigqueryDestination","outputUri"],r),d(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(d(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(d(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function cp(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata","displayName"]);i!=null&&h(e,["displayName"],i);let r=d(n,["metadata","state"]);r!=null&&h(e,["state"],Yb(r));let o=d(n,["metadata","createTime"]);o!=null&&h(e,["createTime"],o);let s=d(n,["metadata","endTime"]);s!=null&&h(e,["endTime"],s);let a=d(n,["metadata","updateTime"]);a!=null&&h(e,["updateTime"],a);let l=d(n,["metadata","model"]);l!=null&&h(e,["model"],l);let c=d(n,["metadata","output"]);return c!=null&&h(e,["dest"],Y3($b(c))),e}function c0(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=d(n,["state"]);r!=null&&h(e,["state"],Yb(r));let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["createTime"]);s!=null&&h(e,["createTime"],s);let a=d(n,["startTime"]);a!=null&&h(e,["startTime"],a);let l=d(n,["endTime"]);l!=null&&h(e,["endTime"],l);let c=d(n,["updateTime"]);c!=null&&h(e,["updateTime"],c);let u=d(n,["model"]);u!=null&&h(e,["model"],u);let f=d(n,["inputConfig"]);f!=null&&h(e,["src"],j3(f));let p=d(n,["outputConfig"]);p!=null&&h(e,["dest"],X3($b(p)));let m=d(n,["completionStats"]);return m!=null&&h(e,["completionStats"],m),e}function j3(n){let e={},t=d(n,["instancesFormat"]);t!=null&&h(e,["format"],t);let i=d(n,["gcsSource","uris"]);i!=null&&h(e,["gcsUri"],i);let r=d(n,["bigquerySource","inputUri"]);return r!=null&&h(e,["bigqueryUri"],r),e}function Z3(n,e){let t={};if(d(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(d(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(d(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let i=d(e,["fileName"]);i!=null&&h(t,["fileName"],i);let r=d(e,["inlinedRequests"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>TV(n,s))),h(t,["requests","requests"],o)}return t}function K3(n){let e={},t=d(n,["format"]);t!=null&&h(e,["instancesFormat"],t);let i=d(n,["gcsUri"]);i!=null&&h(e,["gcsSource","uris"],i);let r=d(n,["bigqueryUri"]);if(r!=null&&h(e,["bigquerySource","inputUri"],r),d(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(d(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Q3(n){let e={},t=d(n,["data"]);if(t!=null&&h(e,["data"],t),d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function eV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function tV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function nV(n){let e={},t=d(n,["content"]);t!=null&&h(e,["content"],t);let i=d(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],iV(i));let r=d(n,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);let o=d(n,["finishReason"]);o!=null&&h(e,["finishReason"],o);let s=d(n,["avgLogprobs"]);s!=null&&h(e,["avgLogprobs"],s);let a=d(n,["groundingMetadata"]);a!=null&&h(e,["groundingMetadata"],a);let l=d(n,["index"]);l!=null&&h(e,["index"],l);let c=d(n,["logprobsResult"]);c!=null&&h(e,["logprobsResult"],c);let u=d(n,["safetyRatings"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>m)),h(e,["safetyRatings"],p)}let f=d(n,["urlContextMetadata"]);return f!=null&&h(e,["urlContextMetadata"],f),e}function iV(n){let e={},t=d(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["citations"],i)}return e}function Xb(n){let e={},t=d(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>RV(o))),h(e,["parts"],r)}let i=d(n,["role"]);return i!=null&&h(e,["role"],i),e}function rV(n,e){let t={},i=d(n,["displayName"]);if(e!==void 0&&i!=null&&h(e,["batch","displayName"],i),d(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function oV(n,e){let t={},i=d(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=d(n,["dest"]);return e!==void 0&&r!=null&&h(e,["outputConfig"],J3($3(r))),t}function vb(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["src"]);r!=null&&h(t,["batch","inputConfig"],Z3(n,qb(n,r)));let o=d(e,["config"]);return o!=null&&rV(o,t),t}function sV(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["model"],Et(n,i));let r=d(e,["src"]);r!=null&&h(t,["inputConfig"],K3(qb(n,r)));let o=d(e,["config"]);return o!=null&&oV(o,t),t}function aV(n,e){let t={},i=d(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["batch","displayName"],i),t}function lV(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["src"]);r!=null&&h(t,["batch","inputConfig"],mV(n,r));let o=d(e,["config"]);return o!=null&&aV(o,t),t}function cV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function uV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function dV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["name"]);i!=null&&h(e,["name"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);return o!=null&&h(e,["error"],o),e}function fV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["name"]);i!=null&&h(e,["name"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);return o!=null&&h(e,["error"],o),e}function hV(n,e){let t={},i=d(e,["contents"]);if(i!=null){let o=k0(n,i);Array.isArray(o)&&(o=o.map(s=>s)),h(t,["requests[]","request","content"],o)}let r=d(e,["config"]);return r!=null&&(h(t,["_self"],pV(r,t)),T3(t,{"requests[].*":"requests[].request.*"})),t}function pV(n,e){let t={},i=d(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);let r=d(n,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);let o=d(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),d(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(d(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function mV(n,e){let t={},i=d(e,["fileName"]);i!=null&&h(t,["file_name"],i);let r=d(e,["inlinedRequests"]);return r!=null&&h(t,["requests"],hV(n,r)),t}function gV(n){let e={};if(d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=d(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function yV(n,e,t){let i={},r=d(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],Xb(Nn(r)));let o=d(e,["temperature"]);o!=null&&h(i,["temperature"],o);let s=d(e,["topP"]);s!=null&&h(i,["topP"],s);let a=d(e,["topK"]);a!=null&&h(i,["topK"],a);let l=d(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);let c=d(e,["maxOutputTokens"]);c!=null&&h(i,["maxOutputTokens"],c);let u=d(e,["stopSequences"]);u!=null&&h(i,["stopSequences"],u);let f=d(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);let p=d(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);let m=d(e,["presencePenalty"]);m!=null&&h(i,["presencePenalty"],m);let v=d(e,["frequencyPenalty"]);v!=null&&h(i,["frequencyPenalty"],v);let _=d(e,["seed"]);_!=null&&h(i,["seed"],_);let y=d(e,["responseMimeType"]);y!=null&&h(i,["responseMimeType"],y);let g=d(e,["responseSchema"]);g!=null&&h(i,["responseSchema"],U0(g));let T=d(e,["responseJsonSchema"]);if(T!=null&&h(i,["responseJsonSchema"],T),d(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(d(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=d(e,["safetySettings"]);if(t!==void 0&&x!=null){let z=x;Array.isArray(z)&&(z=z.map(N=>NV(N))),h(t,["safetySettings"],z)}let M=d(e,["tools"]);if(t!==void 0&&M!=null){let z=Ml(M);Array.isArray(z)&&(z=z.map(N=>PV(Tl(N)))),h(t,["tools"],z)}let D=d(e,["toolConfig"]);if(t!==void 0&&D!=null&&h(t,["toolConfig"],D),d(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=d(e,["cachedContent"]);t!==void 0&&I!=null&&h(t,["cachedContent"],Wr(n,I));let A=d(e,["responseModalities"]);A!=null&&h(i,["responseModalities"],A);let k=d(e,["mediaResolution"]);k!=null&&h(i,["mediaResolution"],k);let w=d(e,["speechConfig"]);if(w!=null&&h(i,["speechConfig"],B0(w)),d(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let S=d(e,["thinkingConfig"]);S!=null&&h(i,["thinkingConfig"],S);let L=d(e,["imageConfig"]);return L!=null&&h(i,["imageConfig"],L),i}function vV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["candidates"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>nV(c))),h(e,["candidates"],l)}let r=d(n,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);let o=d(n,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);let s=d(n,["responseId"]);s!=null&&h(e,["responseId"],s);let a=d(n,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function _V(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function EV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Cl(n,i)),t}function xV(n){let e={};if(d(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=d(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function SV(n){let e={};if(d(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=d(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function TV(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["request","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let a=Mi(r);Array.isArray(a)&&(a=a.map(l=>Xb(l))),h(t,["request","contents"],a)}let o=d(e,["metadata"]);o!=null&&h(t,["metadata"],o);let s=d(e,["config"]);return s!=null&&h(t,["request","generationConfig"],yV(n,s,d(t,["request"],{}))),t}function MV(n){let e={},t=d(n,["response"]);t!=null&&h(e,["response"],vV(t));let i=d(n,["error"]);return i!=null&&h(e,["error"],i),e}function CV(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);if(e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),d(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function wV(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);let o=d(n,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),t}function bV(n){let e={},t=d(n,["config"]);return t!=null&&CV(t,e),e}function IV(n){let e={},t=d(n,["config"]);return t!=null&&wV(t,e),e}function AV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["operations"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>cp(s))),h(e,["batchJobs"],o)}return e}function DV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["batchPredictionJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>c0(s))),h(e,["batchJobs"],o)}return e}function RV(n){let e={},t=d(n,["functionCall"]);t!=null&&h(e,["functionCall"],t);let i=d(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=d(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=d(n,["fileData"]);o!=null&&h(e,["fileData"],gV(o));let s=d(n,["functionResponse"]);s!=null&&h(e,["functionResponse"],s);let a=d(n,["inlineData"]);a!=null&&h(e,["inlineData"],Q3(a));let l=d(n,["text"]);l!=null&&h(e,["text"],l);let c=d(n,["thought"]);c!=null&&h(e,["thought"],c);let u=d(n,["thoughtSignature"]);u!=null&&h(e,["thoughtSignature"],u);let f=d(n,["videoMetadata"]);return f!=null&&h(e,["videoMetadata"],f),e}function NV(n){let e={},t=d(n,["category"]);if(t!=null&&h(e,["category"],t),d(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=d(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function PV(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(d(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=d(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);let r=d(n,["computerUse"]);r!=null&&h(e,["computerUse"],r);let o=d(n,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);let s=d(n,["codeExecution"]);if(s!=null&&h(e,["codeExecution"],s),d(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=d(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],xV(a));let l=d(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],SV(l));let c=d(n,["urlContext"]);return c!=null&&h(e,["urlContext"],c),e}var Ao=(function(n){return n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents",n})(Ao||{}),Gr=class{constructor(e,t,i,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,r)}init(e,t,i){var r,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!i||Object.keys(i).length===0?s={config:{}}:typeof i=="object"?s=Object.assign({},i):s=i,s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(o=(r=s.config)===null||r===void 0?void 0:r.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var u0=class extends Gi{constructor(e){super(),this.apiClient=e,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new Gr(Ao.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){let t=vb(this.apiClient,e),i=t._url,r=ge("{model}:batchGenerateContent",i),a=t.batch.inputConfig.requests,l=a.requests,c=[];for(let u of l){let f=Object.assign({},u);if(f.systemInstruction){let p=f.systemInstruction;delete f.systemInstruction;let m=f.request;m.systemInstruction=p,f.request=m}c.push(f)}return a.requests=c,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let i=t?Object.assign({},t):{},r=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${r}`),i.dest===void 0){let o=this.getGcsUri(e),s=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?i.dest=`${o.slice(0,-6)}/dest`:i.dest=`${o}_dest_${r}`;else if(s)i.dest=`${s}_dest_${r}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=sV(this.apiClient,e);return a=ge("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>c0(u))}else{let c=vb(this.apiClient,e);return a=ge("{model}:batchGenerateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>cp(u))}}async createEmbeddingsInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=lV(this.apiClient,e);return o=ge("{model}:asyncBatchEmbedContent",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>cp(l))}}async get(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=EV(this.apiClient,e);return a=ge("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>c0(u))}else{let c=_V(this.apiClient,e);return a=ge("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>cp(u))}}async cancel(e){var t,i,r,o;let s="",a={};if(this.apiClient.isVertexAI()){let l=tV(this.apiClient,e);s=ge("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{let l=eV(this.apiClient,e);s=ge("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=IV(e);return a=ge("batchPredictionJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=DV(u),p=new Ep;return Object.assign(p,f),p})}else{let c=bV(e);return a=ge("batches",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=AV(u),p=new Ep;return Object.assign(p,f),p})}}async delete(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=uV(this.apiClient,e);return a=ge("batchPredictionJobs/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>fV(u))}else{let c=cV(this.apiClient,e);return a=ge("batches/{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>dV(u))}}};function LV(n){let e={},t=d(n,["data"]);if(t!=null&&h(e,["data"],t),d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function _b(n){let e={},t=d(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>tH(o))),h(e,["parts"],r)}let i=d(n,["role"]);return i!=null&&h(e,["role"],i),e}function FV(n,e){let t={},i=d(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=d(n,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);let o=d(n,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);let s=d(n,["contents"]);if(e!==void 0&&s!=null){let u=Mi(s);Array.isArray(u)&&(u=u.map(f=>_b(f))),h(e,["contents"],u)}let a=d(n,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],_b(Nn(a)));let l=d(n,["tools"]);if(e!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(f=>nH(f))),h(e,["tools"],u)}let c=d(n,["toolConfig"]);if(e!==void 0&&c!=null&&h(e,["toolConfig"],c),d(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function OV(n,e){let t={},i=d(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=d(n,["expireTime"]);e!==void 0&&r!=null&&h(e,["expireTime"],r);let o=d(n,["displayName"]);e!==void 0&&o!=null&&h(e,["displayName"],o);let s=d(n,["contents"]);if(e!==void 0&&s!=null){let f=Mi(s);Array.isArray(f)&&(f=f.map(p=>p)),h(e,["contents"],f)}let a=d(n,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],Nn(a));let l=d(n,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>iH(p))),h(e,["tools"],f)}let c=d(n,["toolConfig"]);e!==void 0&&c!=null&&h(e,["toolConfig"],c);let u=d(n,["kmsKeyName"]);return e!==void 0&&u!=null&&h(e,["encryption_spec","kmsKeyName"],u),t}function kV(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["model"],Ob(n,i));let r=d(e,["config"]);return r!=null&&FV(r,t),t}function UV(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["model"],Ob(n,i));let r=d(e,["config"]);return r!=null&&OV(r,t),t}function BV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Wr(n,i)),t}function VV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Wr(n,i)),t}function HV(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function zV(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function GV(n){let e={};if(d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=d(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function WV(n){let e={};if(d(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=d(n,["description"]);t!=null&&h(e,["description"],t);let i=d(n,["name"]);i!=null&&h(e,["name"],i);let r=d(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=d(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let s=d(n,["response"]);s!=null&&h(e,["response"],s);let a=d(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function qV(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Wr(n,i)),t}function $V(n,e){let t={},i=d(e,["name"]);return i!=null&&h(t,["_url","name"],Wr(n,i)),t}function YV(n){let e={};if(d(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=d(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function XV(n){let e={};if(d(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=d(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function JV(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function jV(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function ZV(n){let e={},t=d(n,["config"]);return t!=null&&JV(t,e),e}function KV(n){let e={},t=d(n,["config"]);return t!=null&&jV(t,e),e}function QV(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["cachedContents"],o)}return e}function eH(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["cachedContents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["cachedContents"],o)}return e}function tH(n){let e={},t=d(n,["functionCall"]);t!=null&&h(e,["functionCall"],t);let i=d(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=d(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=d(n,["fileData"]);o!=null&&h(e,["fileData"],GV(o));let s=d(n,["functionResponse"]);s!=null&&h(e,["functionResponse"],s);let a=d(n,["inlineData"]);a!=null&&h(e,["inlineData"],LV(a));let l=d(n,["text"]);l!=null&&h(e,["text"],l);let c=d(n,["thought"]);c!=null&&h(e,["thought"],c);let u=d(n,["thoughtSignature"]);u!=null&&h(e,["thoughtSignature"],u);let f=d(n,["videoMetadata"]);return f!=null&&h(e,["videoMetadata"],f),e}function nH(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(d(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=d(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);let r=d(n,["computerUse"]);r!=null&&h(e,["computerUse"],r);let o=d(n,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);let s=d(n,["codeExecution"]);if(s!=null&&h(e,["codeExecution"],s),d(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=d(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],YV(a));let l=d(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],XV(l));let c=d(n,["urlContext"]);return c!=null&&h(e,["urlContext"],c),e}function iH(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>WV(p))),h(e,["functionDeclarations"],f)}let i=d(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);let r=d(n,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);let o=d(n,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),d(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=d(n,["codeExecution"]);s!=null&&h(e,["codeExecution"],s);let a=d(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);let l=d(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);let c=d(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let u=d(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function rH(n,e){let t={},i=d(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=d(n,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),t}function oH(n,e){let t={},i=d(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);let r=d(n,["expireTime"]);return e!==void 0&&r!=null&&h(e,["expireTime"],r),t}function sH(n,e){let t={},i=d(e,["name"]);i!=null&&h(t,["_url","name"],Wr(n,i));let r=d(e,["config"]);return r!=null&&rH(r,t),t}function aH(n,e){let t={},i=d(e,["name"]);i!=null&&h(t,["_url","name"],Wr(n,i));let r=d(e,["config"]);return r!=null&&oH(r,t),t}var d0=class extends Gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gr(Ao.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=UV(this.apiClient,e);return a=ge("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{let c=kV(this.apiClient,e);return a=ge("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async get(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=$V(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{let c=qV(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async delete(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=VV(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=zV(u),p=new vp;return Object.assign(p,f),p})}else{let c=BV(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=HV(u),p=new vp;return Object.assign(p,f),p})}}async update(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=aH(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}else{let c=sH(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>u)}}async listInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=KV(e);return a=ge("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=eH(u),p=new _p;return Object.assign(p,f),p})}else{let c=ZV(e);return a=ge("cachedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=QV(u),p=new _p;return Object.assign(p,f),p})}}};function Eb(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ot(n){return this instanceof Ot?(this.v=n,this):new Ot(n)}function xl(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),r[Symbol.asyncIterator]=function(){return this},r;function s(m){return function(v){return Promise.resolve(v).then(m,f)}}function a(m,v){i[m]&&(r[m]=function(_){return new Promise(function(y,g){o.push([m,_,y,g])>1||l(m,_)})},v&&(r[m]=v(r[m])))}function l(m,v){try{c(i[m](v))}catch(_){p(o[0][3],_)}}function c(m){m.value instanceof Ot?Promise.resolve(m.value.v).then(u,f):p(o[0][2],m)}function u(m){l("next",m)}function f(m){l("throw",m)}function p(m,v){m(v),o.shift(),o.length&&l(o[0][0],o[0][1])}}function xu(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Eb=="function"?Eb(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(s){return new Promise(function(a,l){s=n[o](s),r(a,l,s.done,s.value)})}}function r(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}}function lH(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Jb(t)}function Jb(n){if(n.parts===void 0||n.parts.length===0)return!1;for(let e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function cH(n){if(n.length!==0){for(let e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function xb(n){if(n===void 0||n.length===0)return[];let e=[],t=n.length,i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{let r=[],o=!0;for(;i<t&&n[i].role==="model";)r.push(n[i]),o&&!Jb(n[i])&&(o=!1),i++;o?e.push(...r):e.pop()}return e}var f0=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new h0(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},h0=class{constructor(e,t,i,r={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=r,this.history=o,this.sendPromise=Promise.resolve(),cH(o)}async sendMessage(e){var t;await this.sendPromise;let i=Nn(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,s,a;let l=await r,c=(s=(o=l.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content,u=l.automaticFunctionCallingHistory,f=this.getHistory(!0).length,p=[];u!=null&&(p=(a=u.slice(f))!==null&&a!==void 0?a:[]);let m=c?[c]:[];this.recordHistory(i,m,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let i=Nn(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});let o=await r;return this.processStreamResponse(o,i)}getHistory(e=!1){let t=e?xb(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,r;return xl(this,arguments,function*(){var s,a,l,c;let u=[];try{for(var f=!0,p=xu(e),m;m=yield Ot(p.next()),s=m.done,!s;f=!0){c=m.value,f=!1;let v=c;if(lH(v)){let _=(r=(i=v.candidates)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.content;_!==void 0&&u.push(_)}yield yield Ot(v)}}catch(v){a={error:v}}finally{try{!f&&!s&&(l=p.return)&&(yield Ot(l.call(p)))}finally{if(a)throw a.error}}this.recordHistory(t,u)})}recordHistory(e,t,i){let r=[];t.length>0&&t.every(o=>o.role!==void 0)?r=t:r.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...xb(i)):this.history.push(e),this.history.push(...r)}};var Sp=class n extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,n.prototype)}};function uH(n){let e={},t=d(n,["file"]);return t!=null&&h(e,["file"],t),e}function dH(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function fH(n){let e={},t=d(n,["name"]);return t!=null&&h(e,["_url","file"],zb(t)),e}function hH(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function pH(n){let e={},t=d(n,["name"]);return t!=null&&h(e,["_url","file"],zb(t)),e}function mH(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function gH(n){let e={},t=d(n,["config"]);return t!=null&&mH(t,e),e}function yH(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["files"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["files"],o)}return e}var p0=class extends Gi{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gr(Ao.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=gH(e);return o=ge("files",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>{let c=yH(l),u=new n0;return Object.assign(u,c),u})}}async createInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=uH(e);return o=ge("upload/v1beta/files",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=dH(l),u=new i0;return Object.assign(u,c),u})}}async get(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=pH(e);return o=ge("files/{file}",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=fH(e);return o=ge("files/{file}",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>{let c=hH(l),u=new r0;return Object.assign(u,c),u})}}};function up(n){let e={},t=d(n,["data"]);if(t!=null&&h(e,["data"],t),d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function vH(n){let e={},t=d(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>PH(o))),h(e,["parts"],r)}let i=d(n,["role"]);return i!=null&&h(e,["role"],i),e}function _H(n){let e={};if(d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=d(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function EH(n){let e={};if(d(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=d(n,["description"]);t!=null&&h(e,["description"],t);let i=d(n,["name"]);i!=null&&h(e,["name"],i);let r=d(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=d(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let s=d(n,["response"]);s!=null&&h(e,["response"],s);let a=d(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function xH(n){let e={},t=d(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);let i=d(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);let r=d(n,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);let o=d(n,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);let s=d(n,["enableAffectiveDialog"]);s!=null&&h(e,["enableAffectiveDialog"],s);let a=d(n,["frequencyPenalty"]);a!=null&&h(e,["frequencyPenalty"],a);let l=d(n,["logprobs"]);l!=null&&h(e,["logprobs"],l);let c=d(n,["maxOutputTokens"]);c!=null&&h(e,["maxOutputTokens"],c);let u=d(n,["mediaResolution"]);u!=null&&h(e,["mediaResolution"],u);let f=d(n,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);let p=d(n,["responseLogprobs"]);p!=null&&h(e,["responseLogprobs"],p);let m=d(n,["responseMimeType"]);m!=null&&h(e,["responseMimeType"],m);let v=d(n,["responseModalities"]);v!=null&&h(e,["responseModalities"],v);let _=d(n,["responseSchema"]);_!=null&&h(e,["responseSchema"],_);let y=d(n,["routingConfig"]);y!=null&&h(e,["routingConfig"],y);let g=d(n,["seed"]);g!=null&&h(e,["seed"],g);let T=d(n,["speechConfig"]);T!=null&&h(e,["speechConfig"],jb(T));let x=d(n,["stopSequences"]);x!=null&&h(e,["stopSequences"],x);let M=d(n,["temperature"]);M!=null&&h(e,["temperature"],M);let D=d(n,["thinkingConfig"]);D!=null&&h(e,["thinkingConfig"],D);let I=d(n,["topK"]);I!=null&&h(e,["topK"],I);let A=d(n,["topP"]);if(A!=null&&h(e,["topP"],A),d(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function SH(n){let e={};if(d(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=d(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function TH(n){let e={};if(d(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=d(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function MH(n,e){let t={},i=d(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);let r=d(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=d(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let s=d(n,["topP"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","topP"],s);let a=d(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);let l=d(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);let c=d(n,["mediaResolution"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","mediaResolution"],c);let u=d(n,["seed"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","seed"],u);let f=d(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],V0(f));let p=d(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);let m=d(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],m);let v=d(n,["systemInstruction"]);e!==void 0&&v!=null&&h(e,["setup","systemInstruction"],vH(Nn(v)));let _=d(n,["tools"]);if(e!==void 0&&_!=null){let I=Ml(_);Array.isArray(I)&&(I=I.map(A=>FH(Tl(A)))),h(e,["setup","tools"],I)}let y=d(n,["sessionResumption"]);e!==void 0&&y!=null&&h(e,["setup","sessionResumption"],LH(y));let g=d(n,["inputAudioTranscription"]);e!==void 0&&g!=null&&h(e,["setup","inputAudioTranscription"],g);let T=d(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&h(e,["setup","outputAudioTranscription"],T);let x=d(n,["realtimeInputConfig"]);e!==void 0&&x!=null&&h(e,["setup","realtimeInputConfig"],x);let M=d(n,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);let D=d(n,["proactivity"]);return e!==void 0&&D!=null&&h(e,["setup","proactivity"],D),t}function CH(n,e){let t={},i=d(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],xH(i));let r=d(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=d(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let s=d(n,["topP"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","topP"],s);let a=d(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);let l=d(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);let c=d(n,["mediaResolution"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","mediaResolution"],c);let u=d(n,["seed"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","seed"],u);let f=d(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],jb(V0(f)));let p=d(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);let m=d(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],m);let v=d(n,["systemInstruction"]);e!==void 0&&v!=null&&h(e,["setup","systemInstruction"],Nn(v));let _=d(n,["tools"]);if(e!==void 0&&_!=null){let I=Ml(_);Array.isArray(I)&&(I=I.map(A=>OH(Tl(A)))),h(e,["setup","tools"],I)}let y=d(n,["sessionResumption"]);e!==void 0&&y!=null&&h(e,["setup","sessionResumption"],y);let g=d(n,["inputAudioTranscription"]);e!==void 0&&g!=null&&h(e,["setup","inputAudioTranscription"],g);let T=d(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&h(e,["setup","outputAudioTranscription"],T);let x=d(n,["realtimeInputConfig"]);e!==void 0&&x!=null&&h(e,["setup","realtimeInputConfig"],x);let M=d(n,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);let D=d(n,["proactivity"]);return e!==void 0&&D!=null&&h(e,["setup","proactivity"],D),t}function wH(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["setup","model"],Et(n,i));let r=d(e,["config"]);return r!=null&&h(t,["config"],MH(r,t)),t}function bH(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["setup","model"],Et(n,i));let r=d(e,["config"]);return r!=null&&h(t,["config"],CH(r,t)),t}function IH(n){let e={},t=d(n,["musicGenerationConfig"]);return t!=null&&h(e,["musicGenerationConfig"],t),e}function AH(n){let e={},t=d(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["weightedPrompts"],i)}return e}function DH(n){let e={},t=d(n,["media"]);if(t!=null){let c=kb(t);Array.isArray(c)&&(c=c.map(u=>up(u))),h(e,["mediaChunks"],c)}let i=d(n,["audio"]);i!=null&&h(e,["audio"],up(Bb(i)));let r=d(n,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);let o=d(n,["video"]);o!=null&&h(e,["video"],up(Ub(o)));let s=d(n,["text"]);s!=null&&h(e,["text"],s);let a=d(n,["activityStart"]);a!=null&&h(e,["activityStart"],a);let l=d(n,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function RH(n){let e={},t=d(n,["media"]);if(t!=null){let c=kb(t);Array.isArray(c)&&(c=c.map(u=>u)),h(e,["mediaChunks"],c)}let i=d(n,["audio"]);i!=null&&h(e,["audio"],Bb(i));let r=d(n,["audioStreamEnd"]);r!=null&&h(e,["audioStreamEnd"],r);let o=d(n,["video"]);o!=null&&h(e,["video"],Ub(o));let s=d(n,["text"]);s!=null&&h(e,["text"],s);let a=d(n,["activityStart"]);a!=null&&h(e,["activityStart"],a);let l=d(n,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function NH(n){let e={},t=d(n,["setupComplete"]);t!=null&&h(e,["setupComplete"],t);let i=d(n,["serverContent"]);i!=null&&h(e,["serverContent"],i);let r=d(n,["toolCall"]);r!=null&&h(e,["toolCall"],r);let o=d(n,["toolCallCancellation"]);o!=null&&h(e,["toolCallCancellation"],o);let s=d(n,["usageMetadata"]);s!=null&&h(e,["usageMetadata"],kH(s));let a=d(n,["goAway"]);a!=null&&h(e,["goAway"],a);let l=d(n,["sessionResumptionUpdate"]);return l!=null&&h(e,["sessionResumptionUpdate"],l),e}function PH(n){let e={},t=d(n,["functionCall"]);t!=null&&h(e,["functionCall"],t);let i=d(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=d(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=d(n,["fileData"]);o!=null&&h(e,["fileData"],_H(o));let s=d(n,["functionResponse"]);s!=null&&h(e,["functionResponse"],s);let a=d(n,["inlineData"]);a!=null&&h(e,["inlineData"],up(a));let l=d(n,["text"]);l!=null&&h(e,["text"],l);let c=d(n,["thought"]);c!=null&&h(e,["thought"],c);let u=d(n,["thoughtSignature"]);u!=null&&h(e,["thoughtSignature"],u);let f=d(n,["videoMetadata"]);return f!=null&&h(e,["videoMetadata"],f),e}function LH(n){let e={},t=d(n,["handle"]);if(t!=null&&h(e,["handle"],t),d(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function jb(n){let e={},t=d(n,["languageCode"]);t!=null&&h(e,["languageCode"],t);let i=d(n,["voiceConfig"]);if(i!=null&&h(e,["voiceConfig"],i),d(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function FH(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(d(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=d(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);let r=d(n,["computerUse"]);r!=null&&h(e,["computerUse"],r);let o=d(n,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);let s=d(n,["codeExecution"]);if(s!=null&&h(e,["codeExecution"],s),d(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=d(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],SH(a));let l=d(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],TH(l));let c=d(n,["urlContext"]);return c!=null&&h(e,["urlContext"],c),e}function OH(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>EH(p))),h(e,["functionDeclarations"],f)}let i=d(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);let r=d(n,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);let o=d(n,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),d(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=d(n,["codeExecution"]);s!=null&&h(e,["codeExecution"],s);let a=d(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);let l=d(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);let c=d(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let u=d(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function kH(n){let e={},t=d(n,["promptTokenCount"]);t!=null&&h(e,["promptTokenCount"],t);let i=d(n,["cachedContentTokenCount"]);i!=null&&h(e,["cachedContentTokenCount"],i);let r=d(n,["candidatesTokenCount"]);r!=null&&h(e,["responseTokenCount"],r);let o=d(n,["toolUsePromptTokenCount"]);o!=null&&h(e,["toolUsePromptTokenCount"],o);let s=d(n,["thoughtsTokenCount"]);s!=null&&h(e,["thoughtsTokenCount"],s);let a=d(n,["totalTokenCount"]);a!=null&&h(e,["totalTokenCount"],a);let l=d(n,["promptTokensDetails"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["promptTokensDetails"],m)}let c=d(n,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["cacheTokensDetails"],m)}let u=d(n,["candidatesTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["responseTokensDetails"],m)}let f=d(n,["toolUsePromptTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(v=>v)),h(e,["toolUsePromptTokensDetails"],m)}let p=d(n,["trafficType"]);return p!=null&&h(e,["trafficType"],p),e}function UH(n){let e={},t=d(n,["data"]);if(t!=null&&h(e,["data"],t),d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function BH(n){let e={},t=d(n,["content"]);t!=null&&h(e,["content"],t);let i=d(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],VH(i));let r=d(n,["tokenCount"]);r!=null&&h(e,["tokenCount"],r);let o=d(n,["finishReason"]);o!=null&&h(e,["finishReason"],o);let s=d(n,["avgLogprobs"]);s!=null&&h(e,["avgLogprobs"],s);let a=d(n,["groundingMetadata"]);a!=null&&h(e,["groundingMetadata"],a);let l=d(n,["index"]);l!=null&&h(e,["index"],l);let c=d(n,["logprobsResult"]);c!=null&&h(e,["logprobsResult"],c);let u=d(n,["safetyRatings"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>m)),h(e,["safetyRatings"],p)}let f=d(n,["urlContextMetadata"]);return f!=null&&h(e,["urlContextMetadata"],f),e}function VH(n){let e={},t=d(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>r)),h(e,["citations"],i)}return e}function HH(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let o=Mi(r);Array.isArray(o)&&(o=o.map(s=>s)),h(t,["contents"],o)}return t}function zH(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["tokensInfo"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["tokensInfo"],r)}return e}function GH(n){let e={},t=d(n,["values"]);t!=null&&h(e,["values"],t);let i=d(n,["statistics"]);return i!=null&&h(e,["statistics"],WH(i)),e}function WH(n){let e={},t=d(n,["truncated"]);t!=null&&h(e,["truncated"],t);let i=d(n,["token_count"]);return i!=null&&h(e,["tokenCount"],i),e}function Cp(n){let e={},t=d(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Jz(o))),h(e,["parts"],r)}let i=d(n,["role"]);return i!=null&&h(e,["role"],i),e}function qH(n){let e={},t=d(n,["controlType"]);t!=null&&h(e,["controlType"],t);let i=d(n,["enableControlImageComputation"]);return i!=null&&h(e,["computeControl"],i),e}function $H(n){let e={};if(d(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(d(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(d(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function YH(n,e){let t={},i=d(n,["systemInstruction"]);e!==void 0&&i!=null&&h(e,["systemInstruction"],Nn(i));let r=d(n,["tools"]);if(e!==void 0&&r!=null){let s=r;Array.isArray(s)&&(s=s.map(a=>tI(a))),h(e,["tools"],s)}let o=d(n,["generationConfig"]);return e!==void 0&&o!=null&&h(e,["generationConfig"],Oz(o)),t}function XH(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let s=Mi(r);Array.isArray(s)&&(s=s.map(a=>Cp(a))),h(t,["contents"],s)}let o=d(e,["config"]);return o!=null&&$H(o),t}function JH(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let s=Mi(r);Array.isArray(s)&&(s=s.map(a=>a)),h(t,["contents"],s)}let o=d(e,["config"]);return o!=null&&YH(o,t),t}function jH(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["totalTokens"]);i!=null&&h(e,["totalTokens"],i);let r=d(n,["cachedContentTokenCount"]);return r!=null&&h(e,["cachedContentTokenCount"],r),e}function ZH(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["totalTokens"]);return i!=null&&h(e,["totalTokens"],i),e}function KH(n,e){let t={},i=d(e,["model"]);return i!=null&&h(t,["_url","name"],Et(n,i)),t}function QH(n,e){let t={},i=d(e,["model"]);return i!=null&&h(t,["_url","name"],Et(n,i)),t}function ez(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function tz(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function nz(n,e){let t={},i=d(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=d(n,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);let o=d(n,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);let s=d(n,["aspectRatio"]);e!==void 0&&s!=null&&h(e,["parameters","aspectRatio"],s);let a=d(n,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);let l=d(n,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);let c=d(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&h(e,["parameters","safetySetting"],c);let u=d(n,["personGeneration"]);e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u);let f=d(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&h(e,["parameters","includeSafetyAttributes"],f);let p=d(n,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);let m=d(n,["language"]);e!==void 0&&m!=null&&h(e,["parameters","language"],m);let v=d(n,["outputMimeType"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","mimeType"],v);let _=d(n,["outputCompressionQuality"]);e!==void 0&&_!=null&&h(e,["parameters","outputOptions","compressionQuality"],_);let y=d(n,["addWatermark"]);e!==void 0&&y!=null&&h(e,["parameters","addWatermark"],y);let g=d(n,["labels"]);e!==void 0&&g!=null&&h(e,["labels"],g);let T=d(n,["editMode"]);e!==void 0&&T!=null&&h(e,["parameters","editMode"],T);let x=d(n,["baseSteps"]);return e!==void 0&&x!=null&&h(e,["parameters","editConfig","baseSteps"],x),t}function iz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=d(e,["referenceImages"]);if(o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>tG(l))),h(t,["instances[0]","referenceImages"],a)}let s=d(e,["config"]);return s!=null&&nz(s,t),t}function rz(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>wp(o))),h(e,["generatedImages"],r)}return e}function oz(n,e){let t={},i=d(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);let r=d(n,["title"]);e!==void 0&&r!=null&&h(e,["requests[]","title"],r);let o=d(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&h(e,["requests[]","outputDimensionality"],o),d(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(d(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function sz(n,e){let t={},i=d(n,["taskType"]);e!==void 0&&i!=null&&h(e,["instances[]","task_type"],i);let r=d(n,["title"]);e!==void 0&&r!=null&&h(e,["instances[]","title"],r);let o=d(n,["outputDimensionality"]);e!==void 0&&o!=null&&h(e,["parameters","outputDimensionality"],o);let s=d(n,["mimeType"]);e!==void 0&&s!=null&&h(e,["instances[]","mimeType"],s);let a=d(n,["autoTruncate"]);return e!==void 0&&a!=null&&h(e,["parameters","autoTruncate"],a),t}function az(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let a=k0(n,r);Array.isArray(a)&&(a=a.map(l=>l)),h(t,["requests[]","content"],a)}let o=d(e,["config"]);o!=null&&oz(o,t);let s=d(e,["model"]);return s!==void 0&&h(t,["requests[]","model"],Et(n,s)),t}function lz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let s=k0(n,r);Array.isArray(s)&&(s=s.map(a=>a)),h(t,["instances[]","content"],s)}let o=d(e,["config"]);return o!=null&&sz(o,t),t}function cz(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["embeddings"],o)}let r=d(n,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function uz(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["predictions[]","embeddings"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>GH(s))),h(e,["embeddings"],o)}let r=d(n,["metadata"]);return r!=null&&h(e,["metadata"],r),e}function dz(n){let e={},t=d(n,["endpoint"]);t!=null&&h(e,["name"],t);let i=d(n,["deployedModelId"]);return i!=null&&h(e,["deployedModelId"],i),e}function fz(n){let e={};if(d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=d(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function hz(n){let e={};if(d(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=d(n,["description"]);t!=null&&h(e,["description"],t);let i=d(n,["name"]);i!=null&&h(e,["name"],i);let r=d(n,["parameters"]);r!=null&&h(e,["parameters"],r);let o=d(n,["parametersJsonSchema"]);o!=null&&h(e,["parametersJsonSchema"],o);let s=d(n,["response"]);s!=null&&h(e,["response"],s);let a=d(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function pz(n,e,t){let i={},r=d(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],Cp(Nn(r)));let o=d(e,["temperature"]);o!=null&&h(i,["temperature"],o);let s=d(e,["topP"]);s!=null&&h(i,["topP"],s);let a=d(e,["topK"]);a!=null&&h(i,["topK"],a);let l=d(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);let c=d(e,["maxOutputTokens"]);c!=null&&h(i,["maxOutputTokens"],c);let u=d(e,["stopSequences"]);u!=null&&h(i,["stopSequences"],u);let f=d(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);let p=d(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);let m=d(e,["presencePenalty"]);m!=null&&h(i,["presencePenalty"],m);let v=d(e,["frequencyPenalty"]);v!=null&&h(i,["frequencyPenalty"],v);let _=d(e,["seed"]);_!=null&&h(i,["seed"],_);let y=d(e,["responseMimeType"]);y!=null&&h(i,["responseMimeType"],y);let g=d(e,["responseSchema"]);g!=null&&h(i,["responseSchema"],U0(g));let T=d(e,["responseJsonSchema"]);if(T!=null&&h(i,["responseJsonSchema"],T),d(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(d(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=d(e,["safetySettings"]);if(t!==void 0&&x!=null){let z=x;Array.isArray(z)&&(z=z.map(N=>nG(N))),h(t,["safetySettings"],z)}let M=d(e,["tools"]);if(t!==void 0&&M!=null){let z=Ml(M);Array.isArray(z)&&(z=z.map(N=>lG(Tl(N)))),h(t,["tools"],z)}let D=d(e,["toolConfig"]);if(t!==void 0&&D!=null&&h(t,["toolConfig"],D),d(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let I=d(e,["cachedContent"]);t!==void 0&&I!=null&&h(t,["cachedContent"],Wr(n,I));let A=d(e,["responseModalities"]);A!=null&&h(i,["responseModalities"],A);let k=d(e,["mediaResolution"]);k!=null&&h(i,["mediaResolution"],k);let w=d(e,["speechConfig"]);if(w!=null&&h(i,["speechConfig"],B0(w)),d(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let S=d(e,["thinkingConfig"]);S!=null&&h(i,["thinkingConfig"],S);let L=d(e,["imageConfig"]);return L!=null&&h(i,["imageConfig"],L),i}function mz(n,e,t){let i={},r=d(e,["systemInstruction"]);t!==void 0&&r!=null&&h(t,["systemInstruction"],Nn(r));let o=d(e,["temperature"]);o!=null&&h(i,["temperature"],o);let s=d(e,["topP"]);s!=null&&h(i,["topP"],s);let a=d(e,["topK"]);a!=null&&h(i,["topK"],a);let l=d(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);let c=d(e,["maxOutputTokens"]);c!=null&&h(i,["maxOutputTokens"],c);let u=d(e,["stopSequences"]);u!=null&&h(i,["stopSequences"],u);let f=d(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);let p=d(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);let m=d(e,["presencePenalty"]);m!=null&&h(i,["presencePenalty"],m);let v=d(e,["frequencyPenalty"]);v!=null&&h(i,["frequencyPenalty"],v);let _=d(e,["seed"]);_!=null&&h(i,["seed"],_);let y=d(e,["responseMimeType"]);y!=null&&h(i,["responseMimeType"],y);let g=d(e,["responseSchema"]);g!=null&&h(i,["responseSchema"],U0(g));let T=d(e,["responseJsonSchema"]);T!=null&&h(i,["responseJsonSchema"],T);let x=d(e,["routingConfig"]);x!=null&&h(i,["routingConfig"],x);let M=d(e,["modelSelectionConfig"]);M!=null&&h(i,["modelConfig"],M);let D=d(e,["safetySettings"]);if(t!==void 0&&D!=null){let Q=D;Array.isArray(Q)&&(Q=Q.map(re=>re)),h(t,["safetySettings"],Q)}let I=d(e,["tools"]);if(t!==void 0&&I!=null){let Q=Ml(I);Array.isArray(Q)&&(Q=Q.map(re=>tI(Tl(re)))),h(t,["tools"],Q)}let A=d(e,["toolConfig"]);t!==void 0&&A!=null&&h(t,["toolConfig"],A);let k=d(e,["labels"]);t!==void 0&&k!=null&&h(t,["labels"],k);let w=d(e,["cachedContent"]);t!==void 0&&w!=null&&h(t,["cachedContent"],Wr(n,w));let S=d(e,["responseModalities"]);S!=null&&h(i,["responseModalities"],S);let L=d(e,["mediaResolution"]);L!=null&&h(i,["mediaResolution"],L);let z=d(e,["speechConfig"]);z!=null&&h(i,["speechConfig"],eI(B0(z)));let N=d(e,["audioTimestamp"]);N!=null&&h(i,["audioTimestamp"],N);let $=d(e,["thinkingConfig"]);$!=null&&h(i,["thinkingConfig"],$);let Y=d(e,["imageConfig"]);return Y!=null&&h(i,["imageConfig"],Y),i}function Sb(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let s=Mi(r);Array.isArray(s)&&(s=s.map(a=>Cp(a))),h(t,["contents"],s)}let o=d(e,["config"]);return o!=null&&h(t,["generationConfig"],pz(n,o,t)),t}function Tb(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["contents"]);if(r!=null){let s=Mi(r);Array.isArray(s)&&(s=s.map(a=>a)),h(t,["contents"],s)}let o=d(e,["config"]);return o!=null&&h(t,["generationConfig"],mz(n,o,t)),t}function Mb(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["candidates"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>BH(c))),h(e,["candidates"],l)}let r=d(n,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);let o=d(n,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);let s=d(n,["responseId"]);s!=null&&h(e,["responseId"],s);let a=d(n,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function Cb(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(u=>u)),h(e,["candidates"],c)}let r=d(n,["createTime"]);r!=null&&h(e,["createTime"],r);let o=d(n,["modelVersion"]);o!=null&&h(e,["modelVersion"],o);let s=d(n,["promptFeedback"]);s!=null&&h(e,["promptFeedback"],s);let a=d(n,["responseId"]);a!=null&&h(e,["responseId"],a);let l=d(n,["usageMetadata"]);return l!=null&&h(e,["usageMetadata"],l),e}function gz(n,e){let t={};if(d(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(d(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let i=d(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=d(n,["aspectRatio"]);e!==void 0&&r!=null&&h(e,["parameters","aspectRatio"],r);let o=d(n,["guidanceScale"]);if(e!==void 0&&o!=null&&h(e,["parameters","guidanceScale"],o),d(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=d(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&h(e,["parameters","safetySetting"],s);let a=d(n,["personGeneration"]);e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a);let l=d(n,["includeSafetyAttributes"]);e!==void 0&&l!=null&&h(e,["parameters","includeSafetyAttributes"],l);let c=d(n,["includeRaiReason"]);e!==void 0&&c!=null&&h(e,["parameters","includeRaiReason"],c);let u=d(n,["language"]);e!==void 0&&u!=null&&h(e,["parameters","language"],u);let f=d(n,["outputMimeType"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","mimeType"],f);let p=d(n,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&h(e,["parameters","outputOptions","compressionQuality"],p),d(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(d(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let m=d(n,["imageSize"]);if(e!==void 0&&m!=null&&h(e,["parameters","sampleImageSize"],m),d(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function yz(n,e){let t={},i=d(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=d(n,["negativePrompt"]);e!==void 0&&r!=null&&h(e,["parameters","negativePrompt"],r);let o=d(n,["numberOfImages"]);e!==void 0&&o!=null&&h(e,["parameters","sampleCount"],o);let s=d(n,["aspectRatio"]);e!==void 0&&s!=null&&h(e,["parameters","aspectRatio"],s);let a=d(n,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);let l=d(n,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);let c=d(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&h(e,["parameters","safetySetting"],c);let u=d(n,["personGeneration"]);e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u);let f=d(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&h(e,["parameters","includeSafetyAttributes"],f);let p=d(n,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);let m=d(n,["language"]);e!==void 0&&m!=null&&h(e,["parameters","language"],m);let v=d(n,["outputMimeType"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","mimeType"],v);let _=d(n,["outputCompressionQuality"]);e!==void 0&&_!=null&&h(e,["parameters","outputOptions","compressionQuality"],_);let y=d(n,["addWatermark"]);e!==void 0&&y!=null&&h(e,["parameters","addWatermark"],y);let g=d(n,["labels"]);e!==void 0&&g!=null&&h(e,["labels"],g);let T=d(n,["imageSize"]);e!==void 0&&T!=null&&h(e,["parameters","sampleImageSize"],T);let x=d(n,["enhancePrompt"]);return e!==void 0&&x!=null&&h(e,["parameters","enhancePrompt"],x),t}function vz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=d(e,["config"]);return o!=null&&gz(o,t),t}function _z(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=d(e,["config"]);return o!=null&&yz(o,t),t}function Ez(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Nz(s))),h(e,["generatedImages"],o)}let r=d(n,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],Kb(r)),e}function xz(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>wp(s))),h(e,["generatedImages"],o)}let r=d(n,["positivePromptSafetyAttributes"]);return r!=null&&h(e,["positivePromptSafetyAttributes"],Qb(r)),e}function Sz(n,e){let t={},i=d(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i),d(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(d(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let r=d(n,["durationSeconds"]);if(e!==void 0&&r!=null&&h(e,["parameters","durationSeconds"],r),d(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=d(n,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);let s=d(n,["resolution"]);e!==void 0&&s!=null&&h(e,["parameters","resolution"],s);let a=d(n,["personGeneration"]);if(e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a),d(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let l=d(n,["negativePrompt"]);e!==void 0&&l!=null&&h(e,["parameters","negativePrompt"],l);let c=d(n,["enhancePrompt"]);if(e!==void 0&&c!=null&&h(e,["parameters","enhancePrompt"],c),d(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let u=d(n,["lastFrame"]);e!==void 0&&u!=null&&h(e,["instances[0]","lastFrame"],bp(u));let f=d(n,["referenceImages"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>xG(m))),h(e,["instances[0]","referenceImages"],p)}if(d(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(d(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function Tz(n,e){let t={},i=d(n,["numberOfVideos"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=d(n,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);let o=d(n,["fps"]);e!==void 0&&o!=null&&h(e,["parameters","fps"],o);let s=d(n,["durationSeconds"]);e!==void 0&&s!=null&&h(e,["parameters","durationSeconds"],s);let a=d(n,["seed"]);e!==void 0&&a!=null&&h(e,["parameters","seed"],a);let l=d(n,["aspectRatio"]);e!==void 0&&l!=null&&h(e,["parameters","aspectRatio"],l);let c=d(n,["resolution"]);e!==void 0&&c!=null&&h(e,["parameters","resolution"],c);let u=d(n,["personGeneration"]);e!==void 0&&u!=null&&h(e,["parameters","personGeneration"],u);let f=d(n,["pubsubTopic"]);e!==void 0&&f!=null&&h(e,["parameters","pubsubTopic"],f);let p=d(n,["negativePrompt"]);e!==void 0&&p!=null&&h(e,["parameters","negativePrompt"],p);let m=d(n,["enhancePrompt"]);e!==void 0&&m!=null&&h(e,["parameters","enhancePrompt"],m);let v=d(n,["generateAudio"]);e!==void 0&&v!=null&&h(e,["parameters","generateAudio"],v);let _=d(n,["lastFrame"]);e!==void 0&&_!=null&&h(e,["instances[0]","lastFrame"],Wi(_));let y=d(n,["referenceImages"]);if(e!==void 0&&y!=null){let x=y;Array.isArray(x)&&(x=x.map(M=>SG(M))),h(e,["instances[0]","referenceImages"],x)}let g=d(n,["mask"]);e!==void 0&&g!=null&&h(e,["instances[0]","mask"],EG(g));let T=d(n,["compressionQuality"]);return e!==void 0&&T!=null&&h(e,["parameters","compressionQuality"],T),t}function Mz(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response","generateVideoResponse"]);return s!=null&&h(e,["response"],Iz(s)),e}function Cz(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response"]);return s!=null&&h(e,["response"],Az(s)),e}function wz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=d(e,["image"]);o!=null&&h(t,["instances[0]","image"],bp(o));let s=d(e,["video"]);s!=null&&h(t,["instances[0]","video"],nI(s));let a=d(e,["source"]);a!=null&&Dz(a,t);let l=d(e,["config"]);return l!=null&&Sz(l,t),t}function bz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["prompt"]);r!=null&&h(t,["instances[0]","prompt"],r);let o=d(e,["image"]);o!=null&&h(t,["instances[0]","image"],Wi(o));let s=d(e,["video"]);s!=null&&h(t,["instances[0]","video"],iI(s));let a=d(e,["source"]);a!=null&&Rz(a,t);let l=d(e,["config"]);return l!=null&&Tz(l,t),t}function Iz(n){let e={},t=d(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Lz(s))),h(e,["generatedVideos"],o)}let i=d(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=d(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function Az(n){let e={},t=d(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Fz(s))),h(e,["generatedVideos"],o)}let i=d(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);let r=d(n,["raiMediaFilteredReasons"]);return r!=null&&h(e,["raiMediaFilteredReasons"],r),e}function Dz(n,e){let t={},i=d(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=d(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],bp(r));let o=d(n,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],nI(o)),t}function Rz(n,e){let t={},i=d(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=d(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],Wi(r));let o=d(n,["video"]);return e!==void 0&&o!=null&&h(e,["instances[0]","video"],iI(o)),t}function Nz(n){let e={},t=d(n,["_self"]);t!=null&&h(e,["image"],Hz(t));let i=d(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);let r=d(n,["_self"]);return r!=null&&h(e,["safetyAttributes"],Kb(r)),e}function wp(n){let e={},t=d(n,["_self"]);t!=null&&h(e,["image"],Zb(t));let i=d(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);let r=d(n,["_self"]);r!=null&&h(e,["safetyAttributes"],Qb(r));let o=d(n,["prompt"]);return o!=null&&h(e,["enhancedPrompt"],o),e}function Pz(n){let e={},t=d(n,["_self"]);t!=null&&h(e,["mask"],Zb(t));let i=d(n,["labels"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["labels"],r)}return e}function Lz(n){let e={},t=d(n,["video"]);return t!=null&&h(e,["video"],vG(t)),e}function Fz(n){let e={},t=d(n,["_self"]);return t!=null&&h(e,["video"],_G(t)),e}function Oz(n){let e={},t=d(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);let i=d(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);let r=d(n,["audioTimestamp"]);r!=null&&h(e,["audioTimestamp"],r);let o=d(n,["candidateCount"]);o!=null&&h(e,["candidateCount"],o);let s=d(n,["enableAffectiveDialog"]);s!=null&&h(e,["enableAffectiveDialog"],s);let a=d(n,["frequencyPenalty"]);a!=null&&h(e,["frequencyPenalty"],a);let l=d(n,["logprobs"]);l!=null&&h(e,["logprobs"],l);let c=d(n,["maxOutputTokens"]);c!=null&&h(e,["maxOutputTokens"],c);let u=d(n,["mediaResolution"]);u!=null&&h(e,["mediaResolution"],u);let f=d(n,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);let p=d(n,["responseLogprobs"]);p!=null&&h(e,["responseLogprobs"],p);let m=d(n,["responseMimeType"]);m!=null&&h(e,["responseMimeType"],m);let v=d(n,["responseModalities"]);v!=null&&h(e,["responseModalities"],v);let _=d(n,["responseSchema"]);_!=null&&h(e,["responseSchema"],_);let y=d(n,["routingConfig"]);y!=null&&h(e,["routingConfig"],y);let g=d(n,["seed"]);g!=null&&h(e,["seed"],g);let T=d(n,["speechConfig"]);T!=null&&h(e,["speechConfig"],eI(T));let x=d(n,["stopSequences"]);x!=null&&h(e,["stopSequences"],x);let M=d(n,["temperature"]);M!=null&&h(e,["temperature"],M);let D=d(n,["thinkingConfig"]);D!=null&&h(e,["thinkingConfig"],D);let I=d(n,["topK"]);I!=null&&h(e,["topK"],I);let A=d(n,["topP"]);if(A!=null&&h(e,["topP"],A),d(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function kz(n,e){let t={},i=d(e,["model"]);return i!=null&&h(t,["_url","name"],Et(n,i)),t}function Uz(n,e){let t={},i=d(e,["model"]);return i!=null&&h(t,["_url","name"],Et(n,i)),t}function Bz(n){let e={};if(d(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=d(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function Vz(n){let e={};if(d(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=d(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function Hz(n){let e={},t=d(n,["bytesBase64Encoded"]);t!=null&&h(e,["imageBytes"],Io(t));let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Zb(n){let e={},t=d(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);let i=d(n,["bytesBase64Encoded"]);i!=null&&h(e,["imageBytes"],Io(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function bp(n){let e={};if(d(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=d(n,["imageBytes"]);t!=null&&h(e,["bytesBase64Encoded"],Io(t));let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Wi(n){let e={},t=d(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);let i=d(n,["imageBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Io(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function zz(n,e,t){let i={},r=d(e,["pageSize"]);t!==void 0&&r!=null&&h(t,["_query","pageSize"],r);let o=d(e,["pageToken"]);t!==void 0&&o!=null&&h(t,["_query","pageToken"],o);let s=d(e,["filter"]);t!==void 0&&s!=null&&h(t,["_query","filter"],s);let a=d(e,["queryBase"]);return t!==void 0&&a!=null&&h(t,["_url","models_url"],Gb(n,a)),i}function Gz(n,e,t){let i={},r=d(e,["pageSize"]);t!==void 0&&r!=null&&h(t,["_query","pageSize"],r);let o=d(e,["pageToken"]);t!==void 0&&o!=null&&h(t,["_query","pageToken"],o);let s=d(e,["filter"]);t!==void 0&&s!=null&&h(t,["_query","filter"],s);let a=d(e,["queryBase"]);return t!==void 0&&a!=null&&h(t,["_url","models_url"],Gb(n,a)),i}function Wz(n,e){let t={},i=d(e,["config"]);return i!=null&&zz(n,i,t),t}function qz(n,e){let t={},i=d(e,["config"]);return i!=null&&Gz(n,i,t),t}function $z(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["_self"]);if(r!=null){let o=Wb(r);Array.isArray(o)&&(o=o.map(s=>m0(s))),h(e,["models"],o)}return e}function Yz(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["_self"]);if(r!=null){let o=Wb(r);Array.isArray(o)&&(o=o.map(s=>g0(s))),h(e,["models"],o)}return e}function Xz(n){let e={},t=d(n,["maskMode"]);t!=null&&h(e,["maskMode"],t);let i=d(n,["segmentationClasses"]);i!=null&&h(e,["maskClasses"],i);let r=d(n,["maskDilation"]);return r!=null&&h(e,["dilation"],r),e}function m0(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=d(n,["description"]);r!=null&&h(e,["description"],r);let o=d(n,["version"]);o!=null&&h(e,["version"],o);let s=d(n,["_self"]);s!=null&&h(e,["tunedModelInfo"],cG(s));let a=d(n,["inputTokenLimit"]);a!=null&&h(e,["inputTokenLimit"],a);let l=d(n,["outputTokenLimit"]);l!=null&&h(e,["outputTokenLimit"],l);let c=d(n,["supportedGenerationMethods"]);return c!=null&&h(e,["supportedActions"],c),e}function g0(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["displayName"]);i!=null&&h(e,["displayName"],i);let r=d(n,["description"]);r!=null&&h(e,["description"],r);let o=d(n,["versionId"]);o!=null&&h(e,["version"],o);let s=d(n,["deployedModels"]);if(s!=null){let f=s;Array.isArray(f)&&(f=f.map(p=>dz(p))),h(e,["endpoints"],f)}let a=d(n,["labels"]);a!=null&&h(e,["labels"],a);let l=d(n,["_self"]);l!=null&&h(e,["tunedModelInfo"],uG(l));let c=d(n,["defaultCheckpointId"]);c!=null&&h(e,["defaultCheckpointId"],c);let u=d(n,["checkpoints"]);if(u!=null){let f=u;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["checkpoints"],f)}return e}function Jz(n){let e={},t=d(n,["functionCall"]);t!=null&&h(e,["functionCall"],t);let i=d(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=d(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=d(n,["fileData"]);o!=null&&h(e,["fileData"],fz(o));let s=d(n,["functionResponse"]);s!=null&&h(e,["functionResponse"],s);let a=d(n,["inlineData"]);a!=null&&h(e,["inlineData"],UH(a));let l=d(n,["text"]);l!=null&&h(e,["text"],l);let c=d(n,["thought"]);c!=null&&h(e,["thought"],c);let u=d(n,["thoughtSignature"]);u!=null&&h(e,["thoughtSignature"],u);let f=d(n,["videoMetadata"]);return f!=null&&h(e,["videoMetadata"],f),e}function jz(n){let e={},t=d(n,["productImage"]);return t!=null&&h(e,["image"],Wi(t)),e}function Zz(n,e){let t={},i=d(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);let r=d(n,["baseSteps"]);e!==void 0&&r!=null&&h(e,["parameters","editConfig","baseSteps"],r);let o=d(n,["outputGcsUri"]);e!==void 0&&o!=null&&h(e,["parameters","storageUri"],o);let s=d(n,["seed"]);e!==void 0&&s!=null&&h(e,["parameters","seed"],s);let a=d(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&h(e,["parameters","safetySetting"],a);let l=d(n,["personGeneration"]);e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l);let c=d(n,["addWatermark"]);e!==void 0&&c!=null&&h(e,["parameters","addWatermark"],c);let u=d(n,["outputMimeType"]);e!==void 0&&u!=null&&h(e,["parameters","outputOptions","mimeType"],u);let f=d(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","compressionQuality"],f);let p=d(n,["enhancePrompt"]);e!==void 0&&p!=null&&h(e,["parameters","enhancePrompt"],p);let m=d(n,["labels"]);return e!==void 0&&m!=null&&h(e,["labels"],m),t}function Kz(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["source"]);r!=null&&eG(r,t);let o=d(e,["config"]);return o!=null&&Zz(o,t),t}function Qz(n){let e={},t=d(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>wp(r))),h(e,["generatedImages"],i)}return e}function eG(n,e){let t={},i=d(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=d(n,["personImage"]);e!==void 0&&r!=null&&h(e,["instances[0]","personImage","image"],Wi(r));let o=d(n,["productImages"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>jz(a))),h(e,["instances[0]","productImages"],s)}return t}function tG(n){let e={},t=d(n,["referenceImage"]);t!=null&&h(e,["referenceImage"],Wi(t));let i=d(n,["referenceId"]);i!=null&&h(e,["referenceId"],i);let r=d(n,["referenceType"]);r!=null&&h(e,["referenceType"],r);let o=d(n,["maskImageConfig"]);o!=null&&h(e,["maskImageConfig"],Xz(o));let s=d(n,["controlImageConfig"]);s!=null&&h(e,["controlImageConfig"],qH(s));let a=d(n,["styleImageConfig"]);a!=null&&h(e,["styleImageConfig"],a);let l=d(n,["subjectImageConfig"]);return l!=null&&h(e,["subjectImageConfig"],l),e}function Kb(n){let e={},t=d(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);let i=d(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);let r=d(n,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function Qb(n){let e={},t=d(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);let i=d(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);let r=d(n,["contentType"]);return r!=null&&h(e,["contentType"],r),e}function nG(n){let e={},t=d(n,["category"]);if(t!=null&&h(e,["category"],t),d(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let i=d(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function iG(n){let e={},t=d(n,["image"]);return t!=null&&h(e,["image"],Wi(t)),e}function rG(n,e){let t={},i=d(n,["mode"]);e!==void 0&&i!=null&&h(e,["parameters","mode"],i);let r=d(n,["maxPredictions"]);e!==void 0&&r!=null&&h(e,["parameters","maxPredictions"],r);let o=d(n,["confidenceThreshold"]);e!==void 0&&o!=null&&h(e,["parameters","confidenceThreshold"],o);let s=d(n,["maskDilation"]);e!==void 0&&s!=null&&h(e,["parameters","maskDilation"],s);let a=d(n,["binaryColorThreshold"]);e!==void 0&&a!=null&&h(e,["parameters","binaryColorThreshold"],a);let l=d(n,["labels"]);return e!==void 0&&l!=null&&h(e,["labels"],l),t}function oG(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["source"]);r!=null&&aG(r,t);let o=d(e,["config"]);return o!=null&&rG(o,t),t}function sG(n){let e={},t=d(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>Pz(r))),h(e,["generatedMasks"],i)}return e}function aG(n,e){let t={},i=d(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);let r=d(n,["image"]);e!==void 0&&r!=null&&h(e,["instances[0]","image"],Wi(r));let o=d(n,["scribbleImage"]);return e!==void 0&&o!=null&&h(e,["instances[0]","scribble"],iG(o)),t}function eI(n){let e={},t=d(n,["languageCode"]);t!=null&&h(e,["languageCode"],t);let i=d(n,["voiceConfig"]);if(i!=null&&h(e,["voiceConfig"],i),d(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function lG(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(d(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=d(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);let r=d(n,["computerUse"]);r!=null&&h(e,["computerUse"],r);let o=d(n,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);let s=d(n,["codeExecution"]);if(s!=null&&h(e,["codeExecution"],s),d(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=d(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],Bz(a));let l=d(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],Vz(l));let c=d(n,["urlContext"]);return c!=null&&h(e,["urlContext"],c),e}function tI(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>hz(p))),h(e,["functionDeclarations"],f)}let i=d(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);let r=d(n,["googleSearchRetrieval"]);r!=null&&h(e,["googleSearchRetrieval"],r);let o=d(n,["computerUse"]);if(o!=null&&h(e,["computerUse"],o),d(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=d(n,["codeExecution"]);s!=null&&h(e,["codeExecution"],s);let a=d(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);let l=d(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);let c=d(n,["googleSearch"]);c!=null&&h(e,["googleSearch"],c);let u=d(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function cG(n){let e={},t=d(n,["baseModel"]);t!=null&&h(e,["baseModel"],t);let i=d(n,["createTime"]);i!=null&&h(e,["createTime"],i);let r=d(n,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function uG(n){let e={},t=d(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&h(e,["baseModel"],t);let i=d(n,["createTime"]);i!=null&&h(e,["createTime"],i);let r=d(n,["updateTime"]);return r!=null&&h(e,["updateTime"],r),e}function dG(n,e){let t={},i=d(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=d(n,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);let o=d(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),t}function fG(n,e){let t={},i=d(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);let r=d(n,["description"]);e!==void 0&&r!=null&&h(e,["description"],r);let o=d(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&h(e,["defaultCheckpointId"],o),t}function hG(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","name"],Et(n,i));let r=d(e,["config"]);return r!=null&&dG(r,t),t}function pG(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["config"]);return r!=null&&fG(r,t),t}function mG(n,e){let t={},i=d(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);let r=d(n,["safetyFilterLevel"]);e!==void 0&&r!=null&&h(e,["parameters","safetySetting"],r);let o=d(n,["personGeneration"]);e!==void 0&&o!=null&&h(e,["parameters","personGeneration"],o);let s=d(n,["includeRaiReason"]);e!==void 0&&s!=null&&h(e,["parameters","includeRaiReason"],s);let a=d(n,["outputMimeType"]);e!==void 0&&a!=null&&h(e,["parameters","outputOptions","mimeType"],a);let l=d(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&h(e,["parameters","outputOptions","compressionQuality"],l);let c=d(n,["enhanceInputImage"]);e!==void 0&&c!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],c);let u=d(n,["imagePreservationFactor"]);e!==void 0&&u!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],u);let f=d(n,["labels"]);e!==void 0&&f!=null&&h(e,["labels"],f);let p=d(n,["numberOfImages"]);e!==void 0&&p!=null&&h(e,["parameters","sampleCount"],p);let m=d(n,["mode"]);return e!==void 0&&m!=null&&h(e,["parameters","mode"],m),t}function gG(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["_url","model"],Et(n,i));let r=d(e,["image"]);r!=null&&h(t,["instances[0]","image"],Wi(r));let o=d(e,["upscaleFactor"]);o!=null&&h(t,["parameters","upscaleConfig","upscaleFactor"],o);let s=d(e,["config"]);return s!=null&&mG(s,t),t}function yG(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>wp(o))),h(e,["generatedImages"],r)}return e}function vG(n){let e={},t=d(n,["uri"]);t!=null&&h(e,["uri"],t);let i=d(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],Io(i));let r=d(n,["encoding"]);return r!=null&&h(e,["mimeType"],r),e}function _G(n){let e={},t=d(n,["gcsUri"]);t!=null&&h(e,["uri"],t);let i=d(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],Io(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}function EG(n){let e={},t=d(n,["image"]);t!=null&&h(e,["_self"],Wi(t));let i=d(n,["maskMode"]);return i!=null&&h(e,["maskMode"],i),e}function xG(n){let e={},t=d(n,["image"]);t!=null&&h(e,["image"],bp(t));let i=d(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function SG(n){let e={},t=d(n,["image"]);t!=null&&h(e,["image"],Wi(t));let i=d(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function nI(n){let e={},t=d(n,["uri"]);t!=null&&h(e,["uri"],t);let i=d(n,["videoBytes"]);i!=null&&h(e,["encodedVideo"],Io(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["encoding"],r),e}function iI(n){let e={},t=d(n,["uri"]);t!=null&&h(e,["gcsUri"],t);let i=d(n,["videoBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Io(i));let r=d(n,["mimeType"]);return r!=null&&h(e,["mimeType"],r),e}var TG="Content-Type",MG="X-Server-Timeout",CG="User-Agent",y0="x-goog-api-client",wG="1.29.0",bG=`google-genai-sdk/${wG}`,IG="v1beta1",AG="v1beta",wb=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/,v0=class{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let r={};this.clientOptions.vertexai?(r.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:IG,r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:AG,r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){let r=[this.getRequestUrlInternal(t)];return i&&r.push(this.getBaseResourcePath()),e!==""&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);if(e.queryParams)for(let[s,a]of Object.entries(e.queryParams))r.searchParams.append(s,String(a));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,r.toString(),e.abortSignal),this.unaryApiCall(r,o,e.httpMethod)}patchHttpOptions(e,t){let i=JSON.parse(JSON.stringify(e));for(let[r,o]of Object.entries(t))typeof o=="object"?i[r]=Object.assign(Object.assign({},i[r]),o):o!==void 0&&(i[r]=o);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,i);(!r.searchParams.has("alt")||r.searchParams.get("alt")!=="sse")&&r.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,r.toString(),e.abortSignal),this.streamApiCall(r,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,r){if(t&&t.timeout||r){let o=new AbortController,s=o.signal;if(t.timeout&&t?.timeout>0){let a=setTimeout(()=>o.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}r&&r.addEventListener("abort",()=>{o.abort()}),e.signal=s}return t&&t.extraBody!==null&&DG(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await bb(r),new Su(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async r=>(await bb(r),this.processStreamResponse(r))).catch(r=>{throw r instanceof Error?r:new Error(JSON.stringify(r))})}processStreamResponse(e){var t;return xl(this,arguments,function*(){let r=(t=e?.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!r)throw new Error("Response body is empty");try{let s="";for(;;){let{done:a,value:l}=yield Ot(r.read());if(a){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let c=o.decode(l,{stream:!0});try{let f=JSON.parse(c);if("error"in f){let p=JSON.parse(JSON.stringify(f.error)),m=p.status,v=p.code,_=`got status: ${m}. ${JSON.stringify(f)}`;if(v>=400&&v<600)throw new Sp({message:_,status:v})}}catch(f){if(f.name==="ApiError")throw f}s+=c;let u=s.match(wb);for(;u;){let f=u[1];try{let p=new Response(f,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield Ot(new Su(p)),s=s.slice(u[0].length),u=s.match(wb)}catch(p){throw new Error(`exception parsing stream chunk ${f}. ${p}`)}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){let e={},t=bG+" "+this.clientOptions.userAgentExtra;return e[CG]=t,e[y0]=t,e[TG]="application/json",e}async getHeadersInternal(e,t){let i=new Headers;if(e&&e.headers){for(let[r,o]of Object.entries(e.headers))i.append(r,o);e.timeout&&e.timeout>0&&i.append(MG,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;let r={};t!=null&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let o=this.clientOptions.uploader,s=await o.stat(e);r.sizeBytes=String(s.size);let a=(i=t?.mimeType)!==null&&i!==void 0?i:s.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=a;let l={file:r},c=this.getFileName(e),u=ge("upload/v1beta/files",l._url),f=await this.fetchUploadUrl(u,r.sizeBytes,r.mimeType,c,l,t?.httpOptions);return o.upload(e,f,this)}async uploadFileToFileSearchStore(e,t,i){var r;let o=this.clientOptions.uploader,s=await o.stat(t),a=String(s.size),l=(r=i?.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let c=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),f={};i?.customMetadata&&(f.customMetadata=i.customMetadata),i?.chunkingConfig&&(f.chunkingConfig=i.chunkingConfig);let p=await this.fetchUploadUrl(c,a,l,u,f,i?.httpOptions);return o.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,r,o,s){var a;let l={};s?l=s:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},r?{"X-Goog-Upload-File-Name":r}:{})};let c=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:l});if(!c||!c?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=(a=c?.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}};async function bb(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){let t=n.status,i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};let r=JSON.stringify(i);throw t>=400&&t<600?new Sp({message:r,status:t}):new Error(r)}}function DG(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{let o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(o,s){let a=Object.assign({},o);for(let l in s)if(Object.prototype.hasOwnProperty.call(s,l)){let c=s[l],u=a[l];c&&typeof c=="object"&&!Array.isArray(c)&&u&&typeof u=="object"&&!Array.isArray(u)?a[l]=i(u,c):(u&&c&&typeof u!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof u}, New type: ${typeof c}. Overwriting.`),a[l]=c)}return a}let r=i(t,e);n.body=JSON.stringify(r)}var RG="mcp_used/unknown",NG=!1;function rI(n){for(let e of n)if(PG(e)||typeof e=="object"&&"inputSchema"in e)return!0;return NG}function oI(n){var e;let t=(e=n[y0])!==null&&e!==void 0?e:"";n[y0]=(t+` ${RG}`).trimStart()}function PG(n){return n!==null&&typeof n=="object"&&n instanceof _0}function LG(n,e=100){return xl(this,arguments,function*(){let i,r=0;for(;r<e;){let o=yield Ot(n.listTools({cursor:i}));for(let s of o.tools)yield yield Ot(s),r++;if(!o.nextCursor)break;i=o.nextCursor}})}var _0=class n{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n(e,t)}async initialize(){var e,t,i,r;if(this.mcpTools.length>0)return;let o={},s=[];for(let u of this.mcpClients)try{for(var a=!0,l=(t=void 0,xu(LG(u))),c;c=await l.next(),e=c.done,!e;a=!0){r=c.value,a=!1;let f=r;s.push(f);let p=f.name;if(o[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);o[p]=u}}catch(f){t={error:f}}finally{try{!a&&!e&&(i=l.return)&&await i.call(l)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),q3(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let i of e)if(i.name in this.functionNameToMcpClient){let r=this.functionNameToMcpClient[i.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let s=await r.callTool({name:i.name,arguments:i.args},void 0,o);t.push({functionResponse:{name:i.name,response:s.isError?{error:s}:s}})}return t}};async function FG(n,e,t){let i=new s0,r;t.data instanceof Blob?r=JSON.parse(await t.data.text()):r=JSON.parse(t.data),Object.assign(i,r),e(i)}var E0=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=kG(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${r}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${a}`,c=()=>{},u=new Promise(x=>{c=x}),f=e.callbacks,p=function(){c({})},m=this.apiClient,v={onopen:p,onmessage:x=>{FG(m,f.onmessage,x)},onerror:(t=f?.onerror)!==null&&t!==void 0?t:function(x){},onclose:(i=f?.onclose)!==null&&i!==void 0?i:function(x){}},_=this.webSocketFactory.create(l,OG(s),v);_.connect(),await u;let T={setup:{model:Et(this.apiClient,e.model)}};return _.send(JSON.stringify(T)),new x0(_,this.apiClient)}},x0=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=AH(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=IH(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Eu.PLAY)}pause(){this.sendPlaybackControl(Eu.PAUSE)}stop(){this.sendPlaybackControl(Eu.STOP)}resetContext(){this.sendPlaybackControl(Eu.RESET_CONTEXT)}close(){this.conn.close()}};function OG(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function kG(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var UG="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function BG(n,e,t){let i=new o0,r;t.data instanceof Blob?r=await t.data.text():t.data instanceof ArrayBuffer?r=new TextDecoder().decode(t.data):r=t.data;let o=JSON.parse(r);if(n.isVertexAI()){let s=NH(o);Object.assign(i,s)}else Object.assign(i,o);e(i)}var S0=class{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new E0(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,r,o,s,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),u,f=this.apiClient.getHeaders();e.config&&e.config.tools&&rI(e.config.tools)&&oI(f);let p=zG(f);if(this.apiClient.isVertexAI())u=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,u);else{let w=this.apiClient.getApiKey(),S="BidiGenerateContent",L="key";w?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),S="BidiGenerateContentConstrained",L="access_token"),u=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${S}?${L}=${w}`}let m=()=>{},v=new Promise(w=>{m=w}),_=e.callbacks,y=function(){var w;(w=_?.onopen)===null||w===void 0||w.call(_),m({})},g=this.apiClient,T={onopen:y,onmessage:w=>{BG(g,_.onmessage,w)},onerror:(t=_?.onerror)!==null&&t!==void 0?t:function(w){},onclose:(i=_?.onclose)!==null&&i!==void 0?i:function(w){}},x=this.webSocketFactory.create(u,HG(p),T);x.connect(),await v;let M=Et(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&M.startsWith("publishers/")){let w=this.apiClient.getProject(),S=this.apiClient.getLocation();M=`projects/${w}/locations/${S}/`+M}let D={};this.apiClient.isVertexAI()&&((r=e.config)===null||r===void 0?void 0:r.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[$_.AUDIO]}:e.config.responseModalities=[$_.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let I=(a=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[],A=[];for(let w of I)if(this.isCallableTool(w)){let S=w;A.push(await S.tool())}else A.push(w);A.length>0&&(e.config.tools=A);let k={model:M,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?D=bH(this.apiClient,k):D=wH(this.apiClient,k),delete D.config,x.send(JSON.stringify(D)),new T0(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},VG={turnComplete:!0},T0=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=Mi(t.turns),e.isVertexAI()||(i=i.map(r=>Cp(r)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(let o of i){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(UG)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},VG),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:RH(e)}:t={realtimeInput:DH(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function HG(n){let e={};return n.forEach((t,i)=>{e[i]=t}),e}function zG(n){let e=new Headers;for(let[t,i]of Object.entries(n))e.append(t,i);return e}var Ib=10;function Ab(n){var e,t,i;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let r=!1;for(let s of(t=n?.tools)!==null&&t!==void 0?t:[])if(Sl(s)){r=!0;break}if(!r)return!0;let o=(i=n?.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Sl(n){return"callTool"in n&&typeof n.callTool=="function"}function GG(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(r=>Sl(r)))!==null&&i!==void 0?i:!1}function Db(n){var e;let t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,r)=>{if(Sl(i))return;let o=i;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(r)}),t}function Rb(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var M0=class extends Gi{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,r,o,s,a;let l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!GG(t)||Ab(t.config))return await this.generateContentInternal(l);let c=Db(t);if(c.length>0){let _=c.map(y=>`tools[${y}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${_}.`)}let u,f,p=Mi(l.contents),m=(o=(r=(i=l.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:Ib,v=0;for(;v<m&&(u=await this.generateContentInternal(l),!(!u.functionCalls||u.functionCalls.length===0));){let _=u.candidates[0].content,y=[];for(let g of(a=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(Sl(g)){let x=await g.callTool(u.functionCalls);y.push(...x)}v++,f={role:"user",parts:y},l.contents=Mi(l.contents),l.contents.push(_),l.contents.push(f),Rb(l.config)&&(p.push(_),p.push(f))}return Rb(l.config)&&(u.automaticFunctionCallingHistory=p),u},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),Ab(t.config)){let r=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(r)}let i=Db(t);if(i.length>0){let r=i.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${r}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var r;let o,s=[];if(i?.generatedImages)for(let l of i.generatedImages)l&&l?.safetyAttributes&&((r=l?.safetyAttributes)===null||r===void 0?void 0:r.contentType)==="Positive Prompt"?o=l?.safetyAttributes:s.push(l);let a;return o?a={generatedImages:s,positivePromptSafetyAttributes:o,sdkHttpResponse:i.sdkHttpResponse}:a={generatedImages:s,sdkHttpResponse:i.sdkHttpResponse},a}),this.list=async t=>{var i;let s={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((i=s.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Gr(Ao.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(s),s)},this.editImage=async t=>{let i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(r=>r.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));let r={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(r)},this.generateVideos=async t=>{var i,r,o,s,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((r=t.video)===null||r===void 0)&&r.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((s=(o=t.source)===null||o===void 0?void 0:o.video)===null||s===void 0)&&s.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,r;let o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;let s=await Promise.all(o.map(async l=>Sl(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&rI(e.config.tools)){let l=(r=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&r!==void 0?r:{},c=Object.assign({},l);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),oI(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var t,i,r;let o=new Map;for(let s of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(Sl(s)){let a=s,l=await a.tool();for(let c of(r=l.functionDeclarations)!==null&&r!==void 0?r:[]){if(!c.name)throw new Error("Function declaration name is required.");if(o.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);o.set(c.name,a)}}return o}async processAfcStream(e){var t,i,r;let o=(r=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:Ib,s=!1,a=0,l=await this.initAfcToolsMap(e);return(function(c,u,f){var p,m;return xl(this,arguments,function*(){for(var v,_,y,g;a<o;){s&&(a++,s=!1);let D=yield Ot(c.processParamsMaybeAddMcpUsage(f)),I=yield Ot(c.generateContentStreamInternal(D)),A=[],k=[];try{for(var T=!0,x=(_=void 0,xu(I)),M;M=yield Ot(x.next()),v=M.done,!v;T=!0){g=M.value,T=!1;let w=g;if(yield yield Ot(w),w.candidates&&(!((p=w.candidates[0])===null||p===void 0)&&p.content)){k.push(w.candidates[0].content);for(let S of(m=w.candidates[0].content.parts)!==null&&m!==void 0?m:[])if(a<o&&S.functionCall){if(!S.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(S.functionCall.name)){let L=yield Ot(u.get(S.functionCall.name).callTool([S.functionCall]));A.push(...L)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${S.functionCall.name}`)}}}}catch(w){_={error:w}}finally{try{!T&&!v&&(y=x.return)&&(yield Ot(y.call(x)))}finally{if(_)throw _.error}}if(A.length>0){s=!0;let w=new Ds;w.candidates=[{content:{role:"user",parts:A}}],yield yield Ot(w);let S=[];S.push(...k),S.push({role:"user",parts:A});let L=Mi(f.contents).concat(S);f.contents=L}else break}})})(this,l,e)}async generateContentInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Tb(this.apiClient,e);return a=ge("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=Cb(u),p=new Ds;return Object.assign(p,f),p})}else{let c=Sb(this.apiClient,e);return a=ge("{model}:generateContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=Mb(u),p=new Ds;return Object.assign(p,f),p})}}async generateContentStreamInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Tb(this.apiClient,e);return a=ge("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(f){return xl(this,arguments,function*(){var p,m,v,_;try{for(var y=!0,g=xu(f),T;T=yield Ot(g.next()),p=T.done,!p;y=!0){_=T.value,y=!1;let x=_,M=Cb(yield Ot(x.json()));M.sdkHttpResponse={headers:x.headers};let D=new Ds;Object.assign(D,M),yield yield Ot(D)}}catch(x){m={error:x}}finally{try{!y&&!p&&(v=g.return)&&(yield Ot(v.call(g)))}finally{if(m)throw m.error}}})})}else{let c=Sb(this.apiClient,e);return a=ge("{model}:streamGenerateContent?alt=sse",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),s.then(function(f){return xl(this,arguments,function*(){var p,m,v,_;try{for(var y=!0,g=xu(f),T;T=yield Ot(g.next()),p=T.done,!p;y=!0){_=T.value,y=!1;let x=_,M=Mb(yield Ot(x.json()));M.sdkHttpResponse={headers:x.headers};let D=new Ds;Object.assign(D,M),yield yield Ot(D)}}catch(x){m={error:x}}finally{try{!y&&!p&&(v=g.return)&&(yield Ot(v.call(g)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=lz(this.apiClient,e);return a=ge("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=uz(u),p=new dp;return Object.assign(p,f),p})}else{let c=az(this.apiClient,e);return a=ge("{model}:batchEmbedContents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=cz(u),p=new dp;return Object.assign(p,f),p})}}async generateImagesInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=_z(this.apiClient,e);return a=ge("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=xz(u),p=new fp;return Object.assign(p,f),p})}else{let c=vz(this.apiClient,e);return a=ge("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=Ez(u),p=new fp;return Object.assign(p,f),p})}}async editImageInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=iz(this.apiClient,e);return o=ge("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>{let c=rz(l),u=new Y_;return Object.assign(u,c),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=gG(this.apiClient,e);return o=ge("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>{let c=yG(l),u=new X_;return Object.assign(u,c),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=Kz(this.apiClient,e);return o=ge("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=Qz(l),u=new J_;return Object.assign(u,c),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=oG(this.apiClient,e);return o=ge("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=sG(l),u=new j_;return Object.assign(u,c),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=Uz(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>g0(u))}else{let c=kz(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>m0(u))}}async listInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=qz(this.apiClient,e);return a=ge("{models_url}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=Yz(u),p=new hp;return Object.assign(p,f),p})}else{let c=Wz(this.apiClient,e);return a=ge("{models_url}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=$z(u),p=new hp;return Object.assign(p,f),p})}}async update(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=pG(this.apiClient,e);return a=ge("{model}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>g0(u))}else{let c=hG(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>m0(u))}}async delete(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=QH(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=tz(u),p=new pp;return Object.assign(p,f),p})}else{let c=KH(this.apiClient,e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=ez(u),p=new pp;return Object.assign(p,f),p})}}async countTokens(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=JH(this.apiClient,e);return a=ge("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=ZH(u),p=new mp;return Object.assign(p,f),p})}else{let c=XH(this.apiClient,e);return a=ge("{model}:countTokens",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=jH(u),p=new mp;return Object.assign(p,f),p})}}async computeTokens(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=HH(this.apiClient,e);return o=ge("{model}:computeTokens",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>{let c=zH(l),u=new Z_;return Object.assign(u,c),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=bz(this.apiClient,e);return a=ge("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>{let f=Cz(u),p=new gp;return Object.assign(p,f),p})}else{let c=wz(this.apiClient,e);return a=ge("{model}:predictLongRunning",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s.then(u=>{let f=Mz(u),p=new gp;return Object.assign(p,f),p})}}};var C0=class extends Gi{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let r=t.name.split("/operations/")[0],o;i&&"httpOptions"in i&&(o=i.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let r=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async get(e){let t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let r=t.name.split("/operations/")[0],o;i&&"httpOptions"in i&&(o=i.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let r=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=N3(e);return a=ge("{operationName}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s}else{let c=R3(e);return a=ge("{operationName}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json()),s}}async fetchPredictVideosOperationInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=M3(e);return o=ge("{resourceName}:fetchPredictOperation",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r}else throw new Error("This method is only supported by the Vertex AI.")}};function WG(n){let e={},t=d(n,["data"]);if(t!=null&&h(e,["data"],t),d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function qG(n){let e={},t=d(n,["parts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>QG(o))),h(e,["parts"],r)}let i=d(n,["role"]);return i!=null&&h(e,["role"],i),e}function $G(n,e,t){let i={},r=d(e,["expireTime"]);t!==void 0&&r!=null&&h(t,["expireTime"],r);let o=d(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&h(t,["newSessionExpireTime"],o);let s=d(e,["uses"]);t!==void 0&&s!=null&&h(t,["uses"],s);let a=d(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&h(t,["bidiGenerateContentSetup"],KG(n,a));let l=d(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&h(t,["fieldMask"],l),i}function YG(n,e){let t={},i=d(e,["config"]);return i!=null&&h(t,["config"],$G(n,i,t)),t}function XG(n){let e={};if(d(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=d(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);let i=d(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function JG(n){let e={};if(d(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=d(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function jG(n){let e={};if(d(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(d(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=d(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function ZG(n,e){let t={},i=d(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);let r=d(n,["responseModalities"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","responseModalities"],r);let o=d(n,["temperature"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","temperature"],o);let s=d(n,["topP"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","topP"],s);let a=d(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);let l=d(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);let c=d(n,["mediaResolution"]);e!==void 0&&c!=null&&h(e,["setup","generationConfig","mediaResolution"],c);let u=d(n,["seed"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","seed"],u);let f=d(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],V0(f));let p=d(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);let m=d(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],m);let v=d(n,["systemInstruction"]);e!==void 0&&v!=null&&h(e,["setup","systemInstruction"],qG(Nn(v)));let _=d(n,["tools"]);if(e!==void 0&&_!=null){let I=Ml(_);Array.isArray(I)&&(I=I.map(A=>t4(Tl(A)))),h(e,["setup","tools"],I)}let y=d(n,["sessionResumption"]);e!==void 0&&y!=null&&h(e,["setup","sessionResumption"],e4(y));let g=d(n,["inputAudioTranscription"]);e!==void 0&&g!=null&&h(e,["setup","inputAudioTranscription"],g);let T=d(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&h(e,["setup","outputAudioTranscription"],T);let x=d(n,["realtimeInputConfig"]);e!==void 0&&x!=null&&h(e,["setup","realtimeInputConfig"],x);let M=d(n,["contextWindowCompression"]);e!==void 0&&M!=null&&h(e,["setup","contextWindowCompression"],M);let D=d(n,["proactivity"]);return e!==void 0&&D!=null&&h(e,["setup","proactivity"],D),t}function KG(n,e){let t={},i=d(e,["model"]);i!=null&&h(t,["setup","model"],Et(n,i));let r=d(e,["config"]);return r!=null&&h(t,["config"],ZG(r,t)),t}function QG(n){let e={},t=d(n,["functionCall"]);t!=null&&h(e,["functionCall"],t);let i=d(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);let r=d(n,["executableCode"]);r!=null&&h(e,["executableCode"],r);let o=d(n,["fileData"]);o!=null&&h(e,["fileData"],XG(o));let s=d(n,["functionResponse"]);s!=null&&h(e,["functionResponse"],s);let a=d(n,["inlineData"]);a!=null&&h(e,["inlineData"],WG(a));let l=d(n,["text"]);l!=null&&h(e,["text"],l);let c=d(n,["thought"]);c!=null&&h(e,["thought"],c);let u=d(n,["thoughtSignature"]);u!=null&&h(e,["thoughtSignature"],u);let f=d(n,["videoMetadata"]);return f!=null&&h(e,["videoMetadata"],f),e}function e4(n){let e={},t=d(n,["handle"]);if(t!=null&&h(e,["handle"],t),d(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function t4(n){let e={},t=d(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(f=>f)),h(e,["functionDeclarations"],u)}if(d(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=d(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);let r=d(n,["computerUse"]);r!=null&&h(e,["computerUse"],r);let o=d(n,["fileSearch"]);o!=null&&h(e,["fileSearch"],o);let s=d(n,["codeExecution"]);if(s!=null&&h(e,["codeExecution"],s),d(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=d(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],JG(a));let l=d(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],jG(l));let c=d(n,["urlContext"]);return c!=null&&h(e,["urlContext"],c),e}function n4(n){let e=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){let r=Object.keys(i).map(o=>`${t}.${o}`);e.push(...r)}else e.push(t)}return e.join(",")}function i4(n,e){let t=null,i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){let o=i.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;let r=n.fieldMask;if(t){let o=n4(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)o?n.fieldMask=o:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&r!==null&&Array.isArray(r)&&r.length>0){let s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],a=[];r.length>0&&(a=r.map(c=>s.includes(c)?`generationConfig.${c}`:c));let l=[];o&&l.push(o),a.length>0&&l.push(...a),l.length>0?n.fieldMask=l.join(","):delete n.fieldMask}else delete n.fieldMask}else r!==null&&Array.isArray(r)&&r.length>0?n.fieldMask=r.join(","):delete n.fieldMask;return n}var w0=class extends Gi{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let a=YG(this.apiClient,e);o=ge("auth_tokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query;let l=i4(a,e.config);return r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),r.then(c=>c)}}};function r4(n,e){let t={},i=d(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["displayName"],i),t}function o4(n){let e={},t=d(n,["config"]);return t!=null&&r4(t,e),e}function s4(n,e){let t={},i=d(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function a4(n){let e={},t=d(n,["name"]);t!=null&&h(e,["_url","name"],t);let i=d(n,["config"]);return i!=null&&s4(i,e),e}function l4(n){let e={},t=d(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function c4(n,e){let t={},i=d(n,["customMetadata"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["customMetadata"],o)}let r=d(n,["chunkingConfig"]);return e!==void 0&&r!=null&&h(e,["chunkingConfig"],r),t}function u4(n){let e={},t=d(n,["name"]);t!=null&&h(e,["name"],t);let i=d(n,["metadata"]);i!=null&&h(e,["metadata"],i);let r=d(n,["done"]);r!=null&&h(e,["done"],r);let o=d(n,["error"]);o!=null&&h(e,["error"],o);let s=d(n,["response"]);return s!=null&&h(e,["response"],f4(s)),e}function d4(n){let e={},t=d(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);let i=d(n,["fileName"]);i!=null&&h(e,["fileName"],i);let r=d(n,["config"]);return r!=null&&c4(r,e),e}function f4(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["parent"]);i!=null&&h(e,["parent"],i);let r=d(n,["documentName"]);return r!=null&&h(e,["documentName"],r),e}function h4(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function p4(n){let e={},t=d(n,["config"]);return t!=null&&h4(t,e),e}function m4(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["fileSearchStores"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["fileSearchStores"],o)}return e}function g4(n,e){let t={},i=d(n,["mimeType"]);e!==void 0&&i!=null&&h(e,["mimeType"],i);let r=d(n,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);let o=d(n,["customMetadata"]);if(e!==void 0&&o!=null){let a=o;Array.isArray(a)&&(a=a.map(l=>l)),h(e,["customMetadata"],a)}let s=d(n,["chunkingConfig"]);return e!==void 0&&s!=null&&h(e,["chunkingConfig"],s),t}function y4(n){let e={},t=d(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);let i=d(n,["config"]);return i!=null&&g4(i,e),e}function v4(n){let e={},t=d(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function _4(n,e){let t={},i=d(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function E4(n){let e={},t=d(n,["name"]);t!=null&&h(e,["_url","name"],t);let i=d(n,["config"]);return i!=null&&_4(i,e),e}function x4(n){let e={},t=d(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function S4(n,e){let t={},i=d(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);let r=d(n,["pageToken"]);return e!==void 0&&r!=null&&h(e,["_query","pageToken"],r),t}function T4(n){let e={},t=d(n,["parent"]);t!=null&&h(e,["_url","parent"],t);let i=d(n,["config"]);return i!=null&&S4(i,e),e}function M4(n){let e={},t=d(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);let i=d(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);let r=d(n,["documents"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),h(e,["documents"],o)}return e}var b0=class extends Gi{constructor(e){super(),this.apiClient=e,this.list=async t=>new Gr(Ao.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=x4(e);return o=ge("{name}",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,i;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=E4(e);r=ge("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=T4(e);return o=ge("{parent}/documents",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=M4(l),u=new K_;return Object.assign(u,c),u})}}};var I0=class extends Gi{constructor(e,t=new b0(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new Gr(Ao.PAGED_ITEM_FILE_SEARCH_STORES,r=>this.listInternal(r),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=o4(e);return o=ge("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async get(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=l4(e);return o=ge("{name}",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>l)}}async delete(e){var t,i;let r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=a4(e);r=ge("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=p4(e);return o=ge("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=m4(l),u=new Q_;return Object.assign(u,c),u})}}async uploadToFileSearchStoreInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=y4(e);return o=ge("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=v4(l),u=new e0;return Object.assign(u,c),u})}}async importFile(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=d4(e);return o=ge("{file_search_store_name}:importFile",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),r.then(l=>{let c=u4(l),u=new t0;return Object.assign(u,c),u})}}};function C4(n,e){let t={},i=d(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function w4(n,e){let t={},i=d(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function b4(n,e,t){let i={};if(d(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let r=d(n,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&h(e,["displayName"],r),d(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=d(n,["epochCount"]);e!==void 0&&o!=null&&h(e,["tuningTask","hyperparameters","epochCount"],o);let s=d(n,["learningRateMultiplier"]);if(s!=null&&h(i,["tuningTask","hyperparameters","learningRateMultiplier"],s),d(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(d(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(d(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let a=d(n,["batchSize"]);e!==void 0&&a!=null&&h(e,["tuningTask","hyperparameters","batchSize"],a);let l=d(n,["learningRate"]);if(e!==void 0&&l!=null&&h(e,["tuningTask","hyperparameters","learningRate"],l),d(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(d(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function I4(n,e,t){let i={},r=d(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let m=d(n,["validationDataset"]);e!==void 0&&m!=null&&h(e,["supervisedTuningSpec"],Nb(m))}else if(r==="PREFERENCE_TUNING"){let m=d(n,["validationDataset"]);e!==void 0&&m!=null&&h(e,["preferenceOptimizationSpec"],Nb(m))}let o=d(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&h(e,["tunedModelDisplayName"],o);let s=d(n,["description"]);e!==void 0&&s!=null&&h(e,["description"],s);let a=d(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){let m=d(n,["epochCount"]);e!==void 0&&m!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(a==="PREFERENCE_TUNING"){let m=d(n,["epochCount"]);e!==void 0&&m!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let l=d(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let m=d(n,["learningRateMultiplier"]);e!==void 0&&m!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(l==="PREFERENCE_TUNING"){let m=d(n,["learningRateMultiplier"]);e!==void 0&&m!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=d(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){let m=d(n,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){let m=d(n,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let u=d(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){let m=d(n,["adapterSize"]);e!==void 0&&m!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(u==="PREFERENCE_TUNING"){let m=d(n,["adapterSize"]);e!==void 0&&m!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(d(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(d(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let f=d(n,["labels"]);e!==void 0&&f!=null&&h(e,["labels"],f);let p=d(n,["beta"]);return e!==void 0&&p!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),i}function A4(n,e){let t={},i=d(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);let r=d(n,["preTunedModel"]);r!=null&&h(t,["preTunedModel"],r);let o=d(n,["trainingDataset"]);o!=null&&V4(o);let s=d(n,["config"]);return s!=null&&b4(s,t),t}function D4(n,e){let t={},i=d(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);let r=d(n,["preTunedModel"]);r!=null&&h(t,["preTunedModel"],r);let o=d(n,["trainingDataset"]);o!=null&&H4(o,t,e);let s=d(n,["config"]);return s!=null&&I4(s,t,e),t}function R4(n,e){let t={},i=d(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function N4(n,e){let t={},i=d(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function P4(n,e,t){let i={},r=d(n,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);let o=d(n,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);let s=d(n,["filter"]);return e!==void 0&&s!=null&&h(e,["_query","filter"],s),i}function L4(n,e,t){let i={},r=d(n,["pageSize"]);e!==void 0&&r!=null&&h(e,["_query","pageSize"],r);let o=d(n,["pageToken"]);e!==void 0&&o!=null&&h(e,["_query","pageToken"],o);let s=d(n,["filter"]);return e!==void 0&&s!=null&&h(e,["_query","filter"],s),i}function F4(n,e){let t={},i=d(n,["config"]);return i!=null&&P4(i,t),t}function O4(n,e){let t={},i=d(n,["config"]);return i!=null&&L4(i,t),t}function k4(n,e){let t={},i=d(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=d(n,["nextPageToken"]);r!=null&&h(t,["nextPageToken"],r);let o=d(n,["tunedModels"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>sI(a))),h(t,["tuningJobs"],s)}return t}function U4(n,e){let t={},i=d(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=d(n,["nextPageToken"]);r!=null&&h(t,["nextPageToken"],r);let o=d(n,["tuningJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>A0(a))),h(t,["tuningJobs"],s)}return t}function B4(n,e){let t={},i=d(n,["name"]);i!=null&&h(t,["model"],i);let r=d(n,["name"]);return r!=null&&h(t,["endpoint"],r),t}function V4(n,e){let t={};if(d(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(d(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let i=d(n,["examples"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(t,["examples","examples"],r)}return t}function H4(n,e,t){let i={},r=d(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){let s=d(n,["gcsUri"]);e!==void 0&&s!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(r==="PREFERENCE_TUNING"){let s=d(n,["gcsUri"]);e!==void 0&&s!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let o=d(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let s=d(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){let s=d(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(d(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function sI(n,e){let t={},i=d(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=d(n,["name"]);r!=null&&h(t,["name"],r);let o=d(n,["state"]);o!=null&&h(t,["state"],Hb(o));let s=d(n,["createTime"]);s!=null&&h(t,["createTime"],s);let a=d(n,["tuningTask","startTime"]);a!=null&&h(t,["startTime"],a);let l=d(n,["tuningTask","completeTime"]);l!=null&&h(t,["endTime"],l);let c=d(n,["updateTime"]);c!=null&&h(t,["updateTime"],c);let u=d(n,["description"]);u!=null&&h(t,["description"],u);let f=d(n,["baseModel"]);f!=null&&h(t,["baseModel"],f);let p=d(n,["_self"]);return p!=null&&h(t,["tunedModel"],B4(p)),t}function A0(n,e){let t={},i=d(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=d(n,["name"]);r!=null&&h(t,["name"],r);let o=d(n,["state"]);o!=null&&h(t,["state"],Hb(o));let s=d(n,["createTime"]);s!=null&&h(t,["createTime"],s);let a=d(n,["startTime"]);a!=null&&h(t,["startTime"],a);let l=d(n,["endTime"]);l!=null&&h(t,["endTime"],l);let c=d(n,["updateTime"]);c!=null&&h(t,["updateTime"],c);let u=d(n,["error"]);u!=null&&h(t,["error"],u);let f=d(n,["description"]);f!=null&&h(t,["description"],f);let p=d(n,["baseModel"]);p!=null&&h(t,["baseModel"],p);let m=d(n,["tunedModel"]);m!=null&&h(t,["tunedModel"],m);let v=d(n,["preTunedModel"]);v!=null&&h(t,["preTunedModel"],v);let _=d(n,["supervisedTuningSpec"]);_!=null&&h(t,["supervisedTuningSpec"],_);let y=d(n,["preferenceOptimizationSpec"]);y!=null&&h(t,["preferenceOptimizationSpec"],y);let g=d(n,["tuningDataStats"]);g!=null&&h(t,["tuningDataStats"],g);let T=d(n,["encryptionSpec"]);T!=null&&h(t,["encryptionSpec"],T);let x=d(n,["partnerModelTuningSpec"]);x!=null&&h(t,["partnerModelTuningSpec"],x);let M=d(n,["customBaseModel"]);M!=null&&h(t,["customBaseModel"],M);let D=d(n,["experiment"]);D!=null&&h(t,["experiment"],D);let I=d(n,["labels"]);I!=null&&h(t,["labels"],I);let A=d(n,["outputUri"]);A!=null&&h(t,["outputUri"],A);let k=d(n,["pipelineJob"]);k!=null&&h(t,["pipelineJob"],k);let w=d(n,["serviceAccount"]);w!=null&&h(t,["serviceAccount"],w);let S=d(n,["tunedModelDisplayName"]);S!=null&&h(t,["tunedModelDisplayName"],S);let L=d(n,["veoTuningSpec"]);return L!=null&&h(t,["veoTuningSpec"],L),t}function z4(n,e){let t={},i=d(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);let r=d(n,["name"]);r!=null&&h(t,["name"],r);let o=d(n,["metadata"]);o!=null&&h(t,["metadata"],o);let s=d(n,["done"]);s!=null&&h(t,["done"],s);let a=d(n,["error"]);return a!=null&&h(t,["error"],a),t}function Nb(n,e){let t={},i=d(n,["gcsUri"]);i!=null&&h(t,["validationDatasetUri"],i);let r=d(n,["vertexDatasetResource"]);return r!=null&&h(t,["validationDatasetUri"],r),t}var D0=class extends Gi{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Gr(Ao.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let r={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(r.checkpointId=t.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},t),{preTunedModel:r});return o.baseModel=void 0,await this.tuneInternal(o)}else{let r=Object.assign({},t);return await this.tuneInternal(r)}else{let r=Object.assign({},t),o=await this.tuneMldevInternal(r),s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:Fb.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=N4(e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>A0(u))}else{let c=R4(e);return a=ge("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>sI(u))}}async listInternal(e){var t,i,r,o;let s,a="",l={};if(this.apiClient.isVertexAI()){let c=O4(e);return a=ge("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=U4(u),p=new yp;return Object.assign(p,f),p})}else{let c=F4(e);return a=ge("tunedModels",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(u=>u.json().then(f=>{let p=f;return p.sdkHttpResponse={headers:u.headers},p})),s.then(u=>{let f=k4(u),p=new yp;return Object.assign(p,f),p})}}async cancel(e){var t,i,r,o;let s="",a={};if(this.apiClient.isVertexAI()){let l=w4(e);s=ge("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{let l=C4(e);s=ge("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(r=e.config)===null||r===void 0?void 0:r.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI()){let a=D4(e,e);return o=ge("tuningJobs",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>A0(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let r,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let a=A4(e);return o=ge("tunedModels",a._url),s=a._query,delete a._url,delete a._query,r=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(c=>{let u=c;return u.sdkHttpResponse={headers:l.headers},u})),r.then(l=>z4(l))}}};var R0=class{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},G4=1024*1024*8,W4=3,q4=1e3,$4=2,Tp="x-goog-upload-status";async function Y4(n,e,t){var i;let r=await aI(n,e,t),o=await r?.json();if(((i=r?.headers)===null||i===void 0?void 0:i[Tp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function X4(n,e,t){var i;let r=await aI(n,e,t),o=await r?.json();if(((i=r?.headers)===null||i===void 0?void 0:i[Tp])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let s=Lb(o),a=new a0;return Object.assign(a,s),a}async function aI(n,e,t){var i,r;let o=0,s=0,a=new Su(new Response),l="upload";for(o=n.size;s<o;){let c=Math.min(G4,o-s),u=n.slice(s,s+c);s+c>=o&&(l+=", finalize");let f=0,p=q4;for(;f<W4&&(a=await t.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(c)}}}),!(!((i=a?.headers)===null||i===void 0)&&i[Tp]));)f++,await j4(p),p=p*$4;if(s+=c,((r=a?.headers)===null||r===void 0?void 0:r[Tp])!=="active")break;if(o<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function J4(n){return{size:n.size,type:n.type}}function j4(n){return new Promise(e=>setTimeout(e,n))}var N0=class{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Y4(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await X4(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await J4(e)}};var P0=class{create(e,t,i){return new L0(e,t,i)}},L0=class{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};var Pb="x-goog-api-key",F0=class{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Pb)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Pb,this.apiKey)}}};var Z4="gl-node/",Mp=class{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;let i=S3(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;let r=new F0(this.apiKey);this.apiClient=new v0({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Z4+"web",uploader:new N0,downloader:new R0}),this.models=new M0(this.apiClient),this.live=new S0(this.apiClient,r,new P0),this.batches=new u0(this.apiClient),this.chats=new f0(this.models,this.apiClient),this.caches=new d0(this.apiClient),this.files=new p0(this.apiClient),this.operations=new C0(this.apiClient),this.authTokens=new w0(this.apiClient),this.tunings=new D0(this.apiClient),this.fileSearchStores=new I0(this.apiClient)}};var K4=["canvas"],Q4=["canvasContainer"],eW=()=>["x","y","z"],tW=(n,e)=>e.id;function nW(n,e){n&1&&(j(0,"div",6)(1,"div",18)(2,"h1",19),Z(3,"3D Model Configurator"),J(),j(4,"p",20),Z(5,"Upload an .obj model to begin."),J()()())}function iW(n,e){if(n&1&&(j(0,"div",25)(1,"p",26),Z(2),J(),j(3,"p"),Z(4),J()()),n&2){let t=e.$implicit;de(),Bt("aria-label",mf("Part name: ",t.name)),de(),Wn(t.name),de(),Bt("aria-label",dy("Vertex count: ",t.vertexCount.toLocaleString(),", Face count: ",t.faceCount.toLocaleString())),de(),pf(" Verts: ",t.vertexCount.toLocaleString()," | Faces: ",t.faceCount.toLocaleString()," ")}}function rW(n,e){if(n&1&&(j(0,"h3",23),Z(1,"Mesh Parts"),J(),j(2,"div",24),ha(3,iW,5,8,"div",25,tW),J()),n&2){let t=ut(2);de(3),pa(t.meshParts())}}function oW(n,e){if(n&1){let t=En();j(0,"div",14)(1,"input",21,2),Mt("change",function(r){at(t);let o=ut();return lt(o.onFileSelected(r))}),J(),j(3,"button",22),Mt("click",function(){at(t);let r=uy(2);return lt(r.click())}),Z(4," Upload OBJ Model "),J(),jt(5,rW,5,0),J()}if(n&2){let t=ut();de(5),Zt(t.modelLoaded()?5:-1)}}function sW(n,e){if(n&1){let t=En();j(0,"div")(1,"label",37),Z(2),J(),j(3,"div",38)(4,"input",39),Mt("input",function(r){let o=at(t).$implicit,s=ut(3);return lt(s.onScaleChange(o,r))}),J(),j(5,"span",40),Z(6),J()()()}if(n&2){let t=e.$implicit,i=ut(3);de(),Kt("htmlFor","scale-"+t),de(),as(" Scale ",t.toUpperCase()," "),de(2),Kt("id","scale-"+t)("value",i.transform().scale[t]),Bt("aria-label","Scale "+t.toUpperCase()+" axis, current value: "+i.transform().scale[t].toFixed(2))("aria-valuenow",i.transform().scale[t]),de(),Bt("aria-hidden",!0),de(),Wn(i.transform().scale[t].toFixed(2))}}function aW(n,e){n&1&&(j(0,"div",28),ha(1,sW,7,8,"div",null,sy),J()),n&2&&(de(),pa(ga(0,eW)))}function lW(n,e){if(n&1){let t=En();j(0,"div",30)(1,"div",41)(2,"label",42),Z(3,"Color"),J(),j(4,"input",43),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onMaterialPropChange("color",r))}),J()(),j(5,"div")(6,"label",44),Z(7,"Roughness"),J(),j(8,"div",38)(9,"input",45),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onMaterialPropChange("roughness",r))}),J(),j(10,"span",40),Z(11),J()()(),j(12,"div")(13,"label",46),Z(14,"Metalness"),J(),j(15,"div",38)(16,"input",47),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onMaterialPropChange("metalness",r))}),J(),j(17,"span",40),Z(18),J()()()()}if(n&2){let t=ut(2);de(4),Bt("aria-label",mf("Material color picker, current color: ",t.material().color)),Kt("value",t.material().color),de(5),Kt("value",t.material().roughness),Bt("aria-label","Material roughness, current value: "+t.material().roughness.toFixed(2))("aria-valuenow",t.material().roughness),de(),Bt("aria-hidden",!0),de(),Wn(t.material().roughness.toFixed(2)),de(5),Kt("value",t.material().metalness),Bt("aria-label","Material metalness, current value: "+t.material().metalness.toFixed(2))("aria-valuenow",t.material().metalness),de(),Bt("aria-hidden",!0),de(),Wn(t.material().metalness.toFixed(2))}}function cW(n,e){n&1&&(Fn(0,"div",53),j(1,"span"),Z(2,"Generating..."),J())}function uW(n,e){n&1&&(j(0,"span"),Z(1,"Generate Texture"),J())}function dW(n,e){if(n&1){let t=En();j(0,"button",52),Mt("click",function(){at(t);let r=ut(3);return lt(r.generateAiTexture())}),jt(1,cW,3,0)(2,uW,2,0,"span"),J()}if(n&2){let t=ut(3);Kt("disabled",t.isGeneratingTexture()||!t.aiTexturePrompt()),Bt("aria-busy",t.isGeneratingTexture()),de(),Zt(t.isGeneratingTexture()?1:2)}}function fW(n,e){n&1&&(j(0,"div"),Fn(1,"img",62),j(2,"p",63),Z(3,"Base Color"),J()()),n&2&&(de(),Kt("src",e,hc))}function hW(n,e){n&1&&(j(0,"div"),Fn(1,"img",64),j(2,"p",63),Z(3,"Normal Map"),J()()),n&2&&(de(),Kt("src",e,hc))}function pW(n,e){n&1&&(Fn(0,"div",65),j(1,"span"),Z(2,"Generating..."),J())}function mW(n,e){n&1&&(j(0,"span"),Z(1,"Re-generate"),J())}function gW(n,e){if(n&1){let t=En();j(0,"div",54),jt(1,fW,4,1,"div"),jt(2,hW,4,1,"div"),J(),j(3,"div",55)(4,"h4",56),Z(5,"Texture Tiling"),J(),j(6,"div")(7,"label",57),Z(8,"Horizontal (U)"),J(),j(9,"div",38)(10,"input",58),Mt("input",function(r){at(t);let o=ut(3);return lt(o.onTilingChange("u",r))}),J(),j(11,"span",40),Z(12),J()()(),j(13,"div")(14,"label",57),Z(15,"Vertical (V)"),J(),j(16,"div",38)(17,"input",58),Mt("input",function(r){at(t);let o=ut(3);return lt(o.onTilingChange("v",r))}),J(),j(18,"span",40),Z(19),J()()()(),j(20,"div",59)(21,"button",60),Mt("click",function(){at(t);let r=ut(3);return lt(r.generateAiTexture())}),jt(22,pW,3,0)(23,mW,2,0,"span"),J(),j(24,"button",61),Mt("click",function(){at(t);let r=ut(3);return lt(r.resetMaterial())}),Z(25," Reset Material "),J()()}if(n&2){let t,i,r=ut(3);de(),Zt((t=r.generatedTextures().albedo)?1:-1,t),de(),Zt((i=r.generatedTextures().normal)?2:-1,i),de(8),Kt("value",r.textureTiling().u),de(2),as("",r.textureTiling().u,"x"),de(5),Kt("value",r.textureTiling().v),de(2),as("",r.textureTiling().v,"x"),de(2),Kt("disabled",r.isGeneratingTexture()||!r.aiTexturePrompt()),de(),Zt(r.isGeneratingTexture()?22:23),de(2),Kt("disabled",r.isGeneratingTexture())}}function yW(n,e){if(n&1){let t=En();j(0,"div",32)(1,"p",48),Z(2,'Describe a material (e.g., "rusty metal panels", "glowing alien rock").'),J(),j(3,"textarea",49),Mt("input",function(r){at(t);let o=ut(2);return lt(o.aiTexturePrompt.set(r.target.value))}),Z(4),J(),j(5,"p",50),Z(6,"Describe the material texture you want AI to generate, such as 'rusty metal' or 'glowing alien rock'"),J(),jt(7,dW,3,3,"button",51)(8,gW,26,9),J()}if(n&2){let t=ut(2);de(3),Kt("value",t.aiTexturePrompt()),de(),Wn(t.aiTexturePrompt()),de(3),Zt(t.generatedTextures().albedo?8:7)}}function vW(n,e){if(n&1){let t=En();j(0,"div",34)(1,"h4",66),Z(2,"Ambient Light"),J(),j(3,"div",41)(4,"label",67),Z(5,"Color"),J(),j(6,"input",68),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onLightPropChange("ambientColor",r))}),J()(),j(7,"div")(8,"label",57),Z(9,"Intensity"),J(),j(10,"div",38)(11,"input",69),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onLightPropChange("ambientIntensity",r))}),J(),j(12,"span",40),Z(13),J()()(),j(14,"h4",70),Z(15,"Directional Light"),J(),j(16,"div",41)(17,"label",67),Z(18,"Color"),J(),j(19,"input",68),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onLightPropChange("directionalColor",r))}),J()(),j(20,"div")(21,"label",57),Z(22,"Intensity"),J(),j(23,"div",38)(24,"input",71),Mt("input",function(r){at(t);let o=ut(2);return lt(o.onLightPropChange("directionalIntensity",r))}),J(),j(25,"span",40),Z(26),J()()()()}if(n&2){let t=ut(2);de(6),Kt("value",t.sceneLighting().ambientColor),de(5),Kt("value",t.sceneLighting().ambientIntensity),de(2),Wn(t.sceneLighting().ambientIntensity.toFixed(2)),de(6),Kt("value",t.sceneLighting().directionalColor),de(5),Kt("value",t.sceneLighting().directionalIntensity),de(2),Wn(t.sceneLighting().directionalIntensity.toFixed(2))}}function _W(n,e){if(n&1){let t=En();j(0,"div",36)(1,"button",72),Mt("click",function(){at(t);let r=ut(2);return lt(r.exportGLB())}),Z(2," Export as .GLB "),J(),j(3,"button",73),Mt("click",function(){at(t);let r=ut(2);return lt(r.exportSTL())}),Z(4," Export as .STL (3D Print) "),J()()}}function EW(n,e){if(n&1){let t=En();j(0,"div",11)(1,"button",27),Mt("click",function(){at(t);let r=ut();return lt(r.togglePanel("transform"))}),j(2,"span"),Z(3,"Transform"),J(),j(4,"span",13),Z(5,"\u25BC"),J()(),jt(6,aW,3,1,"div",28),J(),j(7,"div",11)(8,"button",29),Mt("click",function(){at(t);let r=ut();return lt(r.togglePanel("material"))}),j(9,"span"),Z(10,"Material"),J(),j(11,"span",13),Z(12,"\u25BC"),J()(),jt(13,lW,19,13,"div",30),J(),j(14,"div",11)(15,"button",31),Mt("click",function(){at(t);let r=ut();return lt(r.togglePanel("ai-texture"))}),j(16,"span"),Z(17,"AI Texture Generation"),J(),j(18,"span",13),Z(19,"\u25BC"),J()(),jt(20,yW,9,3,"div",32),J(),j(21,"div",11)(22,"button",33),Mt("click",function(){at(t);let r=ut();return lt(r.togglePanel("lighting"))}),j(23,"span"),Z(24,"Lighting"),J(),j(25,"span",13),Z(26,"\u25BC"),J()(),jt(27,vW,27,6,"div",34),J(),j(28,"div",11)(29,"button",35),Mt("click",function(){at(t);let r=ut();return lt(r.togglePanel("export"))}),j(30,"span"),Z(31,"Export"),J(),j(32,"span",13),Z(33,"\u25BC"),J()(),jt(34,_W,5,0,"div",36),J()}if(n&2){let t=ut();de(),Bt("aria-expanded",t.activePanel()==="transform"),de(3),Qn("rotate-180",t.activePanel()==="transform"),de(2),Zt(t.activePanel()==="transform"?6:-1),de(2),Bt("aria-expanded",t.activePanel()==="material"),de(3),Qn("rotate-180",t.activePanel()==="material"),de(2),Zt(t.activePanel()==="material"?13:-1),de(2),Bt("aria-expanded",t.activePanel()==="ai-texture"),de(3),Qn("rotate-180",t.activePanel()==="ai-texture"),de(2),Zt(t.activePanel()==="ai-texture"?20:-1),de(2),Bt("aria-expanded",t.activePanel()==="lighting"),de(3),Qn("rotate-180",t.activePanel()==="lighting"),de(2),Zt(t.activePanel()==="lighting"?27:-1),de(2),Bt("aria-expanded",t.activePanel()==="export"),de(3),Qn("rotate-180",t.activePanel()==="export"),de(2),Zt(t.activePanel()==="export"?34:-1)}}function xW(n,e){n&1&&(j(0,"div",15)(1,"p"),Z(2,"Awaiting model upload..."),J()())}function SW(n,e){n&1&&(j(0,"div",16),Fn(1,"div",74),j(2,"p",75),Z(3,"Loading Model..."),J()())}function TW(n,e){if(n&1){let t=En();j(0,"div",17)(1,"h3",76),Z(2,"Error"),J(),j(3,"p"),Z(4),J(),j(5,"button",77),Mt("click",function(){at(t);let r=ut();return lt(r.errorMessage.set(null))}),Z(6," Close "),J()()}n&2&&(de(4),Wn(e))}var wl=class wl{constructor(){this.canvas=Tc.required("canvas");this.canvasContainer=Tc.required("canvasContainer");this.isLoading=Dt(!1);this.isGeneratingTexture=Dt(!1);this.errorMessage=Dt(null);this.modelLoaded=Dt(!1);this.meshParts=Dt([]);this.activePanel=Dt("model");this.currentModel=Dt(null);this.transform=Dt({scale:{x:1,y:1,z:1}});this.material=Dt({color:"#cccccc",roughness:.5,metalness:.1});this.sceneLighting=Dt({ambientColor:"#ffffff",ambientIntensity:1,directionalColor:"#ffffff",directionalIntensity:2.5});this.aiTexturePrompt=Dt("");this.generatedTextures=Dt({albedo:null,normal:null});this.textureTiling=Dt({u:1,v:1});this.frameId=null;this.ai=null;this.setupEffects();try{this.ai=new Mp({apiKey:process.env.API_KEY})}catch(e){console.error("Failed to initialize Gemini API. API_KEY might be missing.",e),this.errorMessage.set("Gemini API key is not configured.")}}setupEffects(){lo(()=>{let e=this.currentModel(),{scale:t}=this.transform();e&&e.scale.set(t.x,t.y,t.z)}),lo(()=>{let e=this.currentModel(),{color:t,roughness:i,metalness:r}=this.material();e&&e.traverse(o=>{o instanceof zt&&o.material instanceof zr&&(o.material.color.set(t),o.material.roughness=i,o.material.metalness=r)})}),lo(()=>{let{ambientColor:e,ambientIntensity:t,directionalColor:i,directionalIntensity:r}=this.sceneLighting();this.ambientLight&&(this.ambientLight.color.set(e),this.ambientLight.intensity=t),this.directionalLight&&(this.directionalLight.color.set(i),this.directionalLight.intensity=r)}),lo(()=>{let e=this.currentModel(),{u:t,v:i}=this.textureTiling();e&&e.traverse(r=>{r instanceof zt&&r.material instanceof zr&&(r.material.map&&r.material.map.repeat.set(t,i),r.material.normalMap&&r.material.normalMap.repeat.set(t,i))})})}ngAfterViewInit(){this.initThree(),this.animate(),this.resizeObserver=new ResizeObserver(e=>{let t=e[0];if(t){let{width:i,height:r}=t.contentRect;setTimeout(()=>this.onResize(i,r),0)}}),this.resizeObserver.observe(this.canvasContainer().nativeElement)}ngOnDestroy(){this.frameId!==null&&cancelAnimationFrame(this.frameId),this.renderer?.dispose(),this.resizeObserver?.disconnect()}togglePanel(e){this.activePanel.update(t=>t===e?"":e)}onFileSelected(e){let t=e.target;if(!t.files||t.files.length===0)return;let i=t.files[0];this.isLoading.set(!0),this.modelLoaded.set(!1),this.meshParts.set([]);let r=new FileReader;r.onload=o=>{typeof o.target?.result=="string"?this.loadObjModel(o.target.result):(this.errorMessage.set("Failed to read file content."),this.isLoading.set(!1))},r.onerror=()=>{this.errorMessage.set("Error reading file."),this.isLoading.set(!1)},r.readAsText(i),t.value=""}initThree(){let e=this.canvas().nativeElement,{width:t,height:i}=this.canvasContainer().nativeElement.getBoundingClientRect();this.scene=new Hr,this.scene.background=new ke(1120295),this.camera=new xn(50,t/i,.1,1e3),this.camera.position.set(0,5,15),this.renderer=new dl({canvas:e,antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=g_,this.renderer.setSize(t,i),this.controls=new ip(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.ambientLight=new jh(this.sceneLighting().ambientColor,this.sceneLighting().ambientIntensity),this.scene.add(this.ambientLight),this.directionalLight=new Jh(this.sceneLighting().directionalColor,this.sceneLighting().directionalIntensity),this.directionalLight.position.set(10,20,10),this.directionalLight.castShadow=!0,this.directionalLight.shadow.mapSize.width=2048,this.directionalLight.shadow.mapSize.height=2048,this.scene.add(this.directionalLight);let r=new zt(new Co(100,100),new zr({color:2238519,roughness:.8}));r.rotation.x=-Math.PI/2,r.receiveShadow=!0,r.name="ground_plane",this.scene.add(r)}onResize(e,t){if(!this.camera||!this.renderer)return;let i=this.renderer.getSize(new Ne),r=Math.round(e),o=Math.round(t);(i.x!==r||i.y!==o)&&r>0&&o>0&&(this.camera.aspect=r/o,this.camera.updateProjectionMatrix(),this.renderer.setSize(r,o))}loadObjModel(e){try{this.currentModel.update(a=>(a&&this.scene.remove(a),null)),this.transform.set({scale:{x:1,y:1,z:1}}),this.resetMaterial();let t=new op().parse(e),i=new or;this.scene.add(i);let r=new lr().setFromObject(t);if(!r.isEmpty()){let a=r.getCenter(new P);t.position.sub(a);let l=r.getSize(new P),c=Math.max(l.x,l.y,l.z),u=c>0?10/c:1;t.scale.setScalar(u)}i.add(t);let o=new lr().setFromObject(i);if(!o.isEmpty()){let a=o.min.y;i.position.y=-a}this.currentModel.set(i);let s=[];t.traverse(a=>{a instanceof zt&&(a.material=new zr({color:new ke(this.material().color),roughness:this.material().roughness,metalness:this.material().metalness}),a.castShadow=!0,a.receiveShadow=!0,a.geometry.attributes.normal||a.geometry.computeVertexNormals(),s.push({id:a.uuid,name:a.name||`Part ${s.length+1}`,mesh:a,vertexCount:a.geometry.attributes.position.count,faceCount:Math.round((a.geometry.index?a.geometry.index.count:a.geometry.attributes.position.count)/3)}))}),this.meshParts.set(s),this.modelLoaded.set(!0)}catch(t){console.error(t),this.errorMessage.set("Could not parse the .obj file. Ensure it is a valid format.")}finally{this.isLoading.set(!1)}}animate(){this.frameId=requestAnimationFrame(()=>this.animate()),this.controls.update(),this.renderer.render(this.scene,this.camera)}onScaleChange(e,t){let i=parseFloat(t.target.value);this.transform.update(r=>it(ue({},r),{scale:it(ue({},r.scale),{[e]:i})}))}onMaterialPropChange(e,t){let i=t.target.value;this.material.update(r=>it(ue({},r),{[e]:e==="color"?i:parseFloat(i)}))}onLightPropChange(e,t){let i=t.target.value;this.sceneLighting.update(r=>it(ue({},r),{[e]:e.includes("Color")?i:parseFloat(i)}))}onTilingChange(e,t){let i=parseInt(t.target.value,10);this.textureTiling.update(r=>it(ue({},r),{[e]:i}))}async generateAiTexture(){if(!(!this.ai||this.isGeneratingTexture()||!this.aiTexturePrompt())){this.isGeneratingTexture.set(!0),this.errorMessage.set(null);try{let e=this.aiTexturePrompt(),t=this.ai.models.generateContent({model:"gemini-2.5-flash",contents:`Analyze the material description "${e}" and determine appropriate PBR values for roughness and metalness.`,config:{responseMimeType:"application/json",responseSchema:{type:zi.OBJECT,properties:{roughness:{type:zi.NUMBER,description:"A value from 0.0 (smooth) to 1.0 (rough)."},metalness:{type:zi.NUMBER,description:"A value from 0.0 (non-metal) to 1.0 (metal)."}},required:["roughness","metalness"]}}}),i=this.ai.models.generateImages({model:"imagen-3.0-generate-002",prompt:`A high-resolution, photorealistic, seamless, tileable PBR albedo (base color) texture map of ${e}.`,config:{numberOfImages:1,outputMimeType:"image/png"}}),r=this.ai.models.generateImages({model:"imagen-3.0-generate-002",prompt:`A seamless, tileable, tangent-space normal map for a PBR material of: ${e}. OpenGL format. The image should be predominantly purple-blue, representing surface detail.`,config:{numberOfImages:1,outputMimeType:"image/png"}}),[o,s,a]=await Promise.all([t,i,r]);if(!o.text)throw new Error("AI failed to generate material properties (roughness/metalness). The prompt may have been blocked. Please try a different prompt.");if(!s.generatedImages||s.generatedImages.length===0)throw new Error("AI failed to generate the Base Color texture. The prompt may have been blocked by safety filters. Please try a different prompt.");if(!a.generatedImages||a.generatedImages.length===0)throw new Error("AI failed to generate the Normal Map texture. The prompt may have been blocked by safety filters. Please try a different prompt.");let l=s.generatedImages[0].image.imageBytes,c=a.generatedImages[0].image.imageBytes,u=`data:image/png;base64,${l}`,f=`data:image/png;base64,${c}`;this.generatedTextures.set({albedo:u,normal:f});let p=new Yh,m=this.renderer.capabilities.getMaxAnisotropy(),v=await p.loadAsync(u);v.wrapS=sr,v.wrapT=sr,v.colorSpace=An,v.minFilter=_i,v.magFilter=Rn,v.anisotropy=m,v.repeat.set(this.textureTiling().u,this.textureTiling().v),v.needsUpdate=!0;let _=await p.loadAsync(f);_.wrapS=sr,_.wrapT=sr,_.minFilter=_i,_.magFilter=Rn,_.anisotropy=m,_.repeat.set(this.textureTiling().u,this.textureTiling().v),_.needsUpdate=!0,this.currentModel()?.traverse(y=>{y instanceof zt&&y.material instanceof zr&&(y.material.map=v,y.material.normalMap=_,y.material.needsUpdate=!0)});try{let y=o.text.trim(),g=JSON.parse(y);this.material.update(T=>it(ue({},T),{color:"#ffffff",roughness:Math.max(0,Math.min(1,g.roughness)),metalness:Math.max(0,Math.min(1,g.metalness))}))}catch(y){throw console.error("Failed to parse material properties from AI",y),new Error("AI returned invalid material data. Could not apply roughness/metalness.")}}catch(e){console.error("Error generating texture:",e),e instanceof Error?this.errorMessage.set(e.message):this.errorMessage.set("An unknown error occurred while generating textures. Please try again.")}finally{this.isGeneratingTexture.set(!1)}}}resetMaterial(){this.material.set({color:"#cccccc",roughness:.5,metalness:.1}),this.generatedTextures.set({albedo:null,normal:null}),this.textureTiling.set({u:1,v:1}),this.currentModel()?.traverse(e=>{e instanceof zt&&e.material instanceof zr&&(e.material.map=null,e.material.normalMap=null,e.material.needsUpdate=!0)})}exportGLB(){let e=this.currentModel();if(!e)return;new _l().parse(e,i=>this.downloadFile(new Blob([i]),"model.glb"),i=>this.errorMessage.set("An error occurred during GLB export."),{binary:!0})}exportSTL(){let e=this.currentModel();if(!e)return;let i=new lp().parse(e,{binary:!0});this.downloadFile(new Blob([i]),"model.stl")}downloadFile(e,t){let i=document.createElement("a");i.style.display="none",document.body.appendChild(i);let r=URL.createObjectURL(e);i.href=r,i.download=t,i.click(),URL.revokeObjectURL(r),document.body.removeChild(i)}};wl.\u0275fac=function(t){return new(t||wl)},wl.\u0275cmp=Ln({type:wl,selectors:[["app-configurator"]],viewQuery:function(t,i){t&1&&(ma(i.canvas,K4,5),ma(i.canvasContainer,Q4,5)),t&2&&xc(2)},decls:22,vars:9,consts:[["canvasContainer",""],["canvas",""],["fileInput",""],["role","main","aria-label","3D Model Configurator",1,"w-full","h-full","bg-gray-900","text-white","font-sans","flex","flex-col","md:flex-row"],["role","region","aria-label","3D Model Viewer",1,"flex-grow","h-full","relative"],["tabindex","0","aria-label","3D model canvas - Use mouse or touch to rotate, zoom, and pan the model","role","img",1,"absolute","top-0","left-0","w-full","h-full","outline-none","focus:outline-none"],["role","status","aria-live","polite",1,"absolute","inset-0","flex","items-center","justify-center","pointer-events-none"],["role","complementary","aria-label","Model configuration controls",1,"w-full","md:w-96","h-auto","md:h-full","bg-gray-800","border-t","md:border-t-0","md:border-l","border-gray-700","flex","flex-col","shadow-2xl"],[1,"p-4","border-b","border-gray-700","flex-shrink-0"],[1,"text-xl","font-bold"],[1,"flex-grow","overflow-y-auto","custom-scrollbar","p-4","space-y-2"],[1,"bg-gray-700","rounded-lg"],["aria-controls","model-controls-panel","aria-label","Toggle model controls panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],["aria-hidden","true",1,"transform","transition-transform"],["id","model-controls-panel","role","region","aria-labelledby","model-controls-heading",1,"p-3","border-t","border-gray-600"],[1,"flex-grow","flex","items-center","justify-center","text-center","text-gray-400","p-4"],["role","status","aria-live","polite","aria-label","Loading model",1,"absolute","inset-0","bg-gray-900","bg-opacity-70","flex","flex-col","items-center","justify-center","pointer-events-auto","z-50"],["role","alert","aria-live","assertive","aria-label","Error message",1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","bg-red-800","bg-opacity-80","p-6","rounded-lg","backdrop-blur-sm","text-center","shadow-2xl","border","border-red-600","pointer-events-auto","z-50"],[1,"text-center","bg-gray-800","bg-opacity-50","p-6","rounded-lg","backdrop-blur-sm"],[1,"text-2xl","font-bold","text-white","drop-shadow-md","mb-4"],[1,"text-lg"],["type","file","accept",".obj","aria-label","Select OBJ model file to upload","id","file-input",1,"hidden",3,"change"],["aria-label","Upload OBJ model file",1,"w-full","bg-indigo-600","hover:bg-indigo-700","text-white","font-bold","py-2","px-4","rounded-lg","shadow-lg","transition-transform","transform","hover:scale-105","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"click"],["id","mesh-parts-heading",1,"text-md","font-semibold","mt-4","mb-2"],["role","list","aria-labelledby","mesh-parts-heading",1,"space-y-2","max-h-48","overflow-y-auto","custom-scrollbar"],["role","listitem",1,"bg-gray-600","p-2","rounded-md","text-sm"],[1,"font-bold","truncate"],["aria-controls","transform-panel","aria-label","Toggle transform controls panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],["id","transform-panel","role","region","aria-labelledby","transform-heading",1,"p-3","border-t","border-gray-600","space-y-3"],["aria-controls","material-panel","aria-label","Toggle material controls panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],["id","material-panel","role","region","aria-labelledby","material-heading",1,"p-3","border-t","border-gray-600","space-y-3"],["aria-controls","ai-texture-panel","aria-label","Toggle AI texture generation panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],["id","ai-texture-panel","role","region","aria-labelledby","ai-texture-heading",1,"p-3","border-t","border-gray-600","space-y-3"],["aria-controls","lighting-panel","aria-label","Toggle lighting controls panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],[1,"p-3","border-t","border-gray-600","space-y-3"],["aria-controls","export-panel","aria-label","Toggle export options panel",1,"w-full","flex","justify-between","items-center","p-3","font-semibold","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700","rounded-lg",3,"click"],["id","export-panel","role","region","aria-labelledby","export-heading",1,"p-3","border-t","border-gray-600","space-y-3"],[1,"block","text-sm","font-medium","mb-1",3,"for"],[1,"flex","items-center","space-x-2"],["type","range","min","0.1","max","5","step","0.05","aria-valuemin","0.1","aria-valuemax","5","role","slider",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"input","id","value"],[1,"text-sm","font-mono","w-12","text-center"],[1,"flex","justify-between","items-center"],["for","material-color",1,"block","text-sm","font-medium"],["type","color","id","material-color",1,"p-1","h-8","w-14","block","bg-gray-600","border","border-gray-500","cursor-pointer","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"input","value"],["for","material-roughness",1,"block","text-sm","font-medium","mb-1"],["type","range","id","material-roughness","min","0","max","1","step","0.01","aria-valuemin","0","aria-valuemax","1","role","slider",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"input","value"],["for","material-metalness",1,"block","text-sm","font-medium","mb-1"],["type","range","id","material-metalness","min","0","max","1","step","0.01","aria-valuemin","0","aria-valuemax","1","role","slider",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer","focus:outline-none","focus:ring-2","focus:ring-indigo-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"input","value"],[1,"text-sm","text-gray-400"],["id","texture-prompt","rows","3","placeholder","Enter texture prompt...","aria-label","Enter a description of the material texture you want to generate","aria-describedby","texture-prompt-help",1,"w-full","bg-gray-600","border","border-gray-500","rounded-md","p-2","text-white","placeholder-gray-400","focus:ring-indigo-500","focus:border-indigo-500","focus:outline-none",3,"input","value"],["id","texture-prompt-help",1,"sr-only"],["aria-label","Generate AI texture based on the description",1,"w-full","flex","justify-center","items-center","gap-2","bg-teal-600","hover:bg-teal-700","text-white","font-bold","py-2","px-4","rounded-lg","shadow-lg","disabled:bg-gray-500","disabled:cursor-not-allowed","focus:outline-none","focus:ring-2","focus:ring-teal-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"disabled"],["aria-label","Generate AI texture based on the description",1,"w-full","flex","justify-center","items-center","gap-2","bg-teal-600","hover:bg-teal-700","text-white","font-bold","py-2","px-4","rounded-lg","shadow-lg","disabled:bg-gray-500","disabled:cursor-not-allowed","focus:outline-none","focus:ring-2","focus:ring-teal-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"click","disabled"],["aria-hidden","true",1,"w-5","h-5","border-2","border-dashed","rounded-full","animate-spin","border-white"],[1,"grid","grid-cols-2","gap-2","mt-4"],[1,"pt-3","mt-3","border-t","border-gray-600","space-y-3"],[1,"font-semibold","text-sm"],[1,"block","text-sm","font-medium","mb-1"],["type","range","min","1","max","20","step","1",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer",3,"input","value"],[1,"flex","gap-2","mt-4"],[1,"w-full","flex","justify-center","items-center","gap-2","bg-teal-600","hover:bg-teal-700","text-white","font-bold","py-2","px-4","rounded-lg","shadow-lg","disabled:bg-gray-500","disabled:cursor-not-allowed",3,"click","disabled"],[1,"w-full","bg-red-600","hover:bg-red-700","text-white","font-bold","py-2","px-4","rounded-lg","shadow-lg","disabled:bg-gray-500","disabled:cursor-not-allowed",3,"click","disabled"],["alt","Generated Albedo Texture",1,"w-full","h-auto","rounded-md","border","border-gray-600",3,"src"],[1,"text-xs","text-center","mt-1","text-gray-400"],["alt","Generated Normal Map",1,"w-full","h-auto","rounded-md","border","border-gray-600",3,"src"],[1,"w-5","h-5","border-2","border-dashed","rounded-full","animate-spin","border-white"],[1,"font-semibold"],[1,"block","text-sm","font-medium"],["type","color",1,"p-1","h-8","w-14","block","bg-gray-600","border","border-gray-500","cursor-pointer","rounded-lg",3,"input","value"],["type","range","min","0","max","5","step","0.1",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer",3,"input","value"],[1,"font-semibold","pt-2","border-t","border-gray-600"],["type","range","min","0","max","10","step","0.1",1,"w-full","h-2","bg-gray-600","rounded-lg","appearance-none","cursor-pointer",3,"input","value"],["aria-label","Export model as GLB file format",1,"w-full","bg-green-600","hover:bg-green-700","text-white","font-bold","py-2","px-4","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-green-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"click"],["aria-label","Export model as STL file format for 3D printing",1,"w-full","bg-blue-600","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","focus:ring-offset-gray-700",3,"click"],["aria-hidden","true",1,"w-16","h-16","border-4","border-dashed","rounded-full","animate-spin","border-indigo-500"],[1,"mt-4","text-lg","text-white"],[1,"text-xl","font-bold","mb-2"],["aria-label","Close error message",1,"mt-4","bg-red-600","hover:bg-red-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:ring-2","focus:ring-red-400","focus:ring-offset-2","focus:ring-offset-red-800",3,"click"]],template:function(t,i){if(t&1){let r=En();j(0,"div",3)(1,"div",4,0),Fn(3,"canvas",5,1),jt(5,nW,6,0,"div",6),J(),j(6,"aside",7)(7,"header",8)(8,"h2",9),Z(9,"Controls"),J()(),j(10,"div",10)(11,"div",11)(12,"button",12),Mt("click",function(){return at(r),lt(i.togglePanel("model"))}),j(13,"span"),Z(14,"Model Controls"),J(),j(15,"span",13),Z(16,"\u25BC"),J()(),jt(17,oW,6,1,"div",14),J(),jt(18,EW,35,20)(19,xW,3,0,"div",15),J()(),jt(20,SW,4,0,"div",16),jt(21,TW,7,1,"div",17),J()}if(t&2){let r;de(3),Bt("aria-busy",i.isLoading()),de(2),Zt(i.modelLoaded()?-1:5),de(7),Bt("aria-expanded",i.activePanel()==="model"),de(3),Qn("rotate-180",i.activePanel()==="model"),de(2),Zt(i.activePanel()==="model"?17:-1),de(),Zt(i.modelLoaded()?18:19),de(2),Zt(i.isLoading()?20:-1),de(),Zt((r=i.errorMessage())?21:-1,r)}},encapsulation:2,changeDetection:0});var Ip=wl;var bl=class bl{};bl.\u0275fac=function(t){return new(t||bl)},bl.\u0275cmp=Ln({type:bl,selectors:[["app-about"]],decls:36,vars:0,consts:[[1,"py-16","bg-gray-900"],[1,"container","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"max-w-3xl","mx-auto","text-center"],[1,"text-4xl","font-extrabold","text-white","sm:text-5xl"],[1,"mt-4","text-xl","text-gray-300"],[1,"mt-12","max-w-4xl","mx-auto","bg-gray-800","p-8","rounded-lg","shadow-lg"],[1,"space-y-6","text-gray-300"],[1,"text-2xl","font-bold","text-white","pt-4","border-t","border-gray-700"],[1,"list-disc","list-inside","space-y-2"]],template:function(t,i){t&1&&(j(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Z(4,"About Our 3D Configurator"),J(),j(5,"p",4),Z(6,"Democratizing 3D content creation and customization for everyone."),J()(),j(7,"div",5)(8,"div",6)(9,"p"),Z(10," This 3D Material Editor and Configurator was born from a passion for 3D art and web technology. Our mission is to provide an accessible, powerful, and intuitive tool that empowers creators to bring their digital visions to life directly in their browser. Whether you're a seasoned 3D artist, a game developer, a product designer, or just a hobbyist, this tool is designed for you. "),J(),j(11,"p"),Z(12," We believe that creativity shouldn't be locked behind expensive software or steep learning curves. By leveraging the power of modern web technologies, we've created a seamless experience that runs on any device without installation. "),J(),j(13,"h2",7),Z(14,"Core Technologies"),J(),j(15,"p"),Z(16," Our application is built on a robust, modern tech stack to ensure performance and reliability: "),J(),j(17,"ul",8)(18,"li")(19,"strong"),Z(20,"Angular:"),J(),Z(21," A leading framework for building high-performance, scalable single-page applications."),J(),j(22,"li")(23,"strong"),Z(24,"Three.js:"),J(),Z(25," The powerful 3D graphics library that renders our scenes and models directly in the browser."),J(),j(26,"li")(27,"strong"),Z(28,"Gemini API:"),J(),Z(29," The cutting-edge AI that powers our generative material feature, turning simple text prompts into complex PBR textures."),J(),j(30,"li")(31,"strong"),Z(32,"Tailwind CSS:"),J(),Z(33," A utility-first CSS framework that allows for rapid, responsive UI development."),J()(),j(34,"p"),Z(35," We are constantly working to improve the tool and add new features. Thank you for being a part of our journey! "),J()()()()())},encapsulation:2,changeDetection:0});var Ap=bl;var MW=(n,e)=>e.question;function CW(n,e){if(n&1&&(j(0,"div",12)(1,"p"),Z(2),J()()),n&2){let t=ut().$implicit;de(2),Wn(t.answer)}}function wW(n,e){if(n&1){let t=En();j(0,"div",6)(1,"button",7),Mt("click",function(){let r=at(t).$implicit,o=ut();return lt(o.toggleFaq(r))}),j(2,"h2",8),Z(3),J(),j(4,"span",9),Zi(),j(5,"svg",10),Fn(6,"path",11),J()()(),jt(7,CW,3,1,"div",12),J()}if(n&2){let t=e.$implicit;de(3),Wn(t.question),de(2),Qn("rotate-180",t.open()),de(2),Zt(t.open()?7:-1)}}var Il=class Il{constructor(){this.faqs=Dt([this.createFaqItem("What file formats are supported?","Currently, we support .obj files for model import. Once you have customized your model, you can export the entire scene as a .glb file, which is a highly optimized format perfect for web and AR applications."),this.createFaqItem("Is this tool free to use?","Yes, the 3D Configurator is completely free for personal and commercial use. Our goal is to provide accessible tools for the entire creative community."),this.createFaqItem("What is AI Material Generation?",'This feature uses the Gemini API to interpret your text descriptions (e.g., "old cracked leather") and procedurally generates a full set of PBR (Physically-Based Rendering) texture maps, including color, normal, roughness, and metalness, to create a realistic material.'),this.createFaqItem("Do I need to install any software?","No. The entire application runs in your web browser. There is nothing to download or install. We recommend using an up-to-date version of a modern browser like Chrome, Firefox, or Edge for the best performance."),this.createFaqItem("Can I use the exported models in my game or project?","Absolutely! The exported .glb files are standard and can be used in most modern game engines (like Unity, Unreal Engine), 3D software (like Blender, 3ds Max), and web-based 3D frameworks.")])}createFaqItem(e,t){let i=Dt(!1);return{question:e,answer:t,open:i,toggle:()=>i.update(r=>!r)}}toggleFaq(e){e.toggle()}};Il.\u0275fac=function(t){return new(t||Il)},Il.\u0275cmp=Ln({type:Il,selectors:[["app-faq"]],decls:10,vars:0,consts:[[1,"bg-gray-900","py-16"],[1,"container","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"max-w-3xl","mx-auto","text-center"],[1,"text-4xl","font-extrabold","text-white","sm:text-5xl"],[1,"mt-4","text-xl","text-gray-300"],[1,"mt-12","max-w-3xl","mx-auto","space-y-4"],[1,"bg-gray-800","rounded-lg","shadow-md"],[1,"w-full","flex","justify-between","items-center","text-left","p-6",3,"click"],[1,"text-lg","font-medium","text-white"],[1,"text-indigo-400"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","transition-transform","duration-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"px-6","pb-6","text-gray-400"]],template:function(t,i){t&1&&(j(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Z(4,"Frequently Asked Questions"),J(),j(5,"p",4),Z(6," Have questions? We've got answers. "),J()(),j(7,"div",5),ha(8,wW,8,4,"div",6,MW),J()()()),t&2&&(de(8),pa(i.faqs()))},encapsulation:2,changeDetection:0});var Dp=Il;var Al=class Al{};Al.\u0275fac=function(t){return new(t||Al)},Al.\u0275cmp=Ln({type:Al,selectors:[["app-contact"]],decls:27,vars:0,consts:[[1,"bg-gray-900","py-16"],[1,"container","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"max-w-3xl","mx-auto","text-center"],[1,"text-4xl","font-extrabold","text-white","sm:text-5xl"],[1,"mt-4","text-xl","text-gray-300"],[1,"mt-12","max-w-lg","mx-auto","bg-gray-800","p-8","rounded-lg","shadow-lg"],[1,"space-y-6"],["for","name",1,"block","text-sm","font-medium","text-gray-300"],[1,"mt-1"],["type","text","name","name","id","name","autocomplete","name","placeholder","John Doe",1,"w-full","bg-gray-700","border","border-gray-600","rounded-md","px-3","py-2","text-white","placeholder-gray-400","focus:ring-indigo-500","focus:border-indigo-500"],["for","email",1,"block","text-sm","font-medium","text-gray-300"],["id","email","name","email","type","email","autocomplete","email","placeholder","you@example.com",1,"w-full","bg-gray-700","border","border-gray-600","rounded-md","px-3","py-2","text-white","placeholder-gray-400","focus:ring-indigo-500","focus:border-indigo-500"],["for","message",1,"block","text-sm","font-medium","text-gray-300"],["id","message","name","message","rows","4","placeholder","Your message here...",1,"w-full","bg-gray-700","border","border-gray-600","rounded-md","px-3","py-2","text-white","placeholder-gray-400","focus:ring-indigo-500","focus:border-indigo-500"],["type","submit",1,"w-full","flex","justify-center","py-3","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-indigo-600","hover:bg-indigo-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","focus:ring-offset-gray-800"]],template:function(t,i){t&1&&(j(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Z(4,"Get In Touch"),J(),j(5,"p",4),Z(6," We'd love to hear from you. Send us a message for support or feedback. "),J()(),j(7,"div",5)(8,"form",6)(9,"div")(10,"label",7),Z(11,"Full Name"),J(),j(12,"div",8),Fn(13,"input",9),J()(),j(14,"div")(15,"label",10),Z(16,"Email Address"),J(),j(17,"div",8),Fn(18,"input",11),J()(),j(19,"div")(20,"label",12),Z(21,"Message"),J(),j(22,"div",8),Fn(23,"textarea",13),J()(),j(24,"div")(25,"button",14),Z(26," Send Message "),J()()()()()())},encapsulation:2,changeDetection:0});var Rp=Al;var lI=[{path:"",component:Qf,title:"3D Viewer - Home"},{path:"configurator",component:Ip,title:"3D Configurator"},{path:"about",component:Ap,title:"About Us"},{path:"faq",component:Dp,title:"FAQ"},{path:"contact",component:Rp,title:"Contact Us"},{path:"**",redirectTo:"",pathMatch:"full"}];Dy(Kf,{providers:[py(),tv(lI,nv())]}).catch(n=>console.error(n));
